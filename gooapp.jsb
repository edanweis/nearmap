/* nearmap.com - current, clear, change - Copyright 2016 nearmap.com */
/* 8.11.0 6790577be7e78d0a8ec377e911ad3a835824693a */
function phi4z(a, b, c, d, e, f, g, h, i) {
    var j, k, l, m, n, o, i = f;
    for (o = 1; 15 >= o; o++)
        if (j = Math.sin(i),
        l = Math.tan(i),
        h = l * Math.sqrt(1 - a * j * j),
        k = Math.sin(2 * i),
        m = b * i - c * k + d * Math.sin(4 * i) - e * Math.sin(6 * i),
        n = b - 2 * c * Math.cos(2 * i) + 4 * d * Math.cos(4 * i) - 6 * e * Math.cos(6 * i),
        j = 2 * m + h * (m * m + g) - 2 * f * (h * m + 1),
        l = a * k * (m * m + g - 2 * f * m) / (2 * h),
        h = 2 * (f - m) * (h * n - 2 / k) - 2 * n,
        j /= l + h,
        i += j,
        1e-10 >= Math.abs(j))
            return i;
    return Proj4js.reportError("phi4z: No convergence"),
    null 
}
function e4fn(a) {
    var b;
    return b = 1 + a,
    a = 1 - a,
    Math.sqrt(Math.pow(b, b) * Math.pow(a, a))
}
!function(a, b) {
    "use strict";
    "function" == typeof define && define.amd ? define(b) : "object" == typeof exports ? module.exports = b() : a.returnExports = b()
}(this, function() {
    function a(a) {
        var b = +a;
        return b !== b ? b = 0 : 0 !== b && b !== 1 / 0 && b !== -(1 / 0) && (b = (b > 0 || -1) * Math.floor(Math.abs(b))),
        b
    }
    function b(a) {
        var b = typeof a;
        return null  === a || "undefined" === b || "boolean" === b || "number" === b || "string" === b
    }
    function c(a) {
        var c, d, e;
        if (b(a))
            return a;
        if (d = a.valueOf,
        p(d) && (c = d.call(a),
        b(c)))
            return c;
        if (e = a.toString,
        p(e) && (c = e.call(a),
        b(c)))
            return c;
        throw new TypeError
    }
    var d, e = Array.prototype, f = Object.prototype, g = Function.prototype, h = String.prototype, i = Number.prototype, j = e.slice, k = e.splice, l = e.push, m = e.unshift, n = g.call, o = f.toString, p = function(a) {
        return "[object Function]" === o.call(a)
    }
    , q = function(a) {
        return "[object RegExp]" === o.call(a)
    }
    , r = function(a) {
        return "[object Array]" === o.call(a)
    }
    , s = function(a) {
        return "[object String]" === o.call(a)
    }
    , t = function(a) {
        var b = o.call(a)
          , c = "[object Arguments]" === b;
        return c || (c = !r(a) && null  !== a && "object" == typeof a && "number" == typeof a.length && a.length >= 0 && p(a.callee)),
        c
    }
    , u = Object.defineProperty && function() {
        try {
            return Object.defineProperty({}, "x", {}),
            !0
        } catch (a) {
            return !1
        }
    }();
    d = u ? function(a, b, c, d) {
        !d && b in a || Object.defineProperty(a, b, {
            configurable: !0,
            enumerable: !1,
            writable: !0,
            value: c
        })
    }
     : function(a, b, c, d) {
        !d && b in a || (a[b] = c)
    }
    ;
    var v = function(a, b, c) {
        for (var e in b)
            f.hasOwnProperty.call(b, e) && d(a, e, b[e], c)
    }
      , w = {
        ToObject: function(a) {
            if (null  == a)
                throw new TypeError("can't convert " + a + " to object");
            return Object(a)
        },
        ToUint32: function(a) {
            return a >>> 0
        }
    }
      , x = function() {}
    ;
    v(g, {
        bind: function(a) {
            var b = this;
            if (!p(b))
                throw new TypeError("Function.prototype.bind called on incompatible " + b);
            for (var c, d = j.call(arguments, 1), e = function() {
                if (this instanceof c) {
                    var e = b.apply(this, d.concat(j.call(arguments)));
                    return Object(e) === e ? e : this
                }
                return b.apply(a, d.concat(j.call(arguments)))
            }
            , f = Math.max(0, b.length - d.length), g = [], h = 0; f > h; h++)
                g.push("$" + h);
            return c = Function("binder", "return function (" + g.join(",") + "){ return binder.apply(this, arguments); }")(e),
            b.prototype && (x.prototype = b.prototype,
            c.prototype = new x,
            x.prototype = null ),
            c
        }
    });
    var y = n.bind(f.hasOwnProperty)
      , z = function() {
        var a = [1, 2]
          , b = a.splice();
        return 2 === a.length && r(b) && 0 === b.length
    }();
    v(e, {
        splice: function(a, b) {
            return 0 === arguments.length ? [] : k.apply(this, arguments)
        }
    }, z);
    var A = function() {
        var a = {};
        return e.splice.call(a, 0, 0, 1),
        1 === a.length
    }();
    v(e, {
        splice: function(b, c) {
            if (0 === arguments.length)
                return [];
            var d = arguments;
            return this.length = Math.max(a(this.length), 0),
            arguments.length > 0 && "number" != typeof c && (d = j.call(arguments),
            d.length < 2 ? d.push(this.length - b) : d[1] = a(c)),
            k.apply(this, d)
        }
    }, !A);
    var B = 1 !== [].unshift(0);
    v(e, {
        unshift: function() {
            return m.apply(this, arguments),
            this.length
        }
    }, B),
    v(Array, {
        isArray: r
    });
    var C = Object("a")
      , D = "a" !== C[0] || !(0 in C)
      , E = function(a) {
        var b = !0
          , c = !0;
        return a && (a.call("foo", function(a, c, d) {
            "object" != typeof d && (b = !1)
        }),
        a.call([1], function() {
            "use strict";
            c = "string" == typeof this
        }, "x")),
        !!a && b && c
    }
    ;
    v(e, {
        forEach: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = arguments[1]
              , e = -1
              , f = c.length >>> 0;
            if (!p(a))
                throw new TypeError;
            for (; ++e < f; )
                e in c && a.call(d, c[e], e, b)
        }
    }, !E(e.forEach)),
    v(e, {
        map: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = c.length >>> 0
              , e = Array(d)
              , f = arguments[1];
            if (!p(a))
                throw new TypeError(a + " is not a function");
            for (var g = 0; d > g; g++)
                g in c && (e[g] = a.call(f, c[g], g, b));
            return e
        }
    }, !E(e.map)),
    v(e, {
        filter: function(a) {
            var b, c = w.ToObject(this), d = D && s(this) ? this.split("") : c, e = d.length >>> 0, f = [], g = arguments[1];
            if (!p(a))
                throw new TypeError(a + " is not a function");
            for (var h = 0; e > h; h++)
                h in d && (b = d[h],
                a.call(g, b, h, c) && f.push(b));
            return f
        }
    }, !E(e.filter)),
    v(e, {
        every: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = c.length >>> 0
              , e = arguments[1];
            if (!p(a))
                throw new TypeError(a + " is not a function");
            for (var f = 0; d > f; f++)
                if (f in c && !a.call(e, c[f], f, b))
                    return !1;
            return !0
        }
    }, !E(e.every)),
    v(e, {
        some: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = c.length >>> 0
              , e = arguments[1];
            if (!p(a))
                throw new TypeError(a + " is not a function");
            for (var f = 0; d > f; f++)
                if (f in c && a.call(e, c[f], f, b))
                    return !0;
            return !1
        }
    }, !E(e.some));
    var F = !1;
    e.reduce && (F = "object" == typeof e.reduce.call("es5", function(a, b, c, d) {
        return d
    })),
    v(e, {
        reduce: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = c.length >>> 0;
            if (!p(a))
                throw new TypeError(a + " is not a function");
            if (!d && 1 === arguments.length)
                throw new TypeError("reduce of empty array with no initial value");
            var e, f = 0;
            if (arguments.length >= 2)
                e = arguments[1];
            else
                for (; ; ) {
                    if (f in c) {
                        e = c[f++];
                        break
                    }
                    if (++f >= d)
                        throw new TypeError("reduce of empty array with no initial value")
                }
            for (; d > f; f++)
                f in c && (e = a.call(void 0, e, c[f], f, b));
            return e
        }
    }, !F);
    var G = !1;
    e.reduceRight && (G = "object" == typeof e.reduceRight.call("es5", function(a, b, c, d) {
        return d
    })),
    v(e, {
        reduceRight: function(a) {
            var b = w.ToObject(this)
              , c = D && s(this) ? this.split("") : b
              , d = c.length >>> 0;
            if (!p(a))
                throw new TypeError(a + " is not a function");
            if (!d && 1 === arguments.length)
                throw new TypeError("reduceRight of empty array with no initial value");
            var e, f = d - 1;
            if (arguments.length >= 2)
                e = arguments[1];
            else
                for (; ; ) {
                    if (f in c) {
                        e = c[f--];
                        break
                    }
                    if (--f < 0)
                        throw new TypeError("reduceRight of empty array with no initial value")
                }
            if (0 > f)
                return e;
            do
                f in c && (e = a.call(void 0, e, c[f], f, b));
            while (f--);return e
        }
    }, !G);
    var H = Array.prototype.indexOf && -1 !== [0, 1].indexOf(1, 2);
    v(e, {
        indexOf: function(b) {
            var c = D && s(this) ? this.split("") : w.ToObject(this)
              , d = c.length >>> 0;
            if (!d)
                return -1;
            var e = 0;
            for (arguments.length > 1 && (e = a(arguments[1])),
            e = e >= 0 ? e : Math.max(0, d + e); d > e; e++)
                if (e in c && c[e] === b)
                    return e;
            return -1
        }
    }, H);
    var I = Array.prototype.lastIndexOf && -1 !== [0, 1].lastIndexOf(0, -3);
    v(e, {
        lastIndexOf: function(b) {
            var c = D && s(this) ? this.split("") : w.ToObject(this)
              , d = c.length >>> 0;
            if (!d)
                return -1;
            var e = d - 1;
            for (arguments.length > 1 && (e = Math.min(e, a(arguments[1]))),
            e = e >= 0 ? e : d - Math.abs(e); e >= 0; e--)
                if (e in c && b === c[e])
                    return e;
            return -1
        }
    }, I);
    var J = !{
        toString: null 
    }.propertyIsEnumerable("toString")
      , K = function() {}
    .propertyIsEnumerable("prototype")
      , L = ["toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor"]
      , M = L.length;
    v(Object, {
        keys: function(a) {
            var b = p(a)
              , c = t(a)
              , d = null  !== a && "object" == typeof a
              , e = d && s(a);
            if (!d && !b && !c)
                throw new TypeError("Object.keys called on a non-object");
            var f = []
              , g = K && b;
            if (e || c)
                for (var h = 0; h < a.length; ++h)
                    f.push(String(h));
            else
                for (var i in a)
                    g && "prototype" === i || !y(a, i) || f.push(String(i));
            if (J)
                for (var j = a.constructor, k = j && j.prototype === a, l = 0; M > l; l++) {
                    var m = L[l];
                    k && "constructor" === m || !y(a, m) || f.push(m)
                }
            return f
        }
    });
    var N = Object.keys && function() {
        return 2 === Object.keys(arguments).length
    }(1, 2)
      , O = Object.keys;
    v(Object, {
        keys: function(a) {
            return O(t(a) ? e.slice.call(a) : a)
        }
    }, !N);
    var P = -621987552e5
      , Q = "-000001"
      , R = Date.prototype.toISOString && -1 === new Date(P).toISOString().indexOf(Q);
    v(Date.prototype, {
        toISOString: function() {
            var a, b, c, d, e;
            if (!isFinite(this))
                throw new RangeError("Date.prototype.toISOString called on non-finite value.");
            for (d = this.getUTCFullYear(),
            e = this.getUTCMonth(),
            d += Math.floor(e / 12),
            e = (e % 12 + 12) % 12,
            a = [e + 1, this.getUTCDate(), this.getUTCHours(), this.getUTCMinutes(), this.getUTCSeconds()],
            d = (0 > d ? "-" : d > 9999 ? "+" : "") + ("00000" + Math.abs(d)).slice(d >= 0 && 9999 >= d ? -4 : -6),
            b = a.length; b--; )
                c = a[b],
                10 > c && (a[b] = "0" + c);
            return d + "-" + a.slice(0, 2).join("-") + "T" + a.slice(2).join(":") + "." + ("000" + this.getUTCMilliseconds()).slice(-3) + "Z"
        }
    }, R);
    var S = !1;
    try {
        S = Date.prototype.toJSON && null  === new Date(NaN).toJSON() && -1 !== new Date(P).toJSON().indexOf(Q) && Date.prototype.toJSON.call({
            toISOString: function() {
                return !0
            }
        })
    } catch (T) {}
    S || (Date.prototype.toJSON = function(a) {
        var b, d = Object(this), e = c(d);
        if ("number" == typeof e && !isFinite(e))
            return null ;
        if (b = d.toISOString,
        "function" != typeof b)
            throw new TypeError("toISOString property is not callable");
        return b.call(d)
    }
    );
    var U = 1e15 === Date.parse("+033658-09-27T01:46:40.000Z")
      , V = !isNaN(Date.parse("2012-04-04T24:00:00.500Z")) || !isNaN(Date.parse("2012-11-31T23:59:59.000Z"))
      , W = isNaN(Date.parse("2000-01-01T00:00:00.000Z"));
    Date.parse && !W && !V && U || (Date = function(a) {
        function b(c, d, e, f, g, h, i) {
            var j = arguments.length;
            if (this instanceof a) {
                var k = 1 === j && String(c) === c ? new a(b.parse(c)) : j >= 7 ? new a(c,d,e,f,g,h,i) : j >= 6 ? new a(c,d,e,f,g,h) : j >= 5 ? new a(c,d,e,f,g) : j >= 4 ? new a(c,d,e,f) : j >= 3 ? new a(c,d,e) : j >= 2 ? new a(c,d) : j >= 1 ? new a(c) : new a;
                return k.constructor = b,
                k
            }
            return a.apply(this, arguments)
        }
        function c(a, b) {
            var c = b > 1 ? 1 : 0;
            return f[b] + Math.floor((a - 1969 + c) / 4) - Math.floor((a - 1901 + c) / 100) + Math.floor((a - 1601 + c) / 400) + 365 * (a - 1970)
        }
        function d(b) {
            return Number(new a(1970,0,1,0,0,0,b))
        }
        var e = new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$")
          , f = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];
        for (var g in a)
            b[g] = a[g];
        return b.now = a.now,
        b.UTC = a.UTC,
        b.prototype = a.prototype,
        b.prototype.constructor = b,
        b.parse = function(b) {
            var f = e.exec(b);
            if (f) {
                var g, h = Number(f[1]), i = Number(f[2] || 1) - 1, j = Number(f[3] || 1) - 1, k = Number(f[4] || 0), l = Number(f[5] || 0), m = Number(f[6] || 0), n = Math.floor(1e3 * Number(f[7] || 0)), o = Boolean(f[4] && !f[8]), p = "-" === f[9] ? 1 : -1, q = Number(f[10] || 0), r = Number(f[11] || 0);
                return (l > 0 || m > 0 || n > 0 ? 24 : 25) > k && 60 > l && 60 > m && 1e3 > n && i > -1 && 12 > i && 24 > q && 60 > r && j > -1 && j < c(h, i + 1) - c(h, i) && (g = 60 * (24 * (c(h, i) + j) + k + q * p),
                g = 1e3 * (60 * (g + l + r * p) + m) + n,
                o && (g = d(g)),
                g >= -864e13 && 864e13 >= g) ? g : NaN
            }
            return a.parse.apply(this, arguments)
        }
        ,
        b
    }(Date)),
    Date.now || (Date.now = function() {
        return (new Date).getTime()
    }
    );
    var X = i.toFixed && ("0.000" !== 8e-5.toFixed(3) || "1" !== .9.toFixed(0) || "1.25" !== 1.255.toFixed(2) || "1000000000000000128" !== 0xde0b6b3a7640080.toFixed(0))
      , Y = {
        base: 1e7,
        size: 6,
        data: [0, 0, 0, 0, 0, 0],
        multiply: function(a, b) {
            for (var c = -1; ++c < Y.size; )
                b += a * Y.data[c],
                Y.data[c] = b % Y.base,
                b = Math.floor(b / Y.base)
        },
        divide: function(a) {
            for (var b = Y.size, c = 0; --b >= 0; )
                c += Y.data[b],
                Y.data[b] = Math.floor(c / a),
                c = c % a * Y.base
        },
        numToString: function() {
            for (var a = Y.size, b = ""; --a >= 0; )
                if ("" !== b || 0 === a || 0 !== Y.data[a]) {
                    var c = String(Y.data[a]);
                    "" === b ? b = c : b += "0000000".slice(0, 7 - c.length) + c
                }
            return b
        },
        pow: function ia(a, b, c) {
            return 0 === b ? c : b % 2 === 1 ? ia(a, b - 1, c * a) : ia(a * a, b / 2, c)
        },
        log: function(a) {
            for (var b = 0; a >= 4096; )
                b += 12,
                a /= 4096;
            for (; a >= 2; )
                b += 1,
                a /= 2;
            return b
        }
    };
    v(i, {
        toFixed: function(a) {
            var b, c, d, e, f, g, h, i;
            if (b = Number(a),
            b = b !== b ? 0 : Math.floor(b),
            0 > b || b > 20)
                throw new RangeError("Number.toFixed called with invalid number of decimals");
            if (c = Number(this),
            c !== c)
                return "NaN";
            if (-1e21 >= c || c >= 1e21)
                return String(c);
            if (d = "",
            0 > c && (d = "-",
            c = -c),
            e = "0",
            c > 1e-21)
                if (f = Y.log(c * Y.pow(2, 69, 1)) - 69,
                g = 0 > f ? c * Y.pow(2, -f, 1) : c / Y.pow(2, f, 1),
                g *= 4503599627370496,
                f = 52 - f,
                f > 0) {
                    for (Y.multiply(0, g),
                    h = b; h >= 7; )
                        Y.multiply(1e7, 0),
                        h -= 7;
                    for (Y.multiply(Y.pow(10, h, 1), 0),
                    h = f - 1; h >= 23; )
                        Y.divide(1 << 23),
                        h -= 23;
                    Y.divide(1 << h),
                    Y.multiply(1, 1),
                    Y.divide(2),
                    e = Y.numToString()
                } else
                    Y.multiply(0, g),
                    Y.multiply(1 << -f, 0),
                    e = Y.numToString() + "0.00000000000000000000".slice(2, 2 + b);
            return b > 0 ? (i = e.length,
            e = b >= i ? d + "0.0000000000000000000".slice(0, b - i + 2) + e : d + e.slice(0, i - b) + "." + e.slice(i - b)) : e = d + e,
            e
        }
    }, X);
    var Z = h.split;
    2 !== "ab".split(/(?:ab)*/).length || 4 !== ".".split(/(.?)(.?)/).length || "t" === "tesst".split(/(s)*/)[1] || 4 !== "test".split(/(?:)/, -1).length || "".split(/.?/).length || ".".split(/()()/).length > 1 ? !function() {
        var a = "undefined" == typeof /()??/.exec("")[1];
        h.split = function(b, c) {
            var d = this;
            if ("undefined" == typeof b && 0 === c)
                return [];
            if ("[object RegExp]" !== o.call(b))
                return Z.call(this, b, c);
            var e, f, g, h, i = [], j = (b.ignoreCase ? "i" : "") + (b.multiline ? "m" : "") + (b.extended ? "x" : "") + (b.sticky ? "y" : ""), k = 0;
            for (b = new RegExp(b.source,j + "g"),
            d += "",
            a || (e = new RegExp("^" + b.source + "$(?!\\s)",j)),
            c = "undefined" == typeof c ? -1 >>> 0 : w.ToUint32(c); (f = b.exec(d)) && (g = f.index + f[0].length,
            !(g > k && (i.push(d.slice(k, f.index)),
            !a && f.length > 1 && f[0].replace(e, function() {
                for (var a = 1; a < arguments.length - 2; a++)
                    "undefined" == typeof arguments[a] && (f[a] = void 0)
            }),
            f.length > 1 && f.index < d.length && l.apply(i, f.slice(1)),
            h = f[0].length,
            k = g,
            i.length >= c))); )
                b.lastIndex === f.index && b.lastIndex++;
            return k === d.length ? !h && b.test("") || i.push("") : i.push(d.slice(k)),
            i.length > c ? i.slice(0, c) : i
        }
    }() : "0".split(void 0, 0).length && (h.split = function(a, b) {
        return "undefined" == typeof a && 0 === b ? [] : Z.call(this, a, b)
    }
    );
    var $ = h.replace
      , _ = function() {
        var a = [];
        return "x".replace(/x(.)?/g, function(b, c) {
            a.push(c)
        }),
        1 === a.length && "undefined" == typeof a[0]
    }();
    _ || (h.replace = function(a, b) {
        var c = p(b)
          , d = q(a) && /\)[*?]/.test(a.source);
        if (c && d) {
            var e = function(c) {
                var d = arguments.length
                  , e = a.lastIndex;
                a.lastIndex = 0;
                var f = a.exec(c) || [];
                return a.lastIndex = e,
                f.push(arguments[d - 2], arguments[d - 1]),
                b.apply(this, f)
            }
            ;
            return $.call(this, a, e)
        }
        return $.call(this, a, b)
    }
    );
    var aa = h.substr
      , ba = "".substr && "b" !== "0b".substr(-1);
    v(h, {
        substr: function(a, b) {
            return aa.call(this, 0 > a && (a = this.length + a) < 0 ? 0 : a, b)
        }
    }, ba);
    var ca = "	\n\x0B\f\r   ᠎             　\u2028\u2029\ufeff"
      , da = "​"
      , ea = "[" + ca + "]"
      , fa = new RegExp("^" + ea + ea + "*")
      , ga = new RegExp(ea + ea + "*$")
      , ha = h.trim && (ca.trim() || !da.trim());
    v(h, {
        trim: function() {
            if ("undefined" == typeof this || null  === this)
                throw new TypeError("can't convert " + this + " to object");
            return String(this).replace(fa, "").replace(ga, "")
        }
    }, ha),
    8 === parseInt(ca + "08") && 22 === parseInt(ca + "0x16") || (parseInt = function(a) {
        var b = /^0[xX]/;
        return function(c, d) {
            return c = String(c).trim(),
            Number(d) || (d = b.test(c) ? 16 : 10),
            a(c, d)
        }
    }(parseInt))
}),
function(a, b) {
    "use strict";
    "function" == typeof define && define.amd ? define(b) : "object" == typeof exports ? module.exports = b() : a.returnExports = b()
}(this, function() {
    function a(a) {
        try {
            return a.sentinel = 0,
            0 === Object.getOwnPropertyDescriptor(a, "sentinel").value
        } catch (b) {}
    }
    function b(a) {
        try {
            return Object.defineProperty(a, "sentinel", {}),
            "sentinel" in a
        } catch (b) {}
    }
    var c, d, e, f, g = Function.prototype.call, h = Object.prototype, i = g.bind(h.hasOwnProperty), j = i(h, "__defineGetter__");
    if (j && (c = g.bind(h.__defineGetter__),
    d = g.bind(h.__defineSetter__),
    e = g.bind(h.__lookupGetter__),
    f = g.bind(h.__lookupSetter__)),
    Object.getPrototypeOf || (Object.getPrototypeOf = function(a) {
        var b = a.__proto__;
        return b || null  === b ? b : a.constructor ? a.constructor.prototype : h
    }
    ),
    Object.defineProperty) {
        var k = a({})
          , l = "undefined" == typeof document || a(document.createElement("div"));
        if (!l || !k)
            var m = Object.getOwnPropertyDescriptor
    }
    if (!Object.getOwnPropertyDescriptor || m) {
        var n = "Object.getOwnPropertyDescriptor called on a non-object: ";
        Object.getOwnPropertyDescriptor = function(a, b) {
            if ("object" != typeof a && "function" != typeof a || null  === a)
                throw new TypeError(n + a);
            if (m)
                try {
                    return m.call(Object, a, b)
                } catch (c) {}
            if (i(a, b)) {
                var d = {
                    enumerable: !0,
                    configurable: !0
                };
                if (j) {
                    var g = a.__proto__
                      , k = a !== h;
                    k && (a.__proto__ = h);
                    var l = e(a, b)
                      , o = f(a, b);
                    if (k && (a.__proto__ = g),
                    l || o)
                        return l && (d.get = l),
                        o && (d.set = o),
                        d
                }
                return d.value = a[b],
                d.writable = !0,
                d
            }
        }
    }
    if (Object.getOwnPropertyNames || (Object.getOwnPropertyNames = function(a) {
        return Object.keys(a)
    }
    ),
    !Object.create) {
        var o, p = !({
            __proto__: null 
        } instanceof Object);
        o = p || "undefined" == typeof document ? function() {
            return {
                __proto__: null 
            }
        }
         : function() {
            function a() {}
            var b = document.createElement("iframe")
              , c = document.body || document.documentElement;
            b.style.display = "none",
            c.appendChild(b),
            b.src = "javascript:";
            var d = b.contentWindow.Object.prototype;
            return c.removeChild(b),
            b = null ,
            delete d.constructor,
            delete d.hasOwnProperty,
            delete d.propertyIsEnumerable,
            delete d.isPrototypeOf,
            delete d.toLocaleString,
            delete d.toString,
            delete d.valueOf,
            d.__proto__ = null ,
            a.prototype = d,
            o = function() {
                return new a
            }
            ,
            new a
        }
        ,
        Object.create = function(a, b) {
            function c() {}
            var d;
            if (null  === a)
                d = o();
            else {
                if ("object" != typeof a && "function" != typeof a)
                    throw new TypeError("Object prototype may only be an Object or null");
                c.prototype = a,
                d = new c,
                d.__proto__ = a
            }
            return void 0 !== b && Object.defineProperties(d, b),
            d
        }
    }
    if (Object.defineProperty) {
        var q = b({})
          , r = "undefined" == typeof document || b(document.createElement("div"));
        if (!q || !r)
            var s = Object.defineProperty
              , t = Object.defineProperties
    }
    if (!Object.defineProperty || s) {
        var u = "Property description must be an object: "
          , v = "Object.defineProperty called on non-object: "
          , w = "getters & setters can not be defined on this javascript engine";
        Object.defineProperty = function(a, b, g) {
            if ("object" != typeof a && "function" != typeof a || null  === a)
                throw new TypeError(v + a);
            if ("object" != typeof g && "function" != typeof g || null  === g)
                throw new TypeError(u + g);
            if (s)
                try {
                    return s.call(Object, a, b, g)
                } catch (k) {}
            if (i(g, "value"))
                if (j && (e(a, b) || f(a, b))) {
                    var l = a.__proto__;
                    a.__proto__ = h,
                    delete a[b],
                    a[b] = g.value,
                    a.__proto__ = l
                } else
                    a[b] = g.value;
            else {
                if (!j)
                    throw new TypeError(w);
                i(g, "get") && c(a, b, g.get),
                i(g, "set") && d(a, b, g.set)
            }
            return a
        }
    }
    Object.defineProperties && !t || (Object.defineProperties = function(a, b) {
        if (t)
            try {
                return t.call(Object, a, b)
            } catch (c) {}
        for (var d in b)
            i(b, d) && "__proto__" !== d && Object.defineProperty(a, d, b[d]);
        return a
    }
    ),
    Object.seal || (Object.seal = function(a) {
        return a
    }
    ),
    Object.freeze || (Object.freeze = function(a) {
        return a
    }
    );
    try {
        Object.freeze(function() {})
    } catch (x) {
        Object.freeze = function(a) {
            return function(b) {
                return "function" == typeof b ? b : a(b)
            }
        }(Object.freeze)
    }
    Object.preventExtensions || (Object.preventExtensions = function(a) {
        return a
    }
    ),
    Object.isSealed || (Object.isSealed = function(a) {
        return !1
    }
    ),
    Object.isFrozen || (Object.isFrozen = function(a) {
        return !1
    }
    ),
    Object.isExtensible || (Object.isExtensible = function(a) {
        if (Object(a) !== a)
            throw new TypeError;
        for (var b = ""; i(a, b); )
            b += "?";
        a[b] = !0;
        var c = i(a, b);
        return delete a[b],
        c
    }
    )
});
var nm_module = {};
(function(a) {
    function b(a, b) {
        if (".js" !== a.slice(-3) && -1 === a.indexOf("//")) {
            var c = f[a];
            if ("undefined" == typeof c)
                throw new Error("Module not loaded: " + a);
            if ("undefined" != typeof b && (c = c[b],
            "undefined" == typeof c))
                throw new Error('Module "' + a + '" does not export: ' + b);
            return c
        }
    }
    function c(a, b) {
        var c = b.constructor
          , d = function() {}
        ;
        d.prototype = a.prototype,
        c.prototype = new d,
        c.base = a,
        c.__id = "&" + e++,
        c.toString = function() {
            return "<class " + this.__name + ">"
        }
        ;
        for (var f in b)
            b.hasOwnProperty(f) && (c.prototype[f] = b[f]);
        return c.prototype.constructor = b.constructor,
        c
    }
    function d(a, d) {
        function e(c, d) {
            if ("." === c.slice(0, 1)) {
                c.split(".");
                var e = a.split("/").slice(0, -1).concat(c.split("/"));
                c = [];
                for (var f, g = e[Symbol.iterator](); !(f = g.next()).done; ) {
                    var h = f.value;
                    ".." === h ? c.pop() : "." !== h && c.push(h)
                }
                c = c.join("/")
            }
            return b(c, d)
        }
        a = a.replace(/\./g, "/");
        var g = {
            toString: function() {
                return "<module " + a + ">"
            }
        };
        f[a] = g,
        d(g, e, c, Symbol)
    }
    var e = 0
      , f = {}
      , g = this;
    "undefined" == typeof Symbol && (g.Symbol = function(a) {
        return a = "@@" + a,
        {
            toString: function() {
                return a
            }
        }
    }
    ,
    Symbol.iterator = Symbol("iterator"));
    var h = Array.prototype;
    if ("undefined" == typeof h[Symbol.iterator]) {
        var i = c(Object, {
            constructor: function(a) {
                this.values = a,
                this.index = 0
            },
            next: function() {
                var a = this.values
                  , b = this.index;
                return this.index += 1,
                {
                    value: a[b],
                    done: a.length <= b
                }
            }
        });
        i.prototype[Symbol.iterator] = function() {
            return this
        }
        ,
        h[Symbol.iterator] = function() {
            return new i(this)
        }
    }
    var j = String.prototype;
    "undefined" == typeof j[Symbol.iterator] && (j[Symbol.iterator] = function() {
        return new i(this)
    }
    );
    var k = Function.prototype;
    "undefined" == typeof k.bind && (k.bind = function(a) {
        var b = Array.prototype.slice.call(arguments, 1)
          , c = this;
        return function() {
            var d = Array.prototype.slice.call(arguments, 0);
            return c.apply(a, b.concat(d))
        }
    }
    ),
    a.register = d
}
).call(this, nm_module),
nm_module = nm_module.register,
nm_module("nm/dataproviders/fake-auth", function(a, b, c, d) {
    a.FakeAuthData = {
        IncidentId: null ,
        AccountContext: {
            AccountId: "freeuser",
            Username: "freeuser"
        },
        Result: {
            AccessResult: {
                Status: "Ok",
                AuthenticationRequiredReason: null ,
                Username: "freeuser@nearmap.com",
                AccountId: "freeuser",
                Ticket: null ,
                Expires: "/Date(-62135596800000+0000)/",
                CookieName: null 
            },
            LimitsResult: {
                PeriodStart: "/Date(1409529600000)/",
                PeriodEnd: "/Date(1412121600000)/",
                AccountId: "freeuser",
                Rollup: {
                    Status: "Ok",
                    Usage: 0,
                    Limit: 1,
                    HasUnlimitedUsers: !0,
                    NumberOfLicencedSeats: 1,
                    NumberOfUsedSeats: 1,
                    PropertyReportsUsage: 0,
                    PropertyReportsLimit: 1,
                    SourcePhotosUsage: 0,
                    SourcePhotosLimit: 1
                },
                Balances: [{
                    CounterName: "MultiViewBytes",
                    Usage: 0
                }, {
                    CounterName: "PhotoMapBytes",
                    Usage: 0
                }, {
                    CounterName: "TerrainBytes",
                    Usage: 0
                }],
                EnforceUsageLimit: !1,
                NotifyUsageLimit: !1
            },
            Account: {
                Version: "0",
                Id: "freeuser",
                Name: "Free User",
                Title: null ,
                FirstName: "Free",
                LastName: "User",
                Keys: ["access_country", "area_us", "feature_autotrack", "feature_centremap", "feature_circle", "feature_compare_tool", "feature_disable_tour", "feature_elevation", "feature_email_capture", "feature_latlon", "feature_location_info", "feature_nocommingling", "feature_use_discovery", "feature_property_info", "feature_reverse_geocode", "feature_satellite", "feature_solidmap", "feature_streetmap", "feature_streetview", "feature_timeline_autoplay", "feature_timestamp", "hide_feature_parti_property_info", "hide_feature_rail", "hide_feature_volume_tool", "max_zoom_24", "measurement", "multiview", "product_googlemapbrowser", "terrain", "unlimited_points_polygon"].join(","),
                PackageIds: "discover,area_us",
                PlanCode: "discover",
                Status: "Active",
                LimitedReason: null ,
                InactiveReason: null ,
                AccountClass: "SelfManaged",
                LicenceInfo: null ,
                TsAndCsInfo: "USv1.0",
                DidAcceptCoverageDoc: !0,
                WebData: null ,
                Culture: "en-US",
                Region: null ,
                Currency: "USD",
                IsTrial: !1,
                AccountStates: "area_us",
                ShowAccountPage: !1,
                Administrators: [{
                    Id: 0,
                    Title: null ,
                    FirstName: "Test no newsletter",
                    LastName: "checkbox hello",
                    Email: "freeuser@nearmap.com",
                    Phone: null 
                }],
                Email: "freeuser@nearmap.com",
                ShowTsAndCs: !1
            }
        }
    }
}),
nm_module("nm/client", function(a, b, c, d) {
    var e = a.parseOS = function() {
        var a, b = navigator.userAgent;
        return a = {
            windows: /\(Windows/i.test(b),
            mac: /\((Macintosh|Mac);/i.test(b),
            linux: /; Linux/i.test(b),
            iPhone: /\(iPhone;/i.test(b),
            iPod: /\(iPod;/i.test(b),
            iPad: /\(iPad;/i.test(b),
            android: /\Android;/i.test(b),
            blackBerry: /\BlackBerry;/i.test(b),
            operaMini: /\Opera Mini;/i.test(b),
            windowsMobile: /\IEMobile;/i.test(b)
        },
        a.iOS = a.iPhone || a.iPod || a.iPad,
        a
    }
      , f = (a.parseBrowser = function() {
        var a, b, c, d = navigator.userAgent;
        return c = {
            mozilla: /Gecko\//i.test(navigator.userAgent),
            chrome: /Chrome\//i.test(navigator.appVersion),
            safari: /AppleWebKit.+Version.+/i.test(navigator.appVersion),
            opera: /Opera/i.test(navigator.userAgent),
            msie: !1
        },
        c.mozilla ? (a = d.match(/rv:(\d+[\.\d*]*)/),
        a.length > 1 ? (b = a[1].split("."),
        c.majorVersion = b[0] + "." + (b.length > 1 ? b[1] : 0),
        c.minorVersion = (b.length > 2 ? b[2] : 0) + (b.length > 3 ? "." + b[3] : "")) : (c.majorVersion = 0,
        c.minorVersion = 0)) : c.chrome ? (a = navigator.appVersion.match(/Chrome\/(\d+[\.\d*]*)/),
        a.length > 1 ? (b = a[1].split("."),
        c.majorVersion = b[0] + "." + (b.length > 1 ? b[1] : 0),
        c.minorVersion = (b.length > 2 ? b[2] : 0) + (b.length > 3 ? "." + b[3] : "")) : (c.majorVersion = 0,
        c.minorVersion = 0)) : c.safari ? (a = navigator.appVersion.match(/Version\/(\d+[\.\d*]*)/),
        a.length > 1 ? (b = a[1].split("."),
        c.majorVersion = b[0],
        c.minorVersion = (b.length > 1 ? b[1] : 0) + (b.length > 2 ? "." + b[2] : "")) : (c.majorVersion = 0,
        c.minorVersion = 0)) : c.opera ? (a = d.match(/Opera\/(\d+[\.\d*]*)/),
        a.length > 1 ? (b = a[1].split("."),
        c.majorVersion = b[0],
        c.minorVersion = b[1]) : (c.majorVersion = 0,
        c.minorVersion = 0)) : c.msie ? (a = d.match(/MSIE (\d+[\.\d*]*)/),
        a.length > 1 ? (b = a[1].split("."),
        c.majorVersion = b[0],
        c.minorVersion = b[1]) : (c.majorVersion = 0,
        c.minorVersion = 0)) : (c.majorVersion = 0,
        c.minorVersion = 0),
        c
    }
    ,
    a.isTouchDevice = function() {
        return "ontouchstart" in window || navigator.msMaxTouchPoints > 0
    }
    );
    a.isTabletDevice = function() {
        var a = Math.max(screen.width, screen.height)
          , b = Math.min(screen.width, screen.height)
          , c = a >= 900 && b >= 600 || a >= 600 && b >= 900;
        return e().iOS || e().android || c && f()
    }
    ,
    a.hasSupportForTypedArrays = function() {
        return "undefined" != typeof Uint8Array
    }
}),
nm_module("nm/const", function(a, b, c, d) {
    var e = (a.API_VERSION = null ,
    a.DEBUG_KEY = "db",
    a.NMQ_KEY = "nmq",
    a.LATLNG_KEY = "ll",
    a.TILE_DATE_KEY = "nmd",
    a.LAYER_KEY = "nml",
    a.ZOOM_KEY = "z",
    a.SEARCH_QUERY_KEY = "q",
    a.SPAN_KEY = "spn",
    a.MAPTYPE_KEY = "t",
    a.OVERLAY_KEY = "ov",
    a.MAX_HOSTS_KEY = "mh",
    a.OUTPUT_KEY = "output",
    a.ADDRESS_QUERY_KEY = "addr",
    a.PRINT_MODE_KEY = "pw",
    a.UI_KEY = "ui",
    a.MESSAGE_KEY = "news20130703",
    a.SURVEY_NOTIF_EMAIL = "sne",
    a.LICENCE_KEY = "l",
    a.ACCEPTED_KEY = "a",
    a.GOOGLE_SAT_KEY = "Satellite",
    a.VERT_KEY = "k",
    a.STREETMAP_KEY = "h",
    a.VOLUME_SOFT_LIMIT_KEY = "vsl",
    a.UNHIDE_ICONS_KEY = "unhide-icons-2",
    a.ENABLE_LOG = !0,
    a.ENABLE_TC_UPDATE = !0,
    a.ENABLE_LOCAL_STORAGE = !0,
    a.PKG_KEY_NB_POINTS_POLYGON = 4,
    a.DEFAULT_ZOOM = 4,
    a.ZOOM_LEVEL_BLUE_MARBLE_START = 5,
    a.MINIMUM_ZOOM_LEVEL_MULTIVIEW = 14,
    a.BLUE_MARBLE_YEAR = 2004,
    a.GOOGLE_SAT_LEVEL = 10,
    a.SIMPLE_MODE = "sm",
    a.DEFAULT_TILE_SIZE = 256,
    a.TILE_INFO_DELAY = 500,
    a.REDIRECTION_TIMEOUT = 15e3,
    a.VERT_NAME = "nmPhotoMap",
    a.GOOGLE_STREET_MAP = "Street Maps",
    a.MAP_STATE_COOKIE = "MAP",
    a.SESSION_COOKIE_EXPIRES = 3e5,
    a.SESSION_COOKIE_CHECK_BEFORE = 6e4,
    a.NO_PRINT = "nmnoprint",
    a.HOST_URL = "/")
      , f = (a.TILE_HOST = location.hostname.replace("maps.", "") + (location.port ? ":" + location.port : ""),
    a.GET_SESSION_URL = "/maps/?nmq=getsession",
    a.STATIC_ASSETS_URL = "./static/maps/api-assets/")
      , g = (a.TRANSPARENT_GIF = f + "img/transparent1x1.gif",
    a.TILE_INFO_URL_JSON = e + "maps/?x={X}&y={Y}&z={Z}&nmq=INFO&return200=true&bbox={B}&s={S}&httpauth=false&nmf=json");
    a.TILE_INFO_URL_JSONP = g + "&nmjsonp=?",
    a.MetresInKilometres = 1e3,
    a.DATE_FORMAT = "yyyymmdd",
    a.DEPTH = "depth",
    a.HEIGHT = "height",
    a.HEIGHT_DEPTH = "height_depth"
}),
nm_module("nm/urls", function(a, b, c, d) {
    a.encodeURIComponent = encodeURIComponent,
    a.decodeURIComponent = decodeURIComponent;
    a.formatUrl = function(a, b, c) {
        var d, e = b.length, f = /\?/.test(a);
        for (d = 0; e > d; d++)
            f ? a += "&" + b[d] : (a += "?" + b[d],
            f = !0);
        return c && (a = a.replace(/&/g, "&amp;")),
        a
    }
}),
nm_module("nm/http", function(a, b, c, d) {
    function e(a) {
        var b, c, d = a.split("&"), e = {};
        for (c = 0; c < d.length; c++)
            b = d[c].indexOf("="),
            b > 0 && (e[d[c].substring(0, b)] = g(d[c].substring(b + 1)));
        return e
    }
    function f(a) {
        var b = a.match(/\?(.+)/);
        return b && b.length >= 2 ? e(b[1]) : {}
    }
    var g = b("nm/urls", "decodeURIComponent");
    a.Request = c(Object, {
        constructor: function(a) {
            this._url = a || "",
            this._query = f(a)
        },
        getValue: function(a) {
            return this._query[a] || null 
        },
        getHostname: function() {
            var a = new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im");
            return this._url.match(a)[1].toString()
        },
        param: function(a) {
            var b, c, d, e = [], f = !1;
            if (a instanceof Array)
                for (b = a.length,
                c = 0; b > c; c++)
                    e.push((f ? "&" : "") + encodeURIComponent(a[c].name) + "=" + encodeURIComponent(a[c].value)),
                    f = !0;
            else
                for (d in a)
                    a.hasOwnProperty(d) && (e.push((f ? "&" : "") + encodeURIComponent(d) + "=" + encodeURIComponent(a[d])),
                    f = !0);
            return e.join("")
        }
    })
}),
nm_module("nm/console", function(a, b, c, d) {
    function e() {
        return "undefined" != typeof console
    }
    function f() {
        return {
            time: (new Date).toGMTString(),
            url: window.location.href,
            browser: g(),
            os: h(),
            touch_device: i(),
            api: j,
            db_level: t,
            check_access: void 0,
            account_id: void 0,
            account: void 0
        }
    }
    var g = b("nm/client", "parseBrowser")
      , h = b("nm/client", "parseOS")
      , i = b("nm/client", "isTouchDevice")
      , j = b("nm/const", "API_VERSION")
      , k = b("nm/const", "DEBUG_KEY")
      , l = b("nm/const", "ENABLE_LOG")
      , m = b("nm/http", "Request")
      , n = 0
      , o = !1
      , p = []
      , q = !1
      , r = "\n"
      , s = new m(window.location.href)
      , t = s.getValue(k)
      , u = a.disableDebug = function() {
        o = !1
    }
      , v = a.cmd = function(a) {
        if (l && e() && (o || t > 0)) {
            var b = Array.prototype.slice.call(arguments)
              , c = window.console
              , d = (new Date).toLocaleString()
              , g = ("nmlog " + n++ + " [" + a + "]: \n").toUpperCase();
            b.splice(0, 1),
            b.unshift(d),
            b.unshift(g),
            q || (b.push("\nCONTEXT:\n", f()),
            q = !0),
            b.push(r);
            try {
                c[a.toLowerCase()].apply(c, b)
            } catch (h) {
                "debug" !== a || c.hasOwnProperty(a) || (a = "log"),
                c[a](b.join(" "))
            }
            u(),
            p = p.concat(b)
        }
    }
      , w = a.log = function() {
        var a = Array.prototype.slice.call(arguments);
        a.unshift("log"),
        v.apply(null , a)
    }
    ;
    a.enforce = function() {
        return o = !0,
        {
            log: w
        }
    }
    ,
    a.getHistory = function() {
        return p
    }
    ,
    a.clearHistory = function() {
        p = []
    }
}),
function(a) {
    "function" == typeof define && define.amd ? define(["jquery"], a) : "object" == typeof exports ? module.exports = a(require("jquery")) : a(jQuery)
}(function(a) {
    if (!a.support.cors && a.ajaxTransport && window.XDomainRequest) {
        var b = /^https?:\/\//i
          , c = /^get|post$/i
          , d = new RegExp("^" + location.protocol,"i");
        a.ajaxTransport("* text html xml json", function(e, f, g) {
            if (e.crossDomain && e.async && c.test(e.type) && b.test(e.url) && d.test(e.url)) {
                var h = null ;
                return {
                    send: function(b, c) {
                        var d = ""
                          , g = (f.dataType || "").toLowerCase();
                        h = new XDomainRequest,
                        /^\d+$/.test(f.timeout) && (h.timeout = f.timeout),
                        h.ontimeout = function() {
                            c(500, "timeout")
                        }
                        ,
                        h.onload = function() {
                            var b = "Content-Length: " + h.responseText.length + "\r\nContent-Type: " + h.contentType
                              , d = {
                                code: 200,
                                message: "success"
                            }
                              , e = {
                                text: h.responseText
                            };
                            try {
                                if ("html" === g || /text\/html/i.test(h.contentType))
                                    e.html = h.responseText;
                                else if ("json" === g || "text" !== g && /\/json/i.test(h.contentType))
                                    try {
                                        e.json = a.parseJSON(h.responseText)
                                    } catch (f) {
                                        d.code = 500,
                                        d.message = "parseerror"
                                    }
                                else if ("xml" === g || "text" !== g && /\/xml/i.test(h.contentType)) {
                                    var i = new ActiveXObject("Microsoft.XMLDOM");
                                    i.async = !1;
                                    try {
                                        i.loadXML(h.responseText)
                                    } catch (f) {
                                        i = void 0
                                    }
                                    if (!i || !i.documentElement || i.getElementsByTagName("parsererror").length)
                                        throw d.code = 500,
                                        d.message = "parseerror",
                                        "Invalid XML: " + h.responseText;
                                    e.xml = i
                                }
                            } catch (j) {
                                throw j
                            } finally {
                                c(d.code, d.message, e, b)
                            }
                        }
                        ,
                        h.onprogress = function() {}
                        ,
                        h.onerror = function() {
                            c(500, "error", {
                                text: h.responseText
                            })
                        }
                        ,
                        f.data && (d = "string" === a.type(f.data) ? f.data : a.param(f.data)),
                        h.open(e.type, e.url),
                        h.send(d)
                    },
                    abort: function() {
                        h && h.abort()
                    }
                }
            }
        })
    }
}),
nm_module("js-libs/jquery", function(a, b, c, d) {
    b("{Protocol}//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"),
    b("./jquery/jQuery.XDomainRequest.js");
    a.jQuery = $
}),
nm_module("jscore/types", function(a, b, c, d) {
    a.METHOD = {},
    a.ABSTRACT_METHOD = {},
    a.PROPERTY = {},
    a.isFunction = function(a) {
        return Boolean(a && "function" == typeof a)
    }
    ,
    a.isString = function(a) {
        return Boolean(a && a.constructor === String)
    }
    ,
    a.isUndefined = function(a) {
        return "undefined" == typeof a
    }
    ,
    a.isUndefinedOrNull = function(a) {
        var b = "undefined" == typeof a;
        return b = b || null  === a
    }
    ,
    a.isNumeric = function(a) {
        return !isNaN(parseFloat(a)) && isFinite(a)
    }
    ,
    a.isArray = function(a) {
        return a && a.constructor === Array || !1
    }
}),
nm_module("jscore/map", function(a, b, c, d) {
    var e = a.MapShim = c(Object, {
        constructor: function(a) {
            a = "undefined" == typeof arguments[0] ? [] : a;
            var b = []
              , c = []
              , e = [];
            this._items = e,
            this._keys = c,
            this._values = b;
            for (var f, g = 0, h = a[d.iterator](); !(f = h.next()).done; ) {
                var i = f.value
                  , j = i[1]
                  , i = i[0];
                b.push(j),
                c.push(i),
                e.push([i, j]),
                g += 1
            }
            this.size = g
        },
        has: function(a) {
            return this._keys.indexOf(a) > -1
        },
        set: function(a, b) {
            var c = this._keys
              , d = this._values
              , e = this._items
              , f = c.indexOf(a);
            return -1 === f ? (c.push(a),
            d.push(b),
            e.push([a, b]),
            this.size = c.length) : (c[f] = a,
            d[f] = b,
            e[f] = [a, b]),
            this
        },
        get: function(a) {
            var b = this._keys.indexOf(a);
            return b > -1 ? this._values[b] : void 0
        },
        "delete": function(a) {
            var b = this._keys.indexOf(a);
            return -1 === b ? !1 : (this._values.splice(b, 1),
            this._keys.splice(b, 1),
            this._items.splice(b, 1),
            this.size -= 1,
            !0)
        },
        clear: function() {
            this.size = 0,
            this._items = [],
            this._values = [],
            this._keys = []
        },
        keys: function() {
            return this._keys[d.iterator]()
        },
        values: function() {
            return this._values[d.iterator]()
        },
        entries: function() {
            return this._items[d.iterator]()
        }
    });
    e.prototype[d.iterator] = e.prototype.entries;
    var f = a.getBestMap = function(a, b) {
        var c;
        try {
            if (c = new a([[1, 2]]),
            1 === c.size && 2 === c.get(1) && c.has(1) === !0 && c.has(2) === !1 && c["delete"](1) === !0 && c["delete"](1) === !1 && c.set(1, 2) === c && 1 === c[d.iterator]().next().value[0] && 2 === c[d.iterator]().next().value[1] && 1 === c.entries().next().value[0] && 2 === c.entries().next().value[1] && 1 === c.keys().next().value && 2 === c.values().next().value)
                return a
        } catch (e) {}
        return b
    }
    ;
    a.Map = f(window.Map, e)
}),
nm_module("esixy/runtime/regenerator", function(a, b, c, d) {
    !function() {
        function b(a, b, c, d) {
            return new f(a,b,c || null ,d || [])
        }
        function c() {}
        function e() {}
        function f(a, b, c, d) {
            function e(b, d) {
                if (h === r)
                    throw new Error("Generator is already running");
                if (h === s)
                    return k();
                for (; ; ) {
                    var e = g.delegate;
                    if (e) {
                        try {
                            var f = e.iterator[b](d);
                            b = "next",
                            d = l
                        } catch (i) {
                            g.delegate = null ,
                            b = "throw",
                            d = i;
                            continue
                        }
                        if (!f.done)
                            return h = q,
                            f;
                        g[e.resultName] = f.value,
                        g.next = e.nextLoc,
                        g.delegate = null 
                    }
                    if ("next" === b) {
                        if (h === p && "undefined" != typeof d)
                            throw new TypeError("attempt to send " + JSON.stringify(d) + " to newborn generator");
                        h === q ? g.sent = d : delete g.sent
                    } else if ("throw" === b) {
                        if (h === p)
                            throw h = s,
                            d;
                        g.dispatchException(d) && (b = "next",
                        d = l)
                    } else
                        "return" === b && g.abrupt("return", d);
                    h = r;
                    try {
                        var j = a.call(c, g);
                        h = g.done ? s : q;
                        var f = {
                            value: j,
                            done: g.done
                        };
                        if (j !== t)
                            return f;
                        g.delegate && "next" === b && (d = l)
                    } catch (m) {
                        h = s,
                        "next" === b ? g.dispatchException(m) : d = m
                    }
                }
            }
            var f = b ? Object.create(b.prototype) : this
              , g = new i(d)
              , h = p;
            return f.next = e.bind(f, "next"),
            f["throw"] = e.bind(f, "throw"),
            f["return"] = e.bind(f, "return"),
            f
        }
        function g(a) {
            var b = {
                tryLoc: a[0]
            };
            1 in a && (b.catchLoc = a[1]),
            2 in a && (b.finallyLoc = a[2]),
            this.tryEntries.push(b)
        }
        function h(a, b) {
            var c = a.completion || {};
            c.type = 0 === b ? "normal" : "return",
            delete c.arg,
            a.completion = c
        }
        function i(a) {
            this.tryEntries = [{
                tryLoc: "root"
            }],
            a.forEach(g, this),
            this.reset()
        }
        function j(a) {
            function b() {
                for (; ++d < a.length; )
                    if (m.call(a, d))
                        return b.value = a[d],
                        b.done = !1,
                        b;
                return b.value = l,
                b.done = !0,
                b
            }
            if (a) {
                var c = a[n];
                if (c)
                    return c.call(a);
                if ("function" == typeof a.next)
                    return a;
                if (!isNaN(a.length)) {
                    var d = -1;
                    return b.next = b
                }
            }
            return {
                next: k
            }
        }
        function k() {
            return {
                value: l,
                done: !0
            }
        }
        var l, m = Object.prototype.hasOwnProperty, n = "function" == typeof d && d.iterator || "@@iterator";
        if ("object" != typeof regeneratorRuntime) {
            var o = regeneratorRuntime = "undefined" == typeof a ? {} : a;
            o.wrap = b;
            var p = "suspendedStart"
              , q = "suspendedYield"
              , r = "executing"
              , s = "completed"
              , t = {}
              , u = e.prototype = f.prototype;
            c.prototype = u.constructor = e,
            e.constructor = c,
            c.displayName = "GeneratorFunction",
            o.isGeneratorFunction = function(a) {
                var b = "function" == typeof a && a.constructor;
                return b ? b === c || "GeneratorFunction" === (b.displayName || b.name) : !1
            }
            ,
            o.mark = function(a) {
                return a.__proto__ = e,
                a.prototype = Object.create(u),
                a
            }
            ,
            o.async = function(a, c, d, e) {
                return new Promise(function(f, g) {
                    function h(a) {
                        try {
                            var b = this(a)
                              , c = b.value
                        } catch (d) {
                            return g(d)
                        }
                        b.done ? f(c) : Promise.resolve(c).then(j, k)
                    }
                    var i = b(a, c, d, e)
                      , j = h.bind(i.next)
                      , k = h.bind(i["throw"]);
                    j()
                }
                )
            }
            ,
            u[n] = function() {
                return this
            }
            ,
            u.toString = function() {
                return "[object Generator]"
            }
            ,
            o.keys = function(a) {
                var b = [];
                for (var c in a)
                    b.push(c);
                return b.reverse(),
                function d() {
                    for (; b.length; ) {
                        var c = b.pop();
                        if (c in a)
                            return d.value = c,
                            d.done = !1,
                            d
                    }
                    return d.done = !0,
                    d
                }
            }
            ,
            o.values = j,
            i.prototype = {
                constructor: i,
                reset: function() {
                    this.prev = 0,
                    this.next = 0,
                    this.sent = l,
                    this.done = !1,
                    this.delegate = null ,
                    this.tryEntries.forEach(h);
                    for (var a, b = 0; m.call(this, a = "t" + b) || 20 > b; ++b)
                        this[a] = null 
                },
                stop: function() {
                    this.done = !0;
                    var a = this.tryEntries[0]
                      , b = a.completion;
                    if ("throw" === b.type)
                        throw b.arg;
                    return this.rval
                },
                dispatchException: function(a) {
                    function b(b, d) {
                        return f.type = "throw",
                        f.arg = a,
                        c.next = b,
                        !!d
                    }
                    if (this.done)
                        throw a;
                    for (var c = this, d = this.tryEntries.length - 1; d >= 0; --d) {
                        var e = this.tryEntries[d]
                          , f = e.completion;
                        if ("root" === e.tryLoc)
                            return b("end");
                        if (e.tryLoc <= this.prev) {
                            var g = m.call(e, "catchLoc")
                              , h = m.call(e, "finallyLoc");
                            if (g && h) {
                                if (this.prev < e.catchLoc)
                                    return b(e.catchLoc, !0);
                                if (this.prev < e.finallyLoc)
                                    return b(e.finallyLoc)
                            } else if (g) {
                                if (this.prev < e.catchLoc)
                                    return b(e.catchLoc, !0)
                            } else {
                                if (!h)
                                    throw new Error("try statement without catch or finally");
                                if (this.prev < e.finallyLoc)
                                    return b(e.finallyLoc)
                            }
                        }
                    }
                },
                _findFinallyEntry: function(a) {
                    for (var b = this.tryEntries.length - 1; b >= 0; --b) {
                        var c = this.tryEntries[b];
                        if (c.tryLoc <= this.prev && m.call(c, "finallyLoc") && (c.finallyLoc === a || this.prev < c.finallyLoc))
                            return c
                    }
                },
                abrupt: function(a, b) {
                    var c = this._findFinallyEntry()
                      , d = c ? c.completion : {};
                    return d.type = a,
                    d.arg = b,
                    c ? this.next = c.finallyLoc : this.complete(d),
                    t
                },
                complete: function(a) {
                    if ("throw" === a.type)
                        throw a.arg;
                    return "break" === a.type || "continue" === a.type ? this.next = a.arg : "return" === a.type && (this.rval = a.arg,
                    this.next = "end"),
                    t
                },
                finish: function(a) {
                    var b = this._findFinallyEntry(a);
                    return this.complete(b.completion)
                },
                "catch": function(a) {
                    for (var b = this.tryEntries.length - 1; b >= 0; --b) {
                        var c = this.tryEntries[b];
                        if (c.tryLoc === a) {
                            var d = c.completion;
                            if ("throw" === d.type) {
                                var e = d.arg;
                                h(c, b)
                            }
                            return e
                        }
                    }
                    throw new Error("illegal catch attempt")
                },
                delegateYield: function(a, b, c) {
                    return this.delegate = {
                        iterator: j(a),
                        resultName: b,
                        nextLoc: c
                    },
                    t
                }
            }
        }
    }()
}),
nm_module("jscore/itertools", function(a, b, c, d) {
    function e(a, b) {
        return a === b ? 0 : b > a ? 1 : -1
    }
    var f = b("esixy/runtime/regenerator")
      , g = b("./types", "isNumeric")
      , h = b("./map", "MapShim")
      , i = a.iterator = function(a) {
        return a[d.iterator]()
    }
      , j = a.isIterable = function(a) {
        return "function" == typeof a[d.iterator]
    }
      , k = a.first = function(a) {
        return i(a).next().value
    }
      , l = (a.last = function(a) {
        if (!j(a))
            throw new TypeError("last argument must be an iterable");
        if (a.length) {
            var b = a.length;
            return a[b - 1]
        }
        for (var c, d = i(a); ; ) {
            var e = d.next()
              , f = e.done
              , e = e.value;
            if (f)
                break;
            c = e
        }
        return c
    }
    ,
    c(Object, {
        constructor: function() {},
        next: function() {
            return {
                done: !0
            }
        }
    }));
    l.prototype[d.iterator] = function() {
        return this
    }
    ;
    var m = c(l, {
        constructor: function(a, b, c) {
            this.start = a,
            this.stop = b,
            this.step = c
        },
        next: function() {
            var a = this.start;
            return this.start += this.step,
            {
                value: a,
                done: a >= this.stop
            }
        }
    })
      , n = c(l, {
        constructor: function(a, b) {
            this.start = b,
            this.itemsIter = i(a)
        },
        next: function() {
            var a = this.start;
            this.start += 1;
            var b = this.itemsIter.next()
              , c = b.done
              , b = b.value;
            return {
                value: [a, b],
                done: c
            }
        }
    })
      , o = c(l, {
        constructor: function(a, b, c) {
            o.base.call(this),
            this.longest = b,
            this.fill = c;
            this.iters = function(b) {
                for (var c, e = a[d.iterator](); !(c = e.next()).done; ) {
                    var f = c.value;
                    b.push(i(f))
                }
                return b
            }
            .call(this, [])
        },
        next: function() {
            for (var a = [], b = this.longest, c = this.fill, d = b, e = this.iters, f = 0, g = e.length; g > f; f++) {
                var h = e[f]
                  , i = h.next()
                  , j = i.done
                  , i = i.value;
                b ? (j && (i = c),
                d = j && d) : d = j || d,
                a.push(i)
            }
            return {
                value: a,
                done: d
            }
        }
    })
      , p = c(l, {
        constructor: function(a, b) {
            this.mapFunc = b,
            this.itemsIter = i(a)
        },
        next: function() {
            var a = this.itemsIter.next()
              , b = a.done
              , a = a.value
              , c = this.mapFunc;
            return b || (a = c(a)),
            {
                value: a,
                done: b
            }
        }
    })
      , q = c(l, {
        constructor: function(a, b) {
            this.filterFunc = b,
            this.itemsIter = i(a),
            this.counter = 0
        },
        next: function() {
            var a, b = this.filterFunc, c = !0;
            do
                a = this.itemsIter.next(),
                c = a.done,
                a = a.value,
                {
                    value: a,
                    done: c
                };
            while (!c && !b(a, this.counter++));return {
                value: a,
                done: c
            }
        }
    })
      , r = c(l, {
        constructor: function(a, b, c, d) {
            this.itemsIter = i(a),
            this.counter = 0,
            this.counterValues = new m(b,c,d)
        },
        next: function() {
            var a, b = this.counterValues.next(), c = b.done, b = b.value;
            if (!c)
                do
                    a = this.itemsIter.next(),
                    c = a.done,
                    a = a.value,
                    {
                        value: a,
                        done: c
                    };
                while (!c && this.counter++ !== b);return {
                value: a,
                done: c
            }
        }
    })
      , s = c(l, {
        constructor: function(a) {
            this.iterables = i(a),
            this.currIterator = new l
        },
        next: function() {
            for (; ; ) {
                var a = this.currIterator.next();
                if (!a.done)
                    return a;
                var b = this.iterables.next();
                if (b.done)
                    return {
                        done: !0
                    };
                this.currIterator = i(b.value)
            }
        }
    })
      , t = c(l, {
        constructor: function(a, b) {
            var c = i(a)
              , d = k(c);
            b && (c = new s([c, [d]])),
            this.previous = d,
            this.itemsIter = c
        },
        next: function() {
            var a = this.itemsIter.next()
              , b = a.done
              , a = a.value;
            if (!b) {
                var c = this.previous;
                this.previous = a,
                a = [c, a]
            }
            return {
                value: a,
                done: b
            }
        }
    })
      , u = (a.array = function(a) {
        return function(b) {
            for (var c, e = a[d.iterator](); !(c = e.next()).done; ) {
                var f = c.value;
                b.push(f)
            }
            return b
        }
        .call(this, [])
    }
    ,
    a.range = function(a, b, c) {
        return c = "undefined" == typeof arguments[2] ? 1 : c,
        "undefined" == typeof b && (b = a,
        a = 0),
        new m(a,b,c)
    }
    )
      , v = a.enumerate = function(a, b) {
        return b = "undefined" == typeof arguments[1] ? 0 : b,
        new n(a,b)
    }
      , w = a.zip = function() {
        var a = Array.prototype.slice.call(arguments, 0);
        return new o(a,!1)
    }
      , x = (a.zipLongest = function() {
        var a = Array.prototype.slice.call(arguments, 0);
        return new o(a,!0)
    }
    ,
    a.chain = function() {
        var a = Array.prototype.slice.call(arguments, 0);
        return new s(a)
    }
    ,
    a.ichain = function(a) {
        return new s(a)
    }
    ,
    a.map = function(a, b) {
        return new p(a,b)
    }
    )
      , y = a.filter = function(a, b) {
        return new q(a,b)
    }
      , z = (a.count = function(a, b) {
        return a = "undefined" == typeof arguments[0] ? 0 : a,
        b = "undefined" == typeof arguments[1] ? 1 : b,
        new m(a,1 / 0,b)
    }
    ,
    a.repeat = function(a, b) {
        return b = "undefined" == typeof arguments[1] ? 1 / 0 : b,
        x(u(b), function() {
            return a
        })
    }
    );
    a.slice = function(a, b, c, d) {
        return d = "undefined" == typeof arguments[3] ? 1 : d,
        "function" == typeof a.slice && 1 === d ? i(a.slice(b, c)) : new r(a,b,c,d)
    }
    ,
    a.dropwhile = f.mark(function A(a, b) {
        var c, e, g, h;
        return f.wrap(function(f) {
            for (; ; )
                switch (f.prev = f.next) {
                case 0:
                    c = i(a),
                    e = c[d.iterator]();
                case 2:
                    if ((g = e.next()).done) {
                        f.next = 10;
                        break
                    }
                    if (h = g.value,
                    b(h)) {
                        f.next = 8;
                        break
                    }
                    return f.next = 7,
                    h;
                case 7:
                    return f.abrupt("break", 10);
                case 8:
                    f.next = 2;
                    break;
                case 10:
                    return f.delegateYield(c, "t0", 11);
                case 11:
                case "end":
                    return f.stop()
                }
        }, A, this)
    }),
    a.takewhile = f.mark(function B(a, b) {
        var c, e, g;
        return f.wrap(function(f) {
            for (; ; )
                switch (f.prev = f.next) {
                case 0:
                    c = a[d.iterator]();
                case 1:
                    if ((e = c.next()).done) {
                        f.next = 11;
                        break
                    }
                    if (g = e.value,
                    !b(g)) {
                        f.next = 8;
                        break
                    }
                    return f.next = 6,
                    g;
                case 6:
                    f.next = 9;
                    break;
                case 8:
                    return f.abrupt("break", 11);
                case 9:
                    f.next = 1;
                    break;
                case 11:
                case "end":
                    return f.stop()
                }
        }, B, this)
    }),
    a.compress = function(a, b) {
        var c = w(a, b)
          , d = y(c, function(a) {
            return a[1]
        }
        .bind(this));
        return x(d, function(a) {
            return a[0]
        }
        .bind(this))
    }
    ,
    a.chunks = function(a, b, c) {
        var d = z(i(a), b);
        return new o(d,!0,c)
    }
    ,
    a.pairwise = function(a, b) {
        return b = "undefined" == typeof arguments[1] ? !1 : b,
        new t(a,b)
    }
    ,
    a.reduce = function(a, b, c) {
        "undefined" == typeof c && (c = [b, c],
        b = c[1],
        c = c[0],
        [c, b]);
        var e = i(a)
          , f = b;
        "undefined" == typeof f && (f = e.next().value);
        for (var g, h = e[d.iterator](); !(g = h.next()).done; ) {
            var j = g.value;
            f = c(f, j)
        }
        return f
    }
    ,
    a.isEmpty = function(a) {
        return i(a).next().done
    }
    ,
    a.size = function(a) {
        if (!j(a))
            throw new TypeError("size() argument must be an iterable");
        if (g(a.length))
            return a.length;
        for (var b = 0, c = i(a); !c.next().done; )
            b++;
        return b
    }
    ,
    a.find = function(a, b, c) {
        var e;
        "function" == typeof c ? e = !0 : (e = !1,
        c = b);
        for (var f, g = a[d.iterator](); !(f = g.next()).done; ) {
            var h = f.value;
            if (c(h) === !0)
                return h
        }
        return e ? b : void 0
    }
    ,
    a.findIndex = function(a, b) {
        for (var c, e = v(a)[d.iterator](); !(c = e.next()).done; ) {
            var f = c.value
              , g = f[1]
              , f = f[0];
            if (b(g) === !0)
                return f
        }
        return -1
    }
    ,
    a.every = function(a, b) {
        for (var c, e = a[d.iterator](); !(c = e.next()).done; ) {
            var f = c.value;
            if (!b(f))
                return !1
        }
        return !0
    }
    ,
    a.some = function(a, b) {
        for (var c, e = a[d.iterator](); !(c = e.next()).done; ) {
            var f = c.value;
            if (b(f))
                return !0
        }
        return !1
    }
    ,
    a.min = function(a, b) {
        b = "undefined" == typeof arguments[1] ? e : b;
        for (var c, f = i(a), g = k(f), h = a[d.iterator](); !(c = h.next()).done; ) {
            var j = c.value;
            b(g, j) < 0 && (g = j)
        }
        return g
    }
    ,
    a.max = function(a, b) {
        b = "undefined" == typeof arguments[1] ? e : b;
        for (var c, f = i(a), g = k(f), h = a[d.iterator](); !(c = h.next()).done; ) {
            var j = c.value;
            b(g, j) > 0 && (g = j)
        }
        return g
    }
    ,
    a.groupBy = function(a, b) {
        for (var c, e = new h, f = a[d.iterator](); !(c = f.next()).done; ) {
            var g = c.value
              , i = b(g);
            e.has(i) ? e.get(i).push(g) : e.set(i, [g])
        }
        return e
    }
}),
nm_module("jscore/objtools", function(a, b, c, d) {
    var e = b("./itertools", "iterator")
      , f = (a.merge = function(a, b) {
        if (a) {
            for (var c in b)
                "prototype" !== c && b.hasOwnProperty(c) && "undefined" == typeof a[c] && (a[c] = b[c]);
            return a
        }
        return b
    }
    ,
    a.copy = function(a, b) {
        if (!a || !b)
            throw new Error("You must provide an object to copy from and to");
        for (var c in a)
            a.hasOwnProperty(c) && (b[c] = a[c])
    }
    ,
    a.keys = function(a) {
        return Object.keys(a)
    }
    )
      , g = a.values = function(a) {
        for (var b = f(a), c = b.length, d = new Array(c), e = 0; c > e; e++)
            d[e] = a[b[e]];
        return d
    }
      , h = 0
      , i = a.id = function(a) {
        var b;
        if (a === !0)
            return "@true";
        if (a === !1)
            return "@false";
        if (null  === a)
            return "@null";
        if ("string" == typeof a)
            b = "$" + a;
        else if ("number" == typeof a)
            b = "#" + a;
        else {
            if ("object" != typeof a && "function" != typeof a)
                throw new Error("Can't id(" + a + ")");
            b = a.__id,
            "undefined" == typeof b && (a.__id = b = "@" + h++)
        }
        return b
    }
      , j = a.Dictionary = c(Object, {
        constructor: function(a) {
            this._items = {},
            a && this.update(a)
        },
        hasKey: function(a) {
            return a = i(a),
            a in this._items
        },
        set: function(a, b) {
            this.update([[a, b]])
        },
        update: function(a) {
            for (var b = this._items, c = 0, d = a.length; d > c; c++) {
                var e = a[c]
                  , f = e[0]
                  , g = e[1];
                b[i(f)] = [f, g]
            }
        },
        get: function(a, b) {
            a = i(a);
            var c = this._items[a];
            return "undefined" == typeof c ? b : c[1]
        },
        pop: function(a, b) {
            a = i(a);
            var c = this._items[a];
            return "undefined" == typeof c ? b : (delete this._items[a],
            c[1])
        },
        keys: function() {
            var a = g(this._items)
              , b = a.map(function(a) {
                return a[0]
            });
            return b
        },
        values: function() {
            var a = g(this._items)
              , b = a.map(function(a) {
                return a[1]
            });
            return b
        }
    });
    j.prototype[d.iterator] = function() {
        var a = g(this._items);
        return e(a)
    }
}),
nm_module("jscore/functools", function(a, b, c, d) {
    var e = b("./objtools", "values")
      , f = 0
      , g = a.argSlice = function(a, b) {
        return b = 0 | b,
        Array.prototype.slice.call(a, b)
    }
    ;
    a.bind = function(a, b) {
        if ("function" != typeof b)
            throw new Error("Expected bind(thisObj, function), got: bind(" + a + ", " + typeof b + ")");
        var c = a._boundFuncs;
        "undefined" == typeof c && (c = {},
        a._boundFuncs = c);
        var d = b.bindKey;
        "undefined" == typeof d && (f += 1,
        d = f,
        b.bindKey = d);
        var e = c[d];
        return "undefined" == typeof e && (e = function() {
            return b.apply(a, arguments)
        }
        ,
        c[d] = e),
        e
    }
    ,
    a.getBoundFunctions = function(a) {
        var b = a._boundFuncs;
        return "undefined" == typeof b ? [] : e(b)
    }
    ,
    a.partial = function(a, b) {
        if (b = g(arguments),
        a = b.shift(),
        "function" != typeof a && (b = a[1],
        a = a[0]),
        "function" != typeof a)
            throw new Error("Expected partial(function, arg1, ...)");
        return function() {
            var c = b.concat(g(arguments));
            return a.apply(this, c)
        }
    }
}),
nm_module("jscore/async", function(a, b, c, d) {
    var e = b("./functools", "argSlice")
      , f = b("./functools", "partial");
    a.callWhenIdle = function(a, b, c) {
        function d() {
            clearTimeout(g);
            var d = e(arguments)
              , i = f([a, d]);
            g = setTimeout(function() {
                clearTimeout(h),
                h = null ,
                i()
            }, b),
            c && null  === h && (h = setTimeout(function() {
                clearTimeout(g),
                h = null ,
                i()
            }, c))
        }
        var g, h = null ;
        return b = b || 500,
        d
    }
    ;
    a.clearInterval = clearInterval,
    a.setInterval = setInterval,
    a.clearTimeout = clearTimeout,
    a.setTimeout = setTimeout
}),
nm_module("nm/ajax", function(a, b, c, d) {
    var e = b("js-libs/jquery", "jQuery")
      , f = b("jscore/async", "setTimeout")
      , g = e.ajax;
    a.ajax = g;
    a.fake = function(a) {
        return {
            ajax: function() {
                var b = {
                    done: function(a) {
                        return b.done_cb = a,
                        b
                    },
                    fail: function() {
                        return b
                    }
                };
                return f(function() {
                    b.done_cb(a)
                }, 10),
                b
            }
        }
    }
}),
nm_module("jscore/sets", function(a, b, c, d) {
    var e = b("./objtools", "id")
      , f = b("./objtools", "values")
      , g = b("./objtools", "keys")
      , h = a.Set = c(Object, {
        constructor: function(a) {
            a = "undefined" == typeof arguments[0] ? [] : a,
            this._items = {};
            for (var b = 0, c = a.length; c > b; b++) {
                var d = a[b]
                  , f = e(d);
                this._items[f] = d
            }
        },
        contains: function(a) {
            var b = e(a);
            return b in this._items
        },
        add: function(a) {
            for (var b = this._items, c = 0, d = arguments.length; d > c; c++) {
                a = arguments[c];
                var f = e(a);
                b[f] = a
            }
        },
        discard: function(a) {
            for (var b = this._items, c = 0, d = arguments.length; d > c; c++) {
                a = arguments[c];
                var f = e(a);
                delete b[f]
            }
        },
        clear: function() {
            this._items = {}
        },
        toArray: function() {
            return f(this._items)
        },
        equals: function(a) {
            var b = this._items
              , c = g(a._items)
              , d = g(b);
            if (d.length !== c.length)
                return !1;
            for (var e = c.length - 1; e >= 0; e--)
                if (!(c[e] in b))
                    return !1;
            return !0
        }
    });
    h.prototype[d.iterator] = function() {
        return this.toArray()[d.iterator]()
    }
}),
nm_module("jscore/events", function(a, b, c, d) {
    var e = b("./types", "isUndefined")
      , f = b("./objtools", "id")
      , g = b("./objtools", "values")
      , h = b("./functools", "getBoundFunctions")
      , i = b("./sets", "Set")
      , j = a.Event = c(Object, {
        constructor: function() {}
    })
      , k = a.Change = c(j, {
        constructor: function(a, b) {
            k.base.call(this),
            this.target = a,
            this.properties = b || {}
        }
    })
      , l = a.EventTarget = c(Object, {
        constructor: function() {
            this._handlers = {}
        },
        addListener: function(a, b) {
            var c = f(a)
              , d = this._handlers[c];
            e(d) ? this._handlers[c] = [b] : d.push(b)
        },
        removeListeners: function(a) {
            for (var b, c = new i(h(a)), e = this._handlers, f = g(e)[d.iterator](); !(b = f.next()).done; )
                for (var j = b.value, k = 0, l = j.length; l > k; k++)
                    c.contains(j[k]) && (j.splice(k, 1),
                    k -= 1,
                    l -= 1)
        },
        dispatch: function(a) {
            for (var b = this._handlers[f(a.constructor)] || [], c = b.slice(), d = 0, e = c.length; e > d; d++) {
                var g = c[d];
                b.indexOf(g) > -1 && g(a)
            }
        }
    })
      , m = a.ObservableObject = c(l, {
        constructor: function() {
            m.base.call(this)
        },
        changed: function(a) {
            this.dispatch(new k(this,a))
        }
    })
}),
nm_module("nm/authorization", function(a, b, c, d) {
    var e = b("nm/dataproviders/fake-auth", "FakeAuthData")
      , f = b("nm/console", "enforce")
      , g = b("nm/ajax", "fake")
      , h = b("nm/ajax", "ajax")
      , i = b("jscore/events", "ObservableObject")
      , j = b("jscore/functools", "bind")
      , k = b("jscore/async", "setTimeout")
      , l = b("jscore/async", "clearTimeout")
      , m = b("js-libs/jquery", "jQuery")
      , n = g(e)
      , o = "demo"
      , p = "/api/0/checkaccesscombo?nmf=json&return200=true"
      , q = a.Authorization = c(i, {
        constructor: function(a) {
            q.base.call(this),
            this._fakeIt = a,
            this._loginCompleted = !1,
            this._periodic = !0,
            this._intervalDuration = 3e5,
            this._interval = null ,
            this._lastUpdate = null ,
            this.retryTimeout = 1e3,
            this.ticket = null ,
            this.setPeriodicUpdate(),
            this.update()
        },
        can: function(a) {
            if (!this.accountData)
                return !1;
            var b = this.accountData
              , c = b.Keys.split(",")
              , d = this.getUserName();
            return "demo" !== d && "freeuser" !== d && (c.push("feature_solar_persist_data"),
            c.push("feature_solar_persist_paneltypes"),
            c.push("featur_auto_calc_solar_data")),
            c.indexOf(a) > -1
        },
        loginRequired: function() {
            return !this._loginCompleted
        },
        isDemoUser: function() {
            return this.authData ? this.authData.AccountContext.Username === o : void 0
        },
        getUserName: function() {
            return this.authData.AccountContext.Username
        },
        getUserId: function() {
            return this.authData.AccountContext.AccountId
        },
        getPlanCode: function() {
            return this.accountData.PlanCode
        },
        getAccountData: function() {
            return this.accountData ? {
                Result: this.accountData
            } : null 
        },
        getTicket: function() {
            return this.ticket
        },
        setTicket: function(a) {
            this.ticket = a
        },
        update: function() {
            this._loginCompleted = !1,
            this.clearPeriodicUpdate(),
            this.loaded = !1;
            var a = this._fakeIt ? n.ajax : h;
            a({
                type: "GET",
                url: p,
                dataType: "json"
            }).done(function(a) {
                return this.process(a)
            }
            .bind(this)).fail(function() {
                return this.processError()
            }
            .bind(this))
        },
        process: function(a) {
            if (a && null  !== a.IncidentId)
                return void this.processError();
            this.retryTimeout = 1e3;
            var b = a.Result
              , c = "Ok" === b.AccessResult.Status
              , d = c && "Active" === b.Account.Status;
            this.accountData = b.Account,
            this.limitsData = b.LimitsResult,
            this.authData = a,
            this._loginCompleted = c && d,
            this.changed(),
            this._lastUpdate = new Date,
            this._loginCompleted ? (this.setPeriodicUpdate(),
            f().log("Login complete:", this)) : (this.clearPeriodicUpdate(),
            f().log("Login failed:", this))
        },
        processError: function() {
            f().log("network issue, retry", this.retryTimeout),
            this._loginCompleted = !1,
            l(this._interval);
            var a = 2 * this.retryTimeout;
            this.retryTimeout = a,
            a > 8e3 ? (this._loginCompleted = !1,
            this.clearPeriodicUpdate(),
            f().log("Login failed:", this),
            this.changed()) : this._interval = k(function() {
                return this._setAuthTimeout()
            }
            .bind(this), a)
        },
        setPeriodicUpdate: function() {
            this._periodic && m(window).bind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick", j(this, this._setAuthTimeout))
        },
        clearPeriodicUpdate: function() {
            this._periodic && (l(this._interval),
            m(window).unbind("mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick", j(this, this._setAuthTimeout)))
        },
        _setAuthTimeout: function() {
            l(this._interval);
            var a = (new Date).getTime();
            a - this._lastUpdate > this._intervalDuration && this.update(),
            this._interval = k(j(this, this.update), this._intervalDuration)
        }
    })
}),
nm_module("nm/const/endpoints", function(a, b, c, d) {
    var e = b("nm/const", "HOST_URL")
      , f = "0"
      , g = e + "api/" + f + "/"
      , g = (a.API = {
        CHECK_ACCESS: g + "checkaccess",
        ACCOUNT: g + "account",
        LIMITS: g + "account/limits",
        CHECK_TICKET: g + "authentication/checkticket",
        LOGOUT: g + "logout",
        SURVEY_NOTIFICATION: g + "surveynotification/signup",
        ACCEPT_TERMS: g + "acceptterms"
    },
    a.API_URL = g);
    a.MAPS = e + "maps",
    a.COMMON_QUERYSTRING = "&return200=true"
}),
nm_module("nm/dataproviders/auth/ticket", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/functools", "bind")
      , g = b("nm/const/endpoints", "API")
      , h = b("nm/const/endpoints", "COMMON_QUERYSTRING")
      , i = b("nm/ajax", "fake")
      , j = b("nm/ajax", "ajax")
      , k = b("jscore/types", "isFunction")
      , l = b("nm/console", "log")
      , m = i({
        IncidentId: null ,
        AccountContext: {
            AccountId: "freeuser",
            Username: "freeuser@nearmap.com"
        },
        Result: {
            Ticket: {
                Ticket: "freeuser",
                Expires: "/Date(1411457400000)/",
                CookieName: "nearmap_web3_app"
            },
            Status: "Ok",
            Username: "freeuser@nearmap.com",
            AccountId: "freeuser"
        }
    })
      , n = a.TICKET_STATUS = {
        OK: "Ok",
        NOTICKET: "NoTicket",
        VALID: "Valid",
        INVALID: "Invalid"
    }
      , o = a.Ticket = c(e, {
        constructor: function(a, b, c) {
            o.base.call(this),
            this._fakeIt = a,
            this._ticket = null ,
            this._data = null ,
            this.status = n.INVALID,
            this.handlers = {
                success: b,
                fail: c
            }
        },
        update: function(a, b) {
            var c = g.CHECK_TICKET + "?nmf=json" + h;
            k(a) && (this.handlers.success = a),
            k(b) && (this.handlers.fail = b);
            var d = this._fakeIt ? m.ajax : j;
            d({
                type: "GET",
                url: c,
                dataType: "json"
            }).done(f(this, this.process)).fail(f(this, this.processError))
        },
        getValue: function() {
            return this._ticket
        },
        getData: function() {
            return this._data
        },
        isValid: function() {
            return this.status === n.VALID
        },
        clearHandlers: function() {
            delete this.handlers.success,
            delete this.handlers.fail
        },
        process: function(a) {
            return a && null  === a.IncidentId && a.Result ? (this._data = a,
            a.Result && a.Result.Ticket && (this._ticket = a.Result.Ticket.Ticket,
            a.Result.Status === n.OK && (this.status = n.VALID)),
            this.changed(),
            k(this.handlers.success) && this.handlers.success(),
            void l("Ticket result:", a)) : void this.processError.call(this, a, "SanityError", null )
        },
        processError: function() {
            this._data = null ,
            this._ticket = null ,
            this.changed(),
            k(this.handlers.fail) && this.handlers.fail()
        }
    })
}),
nm_module("jscore/strings", function(a, b, c, d) {
    function e(a, b) {
        if (null  === b ? b = "null" : "undefined" == typeof b && (b = "undefined"),
        null  === a)
            return b.toString();
        var c = a.match(g)
          , d = c[2] || " "
          , e = c[3]
          , f = c[4] || ""
          , i = c[5]
          , j = c[6]
          , k = c[7]
          , l = c[8]
          , m = c[10]
          , n = c[11];
        if ("number" == typeof b) {
            switch (e = e || ">",
            j && (d = "0",
            e = "="),
            0 > b && (b = -b,
            f = "-"),
            "undefined" == typeof m && (m = 6),
            n) {
            case "c":
                b = String.fromCharCode(b);
                break;
            case "f":
            case "F":
                b = b.toFixed(m);
                break;
            case "E":
            case "e":
                b = b.toExponential(m),
                b = b.replace("e", n);
                break;
            case "b":
                b = b.toString(2);
                break;
            case "o":
                b = b.toString(8);
                break;
            case "x":
                b = b.toString(16).toLowerCase();
                break;
            case "X":
                b = b.toString(16).toUpperCase();
                break;
            case "n":
                b = b.toLocaleString();
                break;
            case "%":
                b = (100 * b).toFixed(m) + "%";
                break;
            default:
                b = b.toString()
            }
            if (l) {
                var o = b.split(".");
                b = o[0];
                for (var p = []; "" !== b; )
                    p.unshift(b.slice(-3)),
                    b = b.slice(0, -3);
                b = p.join(","),
                o.length > 1 && (b += "." + o[1])
            }
            if (i)
                switch (n) {
                case "b":
                    b = "0b" + b;
                    break;
                case "o":
                    b = "0o" + b;
                    break;
                case "x":
                case "X":
                    b = "0x" + b
                }
        } else
            b = b.toString(),
            e = e || "<";
        var q = f.length + b.length;
        k = k || q;
        var r = Math.max(0, k - q)
          , s = h(d, r);
        switch (e) {
        case ">":
            b = s + f + b;
            break;
        case "<":
            b = f + b + s;
            break;
        case "=":
            b = f + s + b;
            break;
        case "^":
            b = s.slice(0, s.length / 2) + f + b + s.slice(s.length / 2)
        }
        return b
    }
    var f = /{{|}}|{(.*?)}/g
      , g = new RegExp("((.)?([<>=\\^]))?([\\s\\+\\-])?(#)?(0)?(\\d+)?(,)?(\\.(\\d+))?([bcdeEfFgGnosxX%])?")
      , h = a.multiply = function(a, b) {
        b = 0 > b ? 0 : b;
        var c = new Array(b + 1);
        return c.join(a)
    }
    ;
    a.format = function(a) {
        var b = 1
          , c = arguments
          , d = arguments[arguments.length - 1];
        return a.replace(f, function(a, f) {
            if ("{{" === a)
                return "{";
            if ("}}" === a)
                return "}";
            var g = null 
              , h = f.split(":");
            h.length > 1 && (f = h[0],
            g = h[1]);
            var i;
            if ("" === f)
                i = c[b],
                b += 1;
            else {
                var j = parseInt(f, 10);
                i = j.toString() === f ? c[j + 1] : d[f]
            }
            var k = e(g, i);
            return k
        })
    }
    ,
    a.pad = function(a, b) {
        for (a = String(a),
        b = b || 2; a.length < b; )
            a = "0" + a;
        return a
    }
}),
nm_module("nm/ui/panel", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "ObservableObject")
      , g = b("jscore/events", "Change")
      , h = b("jscore/strings", "format")
      , i = b("jscore/async", "callWhenIdle")
      , j = b("js-libs/jquery", "jQuery")
      , k = a.Panel = c(f, {
        constructor: function(a) {
            k.base.call(this),
            this.node = a,
            this.visible = !1
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.changed())
        }
    })
      , l = a.HSplitPanel = c(f, {
        constructor: function(a, b) {
            l.base.call(this),
            this.topPanel = a,
            this.bottomPanel = b,
            this.bottomHeight = 250,
            this.collapsed = !0,
            j(b.node).css({
                bottom: "0px",
                top: "auto"
            }),
            b.addListener(g, e(this, function() {
                this.bottomPanel.visible ? this.expand() : this.collapse()
            })),
            j(window).resize(e(this, this.update)),
            this.update()
        },
        collapse: function() {
            this.collapsed = !0,
            this.update(!0)
        },
        expand: function() {
            this.collapsed = !1,
            this.update(!0)
        },
        update: function(a) {
            var b, c = j(this.topPanel.node), d = j(this.bottomPanel.node), f = c.parent();
            b = this.collapsed ? 0 : this.bottomHeight;
            var g = f.height() - b
              , k = {
                height: h("{}px", g)
            }
              , l = {
                height: h("{}px", b)
            };
            if (a) {
                var m = {
                    duration: 200,
                    complete: i(e(this, function() {
                        this.changed()
                    }), 10)
                };
                c.animate(k, m),
                d.animate(l, m)
            } else
                c.css(k),
                d.css(l),
                this.changed()
        }
    })
}),
nm_module("nm/dom", function(a, b, c, d) {
    var e = b("nm/client", "parseBrowser")
      , f = (a.NodeType = {
        ELEMENT_NODE: 1,
        ATTRIBUTE_NODE: 2,
        TEXT_NODE: 3,
        CDATA_SECTION_NODE: 4,
        ENTITY_REFERENCE_NODE: 5,
        ENTITY_NODE: 6,
        PROCESSING_INSTRUCTION_NODE: 7,
        COMMENT_NODE: 8,
        DOCUMENT_NODE: 9,
        DOCUMENT_TYPE_NODE: 10,
        DOCUMENT_FRAGMENT_NODE: 11,
        NOTATION_NODE: 12
    },
    a.getElementById = function(a) {
        return document.getElementById(a)
    }
    )
      , g = a.createElement = function(a) {
        return document.createElement(a)
    }
      , h = (a.createDocumentFragment = function() {
        return document.createDocumentFragment()
    }
    ,
    a.createTextNode = function(a) {
        return document.createTextNode(a)
    }
    ,
    a.create = function(a, b) {
        var c = g(a);
        for (var d in b)
            b.hasOwnProperty(d) && (c[d] = b[d]);
        return c
    }
    ,
    a.insertAfter = function(a, b, c) {
        a.insertBefore(b, c.nextSibling)
    }
    ,
    a.isEmbedded = function() {
        var a = !1;
        try {
            a = window.parent && window.parent.location.href !== window.location.href
        } catch (b) {
            a = !0
        }
        return a
    }
    ,
    a.topLeft = function(a) {
        var b = a instanceof String ? f(a) : a;
        if (!b)
            throw "You have not provided a valid element to topLeft()";
        return {
            x: b.style.left ? parseInt(b.style.left, 10) : 0,
            y: b.style.top ? parseInt(b.style.top, 10) : 0
        }
    }
    ,
    a.makeEven = function(a) {
        return a % 2 === 1 ? (Math.abs(a) + 1) * Math.abs(a) / a : a
    }
    ,
    a.getDimensions = function(a) {
        var b = a instanceof String ? f(a) : a;
        if (!b)
            throw "You have not provided a valid element to getDimensions()";
        return {
            width: b.offsetWidth,
            height: b.offsetHeight
        }
    }
    ,
    a.imageSize = function(a) {
        return {
            height: a.height,
            width: a.width
        }
    }
    ,
    a.addSelectOption = function(a, b, c, d) {
        var e = g("option");
        return e.text = b,
        e.value = c,
        a.options.add(e),
        e.selected = Boolean(d),
        e
    }
    ,
    a.selectOption = function(a, b) {
        var c, d = a.options;
        for (c = d.length; c--; )
            if (d[c].value === b)
                return void (a.selectedIndex = c)
    }
    ,
    a.contains = function(a, b) {
        var c, d = !1;
        do
            try {
                c = c ? c.parentNode : b.parentNode,
                a === c && (d = !0)
            } catch (e) {
                c = null 
            }
        while (c && "body" !== c.nodeValue && !d);return d
    }
    ,
    a.getWindowHeight = function() {
        return "number" == typeof window.innerHeight ? window.innerHeight : document.documentElement && document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body && document.body.clientHeight ? document.body.clientHeight : void 0
    }
    )
      , i = a.getWindowWidth = function() {
        return "number" == typeof window.innerWidth ? window.innerWidth : document.documentElement && document.documentElement.clientWidth ? document.documentElement.clientWidth : document.body && document.body.clientWidth ? document.body.clientWidth : void 0
    }
      , j = (a.getWindowDimensions = function() {
        return {
            height: h(),
            width: i()
        }
    }
    ,
    a.getBodyOffsetTop = function(a) {
        for (var b = a instanceof String ? f(a) : a, c = b.offsetTop, d = b.offsetParent; d; )
            c += d.offsetTop,
            d = d.offsetParent;
        return c
    }
    )
      , k = a.getBodyOffsetLeft = function(a) {
        for (var b = a instanceof String ? f(a) : a, c = b.offsetLeft, d = b.offsetParent; d; )
            c += d.offsetLeft,
            d = d.offsetParent;
        return c
    }
      , l = (a.getBodyOffset = function(a) {
        return {
            offsetTop: j(a),
            offsetLeft: k(a)
        }
    }
    ,
    a.getBodyScrollLeft = function() {
        return document.body.scrollLeft || document.documentElement.scrollLeft
    }
    ,
    a.getBodyScrollTop = function() {
        return document.body.scrollTop || document.documentElement.scrollTop
    }
    ,
    a.isInput = function(a) {
        switch (a.toLowerCase()) {
        case "input":
            return !0;
        case "select":
            return !0;
        case "option":
            return !0;
        case "textarea":
            return !0;
        default:
            return !1
        }
    }
    ,
    a.isNode = function(a) {
        return "object" == typeof window.Node ? a instanceof window.Node : "object" == typeof a && "number" == typeof a.nodeType && "string" == typeof a.nodeName
    }
    ,
    a.isElement = function(a) {
        return "object" == typeof window.HTMLElement ? a instanceof window.HTMLElement : "object" == typeof a && 1 === a.nodeType && "string" == typeof a.nodeName
    }
    ,
    a.discardElement = function(a) {
        if (a.parentNode && a.parentNode.removeChild(a),
        e().msie)
            try {
                a.outerHTML = ""
            } catch (b) {}
    }
    );
    a.discardBatchElements = function(a, b) {
        for (var c = a.length - 1; c--; )
            l(a[c], b)
    }
}),
nm_module("nm/tools/splash", function(a, b, c, d) {
    var e, f = b("nm/const", "STATIC_ASSETS_URL"), g = b("jscore/types", "isString"), h = b("nm/dom", "create"), i = b("nm/dom", "isNode"), j = b("nm/dom", "createElement"), k = b("nm/dom", "createDocumentFragment"), l = b("nm/dom", "discardElement");
    a.Splash = c(Object, {
        constructor: function(a, b) {
            this.container = a,
            this.map = b
        },
        create: function(a, b, c, d) {
            var l, m = f + "img/nearmap-logo.png", n = k(), o = j("div"), p = j("span"), q = j("h1"), r = j("div"), s = j("h2"), t = j("div");
            this.remove(),
            e = j("div"),
            l = h("img", {
                src: m,
                alt: "Nearmap logo"
            }),
            q.innerHTML = a,
            s.innerHTML = b,
            g(c) ? t.innerHTML = c : i(c) && t.appendChild(c),
            e.className = "nm-splashSplashManager",
            o.className = "nm-splashWrapSplashManager",
            p.className = "nm-logoWrapSplashManager",
            q.className = "nm-headWrapSplashManager",
            r.className = "nm-mainContentWrapSplashManager",
            s.className = "nm-subHeadingWrapSplashManager",
            n.appendChild(e),
            e.appendChild(o),
            o.appendChild(p),
            o.appendChild(q),
            o.appendChild(r),
            r.appendChild(s),
            r.appendChild(t),
            p.appendChild(l),
            this.container.appendChild(n),
            d && "function" == typeof d && d.call(e, this.map)
        },
        getSplash: function() {
            return e
        },
        remove: function() {
            e && (l(e),
            e = null )
        }
    })
}),
nm_module("nm/const/urls", function(a, b, c, d) {
    var e = (a.HOME = "/",
    a.US_HOME = "http://us.nearmap.com",
    a.ACCOUNT = "/my-account/account");
    a.PACKAGE = "/my-account/package",
    a.USAGE = "/my-account/usage",
    a.UPGRADE = "/my-account/package/upgrade",
    a.LEGAL = "/legal/copyright",
    a.SUPPORT = "https://support.nearmap.com/",
    a.LOGIN = "/login",
    a.SIGN_UP = "/signup",
    a.CONTACT = "/contact",
    a.LOGIN_TO_MYACCOUNT = "/login?turl=" + e,
    a.LOGOUT = "/logout",
    a.EXPLAIN_STATUS = "/explain-status",
    a.FEEDBACK = "https://support.nearmap.com/customer/portal/topics/600305",
    a.TOU = "/legal/terms-of-use",
    a.TERMS_OF_USE = "https://support.nearmap.com/customer/portal/articles/1449303-terms-of-use?b_id=1080",
    a.MAP_LAYERS_INFO = "https://support.nearmap.com/customer/portal/topics/615973-map-layers/articles",
    a.BUYPHOTOS = "/images",
    a.RAIL = "/rail",
    a.PROPERTY_REPORTS = "/property-reports",
    a.LAYERS_MANAGER_SUPPORT_URL = "https://support.nearmap.com/customer/portal/articles/1739463"
}),
nm_module("nm/const/messages", function(a, b, c, d) {
    var e = b("nm/const", "REDIRECTION_TIMEOUT")
      , f = b("nm/const/urls", "SUPPORT")
      , g = b("nm/const/urls", "LOGIN")
      , h = b("nm/const/urls", "HOME");
    a.TITLE_AUTHENTICATION_FAILED = "Authentication failed",
    a.TITLE_LOAD_ERROR = "Load error",
    a.TITLE_EVERYONE_ELSE = "However, so did everyone else.",
    a.CONNECTION_ISSUE = "We're currently having trouble communicating with the nearmap.com website. Please check your internet connection and try again.",
    a.GENERIC_ERROR = "An unexpected error has occurred. Please try again.",
    a.TITLES = {
        Sorry: "We're sorry.",
        GotHere: "Yes! You got here!",
        TermsConditions: "Terms and Conditions"
    },
    a.SUBTITLES = {
        AuthenticationFailed: "Authentication failed",
        LoadError: "Load error",
        ConnectionIssue: "We're currently having trouble communicating with the nearmap.com website. Please check your internet connection and try again.",
        EveryoneElse: "However, so did everyone else."
    },
    a.TEXTS = {
        ErrorOccur: "An error occurred. ",
        UnrecognisedCredentials: "We could not recognise your credentials. ",
        ContactUs: 'If the problem persists please refer to our <a href="' + f + '" title="Contact us">knowledge base</a>.<br/>',
        WorkingHard: "We're working hard to adjust the traffic, please connect to us again shortly. ",
        OtherSession: "You have been logged out as the username <strong><i>{username}</i></strong> has been used to log in to nearmap from another device.",
        OtherSessionChangePassword: 'If someone is accessing your account without your authorisation you can <a href="' + g + '">change your password</a>.',
        OtherSessionContinue: '<a href="' + h + '">Click here to continue</a>.',
        RedirectLogin: "<br/><br/><p><small>In less than " + e / 1e3 + " seconds you will be redirected to the login page.</small></p>",
        LoginAgain: 'Please click <a href="' + g + '" title="Login here">here</a> to login again. ',
        TrialExpired: 'Your trial period has expired. We hope you have enjoyed using our amazing PhotoMaps. To learn more about our PhotoMaps solutions and subscriptions, please click <a href="' + h + '" title="Start signup here">here</a>. ',
        ToolUnavailableMapType: "Please switch to PhotoMaps to use this tool.",
        ToolUnavailableCoverage: "You cannot use this tool outside nearmap coverage."
    },
    a.PARTIAL_FEATURES_LOADED = "Some objects not displayed. Please zoom in to view."
}),
nm_module("nm/dom/event", function(a, b, c, d) {
    function e(a) {
        a = a || window.event,
        a.cancelBubble = !0,
        a.stopPropagation && a.stopPropagation()
    }
    function f(a) {
        return a = a || window.event,
        a.returnValue = !1,
        a.preventDefault && a.preventDefault(),
        !1
    }
    function g(a, b, c) {
        return {
            source: a,
            handler: b,
            remove: c
        }
    }
    function h(a, b) {
        if ("string" != typeof a)
            throw new Error("Event name must be a string");
        if ("function" != typeof b)
            throw new Error("Event handler must be a function");
        return !0
    }
    function i(a, b, c) {
        function d() {
            a.removeEventListener ? a.removeEventListener(b, c, !1) : a.detachEvent ? a.detachEvent("on" + b, c) : a[b] = null 
        }
        function e(b, d, e) {
            if (a.removeEventListener)
                for (var f in b)
                    b.hasOwnProperty(f) && a.removeEventListener(b[f], c, !1);
            else
                a.detachEvent ? a.detachEvent(d, c) : a[e] = null 
        }
        switch (b) {
        case "mousewheel":
            e({
                firefox: "DOMMouseScroll",
                others: "mousewheel"
            }, "on" + b, "on" + b);
            break;
        default:
            d()
        }
    }
    function j(a) {
        a >= 0 && (delete t[p + a],
        delete r[a])
    }
    function k(a) {
        var b, c;
        if (a >= 0) {
            if (c = u[p + a],
            c.length) {
                c = o(c);
                for (var d = 0, e = c.length; e > d; d++) {
                    b = c[d];
                    for (var f = 0; f < b.length; f++)
                        b[d].remove()
                }
                delete u[p + a]
            }
            delete s[a]
        }
    }
    function l(a) {
        var b = r.indexOf(a)
          , c = s.indexOf(a);
        j(b),
        k(c)
    }
    function m(a, b, c, d, e) {
        var f, h, j, k = q + d;
        return f = a.indexOf(c),
        -1 === f ? (f = a.length,
        j = p + f,
        a[f] = c,
        b[j] = {},
        b[j].length = 0) : j = p + f,
        h = g(c, e, function() {
            for (var g = b[j][k], l = g.length - 1; l >= 0; l--)
                if (g[l] === h)
                    return b === u && i(c, d, e),
                    1 === g.length ? (delete b[j][k],
                    b[j].length--) : g.splice(l, 1),
                    void (0 === b[j].length && (b[j] = void 0,
                    a[f] = void 0))
        }),
        b[j][k] || (b[j][k] = [],
        b[j].length++),
        b[j][k].push(h),
        h
    }
    var n = b("nm/dom", "createElement")
      , o = b("jscore/objtools", "values")
      , p = "element"
      , q = "event"
      , r = []
      , s = []
      , t = {}
      , u = {}
      , v = {
        LEFT_BUTTON: 1,
        RIGHT_BUTTON: 2,
        MIDDLE_BUTTON: 3
    }
      , w = (a.normalizeWheelDelta = function(a) {
        return a.wheelDelta ? a.wheelDelta < 0 ? -1 : 1 : a.detail ? a.detail < 0 ? 1 : -1 : 0
    }
    ,
    a.stopBubbling = function(a) {
        return e(a),
        !1
    }
    ,
    a.getTarget = function(a) {
        return a.target || a.srcElement
    }
    ,
    a.getRelatedTarget = function(a) {
        return a.relatedTarget || a.toElement
    }
    ,
    a.getCurrentTarget = function(a) {
        return a.currentTarget || a.toElement
    }
    ,
    a.disableSelect = function(a) {
        "undefined" != typeof a.onselectstart ? a.onselectstart = f : "undefined" != typeof a.style.MozUserSelect ? a.style.MozUserSelect = "none" : "undefined" != typeof a.style.KhtmlUserSelect ? a.style.KhtmlUserSelect = "none" : a.onmousedown = f
    }
    ,
    a.getMouseButton = function(a) {
        if (!a.which && a.button)
            switch (a.button) {
            case 1:
                return v.LEFT_BUTTON;
            case 2:
                return v.RIGHT_BUTTON;
            case 4:
                return v.MIDDLE_BUTTON;
            default:
                return -1
            }
        else {
            if (!a.which)
                throw new Error("The mouse button event must be either the w3c or ie event object");
            switch (a.which) {
            case 1:
                return v.LEFT_BUTTON;
            case 2:
                return v.MIDDLE_BUTTON;
            case 3:
                return v.RIGHT_BUTTON;
            default:
                return -1
            }
        }
    }
    ,
    a.getMockEvent = function(a) {
        var b = {};
        return a.clientX && (b.clientX = a.clientX),
        a.clientY && (b.clientY = a.clientY),
        a.screenX && (b.screenX = a.screenX),
        a.screenY && (b.screenY = a.screenY),
        a.pageX && (b.pageX = a.pageX),
        a.pageY && (b.pageY = a.pageY),
        a.target && (b.target = a.target),
        a.srcElement && (b.srcElement = a.srcElement),
        a.relatedTarget && (b.relatedTarget = a.relatedTarget),
        a.toElement && (b.toElement = a.toElement),
        a.wheelDelta && (b.wheelDelta = a.wheelDelta),
        a.detail && (b.detail = a.detail),
        a.which && (b.which = a.which),
        a.button && (b.button = a.button),
        b
    }
    ,
    a.isEventSupported = function() {
        function a(a) {
            var c = n(b[a] || "div");
            a = "on" + a;
            var d = a in c;
            return d || (c.setAttribute(a, "return;"),
            d = "function" == typeof c[a]),
            c = null ,
            d
        }
        var b = {
            select: "input",
            change: "input",
            submit: "form",
            reset: "form",
            error: "img",
            load: "img",
            abort: "img"
        };
        return a
    }(),
    a.removeListener = function(a) {
        if (!a)
            throw new Error("event.removeListener Error: Your must provide a handler to remove");
        a.remove && "function" == typeof a.remove && a.remove()
    }
    )
      , x = (a.batchRemoveListeners = function(a) {
        for (var b = 0; b < a.length; b++)
            w(a[b])
    }
    ,
    a.clearListeners = function(a, b) {
        var c = r.indexOf(a)
          , d = s.indexOf(a);
        if (c >= 0 && delete t[p + c][q + b],
        d >= 0) {
            var e = u[p + d][q + b];
            if (e) {
                for (var f = 0; f < e.length; f++)
                    e[f].remove();
                delete u[p + d][q + b]
            }
        }
    }
    ,
    a.clearNode = function A(a) {
        a.firstChild && A(a.firstChild),
        a.nextSibling && A(a.nextSibling),
        l(a)
    }
    ,
    a.trigger = function(a, b) {
        var c, d, e, f, g, h = r.indexOf(a), i = q + b;
        if (g = Array.apply(null , arguments).slice(2),
        h > -1 && (c = p + h,
        d = t[c][i])) {
            e = d.slice(0);
            for (var j = 0; j < e.length; j++)
                f = e[j],
                f.handler.apply(f.source, g)
        }
    }
    ,
    a.addListener = function(a, b, c) {
        return h(b, c),
        m(r, t, a, b, c)
    }
    )
      , y = a.addDomListener = function(a, b, c, d) {
        function e() {
            a.addEventListener ? a.addEventListener(b, c, d) : a.attachEvent ? a.attachEvent("on" + b, c) : a[b] = c
        }
        function f(b, d, e) {
            if (b && a.addEventListener)
                for (var f in b)
                    b.hasOwnProperty(f) && a.addEventListener(b[f], c, !1);
            else
                d && a.attachEvent ? a.attachEvent(d, c) : a[e] = c
        }
        switch (b) {
        case "mousewheel":
            f({
                firefox: "DOMMouseScroll",
                others: "mousewheel"
            }, "on" + b, "on" + b);
            break;
        case "readystatechange":
            f(null , null , "on" + b);
            break;
        default:
            e()
        }
        return m(s, u, a, b, c)
    }
      , z = a.callback = function(a, b) {
        if ("function" != typeof b)
            throw "The method parameter must be a function";
        return function() {
            return b.apply(a, Array.prototype.slice.call(arguments))
        }
    }
    ;
    a.bind = function(a, b, c, d) {
        return x(a, b, z(c, d))
    }
    ,
    a.bindDom = function(a, b, c, d) {
        return y(a, b, z(c, d))
    }
    ,
    a.callbackArgs = function(a, b) {
        var c;
        if ("function" != typeof b)
            throw "The method parameter must be a function";
        return c = Array.prototype.slice.call(arguments, 2),
        function() {
            return b.apply(a, Array.prototype.slice.call(arguments).concat(c))
        }
    }
    ,
    a.unload = function() {
        for (var a = r.length - 1; a >= 0; a--)
            j(a);
        for (var b = s.length - 1; b >= 0; b--)
            k(b)
    }
}),
nm_module("nm/metrics", function(a, b, c, d) {
    var e = b("jscore/itertools", "findIndex")
      , f = b("nm/console", "log")
      , g = a.CATEGORIES = {
        ProductUse: "Product-Use",
        SurveyUse: "Survey-Use",
        LayerUse: "Layer-Use",
        Limitations: "Limitations",
        Performance: "Performance",
        Error: "Error"
    }
      , h = a.ITEMS = [{
        category: g.ProductUse,
        action: "Context Menu",
        event: "showcontextmenu"
    }, {
        category: g.ProductUse,
        action: "Street View - Context Menu",
        event: "openStreetViewContextMenu"
    }, {
        category: g.ProductUse,
        action: "Zoom in - Context Menu",
        event: "zoomInContextMenu"
    }, {
        category: g.ProductUse,
        action: "Zoom out - Context Menu",
        event: "zoomOutContextMenu"
    }, {
        category: g.ProductUse,
        action: "Zoom all the way here - Context Menu",
        event: "zoomAllHereContextMenu",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Center map here - Context Menu",
        event: "centerMapContextMenu"
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap Photomaps",
        event: "maptype.nmPhotomaps",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap Terrain",
        event: "maptype.nmTerrain",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Google Roadmap",
        event: "maptype.roadmap",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap MultiView North",
        event: "maptype.nmMultiViewN",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap MultiView East",
        event: "maptype.nmMultiViewE",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap MultiView South",
        event: "maptype.nmMultiViewS",
        showInfo: !0
    }, {
        category: g.LayerUse,
        action: "Map type - Nearmap MultiView West",
        event: "maptype.nmMultiViewW",
        showInfo: !0
    }, {
        category: g.SurveyUse,
        action: "Survey - Timeline",
        event: "selectSurvey",
        showInfo: !0
    }, {
        category: g.SurveyUse,
        action: "Survey - Timeline - Latest",
        event: "selectMostRecentSurvey",
        showInfo: !0
    }, {
        category: g.SurveyUse,
        action: "Survey - Timeline - Drop-down Menu",
        event: "selectSurveyDropDown",
        showInfo: !0
    }, {
        category: g.SurveyUse,
        action: "Survey - Timeline - Mouse Wheel",
        event: "selectSurveyWheel",
        showInfo: !0
    }, {
        category: g.SurveyUse,
        action: "Survey - Timeline - Latest Dot",
        event: "selectSurveyLatestDot",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Search Box - Submit",
        event: "search",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Search Box - No Google Geocode Results",
        event: "search.noresults",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Search Box History - Item Selection",
        event: "search.history.selected",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Search Box History - Clear",
        event: "search.history.clear",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Search Box - Open Survey Email Capture",
        event: "search.surveynotif.open"
    }, {
        category: g.ProductUse,
        action: "Search Box - Survey Email Saved",
        event: "search.surveynotif.emailsaved"
    }, {
        category: g.ProductUse,
        action: "Search Box - Survey Email Capture Error",
        event: "search.surveynotif.error",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Splash Window",
        event: "splash"
    }, {
        category: g.ProductUse,
        action: "Save Image",
        event: "save.image"
    }, {
        category: g.ProductUse,
        action: "Terms and Conditions version update",
        event: "tc.updated",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Terms and Conditions accepted - Education",
        event: "tc.education.accepted",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Terms and Conditions declined - Education",
        event: "tc.education.declined",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Toolbar - Print",
        event: "toolbar.print",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Rail line selection",
        event: "rail.select",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Rail convert to path",
        event: "rail.convert"
    }, {
        category: g.Error,
        action: "Toolbar - Failed Init",
        event: "toolbarundefined",
        showInfo: !0
    }, {
        category: g.Error,
        action: "Terms and Conditions version update - Error",
        event: "error.tc.update",
        showInfo: !0
    }, {
        category: g.Error,
        action: "Local Storage - Browser Quota Exceeded",
        event: "localstorage.error",
        showInfo: !0
    }, {
        category: g.Error,
        action: "Terms and Conditions-Education - undefined TandC buttons.",
        event: "tc.education.callback.error",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Flooding layer parameters changed",
        event: "flooding.layer.params_changed",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "diff layer parameters changed",
        event: "compare.diff.layer.params_changed",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Shadowing layer parameters changed",
        event: "shadowing.layer.params_changed",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Volume Tool - Pit",
        event: "volume.pit-activated",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Volume Tool - Mound",
        event: "volume.mound-activated",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Volume Tool - Excavation",
        event: "volume.excavation-activated",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Line Tool - AutoTrack Play",
        event: "line.autotrack.play",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Path Tool - AutoTrack Play",
        event: "path.autotrack.play",
        showInfo: !0
    }, {
        category: g.ProductUse,
        action: "Area Tool - AutoTrack Play",
        event: "area.autotrack.play",
        showInfo: !0
    }]
      , i = a.auth = null 
      , j = a.eto = null 
      , k = a.source = null 
      , l = a.items = []
      , m = a._observers = {}
      , n = a._hasObservers = !1
      , o = a._actions = {}
      , p = a._bind = function(a, b) {
        return "function" != typeof b ? !1 : (a in o ? o[a].push(b) : o[a] = [b],
        {
            name: a,
            handlers: o[a]
        })
    }
      , q = a._unbind = function(a) {
        a in o && (o[a] = null ,
        delete o[a])
    }
      , r = (a.trigger = function(a, b) {
        if (a in o)
            for (var c = o[a].length - 1; c >= 0; c--)
                o[a][c](b);
        return !0
    }
    ,
    a._trackEvent = function(a, b, c, d) {
        j.call(null , "send", "event", {
            eventCategory: a,
            eventAction: b,
            eventLabel: c,
            eventValue: d
        }),
        f("Event tracker:", [a, b, c, d])
    }
    )
      , s = a._format = function(a, b) {
        var c = i.getUserId()
          , d = i.getPlanCode();
        if (!a)
            return void f("Metrics item is null (trackEvent).", a);
        var e, g = "UserId: " + c + " - Plan code: " + d;
        if ("object" == typeof b)
            b.hasOwnProperty("label") && b.hasOwnProperty("description") && (g += " - " + b.label + ": " + b.description),
            b.hasOwnProperty("value") && (e = b.value);
        else if (a.showInfo && k.hasOwnProperty("getZoom") && k.hasOwnProperty("getCenter")) {
            var h = k.getZoom()
              , j = k.getCenter().toUrlValue();
            g += " - Zoom to level: " + h + " - Location (Lat/Lon): " + j
        }
        r(a.category, a.action, g, e)
    }
      , t = a._setObservers = function() {
        return n ? void f("Metrics observers already set.") : (l.forEach(function(a) {
            m[a.event] = p(a.event, function(b) {
                s(a, b)
            })
        }),
        void (n = !0))
    }
      , u = (a.init = function(a, b, c, d) {
        return b && "function" == typeof b ? (i = a,
        j = b,
        k = c || {},
        l = d || h,
        void t()) : void f("Third party tracking code not set.")
    }
    ,
    a._removeObservers = function() {
        var a;
        if (!n)
            return void f("Metrics observers already removed.");
        for (var b = 0; b < l.length; b++)
            a = l[b],
            q(a.event),
            delete m[a.event],
            m[a.event] = null ;
        n = !1
    }
    );
    a.setEvent = function(a) {
        if (!a || "object" != typeof a)
            return !1;
        if (-1 === e(l, function(b) {
            return b.action === a.action
        }
        .bind(this))) {
            if (a.hasOwnProperty("event"))
                return l.push(a),
                p(a.event, function(b) {
                    s(a, b)
                }),
                !0;
            f("Metrics event could not be added, malformed event object:", a)
        }
        return !1
    }
    ,
    a.removeEvent = function(a) {
        q(a.event);
        var b = e(l, function(b) {
            return b === a
        }
        .bind(this));
        l.splice(b, 1)
    }
    ,
    a.stop = function() {
        u()
    }
    ,
    a.start = function() {
        t()
    }
    ,
    a.isObserving = function() {
        return n
    }
}),
nm_module("gooscr/notify", function(a, b) {
    "use strict";
    var c = b("nm/dom")
      , d = b("jscore/async").setTimeout
      , e = b("js-libs/jquery").jQuery
      , f = a;
    a.initialised = !1,
    a.container = null ,
    a.modalContainer = null ,
    a.modalBg = null ,
    a.defaults = {
        type: "information",
        duration: 5e3,
        animDuration: 500,
        closable: !0,
        modal: !1
    },
    a.notifications = [null ],
    a.init = function() {
        if (!f.initialised) {
            var a = document.body
              , b = f.container = c.createElement("div");
            b.className = "notify-container",
            a.appendChild(b);
            var d = f.modalContainer = c.createElement("div");
            d.className = "notify-modalContainer",
            document.body.appendChild(d);
            var g = f.modalBg = c.createElement("div");
            return g.className = "notify-modalBg",
            g.onclick = f.removeModals,
            document.body.appendChild(g),
            e(document).on("keydown.toolbar", function(a) {
                27 === a.which && f.removeModals()
            }),
            f.initialised = !0,
            !0
        }
    }
    ,
    a.fire = function(a, b) {
        f.initialised || f.init();
        var c = e.extend({}, f.defaults, b)
          , g = {
            html: a,
            time: f.time(),
            settings: c
        }
          , h = f.notifications.push(g) - 1;
        return f.create(h),
        "number" == typeof c.duration && d(function() {
            f.remove(h)
        }, c.animDuration + c.duration),
        h
    }
    ,
    a.alert = function(a, b) {
        return f.fireModalDialog(a, {
            text: "OK",
            callback: b
        })
    }
    ,
    a.confirm = function(a, b, c) {
        return f.fireModalDialog(a, {
            text: "OK",
            callback: b
        }, {
            text: "Cancel",
            callback: c
        })
    }
    ,
    a.confirmYesNo = function(a, b, c) {
        return f.fireModalDialog(a, {
            text: "Yes",
            callback: b
        }, {
            text: "No",
            callback: c
        })
    }
    ,
    a.fireModalDialog = function(a) {
        var b = Array.prototype.slice.call(arguments, 1)
          , c = e("<div>", {
            html: a,
            css: {
                textAlign: "center"
            }
        }).append("<br><br>");
        return e.each(b, function(a, b) {
            b.text && e("<div>", {
                text: b.text,
                "class": 0 === a ? "button primary" : "button",
                css: {
                    margin: "0.25em 0.5em"
                },
                click: function() {
                    b.callback && "function" == typeof b.callback && b.callback(),
                    f.removeModals()
                }
            }).appendTo(c)
        }),
        f.fire(c, {
            type: "information",
            duration: null ,
            animDuration: null ,
            closable: !1,
            modal: !0
        })
    }
    ,
    a.create = function(a) {
        if (!(a in f.notifications))
            return !1;
        var b = f.notifications[a]
          , g = b.$element = e("<div>", {
            "class": "notify-item notify-" + b.settings.type + " notify-adding",
            html: b.html
        })
          , h = g[0];
        if (b.settings.closable) {
            var i = c.createElement("div");
            i.className = "notify-close",
            i.onclick = function() {
                f.remove(a)
            }
            ,
            g.append(i)
        }
        return b.settings.modal ? (g.appendTo(f.modalContainer),
        f.modalBg.setAttribute("data-open", "")) : f.container.insertBefore(h, f.container.firstChild),
        d(function() {
            g.removeClass("notify-adding")
        }, 1),
        h
    }
    ,
    a.remove = function(a) {
        if (!(a in f.notifications))
            return !1;
        var b = f.notifications[a]
          , c = b.$element
          , e = b.settings.animDuration;
        c.addClass("notify-removing"),
        d(function() {
            c.remove()
        }, e),
        delete f.notifications[a];
        for (var g = !1, h = f.notifications.length - 1; h >= 0; h--)
            f.notifications[h] && f.notifications[h].settings.modal && (g = !0);
        return g || f.modalBg.removeAttribute("data-open"),
        !0
    }
    ,
    a.removeModals = function() {
        for (var a = f.notifications.length - 1; a >= 0; a--)
            f.notifications[a] && f.notifications[a].settings.modal && f.remove(a)
    }
    ,
    a.time = function() {
        return (new Date).getTime()
    }
}),
nm_module("nm/tools/authui", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("nm/tools/splash", "Splash")
      , h = b("nm/const/messages", "TITLES")
      , i = b("nm/const/messages", "SUBTITLES")
      , j = b("nm/const/messages", "TEXTS")
      , k = b("nm/const", "ENABLE_TC_UPDATE")
      , l = b("nm/dom", "createElement")
      , m = b("nm/dom", "createDocumentFragment")
      , n = b("nm/dom", "createTextNode")
      , o = b("nm/dom/event", "addDomListener")
      , p = b("nm/const/urls", "TOU")
      , q = b("nm/const/urls", "TERMS_OF_USE")
      , r = b("nm/const/endpoints", "API")
      , s = b("nm/ajax", "ajax")
      , t = b("nm/metrics", "trigger")
      , u = b("gooscr/notify", "fire")
      , v = b("gooscr/notify", "remove");
    a.AuthUI = c(Object, {
        constructor: function(a, b) {
            this.auth = b,
            this.splash = new g(a),
            b.addListener(f, e(this, this.handleAuthChange))
        },
        handleAuthChange: function() {
            var a = this.auth;
            a.loginRequired() && this.splash.create(h.Sorry, i.AuthenticationFailed, j.LoginAgain)
        }
    }),
    a.SurveysAuthUI = c(Object, {
        constructor: function(a, b) {
            this.auth = a,
            this.surveysCtl = b,
            this.activeNotification = null ,
            b.addListener(f, e(this, this.handleSurveysChange))
        },
        handleSurveysChange: function() {
            var a = !this.surveysCtl.isAreaAllowed()
              , b = this.activeNotification;
            if (a) {
                var c = '<h3 style="margin:5px;"><span>Out of your coverage boundaries</span></h3><p>The area you are trying to view is not included in your current plan.</p></div>';
                this.auth.isDemoUser() && (c += '<div style="margin-bottom:5px;"><a href="javascript:;" onclick="javascript:location.hash=\'\';location.reload();" class="button primary">Click here</a> to go back to the live demo area</div>'),
                null  === b && (this.activeNotification = u(c, {
                    closable: !1,
                    duration: !1,
                    type: "warning"
                }))
            } else
                null  !== b && (v(b),
                this.activeNotification = null )
        }
    }),
    a.TouUI = c(Object, {
        constructor: function(a, b) {
            this.auth = b,
            this.splash = new g(a),
            this.createUI()
        },
        createUI: function() {
            var a = this.auth.getAccountData();
            if (k && (!a.Result.hasOwnProperty("ShowTsAndCs") || a.Result.ShowTsAndCs !== !1)) {
                var b = this.splash
                  , c = m()
                  , d = l("a")
                  , f = l("button")
                  , g = l("p")
                  , h = n(" | ")
                  , i = "text-decoration:none; border-bottom:1px dotted #4074a5; color:#4074a5;"
                  , j = 'Please confirm your acceptance of our <a href="' + p + '" target="_blank" style="' + i + '">Terms of Use</a> to continue.';
                d.href = q,
                d.target = "_blank",
                d.innerHTML = "Questions?",
                d.style.cssText = i,
                f.innerHTML = "Agree &amp; Continue",
                f.className = "button primary",
                o(f, "click", e(this, this.agree)),
                g.innerHTML = j,
                c.appendChild(g),
                c.appendChild(f),
                c.appendChild(h),
                c.appendChild(d),
                b.create("Welcome to nearmap", "", c)
            }
        },
        agree: function() {
            var a = r.ACCEPT_TERMS + "?nmf=json&return200=true";
            s({
                type: "POST",
                dataType: "json",
                url: a,
                success: e(this, this.successTCUpdate),
                error: e(this, this.errorTCUpdate)
            })
        },
        successTCUpdate: function(a) {
            var b = this.splash;
            return a && a.AccountContext && a.Result ? a.Result && "Ok" !== a.Result ? void this.errorTCUpdate() : (t("tc.updated"),
            void b.remove()) : void this.errorTCUpdate()
        },
        errorTCUpdate: function() {
            var a = this.splash
              , b = l("div")
              , c = l("button");
            c.innerHTML = "Continue to maps",
            c.className = "button primary",
            c.onclick = a.remove,
            b.style.cssText = "margin:1em auto; padding:1em; background: #fad1d1; border-radius: 3px; color: #bc0a0a;",
            b.innerHTML = j.ErrorOccur + " " + j.ContactUs + "<br>",
            b.appendChild(c),
            a.getSplash().firstChild.appendChild(b),
            t("error.tc.update")
        }
    })
}),
nm_module("nm/const/tools", function(a, b, c, d) {
    a.VIEW_UP_TO_ZOOM_24 = "max_zoom_24.view",
    a.FREE_VIEW_UP_TO = 13,
    a.VIEW_ELEVATION_PROFILE = "feature_elevation",
    a.VIEW_ELEVATION_PROFILE_NM = "feature_elevation_nm",
    a.VIEW_TIMELINE_AUTOPLAY = "feature_timeline_autoplay",
    a.SOLAR_TOOL_KEY = "feature_solar_panels",
    a.PERSIST_SOLAR_DATA = "feature_solar_persist_data",
    a.PERSIST_SOLAR_PANELTYPES = "feature_solar_persist_paneltypes",
    a.PERSIST_MEASUREMENTS = "feature_persist_measurements",
    a.AUTO_CALC_SOLAR_DATA = "featur_auto_calc_solar_data",
    a.VIEW_TIMESTAMP = "feature_timestamp",
    a.REVERSE_GEOCODE_KEY = "feature_reverse_geocode",
    a.PROPERTY_KEY = "feature_parti_property_info",
    a.ART_DIRECT_LINK = "product_art",
    a.DATA_LAYERS_KEY = "feature_data_layers",
    a.IMPORT_GEOMETRY = "feature_geom_import",
    a.LOCATION_TOOL_KEY = "feature_location_info",
    a.MEASUREMENT_KEY = "measurement",
    a.MEASUREMENT_UNLIMITED_VERTICES = "unlimited_points_polygon",
    a.AUTOTRACK_KEY = "feature_autotrack",
    a.CIRCLE = "feature_circle",
    a.ADVANCED_SAVE_IMAGE_KEY = "feature_saveimage",
    a.SAVE_IMAGE_KEY = "product_saveimage",
    a.DEM_EXPORT_KEY = "feature_demexport",
    a.MAX_ZOOM_PREF = "max_zoom_",
    a.COMMON_MAX_ZOOM = "common_max_zoom",
    a.TIMELINE = "survey_latest",
    a.STREET_MAP = "feature_streetmap",
    a.MULTIVIEW = "multiview",
    a.TERRAIN = "terrain",
    a.SOLID_MAP = "feature_solidmap",
    a.SATELLITE = "feature_satellite",
    a.STREET_VIEW = "feature_streetview",
    a.PREVENT_COMMINGLING = "feature_nocommingling",
    a.USE_DISCOVERY_SETTINGS = "feature_use_discovery",
    a.PRINT = "feature_print",
    a.CREATE_VIDEO = "product_hyperanimate",
    a.EMAIL_CAPTURE = "feature_email_capture",
    a.CENTRE_MAP = "feature_centremap",
    a.LATLON = "feature_latlon",
    a.PROPERTY_REPORT = "product_property_report",
    a.DEMOGRAPHICS = "feature_demographics",
    a.PROPERTY_INFO = "feature_property_info",
    a.SITE_PLANNER_KEY = "feature_site_planner",
    a.LAYERS_MANAGER_KEY = "feature_layers_manager",
    a.DRAG_AND_DROP_FILE_KEY = "feature_drag_and_drop_file",
    a.LAYERS_MANAGER_NO_PERSISTENCE = "feature_no_persistence",
    a.LAYER_GEOJSON_LABELS = "feature_geojson_labels",
    a.COMPARE_TOOL_KEY = "feature_compare_tool",
    a.VOLUME_TOOL_KEY = "feature_volume_tool",
    a.VIEW_FLOODING = "feature_flooding",
    a.VIEW_SHADOWING = "feature_shadowing",
    a.VIEW_SHADOWING_OBJECTS = "feature_shadowing_objects",
    a.VIEW_DIFF = "feature_diff",
    a.VIEW_HOTZONE = "feature_hotzone",
    a.VIEW_DATA_LAYERS = "feature_data_layers_tab",
    a.INFO_MODE = "feature_info_mode",
    a.RAIL_TOOL_KEY = "feature_rail",
    a.SEARCH_WITH_RESTRICTION = "feature_search_with_restriction",
    a.VIEW_TIMELINE = "product_lite",
    a.DISABLE_TOUR = "feature_disable_tour",
    a.LITE = "product_lite",
    a.TRIAL = "trial",
    a.EDUCATION = "product_education",
    a.GOOGLE_MAPS = "product_googlemapbrowser",
    a.SOLAR_FEEDBACK_URL = "http://support.nearmap.com/customer/portal/articles/1483257",
    a.SOLAR_TUTORIAL_URL = "http://support.nearmap.com/customer/portal/articles/1483179",
    a.SOLAR_VIDEO_TUTORIAL_URL = "http://support.nearmap.com/customer/portal/articles/1487431",
    a.PROPERTY_LANDING_PAGE = "http://nearmap.com/au/property",
    a.ART_DIRECT_LINK_URL_TEMPLATE = "https://nearmap.agents.hometrack.com.au/report/index.cfm?event=ui#/create/{}/{}",
    a.TILT_DEFAULT = 22.5
}),
nm_module("nm/Usage", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("nm/const/tools", "VIEW_UP_TO_ZOOM_24")
      , g = b("nm/const/tools", "FREE_VIEW_UP_TO")
      , h = b("nm/tools/splash", "Splash")
      , i = b("nm/const/urls", "LOGOUT")
      , j = b("nm/const/urls", "ACCOUNT");
    a.Usage = c(Object, {
        constructor: function(a, b, c) {
            this.auth = b,
            this.map = c,
            this.container = a,
            this.splash = new h(a),
            this.zoom = c.getZoom(),
            this.center = c.getCenter(),
            c.addListener(e, function() {
                this.zoom === c.getZoom() && this.center === c.getCenter() || (this.zoom = c.getZoom(),
                this.center = c.getCenter(),
                this.checkUsage())
            }
            .bind(this))
        },
        checkUsage: function() {
            this.isOverUsage() && this.zoom > g && this.showUsageModal()
        },
        isOverUsage: function() {
            return !this.auth.can(f)
        },
        showUsageModal: function() {
            var a = ["\n            <p>\n                Access to nearmap imagery has been restricted.<br>\n                Please contact your administrator for more information.\n            </p>\n        "].join("")
              , b = ['\n            <p>\n                &rarr; <a href="', j, '">Account administration</a>\n            </p>\n            <p>\n                <p>\n                    <a href="', i, '" class="button primary">Close</a>\n                </p>\n            </p>\n        '].join("");
            this.splash.create("", a, b)
        }
    })
}),
nm_module("js-libs/google", function(a, b, c, d) {
    b("{Protocol}//maps.googleapis.com/maps/api/js?v=3.22&libraries=geometry{ClientID}"),
    b("{Protocol}//www.google.com/jsapi?autoload=%7B%22modules%22%3A%5B%7B%22name%22%3A%22visualization%22%2C%22version%22%3A%221%22%2C%22packages%22%3A%5B%22corechart%22%5D%7D%5D%7D");
    a.maps = google.maps,
    a.visualization = google.visualization || null 
}),
nm_module("js-libs/proj4", function(a, b, c, d) {
    function e(a, b, c, d, e, g, h, i, j) {
        var k, l, m, n, o, p, j = g;
        for (p = 1; 15 >= p; p++)
            if (k = Math.sin(j),
            m = Math.tan(j),
            i = m * Math.sqrt(1 - a * k * k),
            l = Math.sin(2 * j),
            n = b * j - c * l + d * Math.sin(4 * j) - e * Math.sin(6 * j),
            o = b - 2 * c * Math.cos(2 * j) + 4 * d * Math.cos(4 * j) - 6 * e * Math.cos(6 * j),
            k = 2 * n + i * (n * n + h) - 2 * g * (i * n + 1),
            m = a * l * (n * n + h - 2 * g * n) / (2 * i),
            i = 2 * (g - n) * (i * o - 2 / l) - 2 * o,
            k /= m + i,
            j += k,
            1e-10 >= Math.abs(k))
                return j;
        return f.reportError("phi4z: No convergence"),
        null 
    }
    var f = {
        defaultDatum: "WGS84",
        transform: function(a, b, c) {
            if (!a.readyToUse)
                return this.reportError("Proj4js initialization for:" + a.srsCode + " not yet complete"),
                c;
            if (!b.readyToUse)
                return this.reportError("Proj4js initialization for:" + b.srsCode + " not yet complete"),
                c;
            if (a.datum && b.datum && ((a.datum.datum_type == f.common.PJD_3PARAM || a.datum.datum_type == f.common.PJD_7PARAM) && "WGS84" != b.datumCode || (b.datum.datum_type == f.common.PJD_3PARAM || b.datum.datum_type == f.common.PJD_7PARAM) && "WGS84" != a.datumCode)) {
                var d = f.WGS84;
                this.transform(a, d, c),
                a = d
            }
            return "enu" != a.axis && this.adjust_axis(a, !1, c),
            "longlat" == a.projName ? (c.x *= f.common.D2R,
            c.y *= f.common.D2R) : (a.to_meter && (c.x *= a.to_meter,
            c.y *= a.to_meter),
            a.inverse(c)),
            a.from_greenwich && (c.x += a.from_greenwich),
            c = this.datum_transform(a.datum, b.datum, c),
            b.from_greenwich && (c.x -= b.from_greenwich),
            "longlat" == b.projName ? (c.x *= f.common.R2D,
            c.y *= f.common.R2D) : (b.forward(c),
            b.to_meter && (c.x /= b.to_meter,
            c.y /= b.to_meter)),
            "enu" != b.axis && this.adjust_axis(b, !0, c),
            c
        },
        datum_transform: function(a, b, c) {
            return a.compare_datums(b) || a.datum_type == f.common.PJD_NODATUM || b.datum_type == f.common.PJD_NODATUM ? c : (a.es == b.es && a.a == b.a && a.datum_type != f.common.PJD_3PARAM && a.datum_type != f.common.PJD_7PARAM && b.datum_type != f.common.PJD_3PARAM && b.datum_type != f.common.PJD_7PARAM || (a.geodetic_to_geocentric(c),
            (a.datum_type == f.common.PJD_3PARAM || a.datum_type == f.common.PJD_7PARAM) && a.geocentric_to_wgs84(c),
            (b.datum_type == f.common.PJD_3PARAM || b.datum_type == f.common.PJD_7PARAM) && b.geocentric_from_wgs84(c),
            b.geocentric_to_geodetic(c)),
            c)
        },
        adjust_axis: function(a, b, c) {
            for (var d, e, f = c.x, g = c.y, h = c.z || 0, i = 0; 3 > i; i++)
                if (!b || 2 != i || void 0 !== c.z)
                    switch (0 == i ? (d = f,
                    e = "x") : 1 == i ? (d = g,
                    e = "y") : (d = h,
                    e = "z"),
                    a.axis[i]) {
                    case "e":
                        c[e] = d;
                        break;
                    case "w":
                        c[e] = -d;
                        break;
                    case "n":
                        c[e] = d;
                        break;
                    case "s":
                        c[e] = -d;
                        break;
                    case "u":
                        void 0 !== c[e] && (c.z = d);
                        break;
                    case "d":
                        void 0 !== c[e] && (c.z = -d);
                        break;
                    default:
                        return alert("ERROR: unknow axis (" + a.axis[i] + ") - check definition of " + a.projName),
                        null 
                    }
            return c
        },
        reportError: function() {},
        extend: function(a, b) {
            if (a = a || {},
            b)
                for (var c in b) {
                    var d = b[c];
                    void 0 !== d && (a[c] = d)
                }
            return a
        },
        Class: function() {
            for (var a, b = function() {
                this.initialize.apply(this, arguments)
            }
            , c = {}, d = 0; d < arguments.length; ++d)
                a = "function" == typeof arguments[d] ? arguments[d].prototype : arguments[d],
                f.extend(c, a);
            return b.prototype = c,
            b
        },
        bind: function(a, b) {
            var c = Array.prototype.slice.apply(arguments, [2]);
            return function() {
                var d = c.concat(Array.prototype.slice.apply(arguments, [0]));
                return a.apply(b, d)
            }
        },
        scriptName: "proj4js-compressed.js",
        defsLookupService: "http://spatialreference.org/ref",
        libPath: null ,
        getScriptLocation: function() {
            if (this.libPath)
                return this.libPath;
            for (var a = this.scriptName, b = a.length, c = document.getElementsByTagName("script"), d = 0; d < c.length; d++) {
                var e = c[d].getAttribute("src");
                if (e) {
                    var f = e.lastIndexOf(a);
                    if (f > -1 && f + b == e.length) {
                        this.libPath = e.slice(0, -b);
                        break
                    }
                }
            }
            return this.libPath || ""
        },
        loadScript: function(a, b, c, d) {
            var e = document.createElement("script");
            e.defer = !1,
            e.type = "text/javascript",
            e.id = a,
            e.src = a,
            e.onload = b,
            e.onerror = c,
            e.loadCheck = d,
            /MSIE/.test(navigator.userAgent) && (e.onreadystatechange = this.checkReadyState),
            document.getElementsByTagName("head")[0].appendChild(e)
        },
        checkReadyState: function() {
            "loaded" == this.readyState && (this.loadCheck() ? this.onload() : this.onerror())
        }
    };
    f.Proj = f.Class({
        readyToUse: !1,
        title: null ,
        projName: null ,
        units: null ,
        datum: null ,
        x0: 0,
        y0: 0,
        localCS: !1,
        queue: null ,
        initialize: function(a, b) {
            if (this.srsCodeInput = a,
            this.queue = [],
            b && this.queue.push(b),
            0 <= a.indexOf("GEOGCS") || 0 <= a.indexOf("GEOCCS") || 0 <= a.indexOf("PROJCS") || 0 <= a.indexOf("LOCAL_CS"))
                this.parseWKT(a),
                this.deriveConstants(),
                this.loadProjCode(this.projName);
            else {
                if (0 == a.indexOf("urn:")) {
                    var c = a.split(":");
                    "ogc" != c[1] && "x-ogc" != c[1] || "def" != c[2] || "crs" != c[3] || (a = c[4] + ":" + c[c.length - 1])
                } else
                    0 == a.indexOf("http://") && (c = a.split("#"),
                    c[0].match(/epsg.org/) ? a = "EPSG:" + c[1] : c[0].match(/RIG.xml/) && (a = "IGNF:" + c[1]));
                this.srsCode = a.toUpperCase(),
                0 == this.srsCode.indexOf("EPSG") ? (this.srsCode = this.srsCode,
                this.srsAuth = "epsg",
                this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("IGNF") ? (this.srsCode = this.srsCode,
                this.srsAuth = "IGNF",
                this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("CRS") ? (this.srsCode = this.srsCode,
                this.srsAuth = "CRS",
                this.srsProjNumber = this.srsCode.substring(4)) : (this.srsAuth = "",
                this.srsProjNumber = this.srsCode),
                this.loadProjDefinition()
            }
        },
        loadProjDefinition: function() {
            if (f.defs[this.srsCode])
                this.defsLoaded();
            else {
                var a = f.getScriptLocation() + "defs/" + this.srsAuth.toUpperCase() + this.srsProjNumber + ".js";
                f.loadScript(a, f.bind(this.defsLoaded, this), f.bind(this.loadFromService, this), f.bind(this.checkDefsLoaded, this))
            }
        },
        loadFromService: function() {
            f.loadScript(f.defsLookupService + "/" + this.srsAuth + "/" + this.srsProjNumber + "/proj4js/", f.bind(this.defsLoaded, this), f.bind(this.defsFailed, this), f.bind(this.checkDefsLoaded, this))
        },
        defsLoaded: function() {
            this.parseDefs(),
            this.loadProjCode(this.projName)
        },
        checkDefsLoaded: function() {
            return !!f.defs[this.srsCode]
        },
        defsFailed: function() {
            f.reportError("failed to load projection definition for: " + this.srsCode),
            f.defs[this.srsCode] = f.defs.WGS84,
            this.defsLoaded()
        },
        loadProjCode: function(a) {
            if (f.Proj[a])
                this.initTransforms();
            else {
                var b = f.getScriptLocation() + "projCode/" + a + ".js";
                f.loadScript(b, f.bind(this.loadProjCodeSuccess, this, a), f.bind(this.loadProjCodeFailure, this, a), f.bind(this.checkCodeLoaded, this, a))
            }
        },
        loadProjCodeSuccess: function(a) {
            f.Proj[a].dependsOn ? this.loadProjCode(f.Proj[a].dependsOn) : this.initTransforms()
        },
        loadProjCodeFailure: function(a) {
            f.reportError("failed to find projection file for: " + a)
        },
        checkCodeLoaded: function(a) {
            return !!f.Proj[a]
        },
        initTransforms: function() {
            if (f.extend(this, f.Proj[this.projName]),
            this.init(),
            this.readyToUse = !0,
            this.queue)
                for (var a; a = this.queue.shift(); )
                    a.call(this, this)
        },
        wktRE: /^(\w+)\[(.*)\]$/,
        parseWKT: function(a) {
            if (a = a.match(this.wktRE)) {
                var b, c = a[1], d = a[2].split(",");
                b = "TOWGS84" == c.toUpperCase() ? c : d.shift(),
                b = b.replace(/^\"/, ""),
                b = b.replace(/\"$/, "");
                for (var a = [], e = 0, g = "", h = 0; h < d.length; ++h) {
                    for (var i = d[h], j = 0; j < i.length; ++j)
                        "[" == i.charAt(j) && ++e,
                        "]" == i.charAt(j) && --e;
                    g += i,
                    0 === e ? (a.push(g),
                    g = "") : g += ","
                }
                switch (c) {
                case "LOCAL_CS":
                    this.projName = "identity",
                    this.localCS = !0,
                    this.srsCode = b;
                    break;
                case "GEOGCS":
                    this.projName = "longlat",
                    this.geocsCode = b,
                    this.srsCode || (this.srsCode = b);
                    break;
                case "PROJCS":
                    this.srsCode = b;
                    break;
                case "PROJECTION":
                    this.projName = f.wktProjections[b];
                    break;
                case "DATUM":
                    this.datumName = b;
                    break;
                case "LOCAL_DATUM":
                    this.datumCode = "none";
                    break;
                case "SPHEROID":
                    this.ellps = b,
                    this.a = parseFloat(a.shift()),
                    this.rf = parseFloat(a.shift());
                    break;
                case "PRIMEM":
                    this.from_greenwich = parseFloat(a.shift());
                    break;
                case "UNIT":
                    this.units = b,
                    this.unitsPerMeter = parseFloat(a.shift());
                    break;
                case "PARAMETER":
                    switch (c = b.toLowerCase(),
                    d = parseFloat(a.shift()),
                    c) {
                    case "false_easting":
                        this.x0 = d;
                        break;
                    case "false_northing":
                        this.y0 = d;
                        break;
                    case "scale_factor":
                        this.k0 = d;
                        break;
                    case "central_meridian":
                        this.long0 = d * f.common.D2R;
                        break;
                    case "latitude_of_origin":
                        this.lat0 = d * f.common.D2R
                    }
                    break;
                case "TOWGS84":
                    this.datum_params = a;
                    break;
                case "AXIS":
                    switch (c = b.toLowerCase(),
                    d = a.shift()) {
                    case "EAST":
                        d = "e";
                        break;
                    case "WEST":
                        d = "w";
                        break;
                    case "NORTH":
                        d = "n";
                        break;
                    case "SOUTH":
                        d = "s";
                        break;
                    case "UP":
                        d = "u";
                        break;
                    case "DOWN":
                        d = "d";
                        break;
                    default:
                        d = " "
                    }
                    switch (this.axis || (this.axis = "enu"),
                    c) {
                    case "x":
                        this.axis = d + this.axis.substr(1, 2);
                        break;
                    case "y":
                        this.axis = this.axis.substr(0, 1) + d + this.axis.substr(2, 1);
                        break;
                    case "z":
                        this.axis = this.axis.substr(0, 2) + d
                    }
                }
                for (h = 0; h < a.length; ++h)
                    this.parseWKT(a[h])
            }
        },
        parseDefs: function() {
            this.defData = f.defs[this.srsCode];
            var a, b;
            if (this.defData) {
                for (var c = this.defData.split("+"), d = 0; d < c.length; d++)
                    switch (b = c[d].split("="),
                    a = b[0].toLowerCase(),
                    b = b[1],
                    a.replace(/\s/gi, "")) {
                    case "title":
                        this.title = b;
                        break;
                    case "proj":
                        this.projName = b.replace(/\s/gi, "");
                        break;
                    case "units":
                        this.units = b.replace(/\s/gi, "");
                        break;
                    case "datum":
                        this.datumCode = b.replace(/\s/gi, "");
                        break;
                    case "nadgrids":
                        this.nagrids = b.replace(/\s/gi, "");
                        break;
                    case "ellps":
                        this.ellps = b.replace(/\s/gi, "");
                        break;
                    case "a":
                        this.a = parseFloat(b);
                        break;
                    case "b":
                        this.b = parseFloat(b);
                        break;
                    case "rf":
                        this.rf = parseFloat(b);
                        break;
                    case "lat_0":
                        this.lat0 = b * f.common.D2R;
                        break;
                    case "lat_1":
                        this.lat1 = b * f.common.D2R;
                        break;
                    case "lat_2":
                        this.lat2 = b * f.common.D2R;
                        break;
                    case "lat_ts":
                        this.lat_ts = b * f.common.D2R;
                        break;
                    case "lon_0":
                        this.long0 = b * f.common.D2R;
                        break;
                    case "alpha":
                        this.alpha = parseFloat(b) * f.common.D2R;
                        break;
                    case "lonc":
                        this.longc = b * f.common.D2R;
                        break;
                    case "x_0":
                        this.x0 = parseFloat(b);
                        break;
                    case "y_0":
                        this.y0 = parseFloat(b);
                        break;
                    case "k_0":
                        this.k0 = parseFloat(b);
                        break;
                    case "k":
                        this.k0 = parseFloat(b);
                        break;
                    case "r_a":
                        this.R_A = !0;
                        break;
                    case "zone":
                        this.zone = parseInt(b, 10);
                        break;
                    case "south":
                        this.utmSouth = !0;
                        break;
                    case "towgs84":
                        this.datum_params = b.split(",");
                        break;
                    case "to_meter":
                        this.to_meter = parseFloat(b);
                        break;
                    case "from_greenwich":
                        this.from_greenwich = b * f.common.D2R;
                        break;
                    case "pm":
                        b = b.replace(/\s/gi, ""),
                        this.from_greenwich = f.PrimeMeridian[b] ? f.PrimeMeridian[b] : parseFloat(b),
                        this.from_greenwich *= f.common.D2R;
                        break;
                    case "axis":
                        b = b.replace(/\s/gi, ""),
                        3 == b.length && -1 != "ewnsud".indexOf(b.substr(0, 1)) && -1 != "ewnsud".indexOf(b.substr(1, 1)) && -1 != "ewnsud".indexOf(b.substr(2, 1)) && (this.axis = b)
                    }
                this.deriveConstants()
            }
        },
        deriveConstants: function() {
            if ("@null" == this.nagrids && (this.datumCode = "none"),
            this.datumCode && "none" != this.datumCode) {
                var a = f.Datum[this.datumCode];
                a && (this.datum_params = a.towgs84 ? a.towgs84.split(",") : null ,
                this.ellps = a.ellipse,
                this.datumName = a.datumName ? a.datumName : this.datumCode)
            }
            this.a || f.extend(this, f.Ellipsoid[this.ellps] ? f.Ellipsoid[this.ellps] : f.Ellipsoid.WGS84),
            this.rf && !this.b && (this.b = (1 - 1 / this.rf) * this.a),
            (0 === this.rf || Math.abs(this.a - this.b) < f.common.EPSLN) && (this.sphere = !0,
            this.b = this.a),
            this.a2 = this.a * this.a,
            this.b2 = this.b * this.b,
            this.es = (this.a2 - this.b2) / this.a2,
            this.e = Math.sqrt(this.es),
            this.R_A && (this.a *= 1 - this.es * (f.common.SIXTH + this.es * (f.common.RA4 + this.es * f.common.RA6)),
            this.a2 = this.a * this.a,
            this.b2 = this.b * this.b,
            this.es = 0),
            this.ep2 = (this.a2 - this.b2) / this.b2,
            this.k0 || (this.k0 = 1),
            this.axis || (this.axis = "enu"),
            this.datum = new f.datum(this)
        }
    }),
    f.Proj.longlat = {
        init: function() {},
        forward: function(a) {
            return a
        },
        inverse: function(a) {
            return a
        }
    },
    f.Proj.identity = f.Proj.longlat,
    f.defs = {
        WGS84: "+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees",
        "EPSG:4326": "+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees",
        "EPSG:4269": "+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees",
        "EPSG:3875": "+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"
    },
    f.defs["EPSG:3785"] = f.defs["EPSG:3875"],
    f.defs.GOOGLE = f.defs["EPSG:3875"],
    f.defs["EPSG:900913"] = f.defs["EPSG:3875"],
    f.defs["EPSG:102113"] = f.defs["EPSG:3875"],
    f.common = {
        PI: 3.141592653589793,
        HALF_PI: 1.5707963267948966,
        TWO_PI: 6.283185307179586,
        FORTPI: .7853981633974483,
        R2D: 57.29577951308232,
        D2R: .017453292519943295,
        SEC_TO_RAD: 484813681109536e-20,
        EPSLN: 1e-10,
        MAX_ITER: 20,
        COS_67P5: .3826834323650898,
        AD_C: 1.0026,
        PJD_UNKNOWN: 0,
        PJD_3PARAM: 1,
        PJD_7PARAM: 2,
        PJD_GRIDSHIFT: 3,
        PJD_WGS84: 4,
        PJD_NODATUM: 5,
        SRS_WGS84_SEMIMAJOR: 6378137,
        SIXTH: .16666666666666666,
        RA4: .04722222222222222,
        RA6: .022156084656084655,
        RV4: .06944444444444445,
        RV6: .04243827160493827,
        msfnz: function(a, b, c) {
            return a *= b,
            c / Math.sqrt(1 - a * a)
        },
        tsfnz: function(a, b, c) {
            return c *= a,
            c = Math.pow((1 - c) / (1 + c), .5 * a),
            Math.tan(.5 * (this.HALF_PI - b)) / c
        },
        phi2z: function(a, b) {
            for (var c, d = .5 * a, e = this.HALF_PI - 2 * Math.atan(b), f = 0; 15 >= f; f++)
                if (c = a * Math.sin(e),
                c = this.HALF_PI - 2 * Math.atan(b * Math.pow((1 - c) / (1 + c), d)) - e,
                e += c,
                1e-10 >= Math.abs(c))
                    return e;
            return alert("phi2z has NoConvergence"),
            -9999
        },
        qsfnz: function(a, b) {
            var c;
            return a > 1e-7 ? (c = a * b,
            (1 - a * a) * (b / (1 - c * c) - .5 / a * Math.log((1 - c) / (1 + c)))) : 2 * b
        },
        asinz: function(a) {
            return 1 < Math.abs(a) && (a = a > 1 ? 1 : -1),
            Math.asin(a)
        },
        e0fn: function(a) {
            return 1 - .25 * a * (1 + a / 16 * (3 + 1.25 * a))
        },
        e1fn: function(a) {
            return .375 * a * (1 + .25 * a * (1 + .46875 * a))
        },
        e2fn: function(a) {
            return .05859375 * a * a * (1 + .75 * a)
        },
        e3fn: function(a) {
            return a * a * a * (35 / 3072)
        },
        mlfn: function(a, b, c, d, e) {
            return a * e - b * Math.sin(2 * e) + c * Math.sin(4 * e) - d * Math.sin(6 * e)
        },
        srat: function(a, b) {
            return Math.pow((1 - a) / (1 + a), b)
        },
        sign: function(a) {
            return 0 > a ? -1 : 1
        },
        adjust_lon: function(a) {
            return a = Math.abs(a) < this.PI ? a : a - this.sign(a) * this.TWO_PI
        },
        adjust_lat: function(a) {
            return a = Math.abs(a) < this.HALF_PI ? a : a - this.sign(a) * this.PI
        },
        latiso: function(a, b, c) {
            return Math.abs(b) > this.HALF_PI ? +Number.NaN : b == this.HALF_PI ? Number.POSITIVE_INFINITY : b == -1 * this.HALF_PI ? -1 * Number.POSITIVE_INFINITY : (c *= a,
            Math.log(Math.tan((this.HALF_PI + b) / 2)) + a * Math.log((1 - c) / (1 + c)) / 2)
        },
        fL: function(a, b) {
            return 2 * Math.atan(a * Math.exp(b)) - this.HALF_PI
        },
        invlatiso: function(a, b) {
            var c = this.fL(1, b)
              , d = 0
              , e = 0;
            do
                d = c,
                e = a * Math.sin(d),
                c = this.fL(Math.exp(a * Math.log((1 + e) / (1 - e)) / 2), b);
            while (1e-12 < Math.abs(c - d));return c
        },
        sinh: function(a) {
            return a = Math.exp(a),
            (a - 1 / a) / 2
        },
        cosh: function(a) {
            return a = Math.exp(a),
            (a + 1 / a) / 2
        },
        tanh: function(a) {
            return a = Math.exp(a),
            (a - 1 / a) / (a + 1 / a)
        },
        asinh: function(a) {
            return (a >= 0 ? 1 : -1) * Math.log(Math.abs(a) + Math.sqrt(a * a + 1))
        },
        acosh: function(a) {
            return 2 * Math.log(Math.sqrt((a + 1) / 2) + Math.sqrt((a - 1) / 2))
        },
        atanh: function(a) {
            return Math.log((a - 1) / (a + 1)) / 2
        },
        gN: function(a, b, c) {
            return b *= c,
            a / Math.sqrt(1 - b * b)
        },
        pj_enfn: function(a) {
            var b = [];
            b[0] = this.C00 - a * (this.C02 + a * (this.C04 + a * (this.C06 + a * this.C08))),
            b[1] = a * (this.C22 - a * (this.C04 + a * (this.C06 + a * this.C08)));
            var c = a * a;
            return b[2] = c * (this.C44 - a * (this.C46 + a * this.C48)),
            c *= a,
            b[3] = c * (this.C66 - a * this.C68),
            b[4] = c * a * this.C88,
            b
        },
        pj_mlfn: function(a, b, c, d) {
            return c *= b,
            b *= b,
            d[0] * a - c * (d[1] + b * (d[2] + b * (d[3] + b * d[4])))
        },
        pj_inv_mlfn: function(a, b, c) {
            for (var d = 1 / (1 - b), e = a, g = f.common.MAX_ITER; g; --g) {
                var h = Math.sin(e)
                  , i = 1 - b * h * h
                  , i = (this.pj_mlfn(e, h, Math.cos(e), c) - a) * i * Math.sqrt(i) * d
                  , e = e - i;
                if (Math.abs(i) < f.common.EPSLN)
                    return e
            }
            return f.reportError("cass:pj_inv_mlfn: Convergence error"),
            e
        },
        C00: 1,
        C02: .25,
        C04: .046875,
        C06: .01953125,
        C08: .01068115234375,
        C22: .75,
        C44: .46875,
        C46: .013020833333333334,
        C48: .007120768229166667,
        C66: .3645833333333333,
        C68: .005696614583333333,
        C88: .3076171875
    },
    f.datum = f.Class({
        initialize: function(a) {
            if (this.datum_type = f.common.PJD_WGS84,
            a.datumCode && "none" == a.datumCode && (this.datum_type = f.common.PJD_NODATUM),
            a && a.datum_params) {
                for (var b = 0; b < a.datum_params.length; b++)
                    a.datum_params[b] = parseFloat(a.datum_params[b]);
                0 == a.datum_params[0] && 0 == a.datum_params[1] && 0 == a.datum_params[2] || (this.datum_type = f.common.PJD_3PARAM),
                3 < a.datum_params.length && (0 != a.datum_params[3] || 0 != a.datum_params[4] || 0 != a.datum_params[5] || 0 != a.datum_params[6]) && (this.datum_type = f.common.PJD_7PARAM,
                a.datum_params[3] *= f.common.SEC_TO_RAD,
                a.datum_params[4] *= f.common.SEC_TO_RAD,
                a.datum_params[5] *= f.common.SEC_TO_RAD,
                a.datum_params[6] = a.datum_params[6] / 1e6 + 1)
            }
            a && (this.a = a.a,
            this.b = a.b,
            this.es = a.es,
            this.ep2 = a.ep2,
            this.datum_params = a.datum_params)
        },
        compare_datums: function(a) {
            return this.datum_type != a.datum_type || this.a != a.a || 5e-11 < Math.abs(this.es - a.es) ? !1 : this.datum_type == f.common.PJD_3PARAM ? this.datum_params[0] == a.datum_params[0] && this.datum_params[1] == a.datum_params[1] && this.datum_params[2] == a.datum_params[2] : this.datum_type == f.common.PJD_7PARAM ? this.datum_params[0] == a.datum_params[0] && this.datum_params[1] == a.datum_params[1] && this.datum_params[2] == a.datum_params[2] && this.datum_params[3] == a.datum_params[3] && this.datum_params[4] == a.datum_params[4] && this.datum_params[5] == a.datum_params[5] && this.datum_params[6] == a.datum_params[6] : this.datum_type == f.common.PJD_GRIDSHIFT || a.datum_type == f.common.PJD_GRIDSHIFT ? (alert("ERROR: Grid shift transformations are not implemented."),
            !1) : !0
        },
        geodetic_to_geocentric: function(a) {
            var b, c, d, e = a.x, g = a.y, h = a.z ? a.z : 0;
            if (g < -f.common.HALF_PI && g > -1.001 * f.common.HALF_PI)
                g = -f.common.HALF_PI;
            else if (g > f.common.HALF_PI && g < 1.001 * f.common.HALF_PI)
                g = f.common.HALF_PI;
            else if (g < -f.common.HALF_PI || g > f.common.HALF_PI)
                return f.reportError("geocent:lat out of range:" + g),
                null ;
            return e > f.common.PI && (e -= 2 * f.common.PI),
            c = Math.sin(g),
            d = Math.cos(g),
            b = this.a / Math.sqrt(1 - this.es * c * c),
            g = (b + h) * d * Math.cos(e),
            e = (b + h) * d * Math.sin(e),
            h = (b * (1 - this.es) + h) * c,
            a.x = g,
            a.y = e,
            a.z = h,
            0
        },
        geocentric_to_geodetic: function(a) {
            var b, c, d, e, f, g, h, i, j, k, l = a.x;
            d = a.y;
            var m = a.z ? a.z : 0;
            if (b = Math.sqrt(l * l + d * d),
            c = Math.sqrt(l * l + d * d + m * m),
            1e-12 > b / this.a) {
                if (l = 0,
                1e-12 > c / this.a)
                    return
            } else
                l = Math.atan2(d, l);
            d = m / c,
            e = b / c,
            f = 1 / Math.sqrt(1 - this.es * (2 - this.es) * e * e),
            h = e * (1 - this.es) * f,
            i = d * f,
            k = 0;
            do
                k++,
                g = this.a / Math.sqrt(1 - this.es * i * i),
                c = b * h + m * i - g * (1 - this.es * i * i),
                g = this.es * g / (g + c),
                f = 1 / Math.sqrt(1 - g * (2 - g) * e * e),
                g = e * (1 - g) * f,
                f *= d,
                j = f * h - g * i,
                h = g,
                i = f;
            while (j * j > 1e-24 && 30 > k);return b = Math.atan(f / Math.abs(g)),
            a.x = l,
            a.y = b,
            a.z = c,
            a
        },
        geocentric_to_geodetic_noniter: function(a) {
            var b, c, d, e, g, h = a.x, i = a.y, j = a.z ? a.z : 0, h = parseFloat(h), i = parseFloat(i), j = parseFloat(j);
            if (g = !1,
            0 != h)
                b = Math.atan2(i, h);
            else if (i > 0)
                b = f.common.HALF_PI;
            else if (0 > i)
                b = -f.common.HALF_PI;
            else if (g = !0,
            b = 0,
            j > 0)
                c = f.common.HALF_PI;
            else {
                if (!(0 > j))
                    return;
                c = -f.common.HALF_PI
            }
            return d = h * h + i * i,
            h = Math.sqrt(d),
            i = j * f.common.AD_C,
            d = Math.sqrt(i * i + d),
            i /= d,
            d = h / d,
            i = j + this.b * this.ep2 * i * i * i,
            e = h - this.a * this.es * d * d * d,
            d = Math.sqrt(i * i + e * e),
            i /= d,
            d = e / d,
            e = this.a / Math.sqrt(1 - this.es * i * i),
            j = d >= f.common.COS_67P5 ? h / d - e : d <= -f.common.COS_67P5 ? h / -d - e : j / i + e * (this.es - 1),
            0 == g && (c = Math.atan(i / d)),
            a.x = b,
            a.y = c,
            a.z = j,
            a
        },
        geocentric_to_wgs84: function(a) {
            if (this.datum_type == f.common.PJD_3PARAM)
                a.x += this.datum_params[0],
                a.y += this.datum_params[1],
                a.z += this.datum_params[2];
            else if (this.datum_type == f.common.PJD_7PARAM) {
                var b = this.datum_params[3]
                  , c = this.datum_params[4]
                  , d = this.datum_params[5]
                  , e = this.datum_params[6]
                  , g = e * (d * a.x + a.y - b * a.z) + this.datum_params[1]
                  , b = e * (-c * a.x + b * a.y + a.z) + this.datum_params[2];
                a.x = e * (a.x - d * a.y + c * a.z) + this.datum_params[0],
                a.y = g,
                a.z = b
            }
        },
        geocentric_from_wgs84: function(a) {
            if (this.datum_type == f.common.PJD_3PARAM)
                a.x -= this.datum_params[0],
                a.y -= this.datum_params[1],
                a.z -= this.datum_params[2];
            else if (this.datum_type == f.common.PJD_7PARAM) {
                var b = this.datum_params[3]
                  , c = this.datum_params[4]
                  , d = this.datum_params[5]
                  , e = this.datum_params[6]
                  , g = (a.x - this.datum_params[0]) / e
                  , h = (a.y - this.datum_params[1]) / e
                  , e = (a.z - this.datum_params[2]) / e;
                a.x = g + d * h - c * e,
                a.y = -d * g + h + b * e,
                a.z = c * g - b * h + e
            }
        }
    }),
    f.Point = f.Class({
        initialize: function(a, b, c) {
            "object" == typeof a ? (this.x = a[0],
            this.y = a[1],
            this.z = a[2] || 0) : "string" == typeof a && "undefined" == typeof b ? (a = a.split(","),
            this.x = parseFloat(a[0]),
            this.y = parseFloat(a[1]),
            this.z = parseFloat(a[2]) || 0) : (this.x = a,
            this.y = b,
            this.z = c || 0)
        },
        clone: function() {
            return new f.Point(this.x,this.y,this.z)
        },
        toString: function() {
            return "x=" + this.x + ",y=" + this.y
        },
        toShortString: function() {
            return this.x + ", " + this.y
        }
    }),
    f.PrimeMeridian = {
        greenwich: 0,
        lisbon: -9.131906111111,
        paris: 2.337229166667,
        bogota: -74.080916666667,
        madrid: -3.687938888889,
        rome: 12.452333333333,
        bern: 7.439583333333,
        jakarta: 106.807719444444,
        ferro: -17.666666666667,
        brussels: 4.367975,
        stockholm: 18.058277777778,
        athens: 23.7163375,
        oslo: 10.722916666667
    },
    f.Ellipsoid = {
        MERIT: {
            a: 6378137,
            rf: 298.257,
            ellipseName: "MERIT 1983"
        },
        SGS85: {
            a: 6378136,
            rf: 298.257,
            ellipseName: "Soviet Geodetic System 85"
        },
        GRS80: {
            a: 6378137,
            rf: 298.257222101,
            ellipseName: "GRS 1980(IUGG, 1980)"
        },
        IAU76: {
            a: 6378140,
            rf: 298.257,
            ellipseName: "IAU 1976"
        },
        airy: {
            a: 6377563.396,
            b: 6356256.91,
            ellipseName: "Airy 1830"
        },
        "APL4.": {
            a: 6378137,
            rf: 298.25,
            ellipseName: "Appl. Physics. 1965"
        },
        NWL9D: {
            a: 6378145,
            rf: 298.25,
            ellipseName: "Naval Weapons Lab., 1965"
        },
        mod_airy: {
            a: 6377340.189,
            b: 6356034.446,
            ellipseName: "Modified Airy"
        },
        andrae: {
            a: 6377104.43,
            rf: 300,
            ellipseName: "Andrae 1876 (Den., Iclnd.)"
        },
        aust_SA: {
            a: 6378160,
            rf: 298.25,
            ellipseName: "Australian Natl & S. Amer. 1969"
        },
        GRS67: {
            a: 6378160,
            rf: 298.247167427,
            ellipseName: "GRS 67(IUGG 1967)"
        },
        bessel: {
            a: 6377397.155,
            rf: 299.1528128,
            ellipseName: "Bessel 1841"
        },
        bess_nam: {
            a: 6377483.865,
            rf: 299.1528128,
            ellipseName: "Bessel 1841 (Namibia)"
        },
        clrk66: {
            a: 6378206.4,
            b: 6356583.8,
            ellipseName: "Clarke 1866"
        },
        clrk80: {
            a: 6378249.145,
            rf: 293.4663,
            ellipseName: "Clarke 1880 mod."
        },
        CPM: {
            a: 6375738.7,
            rf: 334.29,
            ellipseName: "Comm. des Poids et Mesures 1799"
        },
        delmbr: {
            a: 6376428,
            rf: 311.5,
            ellipseName: "Delambre 1810 (Belgium)"
        },
        engelis: {
            a: 6378136.05,
            rf: 298.2566,
            ellipseName: "Engelis 1985"
        },
        evrst30: {
            a: 6377276.345,
            rf: 300.8017,
            ellipseName: "Everest 1830"
        },
        evrst48: {
            a: 6377304.063,
            rf: 300.8017,
            ellipseName: "Everest 1948"
        },
        evrst56: {
            a: 6377301.243,
            rf: 300.8017,
            ellipseName: "Everest 1956"
        },
        evrst69: {
            a: 6377295.664,
            rf: 300.8017,
            ellipseName: "Everest 1969"
        },
        evrstSS: {
            a: 6377298.556,
            rf: 300.8017,
            ellipseName: "Everest (Sabah & Sarawak)"
        },
        fschr60: {
            a: 6378166,
            rf: 298.3,
            ellipseName: "Fischer (Mercury Datum) 1960"
        },
        fschr60m: {
            a: 6378155,
            rf: 298.3,
            ellipseName: "Fischer 1960"
        },
        fschr68: {
            a: 6378150,
            rf: 298.3,
            ellipseName: "Fischer 1968"
        },
        helmert: {
            a: 6378200,
            rf: 298.3,
            ellipseName: "Helmert 1906"
        },
        hough: {
            a: 6378270,
            rf: 297,
            ellipseName: "Hough"
        },
        intl: {
            a: 6378388,
            rf: 297,
            ellipseName: "International 1909 (Hayford)"
        },
        kaula: {
            a: 6378163,
            rf: 298.24,
            ellipseName: "Kaula 1961"
        },
        lerch: {
            a: 6378139,
            rf: 298.257,
            ellipseName: "Lerch 1979"
        },
        mprts: {
            a: 6397300,
            rf: 191,
            ellipseName: "Maupertius 1738"
        },
        new_intl: {
            a: 6378157.5,
            b: 6356772.2,
            ellipseName: "New International 1967"
        },
        plessis: {
            a: 6376523,
            rf: 6355863,
            ellipseName: "Plessis 1817 (France)"
        },
        krass: {
            a: 6378245,
            rf: 298.3,
            ellipseName: "Krassovsky, 1942"
        },
        SEasia: {
            a: 6378155,
            b: 6356773.3205,
            ellipseName: "Southeast Asia"
        },
        walbeck: {
            a: 6376896,
            b: 6355834.8467,
            ellipseName: "Walbeck"
        },
        WGS60: {
            a: 6378165,
            rf: 298.3,
            ellipseName: "WGS 60"
        },
        WGS66: {
            a: 6378145,
            rf: 298.25,
            ellipseName: "WGS 66"
        },
        WGS72: {
            a: 6378135,
            rf: 298.26,
            ellipseName: "WGS 72"
        },
        WGS84: {
            a: 6378137,
            rf: 298.257223563,
            ellipseName: "WGS 84"
        },
        sphere: {
            a: 6370997,
            b: 6370997,
            ellipseName: "Normal Sphere (r=6370997)"
        }
    },
    f.Datum = {
        WGS84: {
            towgs84: "0,0,0",
            ellipse: "WGS84",
            datumName: "WGS84"
        },
        GGRS87: {
            towgs84: "-199.87,74.79,246.62",
            ellipse: "GRS80",
            datumName: "Greek_Geodetic_Reference_System_1987"
        },
        NAD83: {
            towgs84: "0,0,0",
            ellipse: "GRS80",
            datumName: "North_American_Datum_1983"
        },
        NAD27: {
            nadgrids: "@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",
            ellipse: "clrk66",
            datumName: "North_American_Datum_1927"
        },
        potsdam: {
            towgs84: "606.0,23.0,413.0",
            ellipse: "bessel",
            datumName: "Potsdam Rauenberg 1950 DHDN"
        },
        carthage: {
            towgs84: "-263.0,6.0,431.0",
            ellipse: "clark80",
            datumName: "Carthage 1934 Tunisia"
        },
        hermannskogel: {
            towgs84: "653.0,-212.0,449.0",
            ellipse: "bessel",
            datumName: "Hermannskogel"
        },
        ire65: {
            towgs84: "482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",
            ellipse: "mod_airy",
            datumName: "Ireland 1965"
        },
        nzgd49: {
            towgs84: "59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",
            ellipse: "intl",
            datumName: "New Zealand Geodetic Datum 1949"
        },
        OSGB36: {
            towgs84: "446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",
            ellipse: "airy",
            datumName: "Airy 1830"
        }
    },
    f.WGS84 = new f.Proj("WGS84"),
    f.Datum.OSB36 = f.Datum.OSGB36,
    f.wktProjections = {
        "Lambert Tangential Conformal Conic Projection": "lcc",
        Mercator: "merc",
        "Popular Visualisation Pseudo Mercator": "merc",
        Mercator_1SP: "merc",
        Transverse_Mercator: "tmerc",
        "Transverse Mercator": "tmerc",
        "Lambert Azimuthal Equal Area": "laea",
        "Universal Transverse Mercator System": "utm"
    },
    f.Proj.aea = {
        init: function() {
            Math.abs(this.lat1 + this.lat2) < f.common.EPSLN ? f.reportError("aeaInitEqualLatitudes") : (this.temp = this.b / this.a,
            this.es = 1 - Math.pow(this.temp, 2),
            this.e3 = Math.sqrt(this.es),
            this.sin_po = Math.sin(this.lat1),
            this.cos_po = Math.cos(this.lat1),
            this.con = this.t1 = this.sin_po,
            this.ms1 = f.common.msfnz(this.e3, this.sin_po, this.cos_po),
            this.qs1 = f.common.qsfnz(this.e3, this.sin_po, this.cos_po),
            this.sin_po = Math.sin(this.lat2),
            this.cos_po = Math.cos(this.lat2),
            this.t2 = this.sin_po,
            this.ms2 = f.common.msfnz(this.e3, this.sin_po, this.cos_po),
            this.qs2 = f.common.qsfnz(this.e3, this.sin_po, this.cos_po),
            this.sin_po = Math.sin(this.lat0),
            this.cos_po = Math.cos(this.lat0),
            this.t3 = this.sin_po,
            this.qs0 = f.common.qsfnz(this.e3, this.sin_po, this.cos_po),
            this.ns0 = Math.abs(this.lat1 - this.lat2) > f.common.EPSLN ? (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1) : this.con,
            this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1,
            this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0)
        },
        forward: function(a) {
            var b = a.x
              , c = a.y;
            this.sin_phi = Math.sin(c),
            this.cos_phi = Math.cos(c);
            var c = f.common.qsfnz(this.e3, this.sin_phi, this.cos_phi)
              , c = this.a * Math.sqrt(this.c - this.ns0 * c) / this.ns0
              , d = this.ns0 * f.common.adjust_lon(b - this.long0)
              , b = c * Math.sin(d) + this.x0
              , c = this.rh - c * Math.cos(d) + this.y0;
            return a.x = b,
            a.y = c,
            a
        },
        inverse: function(a) {
            var b, c, d;
            return a.x -= this.x0,
            a.y = this.rh - a.y + this.y0,
            0 <= this.ns0 ? (b = Math.sqrt(a.x * a.x + a.y * a.y),
            c = 1) : (b = -Math.sqrt(a.x * a.x + a.y * a.y),
            c = -1),
            d = 0,
            0 != b && (d = Math.atan2(c * a.x, c * a.y)),
            c = b * this.ns0 / this.a,
            b = (this.c - c * c) / this.ns0,
            1e-10 <= this.e3 ? (c = 1 - .5 * (1 - this.es) * Math.log((1 - this.e3) / (1 + this.e3)) / this.e3,
            c = 1e-10 < Math.abs(Math.abs(c) - Math.abs(b)) ? this.phi1z(this.e3, b) : b >= 0 ? .5 * f.common.PI : -.5 * f.common.PI) : c = this.phi1z(this.e3, b),
            d = f.common.adjust_lon(d / this.ns0 + this.long0),
            a.x = d,
            a.y = c,
            a
        },
        phi1z: function(a, b) {
            var c, d, e, g, h = f.common.asinz(.5 * b);
            if (a < f.common.EPSLN)
                return h;
            for (var i = a * a, j = 1; 25 >= j; j++)
                if (c = Math.sin(h),
                d = Math.cos(h),
                e = a * c,
                g = 1 - e * e,
                c = .5 * g * g / d * (b / (1 - i) - c / g + .5 / a * Math.log((1 - e) / (1 + e))),
                h += c,
                1e-7 >= Math.abs(c))
                    return h;
            return f.reportError("aea:phi1z:Convergence error"),
            null 
        }
    },
    f.Proj.sterea = {
        dependsOn: "gauss",
        init: function() {
            f.Proj.gauss.init.apply(this),
            this.rc ? (this.sinc0 = Math.sin(this.phic0),
            this.cosc0 = Math.cos(this.phic0),
            this.R2 = 2 * this.rc,
            this.title || (this.title = "Oblique Stereographic Alternative")) : f.reportError("sterea:init:E_ERROR_0")
        },
        forward: function(a) {
            var b, c, d, e;
            return a.x = f.common.adjust_lon(a.x - this.long0),
            f.Proj.gauss.forward.apply(this, [a]),
            b = Math.sin(a.y),
            c = Math.cos(a.y),
            d = Math.cos(a.x),
            e = this.k0 * this.R2 / (1 + this.sinc0 * b + this.cosc0 * c * d),
            a.x = e * c * Math.sin(a.x),
            a.y = e * (this.cosc0 * b - this.sinc0 * c * d),
            a.x = this.a * a.x + this.x0,
            a.y = this.a * a.y + this.y0,
            a
        },
        inverse: function(a) {
            var b, c, d, e;
            return a.x = (a.x - this.x0) / this.a,
            a.y = (a.y - this.y0) / this.a,
            a.x /= this.k0,
            a.y /= this.k0,
            (e = Math.sqrt(a.x * a.x + a.y * a.y)) ? (d = 2 * Math.atan2(e, this.R2),
            b = Math.sin(d),
            c = Math.cos(d),
            d = Math.asin(c * this.sinc0 + a.y * b * this.cosc0 / e),
            b = Math.atan2(a.x * b, e * this.cosc0 * c - a.y * this.sinc0 * b)) : (d = this.phic0,
            b = 0),
            a.x = b,
            a.y = d,
            f.Proj.gauss.inverse.apply(this, [a]),
            a.x = f.common.adjust_lon(a.x + this.long0),
            a
        }
    },
    f.Proj.poly = {
        init: function() {
            0 == this.lat0 && (this.lat0 = 90),
            this.temp = this.b / this.a,
            this.es = 1 - Math.pow(this.temp, 2),
            this.e = Math.sqrt(this.es),
            this.e0 = f.common.e0fn(this.es),
            this.e1 = f.common.e1fn(this.es),
            this.e2 = f.common.e2fn(this.es),
            this.e3 = f.common.e3fn(this.es),
            this.ml0 = f.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
        },
        forward: function(a) {
            var b, c, d, e, g;
            return d = a.y,
            c = f.common.adjust_lon(a.x - this.long0),
            1e-7 >= Math.abs(d) ? (g = this.x0 + this.a * c,
            b = this.y0 - this.a * this.ml0) : (b = Math.sin(d),
            c = Math.cos(d),
            d = f.common.mlfn(this.e0, this.e1, this.e2, this.e3, d),
            e = f.common.msfnz(this.e, b, c),
            c = b,
            g = this.x0 + this.a * e * Math.sin(c) / b,
            b = this.y0 + this.a * (d - this.ml0 + e * (1 - Math.cos(c)) / b)),
            a.x = g,
            a.y = b,
            a
        },
        inverse: function(a) {
            var b, c;
            if (a.x -= this.x0,
            a.y -= this.y0,
            b = this.ml0 + a.y / this.a,
            1e-7 >= Math.abs(b))
                b = a.x / this.a + this.long0,
                c = 0;
            else {
                if (b = b * b + a.x / this.a * (a.x / this.a),
                b = e(this.es, this.e0, this.e1, this.e2, this.e3, this.al, b, void 0, c),
                1 != b)
                    return b;
                b = f.common.adjust_lon(f.common.asinz(NaN * a.x / this.a) / Math.sin(c) + this.long0)
            }
            return a.x = b,
            a.y = c,
            a
        }
    },
    f.Proj.equi = {
        init: function() {
            this.x0 || (this.x0 = 0),
            this.y0 || (this.y0 = 0),
            this.lat0 || (this.lat0 = 0),
            this.long0 || (this.long0 = 0)
        },
        forward: function(a) {
            var b = a.y
              , c = this.x0 + this.a * f.common.adjust_lon(a.x - this.long0) * Math.cos(this.lat0)
              , b = this.y0 + this.a * b;
            return this.t1 = c,
            this.t2 = Math.cos(this.lat0),
            a.x = c,
            a.y = b,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b = a.y / this.a;
            Math.abs(b) > f.common.HALF_PI && f.reportError("equi:Inv:DataError");
            var c = f.common.adjust_lon(this.long0 + a.x / (this.a * Math.cos(this.lat0)));
            a.x = c,
            a.y = b
        }
    },
    f.Proj.merc = {
        init: function() {
            this.lat_ts && (this.k0 = this.sphere ? Math.cos(this.lat_ts) : f.common.msfnz(this.es, Math.sin(this.lat_ts), Math.cos(this.lat_ts)))
        },
        forward: function(a) {
            var b = a.x
              , c = a.y;
            if (90 < c * f.common.R2D && -90 > c * f.common.R2D && 180 < b * f.common.R2D && -180 > b * f.common.R2D)
                return f.reportError("merc:forward: llInputOutOfRange: " + b + " : " + c),
                null ;
            if (Math.abs(Math.abs(c) - f.common.HALF_PI) <= f.common.EPSLN)
                return f.reportError("merc:forward: ll2mAtPoles"),
                null ;
            if (this.sphere)
                b = this.x0 + this.a * this.k0 * f.common.adjust_lon(b - this.long0),
                c = this.y0 + this.a * this.k0 * Math.log(Math.tan(f.common.FORTPI + .5 * c));
            else
                var d = Math.sin(c)
                  , c = f.common.tsfnz(this.e, c, d)
                  , b = this.x0 + this.a * this.k0 * f.common.adjust_lon(b - this.long0)
                  , c = this.y0 - this.a * this.k0 * Math.log(c);
            return a.x = b,
            a.y = c,
            a
        },
        inverse: function(a) {
            var b = a.x - this.x0
              , c = a.y - this.y0;
            if (this.sphere)
                c = f.common.HALF_PI - 2 * Math.atan(Math.exp(-c / this.a * this.k0));
            else if (c = Math.exp(-c / (this.a * this.k0)),
            c = f.common.phi2z(this.e, c),
            -9999 == c)
                return f.reportError("merc:inverse: lat = -9999"),
                null ;
            return b = f.common.adjust_lon(this.long0 + b / (this.a * this.k0)),
            a.x = b,
            a.y = c,
            a
        }
    },
    f.Proj.utm = {
        dependsOn: "tmerc",
        init: function() {
            this.zone ? (this.lat0 = 0,
            this.long0 = (6 * Math.abs(this.zone) - 183) * f.common.D2R,
            this.x0 = 5e5,
            this.y0 = this.utmSouth ? 1e7 : 0,
            this.k0 = .9996,
            f.Proj.tmerc.init.apply(this),
            this.forward = f.Proj.tmerc.forward,
            this.inverse = f.Proj.tmerc.inverse) : f.reportError("utm:init: zone must be specified for UTM")
        }
    },
    f.Proj.eqdc = {
        init: function() {
            this.mode || (this.mode = 0),
            this.temp = this.b / this.a,
            this.es = 1 - Math.pow(this.temp, 2),
            this.e = Math.sqrt(this.es),
            this.e0 = f.common.e0fn(this.es),
            this.e1 = f.common.e1fn(this.es),
            this.e2 = f.common.e2fn(this.es),
            this.e3 = f.common.e3fn(this.es),
            this.sinphi = Math.sin(this.lat1),
            this.cosphi = Math.cos(this.lat1),
            this.ms1 = f.common.msfnz(this.e, this.sinphi, this.cosphi),
            this.ml1 = f.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat1),
            0 != this.mode ? (Math.abs(this.lat1 + this.lat2) < f.common.EPSLN && f.reportError("eqdc:Init:EqualLatitudes"),
            this.sinphi = Math.sin(this.lat2),
            this.cosphi = Math.cos(this.lat2),
            this.ms2 = f.common.msfnz(this.e, this.sinphi, this.cosphi),
            this.ml2 = f.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat2),
            this.ns = Math.abs(this.lat1 - this.lat2) >= f.common.EPSLN ? (this.ms1 - this.ms2) / (this.ml2 - this.ml1) : this.sinphi) : this.ns = this.sinphi,
            this.g = this.ml1 + this.ms1 / this.ns,
            this.ml0 = f.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0),
            this.rh = this.a * (this.g - this.ml0)
        },
        forward: function(a) {
            var b = a.x
              , c = this.a * (this.g - f.common.mlfn(this.e0, this.e1, this.e2, this.e3, a.y))
              , d = this.ns * f.common.adjust_lon(b - this.long0)
              , b = this.x0 + c * Math.sin(d)
              , c = this.y0 + this.rh - c * Math.cos(d);
            return a.x = b,
            a.y = c,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y = this.rh - a.y + this.y0;
            var b, c;
            0 <= this.ns ? (c = Math.sqrt(a.x * a.x + a.y * a.y),
            b = 1) : (c = -Math.sqrt(a.x * a.x + a.y * a.y),
            b = -1);
            var d = 0;
            return 0 != c && (d = Math.atan2(b * a.x, b * a.y)),
            b = this.phi3z(this.g - c / this.a, this.e0, this.e1, this.e2, this.e3),
            d = f.common.adjust_lon(this.long0 + d / this.ns),
            a.x = d,
            a.y = b,
            a
        },
        phi3z: function(a, b, c, d, e) {
            var g, h;
            g = a;
            for (var i = 0; 15 > i; i++)
                if (h = (a + c * Math.sin(2 * g) - d * Math.sin(4 * g) + e * Math.sin(6 * g)) / b - g,
                g += h,
                1e-10 >= Math.abs(h))
                    return g;
            return f.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
            null 
        }
    },
    f.Proj.tmerc = {
        init: function() {
            this.e0 = f.common.e0fn(this.es),
            this.e1 = f.common.e1fn(this.es),
            this.e2 = f.common.e2fn(this.es),
            this.e3 = f.common.e3fn(this.es),
            this.ml0 = this.a * f.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
        },
        forward: function(a) {
            var b, c, d = a.y, e = f.common.adjust_lon(a.x - this.long0);
            b = Math.sin(d);
            var g = Math.cos(d);
            if (this.sphere) {
                var h = g * Math.sin(e);
                if (1e-10 > Math.abs(Math.abs(h) - 1))
                    return f.reportError("tmerc:forward: Point projects into infinity"),
                    93;
                c = .5 * this.a * this.k0 * Math.log((1 + h) / (1 - h)),
                b = Math.acos(g * Math.cos(e) / Math.sqrt(1 - h * h)),
                0 > d && (b = -b),
                d = this.a * this.k0 * (b - this.lat0)
            } else {
                c = g * e;
                var e = Math.pow(c, 2)
                  , g = this.ep2 * Math.pow(g, 2)
                  , h = Math.tan(d)
                  , i = Math.pow(h, 2);
                b = 1 - this.es * Math.pow(b, 2),
                b = this.a / Math.sqrt(b),
                d = this.a * f.common.mlfn(this.e0, this.e1, this.e2, this.e3, d),
                c = this.k0 * b * c * (1 + e / 6 * (1 - i + g + e / 20 * (5 - 18 * i + Math.pow(i, 2) + 72 * g - 58 * this.ep2))) + this.x0,
                d = this.k0 * (d - this.ml0 + b * h * e * (.5 + e / 24 * (5 - i + 9 * g + 4 * Math.pow(g, 2) + e / 30 * (61 - 58 * i + Math.pow(i, 2) + 600 * g - 330 * this.ep2)))) + this.y0
            }
            return a.x = c,
            a.y = d,
            a
        },
        inverse: function(a) {
            var b, c, d, e;
            if (this.sphere) {
                c = Math.exp(a.x / (this.a * this.k0));
                var g = .5 * (c - 1 / c);
                d = this.lat0 + a.y / (this.a * this.k0),
                e = Math.cos(d),
                b = Math.sqrt((1 - e * e) / (1 + g * g)),
                c = f.common.asinz(b),
                0 > d && (c = -c),
                b = 0 == g && 0 == e ? this.long0 : f.common.adjust_lon(Math.atan2(g, e) + this.long0)
            } else {
                var g = a.x - this.x0
                  , h = a.y - this.y0;
                for (c = b = (this.ml0 + h / this.k0) / this.a,
                e = 0; d = (b + this.e1 * Math.sin(2 * c) - this.e2 * Math.sin(4 * c) + this.e3 * Math.sin(6 * c)) / this.e0 - c,
                c += d,
                !(Math.abs(d) <= f.common.EPSLN); e++)
                    if (e >= 6)
                        return f.reportError("tmerc:inverse: Latitude failed to converge"),
                        95;
                if (Math.abs(c) < f.common.HALF_PI) {
                    b = Math.sin(c),
                    d = Math.cos(c);
                    var i = Math.tan(c);
                    e = this.ep2 * Math.pow(d, 2);
                    var h = Math.pow(e, 2)
                      , j = Math.pow(i, 2)
                      , k = Math.pow(j, 2);
                    b = 1 - this.es * Math.pow(b, 2);
                    var l = this.a / Math.sqrt(b);
                    b = l * (1 - this.es) / b;
                    var g = g / (l * this.k0)
                      , m = Math.pow(g, 2);
                    c -= l * i * m / b * (.5 - m / 24 * (5 + 3 * j + 10 * e - 4 * h - 9 * this.ep2 - m / 30 * (61 + 90 * j + 298 * e + 45 * k - 252 * this.ep2 - 3 * h))),
                    b = f.common.adjust_lon(this.long0 + g * (1 - m / 6 * (1 + 2 * j + e - m / 20 * (5 - 2 * e + 28 * j - 3 * h + 8 * this.ep2 + 24 * k))) / d)
                } else
                    c = f.common.HALF_PI * f.common.sign(h),
                    b = this.long0
            }
            return a.x = b,
            a.y = c,
            a
        }
    },
    f.defs.GOOGLE = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",
    f.defs["EPSG:900913"] = f.defs.GOOGLE,
    f.Proj.gstmerc = {
        init: function() {
            var a = this.b / this.a;
            this.e = Math.sqrt(1 - a * a),
            this.lc = this.long0,
            this.rs = Math.sqrt(1 + this.e * this.e * Math.pow(Math.cos(this.lat0), 4) / (1 - this.e * this.e));
            var a = Math.sin(this.lat0)
              , b = Math.asin(a / this.rs)
              , c = Math.sin(b);
            this.cp = f.common.latiso(0, b, c) - this.rs * f.common.latiso(this.e, this.lat0, a),
            this.n2 = this.k0 * this.a * Math.sqrt(1 - this.e * this.e) / (1 - this.e * this.e * a * a),
            this.xs = this.x0,
            this.ys = this.y0 - this.n2 * b,
            this.title || (this.title = "Gauss Schreiber transverse mercator")
        },
        forward: function(a) {
            var b = a.y
              , c = this.rs * (a.x - this.lc)
              , b = this.cp + this.rs * f.common.latiso(this.e, b, Math.sin(b))
              , d = Math.asin(Math.sin(c) / f.common.cosh(b))
              , d = f.common.latiso(0, d, Math.sin(d));
            return a.x = this.xs + this.n2 * d,
            a.y = this.ys + this.n2 * Math.atan(f.common.sinh(b) / Math.cos(c)),
            a
        },
        inverse: function(a) {
            var b = a.x
              , c = a.y
              , d = Math.atan(f.common.sinh((b - this.xs) / this.n2) / Math.cos((c - this.ys) / this.n2))
              , b = Math.asin(Math.sin((c - this.ys) / this.n2) / f.common.cosh((b - this.xs) / this.n2))
              , b = f.common.latiso(0, b, Math.sin(b));
            return a.x = this.lc + d / this.rs,
            a.y = f.common.invlatiso(this.e, (b - this.cp) / this.rs),
            a
        }
    },
    f.Proj.ortho = {
        init: function() {
            this.sin_p14 = Math.sin(this.lat0),
            this.cos_p14 = Math.cos(this.lat0)
        },
        forward: function(a) {
            var b, c, d, e, g;
            if (c = a.y,
            d = f.common.adjust_lon(a.x - this.long0),
            b = Math.sin(c),
            c = Math.cos(c),
            e = Math.cos(d),
            g = this.sin_p14 * b + this.cos_p14 * c * e,
            g > 0 || Math.abs(g) <= f.common.EPSLN)
                var h = 1 * this.a * c * Math.sin(d)
                  , i = this.y0 + 1 * this.a * (this.cos_p14 * b - this.sin_p14 * c * e);
            else
                f.reportError("orthoFwdPointError");
            return a.x = h,
            a.y = i,
            a
        },
        inverse: function(a) {
            var b, c, d, e;
            return a.x -= this.x0,
            a.y -= this.y0,
            b = Math.sqrt(a.x * a.x + a.y * a.y),
            b > this.a + 1e-7 && f.reportError("orthoInvDataError"),
            c = f.common.asinz(b / this.a),
            d = Math.sin(c),
            e = Math.cos(c),
            c = this.long0,
            Math.abs(b),
            d = f.common.asinz(e * this.sin_p14 + a.y * d * this.cos_p14 / b),
            b = Math.abs(this.lat0) - f.common.HALF_PI,
            Math.abs(b) <= f.common.EPSLN && (c = 0 <= this.lat0 ? f.common.adjust_lon(this.long0 + Math.atan2(a.x, -a.y)) : f.common.adjust_lon(this.long0 - Math.atan2(-a.x, a.y))),
            Math.sin(d),
            a.x = c,
            a.y = d,
            a
        }
    },
    f.Proj.krovak = {
        init: function() {
            this.a = 6377397.155,
            this.es = .006674372230614,
            this.e = Math.sqrt(this.es),
            this.lat0 || (this.lat0 = .863937979737193),
            this.long0 || (this.long0 = .4334234309119251),
            this.k0 || (this.k0 = .9999),
            this.s45 = .785398163397448,
            this.s90 = 2 * this.s45,
            this.fi0 = this.lat0,
            this.e2 = this.es,
            this.e = Math.sqrt(this.e2),
            this.alfa = Math.sqrt(1 + this.e2 * Math.pow(Math.cos(this.fi0), 4) / (1 - this.e2)),
            this.uq = 1.04216856380474,
            this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa),
            this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2),
            this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g,
            this.k1 = this.k0,
            this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2)),
            this.s0 = 1.37008346281555,
            this.n = Math.sin(this.s0),
            this.ro0 = this.k1 * this.n0 / Math.tan(this.s0),
            this.ad = this.s90 - this.uq
        },
        forward: function(a) {
            var b, c, d;
            return c = a.y,
            d = f.common.adjust_lon(a.x - this.long0),
            b = Math.pow((1 + this.e * Math.sin(c)) / (1 - this.e * Math.sin(c)), this.alfa * this.e / 2),
            b = 2 * (Math.atan(this.k * Math.pow(Math.tan(c / 2 + this.s45), this.alfa) / b) - this.s45),
            c = -d * this.alfa,
            d = Math.asin(Math.cos(this.ad) * Math.sin(b) + Math.sin(this.ad) * Math.cos(b) * Math.cos(c)),
            b = this.n * Math.asin(Math.cos(b) * Math.sin(c) / Math.cos(d)),
            d = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(d / 2 + this.s45), this.n),
            a.y = d * Math.cos(b) / 1,
            a.x = d * Math.sin(b) / 1,
            this.czech && (a.y *= -1,
            a.x *= -1),
            a
        },
        inverse: function(a) {
            var b, c, d;
            b = a.x,
            a.x = a.y,
            a.y = b,
            this.czech && (a.y *= -1,
            a.x *= -1),
            b = Math.sqrt(a.x * a.x + a.y * a.y),
            c = Math.atan2(a.y, a.x) / Math.sin(this.s0),
            d = 2 * (Math.atan(Math.pow(this.ro0 / b, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45),
            b = Math.asin(Math.cos(this.ad) * Math.sin(d) - Math.sin(this.ad) * Math.cos(d) * Math.cos(c)),
            c = Math.asin(Math.cos(d) * Math.sin(c) / Math.cos(b)),
            a.x = this.long0 - c / this.alfa,
            c = b;
            var e = d = 0;
            do
                a.y = 2 * (Math.atan(Math.pow(this.k, -1 / this.alfa) * Math.pow(Math.tan(b / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(c)) / (1 - this.e * Math.sin(c)), this.e / 2)) - this.s45),
                1e-10 > Math.abs(c - a.y) && (d = 1),
                c = a.y,
                e += 1;
            while (0 == d && 15 > e);return e >= 15 ? (f.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
            null ) : a
        }
    },
    f.Proj.somerc = {
        init: function() {
            var a = this.lat0;
            this.lambda0 = this.long0;
            var b = Math.sin(a)
              , c = this.a
              , d = 1 / this.rf
              , d = 2 * d - Math.pow(d, 2)
              , e = this.e = Math.sqrt(d);
            this.R = this.k0 * c * Math.sqrt(1 - d) / (1 - d * Math.pow(b, 2)),
            this.alpha = Math.sqrt(1 + d / (1 - d) * Math.pow(Math.cos(a), 4)),
            this.b0 = Math.asin(b / this.alpha),
            this.K = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2)) - this.alpha * Math.log(Math.tan(Math.PI / 4 + a / 2)) + this.alpha * e / 2 * Math.log((1 + e * b) / (1 - e * b))
        },
        forward: function(a) {
            var b = Math.log(Math.tan(Math.PI / 4 - a.y / 2))
              , c = this.e / 2 * Math.log((1 + this.e * Math.sin(a.y)) / (1 - this.e * Math.sin(a.y)))
              , c = 2 * (Math.atan(Math.exp(-this.alpha * (b + c) + this.K)) - Math.PI / 4)
              , d = this.alpha * (a.x - this.lambda0)
              , b = Math.atan(Math.sin(d) / (Math.sin(this.b0) * Math.tan(c) + Math.cos(this.b0) * Math.cos(d)))
              , c = Math.asin(Math.cos(this.b0) * Math.sin(c) - Math.sin(this.b0) * Math.cos(c) * Math.cos(d));
            return a.y = this.R / 2 * Math.log((1 + Math.sin(c)) / (1 - Math.sin(c))) + this.y0,
            a.x = this.R * b + this.x0,
            a
        },
        inverse: function(a) {
            for (var b = (a.x - this.x0) / this.R, c = 2 * (Math.atan(Math.exp((a.y - this.y0) / this.R)) - Math.PI / 4), d = Math.asin(Math.cos(this.b0) * Math.sin(c) + Math.sin(this.b0) * Math.cos(c) * Math.cos(b)), b = this.lambda0 + Math.atan(Math.sin(b) / (Math.cos(this.b0) * Math.cos(b) - Math.sin(this.b0) * Math.tan(c))) / this.alpha, c = 0, e = d, g = -1e3, h = 0; 1e-7 < Math.abs(e - g); ) {
                if (20 < ++h)
                    return void f.reportError("omercFwdInfinity");
                c = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + d / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(e)) / 2)),
                g = e,
                e = 2 * Math.atan(Math.exp(c)) - Math.PI / 2
            }
            return a.x = b,
            a.y = e,
            a
        }
    },
    f.Proj.stere = {
        ssfn_: function(a, b, c) {
            return b *= c,
            Math.tan(.5 * (f.common.HALF_PI + a)) * Math.pow((1 - b) / (1 + b), .5 * c)
        },
        TOL: 1e-8,
        NITER: 8,
        CONV: 1e-10,
        S_POLE: 0,
        N_POLE: 1,
        OBLIQ: 2,
        EQUIT: 3,
        init: function() {
            this.phits = this.lat_ts ? this.lat_ts : f.common.HALF_PI;
            var a = Math.abs(this.lat0);
            if (this.mode = Math.abs(a) - f.common.HALF_PI < f.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : a > f.common.EPSLN ? this.OBLIQ : this.EQUIT,
            this.phits = Math.abs(this.phits),
            this.es) {
                var b;
                switch (this.mode) {
                case this.N_POLE:
                case this.S_POLE:
                    Math.abs(this.phits - f.common.HALF_PI) < f.common.EPSLN ? this.akm1 = 2 * this.k0 / Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e)) : (a = Math.sin(this.phits),
                    this.akm1 = Math.cos(this.phits) / f.common.tsfnz(this.e, this.phits, a),
                    a *= this.e,
                    this.akm1 /= Math.sqrt(1 - a * a));
                    break;
                case this.EQUIT:
                    this.akm1 = 2 * this.k0;
                    break;
                case this.OBLIQ:
                    a = Math.sin(this.lat0),
                    b = 2 * Math.atan(this.ssfn_(this.lat0, a, this.e)) - f.common.HALF_PI,
                    a *= this.e,
                    this.akm1 = 2 * this.k0 * Math.cos(this.lat0) / Math.sqrt(1 - a * a),
                    this.sinX1 = Math.sin(b),
                    this.cosX1 = Math.cos(b)
                }
            } else
                switch (this.mode) {
                case this.OBLIQ:
                    this.sinph0 = Math.sin(this.lat0),
                    this.cosph0 = Math.cos(this.lat0);
                case this.EQUIT:
                    this.akm1 = 2 * this.k0;
                    break;
                case this.S_POLE:
                case this.N_POLE:
                    this.akm1 = Math.abs(this.phits - f.common.HALF_PI) >= f.common.EPSLN ? Math.cos(this.phits) / Math.tan(f.common.FORTPI - .5 * this.phits) : 2 * this.k0
                }
        },
        forward: function(a) {
            var b, c, d = a.x, d = f.common.adjust_lon(d - this.long0), e = a.y;
            if (this.sphere) {
                var g, h, i;
                switch (g = Math.sin(e),
                h = Math.cos(e),
                i = Math.cos(d),
                d = Math.sin(d),
                this.mode) {
                case this.EQUIT:
                    c = 1 + h * i,
                    c <= f.common.EPSLN && f.reportError("stere:forward:Equit"),
                    c = this.akm1 / c,
                    b = c * h * d,
                    c *= g;
                    break;
                case this.OBLIQ:
                    c = 1 + this.sinph0 * g + this.cosph0 * h * i,
                    c <= f.common.EPSLN && f.reportError("stere:forward:Obliq"),
                    c = this.akm1 / c,
                    b = c * h * d,
                    c *= this.cosph0 * g - this.sinph0 * h * i;
                    break;
                case this.N_POLE:
                    i = -i,
                    e = -e;
                case this.S_POLE:
                    Math.abs(e - f.common.HALF_PI) < this.TOL && f.reportError("stere:forward:S_POLE"),
                    c = this.akm1 * Math.tan(f.common.FORTPI + .5 * e),
                    b = d * c,
                    c *= i
                }
            } else {
                i = Math.cos(d),
                d = Math.sin(d),
                g = Math.sin(e);
                var j;
                switch (this.mode != this.OBLIQ && this.mode != this.EQUIT || (j = 2 * Math.atan(this.ssfn_(e, g, this.e)),
                h = Math.sin(j - f.common.HALF_PI),
                j = Math.cos(j)),
                this.mode) {
                case this.OBLIQ:
                    e = this.akm1 / (this.cosX1 * (1 + this.sinX1 * h + this.cosX1 * j * i)),
                    c = e * (this.cosX1 * h - this.sinX1 * j * i),
                    b = e * j;
                    break;
                case this.EQUIT:
                    e = 2 * this.akm1 / (1 + j * i),
                    c = e * h,
                    b = e * j;
                    break;
                case this.S_POLE:
                    e = -e,
                    i = -i,
                    g = -g;
                case this.N_POLE:
                    b = this.akm1 * f.common.tsfnz(this.e, e, g),
                    c = -b * i
                }
                b *= d
            }
            return a.x = b * this.a + this.x0,
            a.y = c * this.a + this.y0,
            a
        },
        inverse: function(a) {
            var b, c, d, e, g = (a.x - this.x0) / this.a, h = (a.y - this.y0) / this.a, i = b = 0, j = d = 0;
            if (this.sphere) {
                switch (i = Math.sqrt(g * g + h * h),
                j = 2 * Math.atan(i / this.akm1),
                d = Math.sin(j),
                j = Math.cos(j),
                b = 0,
                this.mode) {
                case this.EQUIT:
                    c = Math.abs(i) <= f.common.EPSLN ? 0 : Math.asin(h * d / i),
                    0 == j && 0 == g || (b = Math.atan2(g * d, j * i));
                    break;
                case this.OBLIQ:
                    c = Math.abs(i) <= f.common.EPSLN ? this.phi0 : Math.asin(j * this.sinph0 + h * d * this.cosph0 / i),
                    j -= this.sinph0 * Math.sin(c),
                    0 == j && 0 == g || (b = Math.atan2(g * d * this.cosph0, j * i));
                    break;
                case this.N_POLE:
                    h = -h;
                case this.S_POLE:
                    c = Math.abs(i) <= f.common.EPSLN ? this.phi0 : Math.asin(this.mode == this.S_POLE ? -j : j),
                    b = 0 == g && 0 == h ? 0 : Math.atan2(g, h)
                }
                a.x = f.common.adjust_lon(b + this.long0),
                a.y = c
            } else {
                switch (e = Math.sqrt(g * g + h * h),
                this.mode) {
                case this.OBLIQ:
                case this.EQUIT:
                    b = 2 * Math.atan2(e * this.cosX1, this.akm1),
                    d = Math.cos(b),
                    c = Math.sin(b),
                    i = 0 == e ? Math.asin(d * this.sinX1) : Math.asin(d * this.sinX1 + h * c * this.cosX1 / e),
                    b = Math.tan(.5 * (f.common.HALF_PI + i)),
                    g *= c,
                    h = e * this.cosX1 * d - h * this.sinX1 * c,
                    j = f.common.HALF_PI,
                    d = .5 * this.e;
                    break;
                case this.N_POLE:
                    h = -h;
                case this.S_POLE:
                    b = -e / this.akm1,
                    i = f.common.HALF_PI - 2 * Math.atan(b),
                    j = -f.common.HALF_PI,
                    d = -.5 * this.e
                }
                for (e = this.NITER; e--; i = c)
                    if (c = this.e * Math.sin(i),
                    c = 2 * Math.atan(b * Math.pow((1 + c) / (1 - c), d)) - j,
                    Math.abs(i - c) < this.CONV)
                        return this.mode == this.S_POLE && (c = -c),
                        b = 0 == g && 0 == h ? 0 : Math.atan2(g, h),
                        a.x = f.common.adjust_lon(b + this.long0),
                        a.y = c,
                        a
            }
        }
    },
    f.Proj.nzmg = {
        iterations: 1,
        init: function() {
            this.A = [],
            this.A[1] = .6399175073,
            this.A[2] = -.1358797613,
            this.A[3] = .063294409,
            this.A[4] = -.02526853,
            this.A[5] = .0117879,
            this.A[6] = -.0055161,
            this.A[7] = .0026906,
            this.A[8] = -.001333,
            this.A[9] = 67e-5,
            this.A[10] = -34e-5,
            this.B_re = [],
            this.B_im = [],
            this.B_re[1] = .7557853228,
            this.B_im[1] = 0,
            this.B_re[2] = .249204646,
            this.B_im[2] = .003371507,
            this.B_re[3] = -.001541739,
            this.B_im[3] = .04105856,
            this.B_re[4] = -.10162907,
            this.B_im[4] = .01727609,
            this.B_re[5] = -.26623489,
            this.B_im[5] = -.36249218,
            this.B_re[6] = -.6870983,
            this.B_im[6] = -1.1651967,
            this.C_re = [],
            this.C_im = [],
            this.C_re[1] = 1.3231270439,
            this.C_im[1] = 0,
            this.C_re[2] = -.577245789,
            this.C_im[2] = -.007809598,
            this.C_re[3] = .508307513,
            this.C_im[3] = -.112208952,
            this.C_re[4] = -.15094762,
            this.C_im[4] = .18200602,
            this.C_re[5] = 1.01418179,
            this.C_im[5] = 1.64497696,
            this.C_re[6] = 1.9660549,
            this.C_im[6] = 2.5127645,
            this.D = [],
            this.D[1] = 1.5627014243,
            this.D[2] = .5185406398,
            this.D[3] = -.03333098,
            this.D[4] = -.1052906,
            this.D[5] = -.0368594,
            this.D[6] = .007317,
            this.D[7] = .0122,
            this.D[8] = .00394,
            this.D[9] = -.0013
        },
        forward: function(a) {
            for (var b = 1e-5 * ((a.y - this.lat0) / f.common.SEC_TO_RAD), c = a.x - this.long0, d = 1, e = 0, g = 1; 10 >= g; g++)
                d *= b,
                e += this.A[g] * d;
            for (var b = e, d = 1, h = 0, i = 0, j = 0, g = 1; 6 >= g; g++)
                e = d * b - h * c,
                h = h * b + d * c,
                d = e,
                i = i + this.B_re[g] * d - this.B_im[g] * h,
                j = j + this.B_im[g] * d + this.B_re[g] * h;
            return a.x = j * this.a + this.x0,
            a.y = i * this.a + this.y0,
            a
        },
        inverse: function(a) {
            for (var b, c = (a.y - this.y0) / this.a, d = (a.x - this.x0) / this.a, e = 1, g = 0, h = 0, i = 0, j = 1; 6 >= j; j++)
                b = e * c - g * d,
                g = g * c + e * d,
                e = b,
                h = h + this.C_re[j] * e - this.C_im[j] * g,
                i = i + this.C_im[j] * e + this.C_re[j] * g;
            for (e = 0; e < this.iterations; e++) {
                var k, l = h, m = i;
                for (b = c,
                g = d,
                j = 2; 6 >= j; j++)
                    k = l * h - m * i,
                    m = m * h + l * i,
                    l = k,
                    b += (j - 1) * (this.B_re[j] * l - this.B_im[j] * m),
                    g += (j - 1) * (this.B_im[j] * l + this.B_re[j] * m);
                for (var l = 1, m = 0, n = this.B_re[1], o = this.B_im[1], j = 2; 6 >= j; j++)
                    k = l * h - m * i,
                    m = m * h + l * i,
                    l = k,
                    n += j * (this.B_re[j] * l - this.B_im[j] * m),
                    o += j * (this.B_im[j] * l + this.B_re[j] * m);
                i = n * n + o * o,
                h = (b * n + g * o) / i,
                i = (g * n - b * o) / i
            }
            for (c = h,
            d = 1,
            h = 0,
            j = 1; 9 >= j; j++)
                d *= c,
                h += this.D[j] * d;
            return j = this.lat0 + 1e5 * h * f.common.SEC_TO_RAD,
            a.x = this.long0 + i,
            a.y = j,
            a
        }
    },
    f.Proj.mill = {
        init: function() {},
        forward: function(a) {
            var b = a.y
              , c = this.x0 + this.a * f.common.adjust_lon(a.x - this.long0)
              , b = this.y0 + 1.25 * this.a * Math.log(Math.tan(f.common.PI / 4 + b / 2.5));
            return a.x = c,
            a.y = b,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b = f.common.adjust_lon(this.long0 + a.x / this.a)
              , c = 2.5 * (Math.atan(Math.exp(.8 * a.y / this.a)) - f.common.PI / 4);
            return a.x = b,
            a.y = c,
            a
        }
    },
    f.Proj.gnom = {
        init: function() {
            this.sin_p14 = Math.sin(this.lat0),
            this.cos_p14 = Math.cos(this.lat0),
            this.infinity_dist = 1e3 * this.a,
            this.rc = 1
        },
        forward: function(a) {
            var b, c, d, e, g;
            return c = a.y,
            d = f.common.adjust_lon(a.x - this.long0),
            b = Math.sin(c),
            c = Math.cos(c),
            e = Math.cos(d),
            g = this.sin_p14 * b + this.cos_p14 * c * e,
            g > 0 || Math.abs(g) <= f.common.EPSLN ? (d = this.x0 + 1 * this.a * c * Math.sin(d) / g,
            b = this.y0 + 1 * this.a * (this.cos_p14 * b - this.sin_p14 * c * e) / g) : (f.reportError("orthoFwdPointError"),
            d = this.x0 + this.infinity_dist * c * Math.sin(d),
            b = this.y0 + this.infinity_dist * (this.cos_p14 * b - this.sin_p14 * c * e)),
            a.x = d,
            a.y = b,
            a
        },
        inverse: function(a) {
            var b, c, d, e;
            return a.x = (a.x - this.x0) / this.a,
            a.y = (a.y - this.y0) / this.a,
            a.x /= this.k0,
            a.y /= this.k0,
            (b = Math.sqrt(a.x * a.x + a.y * a.y)) ? (e = Math.atan2(b, this.rc),
            c = Math.sin(e),
            d = Math.cos(e),
            e = f.common.asinz(d * this.sin_p14 + a.y * c * this.cos_p14 / b),
            b = Math.atan2(a.x * c, b * this.cos_p14 * d - a.y * this.sin_p14 * c),
            b = f.common.adjust_lon(this.long0 + b)) : (e = this.phic0,
            b = 0),
            a.x = b,
            a.y = e,
            a
        }
    },
    f.Proj.sinu = {
        init: function() {
            this.sphere ? (this.n = 1,
            this.es = this.m = 0,
            this.C_y = Math.sqrt((this.m + 1) / this.n),
            this.C_x = this.C_y / (this.m + 1)) : this.en = f.common.pj_enfn(this.es)
        },
        forward: function(a) {
            var b, c;
            if (b = a.x,
            c = a.y,
            b = f.common.adjust_lon(b - this.long0),
            this.sphere) {
                if (this.m)
                    for (var d = this.n * Math.sin(c), e = f.common.MAX_ITER; e; --e) {
                        var g = (this.m * c + Math.sin(c) - d) / (this.m + Math.cos(c));
                        if (c -= g,
                        Math.abs(g) < f.common.EPSLN)
                            break
                    }
                else
                    c = 1 != this.n ? Math.asin(this.n * Math.sin(c)) : c;
                b = this.a * this.C_x * b * (this.m + Math.cos(c)),
                c *= this.a * this.C_y
            } else
                d = Math.sin(c),
                e = Math.cos(c),
                c = this.a * f.common.pj_mlfn(c, d, e, this.en),
                b = this.a * b * e / Math.sqrt(1 - this.es * d * d);
            return a.x = b,
            a.y = c,
            a
        },
        inverse: function(a) {
            var b, c;
            if (a.x -= this.x0,
            a.y -= this.y0,
            this.sphere)
                a.y /= this.C_y,
                b = this.m ? Math.asin((this.m * a.y + Math.sin(a.y)) / this.n) : 1 != this.n ? Math.asin(Math.sin(a.y) / this.n) : a.y,
                c = a.x / (this.C_x * (this.m + Math.cos(a.y)));
            else {
                b = f.common.pj_inv_mlfn(a.y / this.a, this.es, this.en);
                var d = Math.abs(b);
                d < f.common.HALF_PI ? (d = Math.sin(b),
                c = this.long0 + a.x * Math.sqrt(1 - this.es * d * d) / (this.a * Math.cos(b)),
                c = f.common.adjust_lon(c)) : d - f.common.EPSLN < f.common.HALF_PI && (c = this.long0)
            }
            return a.x = c,
            a.y = b,
            a
        }
    },
    f.Proj.vandg = {
        init: function() {
            this.R = 6370997
        },
        forward: function(a) {
            var b = a.y
              , c = f.common.adjust_lon(a.x - this.long0);
            Math.abs(b);
            var d = f.common.asinz(2 * Math.abs(b / f.common.PI));
            (Math.abs(c) <= f.common.EPSLN || Math.abs(Math.abs(b) - f.common.HALF_PI) <= f.common.EPSLN) && Math.tan(.5 * d);
            var e = .5 * Math.abs(f.common.PI / c - c / f.common.PI)
              , g = e * e
              , h = Math.sin(d)
              , d = Math.cos(d)
              , d = d / (h + d - 1)
              , h = d * (2 / h - 1)
              , h = h * h
              , g = f.common.PI * this.R * (e * (d - h) + Math.sqrt(g * (d - h) * (d - h) - (h + g) * (d * d - h))) / (h + g);
            return 0 > c && (g = -g),
            c = this.x0 + g,
            g = Math.abs(g / (f.common.PI * this.R)),
            b = b >= 0 ? this.y0 + f.common.PI * this.R * Math.sqrt(1 - g * g - 2 * e * g) : this.y0 - f.common.PI * this.R * Math.sqrt(1 - g * g - 2 * e * g),
            a.x = c,
            a.y = b,
            a
        },
        inverse: function(a) {
            var b, c, d, e, g, h, i, j;
            return a.x -= this.x0,
            a.y -= this.y0,
            j = f.common.PI * this.R,
            b = a.x / j,
            d = a.y / j,
            e = b * b + d * d,
            g = -Math.abs(d) * (1 + e),
            c = g - 2 * d * d + b * b,
            h = -2 * g + 1 + 2 * d * d + e * e,
            j = d * d / h + (2 * c * c * c / h / h / h - 9 * g * c / h / h) / 27,
            i = (g - c * c / 3 / h) / h,
            g = 2 * Math.sqrt(-i / 3),
            j = 3 * j / i / g,
            1 < Math.abs(j) && (j = j >= 0 ? 1 : -1),
            j = Math.acos(j) / 3,
            c = 0 <= a.y ? (-g * Math.cos(j + f.common.PI / 3) - c / 3 / h) * f.common.PI : -(-g * Math.cos(j + f.common.PI / 3) - c / 3 / h) * f.common.PI,
            Math.abs(b),
            b = f.common.adjust_lon(this.long0 + f.common.PI * (e - 1 + Math.sqrt(1 + 2 * (b * b - d * d) + e * e)) / 2 / b),
            a.x = b,
            a.y = c,
            a
        }
    },
    f.Proj.cea = {
        init: function() {},
        forward: function(a) {
            var b = a.y
              , c = this.x0 + this.a * f.common.adjust_lon(a.x - this.long0) * Math.cos(this.lat_ts)
              , b = this.y0 + this.a * Math.sin(b) / Math.cos(this.lat_ts);
            return a.x = c,
            a.y = b,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b = f.common.adjust_lon(this.long0 + a.x / this.a / Math.cos(this.lat_ts))
              , c = Math.asin(a.y / this.a * Math.cos(this.lat_ts));
            return a.x = b,
            a.y = c,
            a
        }
    },
    f.Proj.eqc = {
        init: function() {
            this.x0 || (this.x0 = 0),
            this.y0 || (this.y0 = 0),
            this.lat0 || (this.lat0 = 0),
            this.long0 || (this.long0 = 0),
            this.lat_ts || (this.lat_ts = 0),
            this.title || (this.title = "Equidistant Cylindrical (Plate Carre)"),
            this.rc = Math.cos(this.lat_ts)
        },
        forward: function(a) {
            var b = a.y
              , c = f.common.adjust_lon(a.x - this.long0)
              , b = f.common.adjust_lat(b - this.lat0);
            return a.x = this.x0 + this.a * c * this.rc,
            a.y = this.y0 + this.a * b,
            a
        },
        inverse: function(a) {
            var b = a.y;
            return a.x = f.common.adjust_lon(this.long0 + (a.x - this.x0) / (this.a * this.rc)),
            a.y = f.common.adjust_lat(this.lat0 + (b - this.y0) / this.a),
            a
        }
    },
    f.Proj.cass = {
        init: function() {
            this.sphere || (this.en = f.common.pj_enfn(this.es),
            this.m0 = f.common.pj_mlfn(this.lat0, Math.sin(this.lat0), Math.cos(this.lat0), this.en))
        },
        C1: .16666666666666666,
        C2: .008333333333333333,
        C3: .041666666666666664,
        C4: .3333333333333333,
        C5: .06666666666666667,
        forward: function(a) {
            var b, c, d = a.x, e = a.y, d = f.common.adjust_lon(d - this.long0);
            return this.sphere ? (b = Math.asin(Math.cos(e) * Math.sin(d)),
            c = Math.atan2(Math.tan(e), Math.cos(d)) - this.phi0) : (this.n = Math.sin(e),
            this.c = Math.cos(e),
            c = f.common.pj_mlfn(e, this.n, this.c, this.en),
            this.n = 1 / Math.sqrt(1 - this.es * this.n * this.n),
            this.tn = Math.tan(e),
            this.t = this.tn * this.tn,
            this.a1 = d * this.c,
            this.c *= this.es * this.c / (1 - this.es),
            this.a2 = this.a1 * this.a1,
            b = this.n * this.a1 * (1 - this.a2 * this.t * (this.C1 - (8 - this.t + 8 * this.c) * this.a2 * this.C2)),
            c -= this.m0 - this.n * this.tn * this.a2 * (.5 + (5 - this.t + 6 * this.c) * this.a2 * this.C3)),
            a.x = this.a * b + this.x0,
            a.y = this.a * c + this.y0,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b = a.x / this.a
              , c = a.y / this.a;
            if (this.sphere)
                this.dd = c + this.lat0,
                c = Math.asin(Math.sin(this.dd) * Math.cos(b)),
                b = Math.atan2(Math.tan(b), Math.cos(this.dd));
            else {
                var d = f.common.pj_inv_mlfn(this.m0 + c, this.es, this.en);
                this.tn = Math.tan(d),
                this.t = this.tn * this.tn,
                this.n = Math.sin(d),
                this.r = 1 / (1 - this.es * this.n * this.n),
                this.n = Math.sqrt(this.r),
                this.r *= (1 - this.es) * this.n,
                this.dd = b / this.n,
                this.d2 = this.dd * this.dd,
                c = d - this.n * this.tn / this.r * this.d2 * (.5 - (1 + 3 * this.t) * this.d2 * this.C3),
                b = this.dd * (1 + this.t * this.d2 * (-this.C4 + (1 + 3 * this.t) * this.d2 * this.C5)) / Math.cos(d)
            }
            return a.x = f.common.adjust_lon(this.long0 + b),
            a.y = c,
            a
        }
    },
    f.Proj.gauss = {
        init: function() {
            var a = Math.sin(this.lat0)
              , b = Math.cos(this.lat0)
              , b = b * b;
            this.rc = Math.sqrt(1 - this.es) / (1 - this.es * a * a),
            this.C = Math.sqrt(1 + this.es * b * b / (1 - this.es)),
            this.phic0 = Math.asin(a / this.C),
            this.ratexp = .5 * this.C * this.e,
            this.K = Math.tan(.5 * this.phic0 + f.common.FORTPI) / (Math.pow(Math.tan(.5 * this.lat0 + f.common.FORTPI), this.C) * f.common.srat(this.e * a, this.ratexp))
        },
        forward: function(a) {
            var b = a.x
              , c = a.y;
            return a.y = 2 * Math.atan(this.K * Math.pow(Math.tan(.5 * c + f.common.FORTPI), this.C) * f.common.srat(this.e * Math.sin(c), this.ratexp)) - f.common.HALF_PI,
            a.x = this.C * b,
            a
        },
        inverse: function(a) {
            for (var b = a.x / this.C, c = a.y, d = Math.pow(Math.tan(.5 * c + f.common.FORTPI) / this.K, 1 / this.C), e = f.common.MAX_ITER; e > 0 && (c = 2 * Math.atan(d * f.common.srat(this.e * Math.sin(a.y), -.5 * this.e)) - f.common.HALF_PI,
            !(1e-14 > Math.abs(c - a.y))); --e)
                a.y = c;
            return e ? (a.x = b,
            a.y = c,
            a) : (f.reportError("gauss:inverse:convergence failed"),
            null )
        }
    },
    f.Proj.omerc = {
        init: function() {
            this.mode || (this.mode = 0),
            this.lon1 || (this.lon1 = 0,
            this.mode = 1),
            this.lon2 || (this.lon2 = 0),
            this.lat2 || (this.lat2 = 0);
            var a = 1 - Math.pow(this.b / this.a, 2);
            Math.sqrt(a),
            this.sin_p20 = Math.sin(this.lat0),
            this.cos_p20 = Math.cos(this.lat0),
            this.con = 1 - this.es * this.sin_p20 * this.sin_p20,
            this.com = Math.sqrt(1 - a),
            this.bl = Math.sqrt(1 + this.es * Math.pow(this.cos_p20, 4) / (1 - a)),
            this.al = this.a * this.bl * this.k0 * this.com / this.con,
            Math.abs(this.lat0) < f.common.EPSLN ? this.el = this.d = this.ts = 1 : (this.ts = f.common.tsfnz(this.e, this.lat0, this.sin_p20),
            this.con = Math.sqrt(this.con),
            this.d = this.bl * this.com / (this.cos_p20 * this.con),
            this.f = 0 < this.d * this.d - 1 ? 0 <= this.lat0 ? this.d + Math.sqrt(this.d * this.d - 1) : this.d - Math.sqrt(this.d * this.d - 1) : this.d,
            this.el = this.f * Math.pow(this.ts, this.bl)),
            0 != this.mode ? (this.g = .5 * (this.f - 1 / this.f),
            this.gama = f.common.asinz(Math.sin(this.alpha) / this.d),
            this.longc -= f.common.asinz(this.g * Math.tan(this.gama)) / this.bl,
            this.con = Math.abs(this.lat0),
            this.con > f.common.EPSLN && Math.abs(this.con - f.common.HALF_PI) > f.common.EPSLN ? (this.singam = Math.sin(this.gama),
            this.cosgam = Math.cos(this.gama),
            this.sinaz = Math.sin(this.alpha),
            this.cosaz = Math.cos(this.alpha),
            this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz)) : f.reportError("omerc:Init:DataError")) : (this.sinphi = Math.sin(this.at1),
            this.ts1 = f.common.tsfnz(this.e, this.lat1, this.sinphi),
            this.sinphi = Math.sin(this.lat2),
            this.ts2 = f.common.tsfnz(this.e, this.lat2, this.sinphi),
            this.h = Math.pow(this.ts1, this.bl),
            this.l = Math.pow(this.ts2, this.bl),
            this.f = this.el / this.h,
            this.g = .5 * (this.f - 1 / this.f),
            this.j = (this.el * this.el - this.l * this.h) / (this.el * this.el + this.l * this.h),
            this.p = (this.l - this.h) / (this.l + this.h),
            this.dlon = this.lon1 - this.lon2,
            this.dlon < -f.common.PI && (this.lon2 -= 2 * f.common.PI),
            this.dlon > f.common.PI && (this.lon2 += 2 * f.common.PI),
            this.dlon = this.lon1 - this.lon2,
            this.longc = .5 * (this.lon1 + this.lon2) - Math.atan(this.j * Math.tan(.5 * this.bl * this.dlon) / this.p) / this.bl,
            this.dlon = f.common.adjust_lon(this.lon1 - this.longc),
            this.gama = Math.atan(Math.sin(this.bl * this.dlon) / this.g),
            this.alpha = f.common.asinz(this.d * Math.sin(this.gama)),
            Math.abs(this.lat1 - this.lat2) <= f.common.EPSLN ? f.reportError("omercInitDataError") : this.con = Math.abs(this.lat1),
            this.con <= f.common.EPSLN || Math.abs(this.con - f.common.HALF_PI) <= f.common.EPSLN ? f.reportError("omercInitDataError") : Math.abs(Math.abs(this.lat0) - f.common.HALF_PI) <= f.common.EPSLN && f.reportError("omercInitDataError"),
            this.singam = Math.sin(this.gam),
            this.cosgam = Math.cos(this.gam),
            this.sinaz = Math.sin(this.alpha),
            this.cosaz = Math.cos(this.alpha),
            this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz))
        },
        forward: function(a) {
            var b, c, d, e, g;
            return d = a.x,
            c = a.y,
            b = Math.sin(c),
            e = f.common.adjust_lon(d - this.longc),
            d = Math.sin(this.bl * e),
            Math.abs(Math.abs(c) - f.common.HALF_PI) > f.common.EPSLN ? (b = f.common.tsfnz(this.e, c, b),
            b = this.el / Math.pow(b, this.bl),
            g = .5 * (b - 1 / b),
            b = (g * this.singam - d * this.cosgam) / (.5 * (b + 1 / b)),
            c = Math.cos(this.bl * e),
            1e-7 > Math.abs(c) ? d = this.al * this.bl * e : (d = this.al * Math.atan((g * this.cosgam + d * this.singam) / c) / this.bl,
            0 > c && (d += f.common.PI * this.al / this.bl))) : (b = c >= 0 ? this.singam : -this.singam,
            d = this.al * c / this.bl),
            Math.abs(Math.abs(b) - 1) <= f.common.EPSLN && f.reportError("omercFwdInfinity"),
            e = .5 * this.al * Math.log((1 - b) / (1 + b)) / this.bl,
            d -= this.u,
            b = this.y0 + d * this.cosaz - e * this.sinaz,
            a.x = this.x0 + e * this.cosaz + d * this.sinaz,
            a.y = b,
            a
        },
        inverse: function(a) {
            var b, c, d, e;
            return a.x -= this.x0,
            a.y -= this.y0,
            b = a.x * this.cosaz - a.y * this.sinaz,
            d = a.y * this.cosaz + a.x * this.sinaz,
            d += this.u,
            c = Math.exp(-this.bl * b / this.al),
            b = .5 * (c - 1 / c),
            c = .5 * (c + 1 / c),
            d = Math.sin(this.bl * d / this.al),
            e = (d * this.cosgam + b * this.singam) / c,
            Math.abs(Math.abs(e) - 1) <= f.common.EPSLN ? (b = this.longc,
            e = e >= 0 ? f.common.HALF_PI : -f.common.HALF_PI) : (c = 1 / this.bl,
            e = Math.pow(this.el / Math.sqrt((1 + e) / (1 - e)), c),
            e = f.common.phi2z(this.e, e),
            b = this.longc - Math.atan2(b * this.cosgam - d * this.singam, c) / this.bl,
            b = f.common.adjust_lon(b)),
            a.x = b,
            a.y = e,
            a
        }
    },
    f.Proj.lcc = {
        init: function() {
            if (this.lat2 || (this.lat2 = this.lat0),
            this.k0 || (this.k0 = 1),
            Math.abs(this.lat1 + this.lat2) < f.common.EPSLN)
                f.reportError("lcc:init: Equal Latitudes");
            else {
                var a = this.b / this.a;
                this.e = Math.sqrt(1 - a * a);
                var a = Math.sin(this.lat1)
                  , b = Math.cos(this.lat1)
                  , b = f.common.msfnz(this.e, a, b)
                  , c = f.common.tsfnz(this.e, this.lat1, a)
                  , d = Math.sin(this.lat2)
                  , e = Math.cos(this.lat2)
                  , e = f.common.msfnz(this.e, d, e)
                  , d = f.common.tsfnz(this.e, this.lat2, d)
                  , g = f.common.tsfnz(this.e, this.lat0, Math.sin(this.lat0));
                this.ns = Math.abs(this.lat1 - this.lat2) > f.common.EPSLN ? Math.log(b / e) / Math.log(c / d) : a,
                this.f0 = b / (this.ns * Math.pow(c, this.ns)),
                this.rh = this.a * this.f0 * Math.pow(g, this.ns),
                this.title || (this.title = "Lambert Conformal Conic")
            }
        },
        forward: function(a) {
            var b = a.x
              , c = a.y;
            if (!(90 >= c && c >= -90 && 180 >= b && b >= -180))
                return f.reportError("lcc:forward: llInputOutOfRange: " + b + " : " + c),
                null ;
            var d = Math.abs(Math.abs(c) - f.common.HALF_PI);
            if (d > f.common.EPSLN)
                c = f.common.tsfnz(this.e, c, Math.sin(c)),
                c = this.a * this.f0 * Math.pow(c, this.ns);
            else {
                if (d = c * this.ns,
                0 >= d)
                    return f.reportError("lcc:forward: No Projection"),
                    null ;
                c = 0
            }
            return b = this.ns * f.common.adjust_lon(b - this.long0),
            a.x = this.k0 * c * Math.sin(b) + this.x0,
            a.y = this.k0 * (this.rh - c * Math.cos(b)) + this.y0,
            a
        },
        inverse: function(a) {
            var b, c, d, e = (a.x - this.x0) / this.k0, g = this.rh - (a.y - this.y0) / this.k0;
            if (0 < this.ns ? (b = Math.sqrt(e * e + g * g),
            c = 1) : (b = -Math.sqrt(e * e + g * g),
            c = -1),
            d = 0,
            0 != b && (d = Math.atan2(c * e, c * g)),
            0 != b || 0 < this.ns) {
                if (c = 1 / this.ns,
                b = Math.pow(b / (this.a * this.f0), c),
                b = f.common.phi2z(this.e, b),
                -9999 == b)
                    return null 
            } else
                b = -f.common.HALF_PI;
            return d = f.common.adjust_lon(d / this.ns + this.long0),
            a.x = d,
            a.y = b,
            a
        }
    },
    f.Proj.laea = {
        S_POLE: 1,
        N_POLE: 2,
        EQUIT: 3,
        OBLIQ: 4,
        init: function() {
            var a = Math.abs(this.lat0);
            if (this.mode = Math.abs(a - f.common.HALF_PI) < f.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : Math.abs(a) < f.common.EPSLN ? this.EQUIT : this.OBLIQ,
            0 < this.es)
                switch (this.qp = f.common.qsfnz(this.e, 1),
                this.mmf = .5 / (1 - this.es),
                this.apa = this.authset(this.es),
                this.mode) {
                case this.N_POLE:
                case this.S_POLE:
                    this.dd = 1;
                    break;
                case this.EQUIT:
                    this.rq = Math.sqrt(.5 * this.qp),
                    this.dd = 1 / this.rq,
                    this.xmf = 1,
                    this.ymf = .5 * this.qp;
                    break;
                case this.OBLIQ:
                    this.rq = Math.sqrt(.5 * this.qp),
                    a = Math.sin(this.lat0),
                    this.sinb1 = f.common.qsfnz(this.e, a) / this.qp,
                    this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1),
                    this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * a * a) * this.rq * this.cosb1),
                    this.ymf = (this.xmf = this.rq) / this.dd,
                    this.xmf *= this.dd
                }
            else
                this.mode == this.OBLIQ && (this.sinph0 = Math.sin(this.lat0),
                this.cosph0 = Math.cos(this.lat0))
        },
        forward: function(a) {
            var b, c, d = a.x, e = a.y, d = f.common.adjust_lon(d - this.long0);
            if (this.sphere) {
                var g, h, i;
                switch (i = Math.sin(e),
                h = Math.cos(e),
                g = Math.cos(d),
                this.mode) {
                case this.OBLIQ:
                case this.EQUIT:
                    if (c = this.mode == this.EQUIT ? 1 + h * g : 1 + this.sinph0 * i + this.cosph0 * h * g,
                    c <= f.common.EPSLN)
                        return f.reportError("laea:fwd:y less than eps"),
                        null ;
                    c = Math.sqrt(2 / c),
                    b = c * h * Math.sin(d),
                    c *= this.mode == this.EQUIT ? i : this.cosph0 * i - this.sinph0 * h * g;
                    break;
                case this.N_POLE:
                    g = -g;
                case this.S_POLE:
                    if (Math.abs(e + this.phi0) < f.common.EPSLN)
                        return f.reportError("laea:fwd:phi < eps"),
                        null ;
                    c = f.common.FORTPI - .5 * e,
                    c = 2 * (this.mode == this.S_POLE ? Math.cos(c) : Math.sin(c)),
                    b = c * Math.sin(d),
                    c *= g
                }
            } else {
                var j = h = 0
                  , k = 0;
                switch (g = Math.cos(d),
                d = Math.sin(d),
                i = Math.sin(e),
                i = f.common.qsfnz(this.e, i),
                this.mode != this.OBLIQ && this.mode != this.EQUIT || (h = i / this.qp,
                j = Math.sqrt(1 - h * h)),
                this.mode) {
                case this.OBLIQ:
                    k = 1 + this.sinb1 * h + this.cosb1 * j * g;
                    break;
                case this.EQUIT:
                    k = 1 + j * g;
                    break;
                case this.N_POLE:
                    k = f.common.HALF_PI + e,
                    i = this.qp - i;
                    break;
                case this.S_POLE:
                    k = e - f.common.HALF_PI,
                    i = this.qp + i
                }
                if (Math.abs(k) < f.common.EPSLN)
                    return f.reportError("laea:fwd:b < eps"),
                    null ;
                switch (this.mode) {
                case this.OBLIQ:
                case this.EQUIT:
                    k = Math.sqrt(2 / k),
                    c = this.mode == this.OBLIQ ? this.ymf * k * (this.cosb1 * h - this.sinb1 * j * g) : (k = Math.sqrt(2 / (1 + j * g))) * h * this.ymf,
                    b = this.xmf * k * j * d;
                    break;
                case this.N_POLE:
                case this.S_POLE:
                    i >= 0 ? (b = (k = Math.sqrt(i)) * d,
                    c = g * (this.mode == this.S_POLE ? k : -k)) : b = c = 0
                }
            }
            return a.x = this.a * b + this.x0,
            a.y = this.a * c + this.y0,
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b, c = a.x / this.a, d = a.y / this.a;
            if (this.sphere) {
                var e, g = 0, h = 0;
                if (e = Math.sqrt(c * c + d * d),
                b = .5 * e,
                b > 1)
                    return f.reportError("laea:Inv:DataError"),
                    null ;
                switch (b = 2 * Math.asin(b),
                this.mode != this.OBLIQ && this.mode != this.EQUIT || (h = Math.sin(b),
                g = Math.cos(b)),
                this.mode) {
                case this.EQUIT:
                    b = Math.abs(e) <= f.common.EPSLN ? 0 : Math.asin(d * h / e),
                    c *= h,
                    d = g * e;
                    break;
                case this.OBLIQ:
                    b = Math.abs(e) <= f.common.EPSLN ? this.phi0 : Math.asin(g * this.sinph0 + d * h * this.cosph0 / e),
                    c *= h * this.cosph0,
                    d = (g - Math.sin(b) * this.sinph0) * e;
                    break;
                case this.N_POLE:
                    d = -d,
                    b = f.common.HALF_PI - b;
                    break;
                case this.S_POLE:
                    b -= f.common.HALF_PI
                }
                c = 0 != d || this.mode != this.EQUIT && this.mode != this.OBLIQ ? Math.atan2(c, d) : 0
            } else {
                switch (b = 0,
                this.mode) {
                case this.EQUIT:
                case this.OBLIQ:
                    if (c /= this.dd,
                    d *= this.dd,
                    h = Math.sqrt(c * c + d * d),
                    h < f.common.EPSLN)
                        return a.x = 0,
                        a.y = this.phi0,
                        a;
                    e = 2 * Math.asin(.5 * h / this.rq),
                    g = Math.cos(e),
                    c *= e = Math.sin(e),
                    this.mode == this.OBLIQ ? (b = g * this.sinb1 + d * e * this.cosb1 / h,
                    d = h * this.cosb1 * g - d * this.sinb1 * e) : (b = d * e / h,
                    d = h * g);
                    break;
                case this.N_POLE:
                    d = -d;
                case this.S_POLE:
                    if (b = c * c + d * d,
                    !b)
                        return a.x = 0,
                        a.y = this.phi0,
                        a;
                    b = 1 - b / this.qp,
                    this.mode == this.S_POLE && (b = -b)
                }
                c = Math.atan2(c, d),
                b = this.authlat(Math.asin(b), this.apa)
            }
            return a.x = f.common.adjust_lon(this.long0 + c),
            a.y = b,
            a
        },
        P00: .3333333333333333,
        P01: .17222222222222222,
        P02: .10257936507936508,
        P10: .06388888888888888,
        P11: .0664021164021164,
        P20: .016415012942191543,
        authset: function(a) {
            var b, c = [];
            return c[0] = a * this.P00,
            b = a * a,
            c[0] += b * this.P01,
            c[1] = b * this.P10,
            b *= a,
            c[0] += b * this.P02,
            c[1] += b * this.P11,
            c[2] = b * this.P20,
            c
        },
        authlat: function(a, b) {
            var c = a + a;
            return a + b[0] * Math.sin(c) + b[1] * Math.sin(c + c) + b[2] * Math.sin(c + c + c)
        }
    },
    f.Proj.aeqd = {
        init: function() {
            this.sin_p12 = Math.sin(this.lat0),
            this.cos_p12 = Math.cos(this.lat0)
        },
        forward: function(a) {
            var b, c = a.x, d = Math.sin(a.y), e = Math.cos(a.y), c = f.common.adjust_lon(c - this.long0), g = Math.cos(c), h = this.sin_p12 * d + this.cos_p12 * e * g;
            if (Math.abs(Math.abs(h) - 1) < f.common.EPSLN) {
                if (b = 1,
                0 > h)
                    return void f.reportError("aeqd:Fwd:PointError")
            } else
                b = Math.acos(h),
                b /= Math.sin(b);
            return a.x = this.x0 + this.a * b * e * Math.sin(c),
            a.y = this.y0 + this.a * b * (this.cos_p12 * d - this.sin_p12 * e * g),
            a
        },
        inverse: function(a) {
            a.x -= this.x0,
            a.y -= this.y0;
            var b = Math.sqrt(a.x * a.x + a.y * a.y);
            if (!(b > 2 * f.common.HALF_PI * this.a)) {
                var c, d = b / this.a, e = Math.sin(d), d = Math.cos(d), g = this.long0;
                if (Math.abs(b) <= f.common.EPSLN)
                    c = this.lat0;
                else {
                    c = f.common.asinz(d * this.sin_p12 + a.y * e * this.cos_p12 / b);
                    var h = Math.abs(this.lat0) - f.common.HALF_PI;
                    Math.abs(h) <= f.common.EPSLN ? g = 0 <= this.lat0 ? f.common.adjust_lon(this.long0 + Math.atan2(a.x, -a.y)) : f.common.adjust_lon(this.long0 - Math.atan2(-a.x, a.y)) : (h = d - this.sin_p12 * Math.sin(c),
                    Math.abs(h) < f.common.EPSLN && Math.abs(a.x) < f.common.EPSLN || (Math.atan2(a.x * e * this.cos_p12, h * b),
                    g = f.common.adjust_lon(this.long0 + Math.atan2(a.x * e * this.cos_p12, h * b))))
                }
                return a.x = g,
                a.y = c,
                a
            }
            f.reportError("aeqdInvDataError")
        }
    },
    f.Proj.moll = {
        init: function() {},
        forward: function(a) {
            for (var b = a.y, c = f.common.adjust_lon(a.x - this.long0), d = b, e = f.common.PI * Math.sin(b), g = 0; ; g++) {
                var h = -(d + Math.sin(d) - e) / (1 + Math.cos(d))
                  , d = d + h;
                if (Math.abs(h) < f.common.EPSLN)
                    break;
                g >= 50 && f.reportError("moll:Fwd:IterationError")
            }
            return d /= 2,
            f.common.PI / 2 - Math.abs(b) < f.common.EPSLN && (c = 0),
            b = .900316316158 * this.a * c * Math.cos(d) + this.x0,
            d = 1.4142135623731 * this.a * Math.sin(d) + this.y0,
            a.x = b,
            a.y = d,
            a
        },
        inverse: function(a) {
            var b;
            a.x -= this.x0,
            b = a.y / (1.4142135623731 * this.a),
            .999999999999 < Math.abs(b) && (b = .999999999999),
            b = Math.asin(b);
            var c = f.common.adjust_lon(this.long0 + a.x / (.900316316158 * this.a * Math.cos(b)));
            return c < -f.common.PI && (c = -f.common.PI),
            c > f.common.PI && (c = f.common.PI),
            b = (2 * b + Math.sin(2 * b)) / f.common.PI,
            1 < Math.abs(b) && (b = 1),
            b = Math.asin(b),
            a.x = c,
            a.y = b,
            a
        }
    }
}),
nm_module("nm/geom", function(a, b, c, d) {
    var e = b("jscore/itertools", "map")
      , f = b("jscore/itertools", "array")
      , g = b("js-libs/google", "maps")
      , h = g.geometry.spherical
      , i = h.computeDistanceBetween
      , j = h.computeHeading
      , k = h.computeOffset;
    b("js-libs/proj4");
    var l = (a.HEADING_NORTH = 0,
    a.HEADING_EAST = 90,
    a.HEADING_SOUTH = 180,
    a.HEADING_WEST = 270,
    a.LatLng = c(Object, {
        constructor: function(a, b) {
            this.lat = a,
            this.lng = b
        },
        getLat: function() {
            return this.lat
        },
        getLon: function() {
            return this.lng
        },
        setLat: function(a) {
            this.lat = a
        },
        setLon: function(a) {
            this.lon = a
        },
        equals: function(a) {
            return a.lat === this.lat && a.lng === this.lng
        },
        toJSON: function() {
            var a = {
                lat: this.lat,
                lng: this.lng
            };
            return a
        },
        fromJSON: function(a) {
            this.lat = a.lat,
            this.lng = a.lng
        },
        toUrlValue: function(a) {
            var b;
            return a = a || 6,
            a = Math.floor(a),
            b = Math.pow(10, a),
            Math.round(this.lat * b) / b + "," + Math.round(this.lng * b) / b
        },
        fromUrlValue: function(a) {
            var b, c, d;
            if (a && "string" == typeof a) {
                if (b = a.split(/\s*,\s*/),
                b.length < 2)
                    throw new Error('Invalid format lat & lng must be seperated by ","');
                if (c = parseFloat(b[0]),
                d = parseFloat(b[1]),
                isNaN(c) || isNaN(d))
                    throw new Error("Invalid format lat & lng must be numbers");
                return new l(c,d)
            }
            throw new Error("You must provide a string to convert to a lat & lng")
        }
    }))
      , m = (a.getNormalizedCoord = function(a, b) {
        var c = a.y
          , d = a.x
          , e = 1 << b;
        return 0 > c || c >= e ? null  : ((0 > d || d >= e) && (d = (d % e + e) % e),
        {
            x: d,
            y: c
        })
    }
    ,
    a.getComfortableDistanceInView = function(a) {
        var b = a.tmpGoogleMapViewController.gMap
          , c = 111111
          , d = b.getBounds()
          , e = 7.5
          , f = g.geometry.spherical.computeDistanceBetween(d.getNorthEast(), d.getSouthWest())
          , h = f / e / c;
        return h
    }
    )
      , n = (a.getPolygonPoints = function(a) {
        var b = m(a)
          , c = a.getCenter()
          , d = [new l(c.getLat() - b,c.getLon() - b), new l(c.getLat() + b,c.getLon() - b), new l(c.getLat() + b,c.getLon() + b), new l(c.getLat() - b,c.getLon() + b)];
        return d
    }
    ,
    a.getArea = function(a) {
        if (a) {
            var b = e(a, function(a) {
                return new g.LatLng(a.getLat(),a.getLon())
            });
            return g.geometry.spherical.computeArea(f(b))
        }
        return null 
    }
    ,
    a._calculateDistanceWithGreatCircle = function(a, b) {
        return i(a, b)
    }
    )
      , o = a._calculateDistanceWithUTM = function(a, b) {
        var c = function(a) {
            var b = Math.floor((a + 180) / 6) + 1;
            return b
        }
          , d = new Proj4js.Proj("EPSG:4326")
          , e = c(b.lng());
        "undefined" == typeof Proj4js.defs["EPSG:283" + e] && (Proj4js.defs["EPSG:283" + e] = "+proj=utm +zone=" + e + " +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");
        var f = new Proj4js.Proj("EPSG:283" + e)
          , g = new Proj4js.Point(a.lng(),a.lat())
          , h = new Proj4js.Point(b.lng(),b.lat());
        Proj4js.transform(d, f, g),
        Proj4js.transform(d, f, h);
        var i = g.x - h.x
          , j = g.y - h.y
          , k = Math.sqrt(i * i + j * j);
        return k
    }
    ;
    a.calculateDistance = function(a, b) {
        var c = 1e4
          , d = 100
          , e = n(a, b);
        if (e > c)
            return e;
        var f = o(a, b);
        if (c - d > e)
            return f;
        var g = (c - e) / d;
        return g * f + (1 - g) * e
    }
    ,
    a.calculateHeading = function(a, b) {
        return j(a, b)
    }
    ,
    a.calculateOffset = function(a, b, c) {
        return k(a, b, c)
    }
}),
nm_module("nm/maps/drag", function(a, b, c, d) {
    function e(a, b) {
        if (b.getPosition) {
            var c = b.getPosition();
            c = new i.LatLng(c.lat,c.lng);
            var d = {
                dist: i.geometry.spherical.computeDistanceBetween(a, c),
                heading: i.geometry.spherical.computeHeading(a, c)
            };
            return d
        }
        return b.getPoints && console.log("[nm/maps/drag getVector] Dragging not supported for multi-point objects yet."),
        null 
    }
    function f(a, b, c) {
        var d = i.geometry.spherical.computeOffset(b, c.dist, c.heading);
        d = new h(d.lat(),d.lng()),
        a.setPosition(d)
    }
    var g = b("jscore/objtools", "Dictionary")
      , h = b("nm/geom", "LatLng")
      , i = b("js-libs/google", "maps");
    a.DragHandler = c(Object, {
        constructor: function(a) {
            this.selection = a,
            this.vectors = null 
        },
        startDrag: function(a) {
            for (var b, c = new g, f = new i.LatLng(a.lat,a.lng), h = this.selection.getSelectedFeatures(), j = h[d.iterator](); !(b = j.next()).done; ) {
                var k = b.value
                  , l = e(f, k);
                null  !== l && c.set(k, l)
            }
            this.vectors = c
        },
        handleDrag: function(a) {
            var b = this.vectors;
            a = new i.LatLng(a.lat,a.lng),
            b && b.keys().forEach(function(c) {
                var d = b.get(c);
                f(c, a, d)
            })
        },
        endDrag: function(a) {
            this.handleDrag(a),
            this.vectors = null 
        }
    })
}),
nm_module("nm/layers", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.Layer = c(e, {
        constructor: function(a, b, c, d, e, g) {
            b = "undefined" == typeof arguments[1] ? !0 : b,
            c = "undefined" == typeof arguments[2] ? null  : c,
            d = "undefined" == typeof arguments[3] ? !1 : d,
            e = "undefined" == typeof arguments[4] ? !1 : e,
            g = "undefined" == typeof arguments[5] ? !1 : g,
            f.base.call(this),
            this._name = a,
            this._id = c,
            this._visible = b,
            this._persistent = d,
            this._isImmutable = e,
            this._partialFeatures = g
        },
        getName: function() {
            return this._name
        },
        setName: function(a) {
            this._name !== a && (this._name = a,
            this.changed())
        },
        getId: function() {
            return this._id
        },
        setId: function(a) {
            this._id = a
        },
        getVisible: function() {
            return this._visible
        },
        setVisible: function(a) {
            this._visible !== a && (this._visible = a,
            this.changed({
                visible: a
            }))
        },
        setPartialFeatures: function(a) {
            a !== this.getPartialFeatures() && (this._partialFeatures = a,
            this.changed())
        },
        getPartialFeatures: function() {
            return this._partialFeatures
        },
        isPersistent: function() {
            return this._persistent
        },
        isImmutable: function() {
            return this._isImmutable
        },
        hide: function() {
            this.setVisible(!1)
        },
        show: function() {
            this.setVisible(!0)
        }
    })
}),
nm_module("jscore/uuid", function(a, b, c, d) {
    function e(a, b) {
        var c = b || 0
          , d = j;
        return d[a[c++]] + d[a[c++]] + d[a[c++]] + d[a[c++]] + "-" + d[a[c++]] + d[a[c++]] + "-" + d[a[c++]] + d[a[c++]] + "-" + d[a[c++]] + d[a[c++]] + "-" + d[a[c++]] + d[a[c++]] + d[a[c++]] + d[a[c++]] + d[a[c++]] + d[a[c++]]
    }
    var f;
    if (window.crypto && window.crypto.getRandomValues) {
        var g = new window.Uint8Array(16);
        f = function() {
            return window.crypto.getRandomValues(g),
            g
        }
    }
    if (!f) {
        var h = new Array(16);
        f = function() {
            for (var a, b = 0; 16 > b; b++)
                0 === (3 & b) && (a = 4294967296 * Math.random()),
                h[b] = a >>> ((3 & b) << 3) & 255;
            return h
        }
    }
    var i;
    i = "function" == typeof window.Buffer ? window.Buffer : Array;
    for (var j = [], k = {}, l = 0; 256 > l; l++)
        j[l] = (l + 256).toString(16).substr(1),
        k[j[l]] = l;
    a.uuid4 = function(a, b, c) {
        var d = b && c || 0;
        "string" == typeof a && (b = "binary" === a ? new i(16) : null ,
        a = null ),
        a = a || {};
        var g = a.random || (a.rng || f)();
        if (g[6] = 15 & g[6] | 64,
        g[8] = 63 & g[8] | 128,
        b)
            for (var h = 0; 16 > h; h++)
                b[d + h] = g[h];
        return b || e(g)
    }
}),
nm_module("nm/features/geometry", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.Geometry = c(e, {
        constructor: function(a, b, c) {
            b = "undefined" == typeof arguments[1] ? 0 : b,
            c = "undefined" == typeof arguments[2] ? 0 : c,
            f.base.call(this, this),
            this.id = a,
            this.index = b,
            this.zIndex = c
        },
        clone: function() {},
        getId: function() {
            return this.id
        },
        setId: function(a) {
            this.id = a
        },
        getIndex: function() {
            return this.index
        },
        setIndex: function(a) {
            this.index !== a && (this.index = a,
            this.changed())
        },
        getZIndex: function() {
            return this.zIndex
        },
        setZIndex: function(a) {
            this.zIndex !== a && (this.zIndex = a,
            this.changed())
        }
    })
}),
nm_module("jscore/compare", function(a, b, c, d) {
    a.isEqual = function e(a, b) {
        if (a instanceof Array) {
            if (!b instanceof Array)
                return !1;
            if (a.length !== b.length)
                return !1;
            for (var c = 0, d = a.length; d > c; c++)
                if (!e(a[c], b[c]))
                    return !1;
            return !0
        }
        return "function" == typeof a.equals ? a.equals(b) : "function" == typeof b.equals ? b.equals(a) : a === b
    }
}),
nm_module("nm/features/line", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = b("jscore/compare", "isEqual")
      , g = a.Line = c(e, {
        constructor: function(a) {
            g.base.call(this),
            this._points = a
        },
        setPoints: function(a) {
            this._points = a,
            this.changed()
        },
        getPoints: function() {
            return this._points
        },
        equals: function(a) {
            var b = a.getPoints();
            return f(b, this._points)
        },
        getName: function() {
            return "Line"
        },
        clone: function() {
            return new g(this.getPoints())
        }
    })
}),
nm_module("nm/features/arrow", function(a, b, c, d) {
    var e = b("nm/features/line", "Line")
      , f = a.Arrow = c(e, {
        constructor: function(a, b) {
            f.base.call(this, a),
            this._arrowHeads = b
        },
        getArrowHeads: function() {
            return this._arrowHeads
        },
        setArrowHeads: function(a) {
            a !== this._arrowHeads && (this._arrowHeads = a,
            this.changed())
        },
        equals: function(a) {
            return a._otherArrowHeads !== this._arrowHeads ? !1 : f.base.prototype.equals.call(this, a)
        },
        getName: function() {
            return "Arrow"
        },
        clone: function() {
            return new f(this.getPoints(),this.getArrowHeads())
        }
    })
}),
nm_module("nm/features/feature", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.Feature = c(e, {
        constructor: function(a, b, c, d, e) {
            c = "undefined" == typeof arguments[2] ? null  : c,
            d = "undefined" == typeof arguments[3] ? 0 : d,
            e = "undefined" == typeof arguments[4] ? 0 : e,
            f.base.call(this, this),
            this.name = a,
            this.position = b,
            this.id = c,
            this.index = d,
            this.zIndex = e
        },
        getName: function() {
            return this.name
        },
        setName: function(a) {
            a !== this.name && (this.name = a,
            this.changed())
        },
        getId: function() {
            return this.id
        },
        setId: function(a) {
            this.id = a
        },
        getPosition: function() {
            return this.position
        },
        setPosition: function(a) {
            var b = this.position;
            b.equals(a) || (this.position = a,
            this.changed({
                position: b
            }))
        },
        getIndex: function() {
            return this.index
        },
        setIndex: function(a) {
            var b = this.index;
            b !== a && (this.index = a,
            this.changed({
                index: b
            }))
        },
        getZIndex: function() {
            return this.zIndex
        },
        setZIndex: function(a) {
            this.zIndex !== a && (this.zIndex = a,
            this.changed())
        }
    })
}),
nm_module("nm/features/circle", function(a, b, c, d) {
    var e = b("nm/features/feature", "Feature")
      , f = a.Circle = c(e, {
        constructor: function(a, b, c) {
            f.base.call(this, b, c),
            this.radius = a
        },
        getRadius: function() {
            return this.radius
        },
        setRadius: function(a) {
            if (a !== this.radius) {
                var b = this.radius;
                this.radius = a,
                this.changed({
                    radius: b
                })
            }
        },
        clone: function() {
            return new f(this.getRadius(),this.getName(),this.getPosition())
        }
    })
}),
nm_module("nm/features/imageoverlay", function(a, b, c, d) {
    var e = b("nm/features/feature", "Feature")
      , f = a.ImageOverlay = c(e, {
        constructor: function(a, b, c, d, e, g) {
            f.base.call(this, e, g),
            this._url = a,
            this._width = b,
            this._height = c,
            this._rotation = d
        },
        getURL: function() {
            return this._url
        },
        setURL: function(a) {
            a !== this._url && (this._url = a,
            this.changed())
        },
        getWidth: function() {
            return this._width
        },
        setWidth: function(a) {
            a !== this._width && (this._width = a,
            this.changed())
        },
        getHeight: function() {
            return this._height
        },
        setHeight: function(a) {
            a !== this._height && (this._height = a,
            this.changed())
        },
        getRotation: function() {
            return this._rotation
        },
        setRotation: function(a) {
            a !== this._rotation && (this._rotation = a,
            this.changed())
        },
        clone: function() {
            return new f(this.getURL(),this.getWidth(),this.getHeight(),this.getRotation(),this.getName(),this.getPosition())
        }
    })
}),
nm_module("nm/features/label", function(a, b, c, d) {
    var e = b("nm/features/feature", "Feature")
      , f = a.Label = c(e, {
        constructor: function(a, b, c) {
            f.base.call(this, b, c),
            this.text = a
        },
        getText: function() {
            return this.text
        },
        setText: function(a) {
            a !== this.text && (this.text = a,
            this.changed())
        },
        clone: function() {
            return new f(this.getText(),this.getName(),this.getPosition())
        }
    })
}),
nm_module("nm/observableCollection", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.ObservableCollection = c(e, {
        constructor: function(a) {
            if (f.base.call(this),
            this.items = [],
            a)
                for (var b = 0, c = a.length; c > b; b++)
                    this.items.push(a[b])
        },
        addItem: function(a) {
            return this.items.push(a),
            this.changed({
                addItem: a
            }),
            this.items.length
        },
        setItems: function(a) {
            var b = this.items;
            this.items = [];
            for (var c = 0, d = a.length; d > c; c++)
                this.items.push(a[c]);
            this.changed({
                setItems: b
            })
        },
        getLength: function() {
            return this.items.length
        },
        getItems: function() {
            for (var a = [], b = this.items, c = 0, d = b.length; d > c; c++)
                a.push(b[c]);
            return a
        }
    })
}),
nm_module("nm/features/multiPoint", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = b("nm/observableCollection", "ObservableCollection")
      , g = a.MultiPoint = c(e, {
        constructor: function(a) {
            g.base.call(this),
            this.observableCollection = new f(a)
        },
        addPoint: function(a) {
            this.observableCollection.addItem(a)
        },
        setPoints: function(a) {
            this.observableCollection.setItems(a)
        },
        getPoints: function() {
            return this.observableCollection.getItems()
        },
        clone: function() {
            return new g(this.getPoints())
        }
    })
}),
nm_module("nm/features/lineString", function(a, b, c, d) {
    var e = b("nm/features/multiPoint", "MultiPoint")
      , f = a.LineString = c(e, {
        constructor: function(a) {
            f.base.call(this),
            this.addPoints(a)
        },
        clone: function() {
            return new f(this.getPoints())
        }
    })
}),
nm_module("nm/features/multiLineString", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = b("nm/observableCollection", "ObservableCollection")
      , g = a.MultiLineString = c(e, {
        constructor: function(a) {
            g.base.call(this),
            this.observableCollection = new f(a)
        },
        addLineString: function(a) {
            this.observableCollection.addItem(a)
        },
        setLineStrings: function(a) {
            this.observableCollection.setItems(a)
        },
        getLineStrings: function() {
            return this.observableCollection.getItems()
        },
        clone: function() {
            return new this.constructor(this.getLineStrings())
        }
    })
}),
nm_module("nm/features/polygon", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = a.Polygon = c(e, {
        constructor: function(a) {
            f.base.call(this),
            this._points = a
        },
        setPoints: function(a) {
            this._points = a,
            this.changed()
        },
        getPoints: function() {
            return this._points
        },
        equals: function(a) {
            for (var b = a.getPoints(), c = 0; c < this._points.length; c++)
                if (!this._points[c].equals(b[c]))
                    return !1;
            return !0
        },
        getName: function() {
            return "Polygon"
        },
        clone: function() {
            return new f(this.getPoints())
        }
    })
}),
nm_module("nm/features/polygonimage", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = a.PolygonImage = c(e, {
        constructor: function(a) {
            f.base.call(this, a),
            this._points = a,
            this._imageSource = null ,
            this._imageEnabled = !1
        },
        setPoints: function(a) {
            this._points = a,
            this.changed()
        },
        getPoints: function() {
            return this._points
        },
        equals: function(a) {
            var b = a.getPoints();
            if (b.length !== this._points.length)
                return !1;
            for (var c = 0; c < this._points.length; c++)
                if (!this._points[c].equals(b[c]))
                    return !1;
            return !0
        },
        setImageSource: function(a) {
            this._imageSource = a,
            this.changed()
        },
        getImageSource: function() {
            return this._imageSource
        },
        isImageEnabled: function() {
            return this._imageEnabled
        },
        toggleDisplayImage: function() {
            this._imageEnabled ? this._imageEnabled = !1 : this._imageEnabled = !0,
            this.changed()
        },
        enableImage: function(a) {
            this._imageEnabled = a,
            this.changed()
        },
        getName: function() {
            return "Polygon Image"
        },
        clone: function() {
            return new this.constructor(this.getPoints())
        }
    })
}),
nm_module("nm/features/geojsonhelper", function(a, b, c, d) {
    var e = b("jscore/types", "isUndefinedOrNull")
      , f = b("jscore/types", "isUndefined")
      , g = b("jscore/types", "isNumeric")
      , h = b("jscore/itertools", "map")
      , i = b("jscore/itertools", "array")
      , j = b("nm/console", "log")
      , k = b("nm/geom", "LatLng")
      , l = b("nm/features/arrow", "Arrow")
      , m = b("nm/features/circle", "Circle")
      , n = b("nm/features/imageoverlay", "ImageOverlay")
      , o = b("nm/features/label", "Label")
      , p = b("nm/features/line", "Line")
      , q = b("nm/features/lineString", "LineString")
      , r = b("nm/features/multiLineString", "MultiLineString")
      , s = b("nm/features/multiPoint", "MultiPoint")
      , t = b("nm/features/polygon", "Polygon")
      , u = b("nm/features/polygonimage", "PolygonImage");
    a.GeoJsonHelper = c(Object, {
        constructor: function() {},
        newFeatures: function(a) {
            return i(h(a.features, function(a) {
                return this.newFeature(a)
            }
            .bind(this)))
        },
        newFeature: function(a) {
            e(a.geometry) && (a.geometry = {}),
            e(a.properties) && (a.properties = {});
            var b = null ;
            switch (a.geometry.type) {
            case "Point":
                b = this.newPointFeature(a);
                break;
            case "LineString":
                b = this.newLineStringFeature(a);
                break;
            case "Polygon":
                b = this.newPolygonFeature(a);
                break;
            case "MultiPoint":
                b = this.newMultiPointFeature(a);
                break;
            case "MultiLineString":
                b = this.newMultiLineStringFeature(a);
                break;
            case "MultiPolygon":
                j("WARNING: MultiPolygon not currently supported.");
                break;
            case "GeometryCollection":
                j("WARNING: GeometryCollection not currently supported.");
                break;
            default:
                j("Unknown Geometry Type: ", a.geometry.type)
            }
            if (e(b))
                return null ;
            f(a.id) ? b.setId(a.properties.id) : b.setId(a.id);
            var c = a.properties.index;
            g(c) && b.setIndex(c);
            var d = a.properties._nm_zindex;
            return g(d) && b.setZIndex(d),
            b
        },
        newLatLng: function(a) {
            return new k(a[1],a[0])
        },
        newPoints: function(a) {
            for (var b = [], c = 0; c < a.length; c++)
                b.push(this.newLatLng(a[c]));
            return b
        },
        newPointFeature: function(a) {
            var b = this.newLatLng(a.geometry.coordinates);
            switch (a.properties.nmtype) {
            case "Circle":
                return this.newCircle(b, a.properties);
            case "ImageOverlay":
                return this.newImageOverlay(b, a.properties);
            case "Label":
                return this.newLabel(b, a.properties);
            default:
                return j("Default Point based geometry is not supported"),
                null 
            }
        },
        newCircle: function(a, b) {
            return new m(b.radius,b.name,a)
        },
        newImageOverlay: function(a, b) {
            return new n(b.url,b.width,b.height,b.rotation,b.name,a)
        },
        newLabel: function(a, b) {
            return new o(b.text,b.name,a)
        },
        newLineStringFeature: function(a) {
            var b = this.newPoints(a.geometry.coordinates);
            switch (a.properties.nmtype) {
            case "Arrow":
                return this.newArrow(b, a.properties);
            default:
                return new p(b)
            }
        },
        newArrow: function(a, b) {
            return new l(a,b.arrowHeads)
        },
        newPolygonFeature: function(a) {
            for (var b = a.geometry.coordinates[0], c = [], d = 0; d < b.length; d++)
                c.push(this.newLatLng(b[d]));
            switch (a.properties.nmtype) {
            case "PolygonImage":
                return this.newPolygonImage(c, a.properties);
            default:
                return new t(c)
            }
        },
        newPolygonImage: function(a, b) {
            var c = new u(a);
            return c.setImageSource(b.source),
            c
        },
        newMultiPointFeature: function(a) {
            for (var b = [], c = a.geometry.coordinates, d = 0; d < c.length; d++)
                b.push(this.newLatLng(c[d]));
            return new s(b)
        },
        newMultiLineStringFeature: function(a) {
            for (var b = [], c = a.geometry.coordinates, d = 0; d < c.length; d++) {
                var e = this.newLineString(c[d]);
                b.push(e)
            }
            return new r(b)
        },
        toFeature: function(a) {
            switch (a.constructor) {
            case l:
                return this.toArrowFeature(a);
            case m:
                return this.toCircleFeature(a);
            case n:
                return this.toImageOverlayFeature(a);
            case o:
                return this.toLabelFeature(a);
            case p:
                return this.toLineStringFeature(a);
            case q:
                return this.toLineStringFeature(a);
            case r:
                return this.toMultiLineStringFeature(a);
            case s:
                return this.toMultiPointFeature(a);
            case t:
                return this.toPolygonFeature(a);
            case u:
                return this.toPolygonImageFeature(a)
            }
            return j("WARNING: Couldn't process feature", a),
            null 
        },
        newGeoJsonFeature: function(a) {
            var b = {
                type: "Feature",
                id: a.getId(),
                properties: {
                    id: a.getId(),
                    index: a.getIndex(),
                    _nm_zindex: a.getZIndex()
                },
                geometry: null 
            };
            return "function" == typeof a.getName && (b.properties.name = a.getName()),
            b
        },
        toCoord: function(a) {
            return [a.getLon(), a.getLat()]
        },
        toCoords: function(a) {
            for (var b = [], c = 0; c < a.length; c++)
                b.push(this.toCoord(a[c]));
            return b
        },
        toPointFeature: function(a) {
            var b = this.toCoord(a.getPosition())
              , c = {
                type: "Point",
                coordinates: b
            }
              , d = this.newGeoJsonFeature(a);
            return d.geometry = c,
            d
        },
        toArrowFeature: function(a) {
            var b = this.toLineStringFeature(a);
            return b.properties.nmtype = "Arrow",
            b.properties.arrowHeads = a.getArrowHeads(),
            b
        },
        toCircleFeature: function(a) {
            var b = this.toPointFeature(a);
            return b.properties.nmtype = "Circle",
            b.properties.radius = a.getRadius(),
            b
        },
        toImageOverlayFeature: function(a) {
            var b = this.toPointFeature(a);
            return b.properties.nmtype = "ImageOverlay",
            b.properties.url = a.getURL(),
            b.properties.width = a.getWidth(),
            b.properties.height = a.getHeight(),
            b.properties.rotation = a.getRotation(),
            b
        },
        toLabelFeature: function(a) {
            var b = this.toPointFeature(a);
            return b.properties.nmtype = "Label",
            b.properties.text = a.getText(),
            b
        },
        toLineStringFeature: function(a) {
            for (var b = {
                type: "LineString",
                coordinates: []
            }, c = a.getPoints(), d = 0; d < c.length; d++) {
                var e = this.toCoord(c[d]);
                b.coordinates.push(e)
            }
            var f = this.newGeoJsonFeature(a);
            return f.geometry = b,
            f
        },
        toMultiLineStringFeature: function(a) {
            for (var b = {
                type: "MultiLineString"
            }, c = [], d = a.getLineStrings(), e = 0; e < d.length; e++)
                c.push(this.toCoords(d[e]));
            b.coordinates = c;
            var f = this.newGeoJsonFeature(a);
            return f.geometry = b,
            f
        },
        toMultiPointFeature: function(a) {
            var b = {
                type: "MultiPoint"
            };
            b.coordinates = this.toCoords(a.getPoints());
            var c = this.newGeoJsonFeature(a);
            return c.geometry = b,
            c
        },
        toPolygonFeature: function(a) {
            var b = {
                type: "Polygon",
                coordinates: []
            }
              , c = a.getPoints();
            b.coordinates.push(this.toCoords(c));
            var d = this.newGeoJsonFeature(a);
            return d.geometry = b,
            d
        },
        toPolygonImageFeature: function(a) {
            var b = this.toPolygonFeature(a);
            return b.properties.nmtype = "PolygonImage",
            b.properties.source = a.getImageSource(),
            b
        }
    })
}),
nm_module("nm/layers/feature", function(a, b, c, d) {
    var e = b("jscore/itertools", "iterator")
      , f = b("jscore/itertools", "filter")
      , g = b("jscore/itertools", "isEmpty")
      , h = b("jscore/itertools", "array")
      , i = b("jscore/objtools", "Dictionary")
      , j = b("jscore/sets", "Set")
      , k = b("jscore/types", "isUndefinedOrNull")
      , l = b("jscore/uuid", "uuid4")
      , m = b("nm/layers", "Layer")
      , n = b("nm/features/geojsonhelper", "GeoJsonHelper")
      , o = a.FeatureLayer = c(m, {
        constructor: function(a, b, c, d, e) {
            d = "undefined" == typeof arguments[3] ? !0 : d,
            e = "undefined" == typeof arguments[4] ? new n : e,
            o.base.call(this, a, b, c, d),
            this.geojsonHelper = e,
            this.features = new i,
            this.deletedFeatures = new j,
            this.currentIndex = 1,
            this.currentZIndex = 1
        },
        _newFeatureIndex: function() {
            var a = this.currentIndex;
            return this.currentIndex++,
            a
        },
        _newFeatureZIndex: function() {
            var a = this.currentZIndex;
            return this.currentZIndex++,
            a
        },
        getFeatures: function() {
            return this.features.values()
        },
        getFeaturesDict: function() {
            return this.features
        },
        getFeatureById: function(a) {
            return k(a) ? null  : this.features.get(a, null )
        },
        addNewFeature: function(a) {
            var b = a.getId();
            k(b) && (b = l(),
            a.setId(b)),
            this._canAddFeature(a) && (this._updateFeature(a),
            this.features.set(b, a),
            this.changed({
                inserted: [a]
            }))
        },
        addFeature: function(a) {
            return this._canAddFeature(a) ? (this._updateFeature(a),
            this.features.set(a.getId(), a),
            this.changed(),
            !0) : !1
        },
        addAllFeatures: function(a) {
            for (var b, c = h(f(a, function(a) {
                return this._canAddFeature(a)
            }
            .bind(this))), e = c[d.iterator](); !(b = e.next()).done; ) {
                var i = b.value;
                this._updateFeature(i),
                this.features.set(i.getId(), i)
            }
            return g(c) || this.changed(),
            c
        },
        _canAddFeature: function(a) {
            var b = a.getId();
            if (k(b))
                return !1;
            var c = this.features.get(b, null );
            return null  !== c ? !1 : !this.deletedFeatures.contains(b)
        },
        _updateFeature: function(a) {
            0 === a.getIndex() && a.setIndex(this._newFeatureIndex())
        },
        removeFeature: function(a) {
            var b = a.getId();
            k(b) || null  !== this.features.pop(b, null ) && this.changed()
        },
        removeFeatures: function(a) {
            for (var b, c = !1, e = a[d.iterator](); !(b = e.next()).done; ) {
                var f = b.value
                  , g = f.getId();
                k(g) || null  !== this.features.pop(g, null ) && (c = !0)
            }
            c && this.changed()
        },
        removeAllFeatures: function() {
            g(this.features) || (this.features = new i,
            this.changed())
        },
        deleteFeature: function(a) {
            var b = a.getId();
            if (!k(b)) {
                var c = this.features.pop(b, null );
                null  !== c && (this._featureDeleted(c),
                this.changed({
                    deleted: [c]
                }))
            }
        },
        deleteFeatures: function(a) {
            for (var b, c = this.features, e = f(a, function(a) {
                var b = a.getId();
                return !k(b) && c.hasKey(b)
            }), h = [], i = e[d.iterator](); !(b = i.next()).done; ) {
                var j = b.value
                  , l = c.pop(j.getId());
                this._featureDeleted(l),
                h.push(l)
            }
            g(h) || this.changed({
                deleted: h
            })
        },
        _featureDeleted: function(a) {
            if (this.isPersistent()) {
                var b = a.getId();
                k(b) || this.deletedFeatures.add(b)
            }
        },
        confirmDeletedFeatures: function(a) {
            for (var b, c = this.deletedFeatures, e = a[d.iterator](); !(b = e.next()).done; ) {
                var f = b.value;
                c.discard(f)
            }
        },
        getZIndexOfFeature: function(a) {
            return a.getZIndex()
        },
        bringFeatureToFront: function(a) {
            a.setZIndex(this._newFeatureZIndex()),
            this.changed()
        },
        getFeaturesBetweenIndexes: function(a, b) {
            return h(f(this.getFeatures(), function(c) {
                var d = c.getIndex();
                return d && d >= a && b >= d
            }))
        },
        getStyle: function() {
            return this.style
        },
        setStyle: function(a) {
            this.style !== a && (this.style = a,
            this.changed())
        },
        destroy: function() {
            this.removeAllFeatures()
        },
        fromGeoJson: function(a) {
            var b = a.properties
              , c = b.index;
            k(c) || (this.currentIndex = Math.max(c, this.currentIndex));
            var d = b._nm_zindex;
            k(d) || (this.currentZIndex = Math.max(d, this.currentZIndex));
            var e = b._nm_partialFeatures;
            this.setPartialFeatures(e);
            var f = this.geojsonHelper.newFeatures(a);
            return this.addAllFeatures(f)
        },
        toGeoJson: function(a) {
            a = "undefined" == typeof arguments[0] ? this.getFeatures() : a;
            for (var b, c = {
                id: this.getId() || null ,
                name: this.getName() || null ,
                index: this.currentIndex,
                _nm_zIndex: this.currentZIndex
            }, e = [], f = a[d.iterator](); !(b = f.next()).done; ) {
                var g = b.value
                  , h = this.geojsonHelper.toFeature(g);
                k(h) || e.push(h)
            }
            return {
                type: "FeatureCollection",
                properties: c,
                features: e
            }
        }
    });
    o.prototype[d.iterator] = function() {
        return e(this.features.values())
    }
}),
nm_module("nm/layers/floodlayer", function(a, b, c, d) {
    var e = b("nm/layers", "Layer")
      , f = b("jscore/types", "isUndefined")
      , g = a.FloodLayer = c(e, {
        constructor: function(a, b) {
            g.base.call(this, a, b)
        },
        getThreshold: function() {
            return this._threshold
        },
        getSurveyDate: function() {
            return this._surveyDate
        },
        getTransparency: function() {
            return this._transparency
        },
        getColor: function() {
            return this._color
        },
        getGradient: function() {
            return this._gradient
        },
        update: function(a) {
            var b = a
              , c = b.grad
              , d = b.color
              , e = b.transp
              , g = b.surveyDate
              , b = b.thres;
            b = b || this._threshold,
            g = g || this._surveyDate,
            e = e || this._transparency,
            d = d || this._color,
            c = f(c) ? this._gradient : c;
            var h = !(b === this._threshold && g === this._surveyDate && e === this._transparency && d === this._color && c === this._gradient);
            h && (this._threshold = b,
            this._surveyDate = g,
            this._transparency = e,
            this._color = d,
            this._gradient = c,
            this.changed())
        },
        destroy: function() {
            this._threshold = null ,
            this._surveyDate = null ,
            this._transparency = null ,
            this._color = null ,
            this._gradient = null 
        }
    })
}),
nm_module("nm/layers/shadowlayer", function(a, b, c, d) {
    var e = b("nm/layers", "Layer")
      , f = a.ShadowLayer = c(e, {
        constructor: function(a, b, c) {
            c = "undefined" == typeof arguments[2] ? !1 : c,
            f.base.call(this, a, b),
            this._hasObjectSupport = c
        },
        getSimDate: function() {
            return this._simDate
        },
        getSurveyDate: function() {
            return this._surveyDate
        },
        getColor: function() {
            return this._color
        },
        supportsObjects: function() {
            return this._hasObjectSupport
        },
        update: function(a) {
            var b = a
              , c = b.color
              , d = b.surveyDate
              , b = b.simDate;
            b = b || this._simDate,
            d = d || this._surveyDate,
            c = c || this._color;
            var e = !(b === this._simDate && d === this._surveyDate && c === this._color);
            e && (this._simDate = b,
            this._surveyDate = d,
            this._color = c,
            this.changed())
        },
        destroy: function() {
            this._simDate = null ,
            this._surveyDate = null ,
            this._color = null 
        }
    })
}),
nm_module("nm/maps/select", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/sets", "Set")
      , g = b("js-libs/jquery", "jQuery")
      , h = b("nm/layers", "Layer")
      , i = b("nm/features/feature", "Feature")
      , j = b("nm/features/geometry", "Geometry")
      , f = b("jscore/sets", "Set")
      , k = new f(["input", "textarea"])
      , l = a.SelectionManager = c(e, {
        constructor: function() {
            l.base.call(this),
            this.items = new f,
            this.replaceSelection = !0;
            var a = this;
            g(document).keydown(function(b) {
                if (document.activeElement) {
                    var c = document.activeElement.tagName.toLowerCase();
                    if (!k.contains(c)) {
                        var d = b.metaKey || b.ctrlKey || b.shiftKey
                          , e = b.shiftKey;
                        a._setReplaceSelection(!d),
                        a._setMultiSelection(e)
                    }
                }
            }),
            g(document).keyup(function(b) {
                if (document.activeElement) {
                    var c = document.activeElement.tagName.toLowerCase();
                    if (!k.contains(c)) {
                        var d = b.metaKey || b.ctrlKey || b.shiftKey
                          , e = b.shiftKey;
                        a._setReplaceSelection(!d),
                        a._setMultiSelection(e)
                    }
                }
            })
        },
        _setReplaceSelection: function(a) {
            this.replaceSelection !== a && (this.replaceSelection = a,
            this.changed())
        },
        _setMultiSelection: function(a) {
            this.multiSelection !== a && (this.multiSelection = a,
            this.multiSelection || (this.firstSelFeature = null ),
            this.changed())
        },
        _handleMultiSelection: function(a, b, c) {
            if (!this.firstSelFeature) {
                var d = a.toArray();
                d.length > 0 ? this.firstSelFeature = d.slice(-1)[0] : this.firstSelFeature = b
            }
            var e = this.firstSelFeature.getIndex()
              , f = b.getIndex()
              , g = [e, f];
            g = g.sort(function(a, b) {
                return a - b
            });
            var h = c.getFeaturesBetweenIndexes(g[0], g[1]);
            a.add.apply(a, h)
        },
        handleViewSelect: function(a, b) {
            var c = this.items;
            this.replaceSelection ? c.contains(a) || (c.clear(),
            c.add(a),
            this.changed()) : (c.contains(a) ? c.discard(a) : (this.multiSelection && this._handleMultiSelection(c, a, b),
            c.add(a)),
            this.changed())
        },
        select: function(a) {
            var b = this.items;
            b.clear(),
            a instanceof Array ? b.add.apply(b, a) : b.add(a),
            this.changed()
        },
        unselect: function(a) {
            var b = this.items;
            if (a instanceof Array)
                b.discard.apply(b, a);
            else if (a instanceof f) {
                var c = a.toArray();
                b.discard.apply(b, c)
            } else
                b.discard(a);
            this.changed()
        },
        unselectAll: function() {
            this.items.clear(),
            this.changed()
        },
        isSelected: function(a) {
            return this.items.contains(a)
        },
        getItems: function() {
            return this.items
        },
        getLastItem: function() {
            var a = this.items.toArray();
            return a[a.length - 1]
        },
        getSelectedFeatures: function() {
            for (var a, b = [], c = this.getItems()[d.iterator](); !(a = c.next()).done; ) {
                var e = a.value;
                (e instanceof i || e instanceof j) && b.push(e)
            }
            return b
        },
        getSelectedLayers: function() {
            for (var a, b = [], c = this.getItems()[d.iterator](); !(a = c.next()).done; ) {
                var e = a.value;
                e instanceof h && b.push(e)
            }
            return b
        }
    })
}),
nm_module("nm/layers/geojson", function(a, b, c, d) {
    var e = b("jscore/itertools", "array")
      , f = b("jscore/itertools", "findIndex")
      , g = b("jscore/objtools", "Dictionary")
      , h = b("jscore/sets", "Set")
      , i = b("jscore/types", "isUndefinedOrNull")
      , j = b("jscore/types", "isUndefined")
      , k = b("nm/layers", "Layer")
      , l = a.GeoJSONLayer = c(k, {
        constructor: function(a, b, c, d, e) {
            d = "undefined" == typeof arguments[3] ? !0 : d,
            e = "undefined" == typeof arguments[4] ? !1 : e,
            l.base.call(this, a, b, c, d, !0),
            this.layerId = c,
            this.showLabels = e,
            this.featureIds = new h,
            this.geojson = null ,
            this.styleDefs = null 
        },
        getShowLabels: function() {
            return this.showLabels
        },
        setShowLabels: function(a) {
            this.showLabels !== a && (this.showLabels = a,
            this.changed({
                showLabels: a
            }))
        },
        getGeoJson: function() {
            var a = this.geojson;
            return null  === a ? {
                type: "FeatureCollection",
                properties: {},
                features: []
            } : a
        },
        getFeatures: function() {
            var a = this.geojson;
            return null  !== a ? a.features : []
        },
        addAllFeatures: function(a) {
            null  === this.geojson && (this.geojson = {
                type: "FeatureCollection",
                properties: {},
                features: []
            });
            for (var b, c = !1, e = a[d.iterator](); !(b = e.next()).done; ) {
                var f = b.value
                  , g = f.id;
                if (j(g) && (g = f.properties.id,
                f.id = g),
                !i(g)) {
                    var h = this.featureIds.contains(g);
                    h || (c = !0,
                    this.featureIds.add(g),
                    this._updateFeature(f),
                    this.geojson.features.push(f))
                }
            }
            return c && this.changed(),
            []
        },
        removeFeatures: function(a) {
            if (null  !== this.geojson) {
                for (var b, c = !1, e = this.geojson.features, f = this.featureIds, g = a[d.iterator](); !(b = g.next()).done; ) {
                    var h = b.value
                      , k = h.id;
                    if (j(k) && (k = h.properties.id),
                    !i(k)) {
                        var l = f.contains(k);
                        if (l) {
                            c = !0;
                            var m = this.indexOfFeature(k);
                            m >= 0 && e.splice(m, 1),
                            f.discard(k)
                        }
                    }
                }
                c && this.changed()
            }
        },
        removeAllFeatures: function(a) {
            a = "undefined" == typeof arguments[0] ? !0 : a,
            null  !== this.geojson && (this.geojson = null ,
            this.featureIds.clear(),
            this.styleDefs = null ,
            a && this.changed())
        },
        _updateFeature: function(a) {
            a.properties._nm_layerId = this.layerId
        },
        _extractStyleDefinitions: function(a) {
            var b = new g
              , c = a.properties._nm_styles;
            if (!i(c))
                for (var d in c)
                    c.hasOwnProperty(d) && b.set(d, c[d]);
            return b
        },
        getStyleDef: function(a) {
            return null  !== this.styleDefs ? this.styleDefs.get(a, null ) : null 
        },
        getFeatureById: function(a) {
            var b = this.indexOfFeature(a);
            return b >= 0 ? this.geojson.features[b] : null 
        },
        indexOfFeature: function(a) {
            return null  === this.geojson || i(a) ? -1 : f(this.geojson.features, function(b) {
                return b.id === a
            }
            .bind(this))
        },
        destroy: function() {
            this.removeAllFeatures()
        },
        _newGeoJson: function(a) {
            this.geojson = a,
            this.styleDefs = this._extractStyleDefinitions(a);
            for (var b = a.features, c = this.featureIds, d = b.length - 1; d >= 0; d--) {
                var e = b[d]
                  , f = e.id;
                j(f) && (f = e.properties.id,
                e.id = f),
                i(f) || c.contains(f) ? b.splice(d, 1) : (this._updateFeature(e),
                c.add(f))
            }
            return b
        },
        isOverMaxSize: function() {
            return null  === this.geojson ? !1 : this.geojson.features.length > 1e3
        },
        fromGeoJson: function(a) {
            var b, c = a.properties, d = c._nm_partialFeatures;
            return (d || this.isOverMaxSize()) && this.removeAllFeatures(!1),
            null  === this.geojson ? (b = this._newGeoJson(a),
            this.changed()) : b = this.addAllFeatures(a.features),
            this.setPartialFeatures(d),
            b
        },
        toGeoJson: function(a) {
            var b = this.getGeoJson();
            return i(a) ? b : {
                type: "FeatureCollection",
                properties: b.properties,
                features: e(a)
            }
        }
    })
}),
nm_module("jscore/dateutils", function(a, b, c, d) {
    var e = b("./strings", "pad")
      , f = b("./types", "isUndefined")
      , g = (a.isEqualDateTime = function(a, b, c) {
        var d = null 
          , e = null ;
        return (f(c) || null  === c) && (c = !1),
        a instanceof Date && (c && (a = new Date(a.getFullYear(),a.getMonth(),a.getDate())),
        d = a.getTime()),
        b instanceof Date && (c && (b = new Date(b.getFullYear(),b.getMonth(),b.getDate())),
        e = b.getTime()),
        d === e
    }
    ,
    a.parse = function(a) {
        var b = new Date(Date.parse(a));
        return b
    }
    ,
    a.compareDateTimes = function(a, b) {
        var c = null 
          , d = null ;
        return a instanceof Date && (c = a.getTime()),
        b instanceof Date && (d = b.getTime()),
        b > a ? -1 : a > b ? 1 : 0
    }
    ,
    a.naive = function(a, b, c, d, e, f, g) {
        return new Date(Date.UTC(a, b - 1, c, d, e, f, g))
    }
    ,
    new RegExp("d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\\1?|[LloSZ]|\"[^\"]*\"|'[^']*'","g"))
      , h = new RegExp("\\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\\d{4})?)\\b","g")
      , i = /[^-+\dA-Z]/g
      , j = a.formats = {
        "default": "ddd mmm dd yyyy HH:MM:ss",
        shortDate: "m/d/yy",
        mediumDate: "mmm d, yyyy",
        longDate: "mmmm d, yyyy",
        fullDate: "dddd, mmmm d, yyyy",
        shortTime: "h:MM TT",
        mediumTime: "h:MM:ss TT",
        longTime: "h:MM:ss TT Z",
        isoDate: "yyyy-mm-dd",
        isoTime: "HH:MM:ss",
        isoDateTime: "yyyy-mm-dd'T'HH:MM:ss",
        isoUtcDateTime: "UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"
    }
      , k = a.shortDayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
      , l = a.longDayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
      , m = a.shortMonthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
      , n = a.longMonthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    a.format = function(a, b, c) {
        if (1 !== arguments.length || "[object String]" !== Object.prototype.toString.call(a) || /\d/.test(a) || (b = a,
        a = void 0),
        a = a ? new Date(a) : new Date,
        isNaN(a))
            throw "invalid date";
        b = String(j[b] || b || j["default"]),
        "UTC:" === b.slice(0, 4) && (b = b.slice(4),
        c = !0);
        var d = c ? "getUTC" : "get"
          , f = a[d + "Date"]()
          , o = a[d + "Day"]()
          , p = a[d + "Month"]()
          , q = a[d + "FullYear"]()
          , r = a[d + "Hours"]()
          , s = a[d + "Minutes"]()
          , t = a[d + "Seconds"]()
          , u = a[d + "Milliseconds"]()
          , v = c ? 0 : a.getTimezoneOffset()
          , w = {
            d: f,
            dd: e(f),
            ddd: k[o],
            dddd: l[o],
            m: p + 1,
            mm: e(p + 1),
            mmm: m[p],
            mmmm: n[p],
            yy: String(q).slice(2),
            yyyy: q,
            h: r % 12 || 12,
            hh: e(r % 12 || 12),
            H: r,
            HH: e(r),
            M: s,
            MM: e(s),
            s: t,
            ss: e(t),
            l: e(u, 3),
            L: e(u > 99 ? Math.round(u / 10) : u),
            t: 12 > r ? "a" : "p",
            tt: 12 > r ? "am" : "pm",
            T: 12 > r ? "A" : "P",
            TT: 12 > r ? "AM" : "PM",
            Z: c ? "UTC" : (String(a).match(h) || [""]).pop().replace(i, ""),
            o: (v > 0 ? "-" : "+") + e(100 * Math.floor(Math.abs(v) / 60) + Math.abs(v) % 60, 4),
            S: ["th", "st", "nd", "rd"][f % 10 > 3 ? 0 : (f % 100 - f % 10 !== 10) * f % 10]
        };
        return b.replace(g, function(a) {
            return a in w ? w[a] : a.slice(1, a.length - 1)
        })
    }
}),
nm_module("nm/features/solar", function(a, b, c, d) {
    var e = b("jscore/objtools", "id")
      , f = b("jscore/events", "ObservableObject")
      , g = b("nm/features/feature", "Feature")
      , h = b("jscore/events", "Change")
      , i = b("jscore/functools", "bind")
      , j = b("jscore/uuid", "uuid4")
      , k = b("nm/geom", "LatLng")
      , l = b("jscore/dateutils", "isEqualDateTime")
      , m = a.SolarPanel = c(g, {
        constructor: function(a, b, c, d, e, f) {
            m.base.call(this, "Solar Panel", b),
            this.setId(a || j()),
            c = c || 0,
            0 > c && (c = 360 + c),
            this.orientation = c % 360,
            this.tilt = d || 0,
            this.panelType = f,
            this.mountPortrait = e || !1,
            this.setupListeners()
        },
        setOrientation: function(a) {
            a = a || 0,
            a = (360 + a) % 360,
            this.orientation !== a && (this.orientation = a,
            this.changed())
        },
        setTilt: function(a) {
            a = Math.min(a, 90),
            a = Math.max(a, 0),
            this.tilt !== a && (this.tilt = a,
            this.changed())
        },
        setMountPortrait: function(a) {
            this.mountPortrait !== a && (this.mountPortrait = a,
            this.changed())
        },
        setPanelType: function(a) {
            this.panelType && this.panelType.removeListeners(this),
            this.panelType = a,
            this.setupListeners(),
            this.changed()
        },
        setupListeners: function() {
            var a = this.panelType;
            a && a.addListener(h, i(this, this.panelTyepChanged))
        },
        panelTyepChanged: function() {
            this.changed()
        },
        getWidth: function() {
            return this.mountPortrait ? this.panelType.width : this.panelType.length
        },
        getHeight: function() {
            return this.mountPortrait ? this.panelType.length : this.panelType.width
        },
        toJSON: function() {
            var a = this.position
              , b = this.panelType
              , c = {
                type: "Feature",
                geometry: {
                    type: "Point",
                    coordinates: [a.lng, a.lat]
                },
                properties: {
                    id: this.id,
                    index: this.index,
                    orientation: this.orientation,
                    tilt: this.tilt,
                    mountPortrait: this.mountPortrait,
                    panelType: e(b)
                }
            };
            return c
        },
        clone: function() {
            return new m(null ,this.getPosition(),this.orientation,this.tilt,this.mountPortrait,this.panelType)
        },
        destroy: function() {
            var a = this.panelType;
            a && a.removeListeners(this)
        }
    })
      , n = a.SolarJob = c(g, {
        constructor: function(a, b, c, d, e, f, g, h, i, l) {
            n.base.call(this, c, b),
            this.modifiedTime = 0,
            this.id = this.id = a || j(),
            this.title = c,
            this.address = d,
            this.efficiency = g || 77,
            this.surveyDate = e,
            this.imageTimestamp = f,
            this.shadingLosses = h || [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            var m = this.position
              , o = m.lat
              , p = m.lng;
            this.sw = i || new k(o - 1e-4,p - 1e-4),
            this.ne = l || new k(o + 1e-4,p + 1e-4)
        },
        setTitle: function(a) {
            this.title !== a && (this.title = a,
            this.changed())
        },
        setAddress: function(a) {
            this.address = a,
            this.changed()
        },
        setEfficiency: function(a) {
            var b = parseFloat(a);
            isNaN(b) && (b = 100),
            this.efficiency !== b && (this.efficiency = b,
            this.changed())
        },
        setShadingLosses: function(a) {
            for (var b = this.shadingLosses, c = 0; 12 > c; c++)
                if (b[c] !== a[c]) {
                    this.shadingLosses = a,
                    this.changed();
                    break
                }
        },
        setSurveyDate: function(a) {
            l(this.surveyDate, a) || (this.surveyDate = a,
            this.changed())
        },
        setImageTimestamp: function(a) {
            a && !l(this.imageTimestamp, a) && (this.imageTimestamp = a,
            this.changed())
        },
        toJSON: function() {
            var a = this.position
              , b = {
                type: "Feature",
                geometry: {
                    type: "Point",
                    coordinates: [a.lng, a.lat]
                },
                properties: {
                    id: this.id,
                    name: this.title,
                    address: this.address,
                    efficiency: this.efficiency,
                    shadingLosses: this.shadingLosses,
                    surveyDate: this.surveyDate,
                    imageTimestamp: this.imageTimestamp,
                    sw: this.sw,
                    ne: this.ne,
                    modifiedTime: this.modifiedTime
                }
            };
            return b
        },
        setBounds: function(a, b) {
            this.ne.equals(a) && this.sw.equals(b) || (this.sw = b,
            this.ne = a,
            this.changed())
        },
        panelsChanged: function() {
            this.changed()
        },
        setModified: function() {
            this.modifiedTime = (new Date).getTime()
        }
    })
      , o = a.PanelType = c(f, {
        constructor: function(a, b, c, d, e, f, g, h, i) {
            o.base.call(this),
            this.width = b,
            this.length = c,
            this.manufacturer = d,
            this.model = e,
            this.power = f,
            this.type = g,
            this.noct = h,
            this.tempCoef = i,
            this.__id = a
        },
        setManufacturer: function(a) {
            this.manufacturer !== a && (this.manufacturer = a,
            this.changed())
        },
        setModel: function(a) {
            this.model !== a && (this.model = a,
            this.changed())
        },
        setType: function(a) {
            this.type !== a && (this.type = a,
            this.changed())
        },
        setLength: function(a) {
            this.length !== a && (this.length = a,
            this.changed())
        },
        setWidth: function(a) {
            this.width !== a && (this.width = a,
            this.changed())
        },
        setPower: function(a) {
            this.power !== a && (this.power = a,
            this.changed())
        },
        setNoct: function(a) {
            this.noct !== a && (this.noct = a,
            this.changed())
        },
        setTempCoef: function(a) {
            this.tempCoef !== a && (this.tempCoef = a,
            this.changed())
        },
        clone: function() {
            return new o(j(),this.width,this.length,"(custom) " + this.manufacturer,this.model,this.power,this.type,this.noct,this.tempCoef)
        },
        toJSON: function() {
            var a = {
                id: this.__id,
                width: this.width,
                length: this.length,
                manufacturer: this.manufacturer,
                model: this.model,
                power: this.power,
                type: this.type,
                noct: this.noct,
                tempCoef: this.tempCoef
            };
            return a
        }
    })
}),
nm_module("nm/layers/LayersController", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/itertools", "filter")
      , g = b("jscore/itertools", "some")
      , h = b("nm/layers", "Layer")
      , i = b("nm/layers/feature", "FeatureLayer")
      , j = b("nm/layers/floodlayer", "FloodLayer")
      , k = b("nm/layers/shadowlayer", "ShadowLayer")
      , l = b("nm/maps/select", "SelectionManager")
      , m = b("nm/features/feature", "Feature")
      , n = b("nm/features/geometry", "Geometry")
      , o = b("nm/layers/geojson", "GeoJSONLayer")
      , p = b("nm/features/solar", "SolarJob")
      , q = b("nm/features/solar", "SolarPanel")
      , r = a.isItemSupported = function(a) {
        var b = [i, o, m, n, j, k]
          , c = g(b, function(b) {
            return a instanceof b
        }
        .bind(this))
          , d = Boolean("Solar Jobs Layer" === a.getName() || "Current Solar Job Layer" === a.getName() || a instanceof p || a instanceof q);
        return Boolean(c && !d)
    }
      , s = a.LayersController = c(e, {
        constructor: function(a) {
            s.base.call(this),
            this._layers = a || [],
            this._numberOfLayersCreated = 0,
            this._selectionCtrl = new l
        },
        getSelectionCtrl: function() {
            return this._selectionCtrl
        },
        getLayers: function() {
            return this._layers
        },
        insertLayerAtTop: function(a) {
            -1 === this._layers.indexOf(a) && (this._layers.push(a),
            this._numberOfLayersCreated++,
            this.changed())
        },
        insertLayerAboveLayer: function(a) {
            this.insertLayerAtTop(a)
        },
        removeLayer: function(a) {
            var b = this._layers
              , c = b.indexOf(a);
            c > -1 && (b.splice(c, 1),
            a.destroy(),
            this.changed({
                deleted: [a]
            }))
        },
        removeLayers: function(a) {
            for (var b, c = a[d.iterator](); !(b = c.next()).done; ) {
                var e = b.value;
                this.removeLayer(e)
            }
        },
        addLayer: function(a) {
            var b = this.getTopSelectedItem();
            b instanceof m || b instanceof n ? this.insertLayerAboveLayer(a, b) : b instanceof i ? this.insertLayerAboveLayer(a, b) : this.insertLayerAtTop(a)
        },
        newLayer: function(a) {
            this.addLayer(a)
        },
        getSelectedFeatureLayers: function() {
            for (var a, b = [], c = this._selectionCtrl.getItems()[d.iterator](); !(a = c.next()).done; ) {
                var e = a.value;
                e instanceof i && b.push(e)
            }
            return b
        },
        addFeature: function(a) {
            var b = this.getTopSelectedItem();
            if (b instanceof i)
                b.addNewFeature(a),
                b.setVisible(!0);
            else {
                var c = this.getTopmostSupportedLayer(function(a) {
                    return a instanceof i
                }
                .bind(this));
                if (c)
                    c.addNewFeature(a),
                    c.setVisible(!0);
                else {
                    var d = this.newFeatureLayer();
                    d.addNewFeature(a),
                    this.insertLayerAtTop(d)
                }
            }
        },
        deleteFeature: function(a) {
            var b = this.getParentLayerOfFeature(a);
            b && b.deleteFeature(a)
        },
        deleteFeatures: function(a) {
            for (var b, c = a[d.iterator](); !(b = c.next()).done; ) {
                var e = b.value;
                this.deleteFeature(e)
            }
        },
        insertFeatureAboveFeature: function(a, b) {
            var c = this.getParentLayerOfFeature(b);
            c.addNewFeature(a)
        },
        getParentLayerOfFeature: function(a) {
            for (var b, c = this._layers[d.iterator](); !(b = c.next()).done; ) {
                var e = b.value;
                if (e.constructor === i && e.getFeatures().indexOf(a) > -1)
                    return e
            }
            return null 
        },
        getSelectedFeatures: function() {
            return this._selectionCtrl.getSelectedFeatures()
        },
        getTopSelectedItem: function() {
            var a = this.getSupportedSelectedItems();
            return a[a.length - 1]
        },
        getSupportedSelectedItems: function() {
            for (var a, b = this._selectionCtrl.getItems(), c = [], e = b[d.iterator](); !(a = e.next()).done; ) {
                var f = a.value;
                r(f) && c.push(f)
            }
            return c
        },
        autoselectLayer: function() {
            var a = this.getTopmostSupportedLayer();
            a ? this._selectionCtrl.select(a) : this._selectionCtrl.unselectAll()
        },
        autoselectItem: function() {},
        deleteSelectedLayers: function() {
            var a = this._selectionCtrl.getSelectedLayers();
            this.removeLayers(a),
            this._selectionCtrl.unselect(a),
            this.autoselectLayer()
        },
        deleteSelectedFeatures: function() {
            var a = this.getSelectedFeatures()
              , b = f(a, r);
            this.deleteFeatures(b),
            this._selectionCtrl.unselect(b)
        },
        newFeatureLayer: function() {
            var a = "Layer " + this.getNumberOfLayersCreated()
              , b = new i(a);
            return this.addLayer(b),
            this._selectionCtrl.select(b),
            b
        },
        getTopmostSupportedLayer: function(a) {
            a = "undefined" == typeof arguments[0] ? function() {}
             : a;
            for (var b, c = this._layers.concat().reverse(), e = c[d.iterator](); !(b = e.next()).done; ) {
                var f = b.value;
                if (f instanceof h && r(f) && a(f) !== !1)
                    return f
            }
            return null 
        },
        newFeature: function(a) {
            this.addFeature(a),
            this._selectionCtrl.select(a)
        },
        getNumberOfLayersCreated: function() {
            return this._numberOfLayersCreated
        },
        getLayerById: function(a) {
            for (var b, c = this.getLayers()[d.iterator](); !(b = c.next()).done; ) {
                var e = b.value;
                if (e.getId() === a)
                    return e
            }
            return null 
        }
    })
}),
nm_module("nm/maps/map", function(a, b, c, d) {
    var e = b("jscore/events", "Event")
      , f = b("jscore/types", "isUndefined")
      , g = b("nm/geom", "LatLng")
      , h = b("jscore/events", "ObservableObject")
      , i = b("nm/maps/drag", "DragHandler")
      , j = b("nm/layers/LayersController", "LayersController")
      , k = a.Click = c(e, {
        constructor: function(a) {
            k.base.call(this),
            this.latLng = a
        }
    })
      , l = a.Map = c(h, {
        constructor: function(a) {
            l.base.call(this),
            this.center = a.center || new g(0,0),
            this.zoom = a.zoom || 0,
            this.heading = a.heading || 0,
            this.tilt = a.tilt || !1,
            this.layersCtrl = new j,
            this.selection = this.layersCtrl.getSelectionCtrl(),
            this.dragHandler = new i(this.selection)
        },
        getLayers: function() {
            return this.layers
        },
        getLayersCtrl: function() {
            return this.layersCtrl
        },
        getSelection: function() {
            return this.selection
        },
        getDragHandler: function() {
            return this.dragHandler
        },
        setCenter: function(a, b) {
            this.center !== a && this.setView({
                center: a
            }, b)
        },
        setZoom: function(a, b) {
            this.zoom !== a && this.setView({
                zoom: a
            }, b)
        },
        setHeading: function(a, b) {
            this.setView({
                heading: a
            }, b)
        },
        setTilt: function(a, b) {
            this.setView({
                tilt: a
            }, b)
        },
        getCenter: function() {
            return this.center
        },
        getZoom: function() {
            return this.zoom
        },
        setView: function(a) {
            var b = a.heading
              , c = a.tilt
              , d = a.zoom
              , e = a.center;
            b = f(b) ? this.heading : b,
            b = Math.abs(b % 360),
            c = f(c) ? this.tilt : c,
            d = f(d) ? this.zoom : d,
            e = e || this.center;
            var g = !(b === this.heading && c === this.tilt && d === this.zoom && e.equals(this.center));
            g && (this.center = e,
            this.zoom = d,
            this.tilt = c,
            this.heading = b,
            this.changed())
        }
    })
}),
nm_module("nm/layers/baselayer", function(a, b, c, d) {
    var e = b("nm/layers", "Layer")
      , f = b("nm/const/tools", "USE_DISCOVERY_SETTINGS")
      , g = a.BaseLayer = c(e, {
        constructor: function(a, b, c, d, e) {
            g.base.call(this, d, e),
            this._auth = a,
            this._surveysController = b,
            this._useCommlng = c
        },
        getSurveysController: function() {
            return this._surveysController
        },
        useCommingling: function() {
            return this._useCommlng
        },
        getSubdomains: function() {
            return this._auth.can(f) ? ["web10", "web11", "web12", "web13"] : ["web0", "web1", "web2", "web3"]
        }
    })
}),
nm_module("jscore/math", function(a, b, c, d) {
    a.degreesToRadians = function(a) {
        return a * (Math.PI / 180)
    }
    ,
    a.radiansToDegrees = function(a) {
        return a / (Math.PI / 180)
    }
    ,
    a.formatNumber = function(a, b, c) {
        var d, e, f, g, h = a.toString().split("."), i = "";
        for (b || (b = 3),
        c || (c = ","),
        d = h[0],
        e = h.length >= 2 ? "." + h[1] : "",
        f = d.length - 1,
        g = 0; f >= 0; )
            i = d.charAt(f) + (0 !== g && g % b === 0 ? c : "") + i,
            g++,
            f--;
        return i + e
    }
}),
nm_module("nm/projections/google", function(a, b, c, d) {
    var e = b("jscore/math", "degreesToRadians")
      , f = b("jscore/math", "radiansToDegrees")
      , g = b("nm/geom", "HEADING_NORTH")
      , h = b("nm/geom", "HEADING_SOUTH")
      , i = b("nm/geom", "HEADING_EAST")
      , j = b("nm/geom", "HEADING_WEST")
      , k = b("js-libs/google", "maps")
      , l = k.Point
      , m = k.LatLng;
    a.MercatorProjection = c(Object, {
        constructor: function(a, b, c) {
            this.heading = c || g,
            c === g || c === h ? (this.origin = new l(a / 2,b / 2),
            this.pixelsPerLonDegree = a / 360,
            this.pixelsPerLatRadian = b / (2 * Math.PI)) : (this.origin = new l(b / 2,a / 2),
            this.pixelsPerLonDegree = b / 360,
            this.pixelsPerLatRadian = a / (2 * Math.PI))
        },
        rotateLatLng: function(a, b) {
            switch (this.heading) {
            case g:
                break;
            case i:
                b = -b;
                break;
            case h:
                a = -a,
                b = -b;
                break;
            case j:
                a = -a
            }
            return new m(a,b)
        },
        rotatePoint: function(a) {
            var b = this.heading;
            return b === g || b === h ? new l(a.x,a.y) : new l(a.y,a.x)
        },
        rotateTile: function(a, b) {
            var c, d, e = 1 << b;
            switch (this.heading) {
            case g:
                c = a.x,
                d = a.y;
                break;
            case i:
                c = e - (a.y + 1),
                d = a.x;
                break;
            case h:
                c = e - (a.x + 1),
                d = e - (a.y + 1);
                break;
            case j:
                c = a.y,
                d = e - (a.x + 1)
            }
            return new l(c,d)
        },
        fromLatLngToPoint: function(a) {
            var b = this.origin;
            a = this.rotateLatLng(a.lat(), a.lng());
            var c = b.x + a.lng() * this.pixelsPerLonDegree
              , d = Math.sin(e(a.lat()))
              , f = b.y + .5 * Math.log((1 + d) / (1 - d)) * -this.pixelsPerLatRadian;
            return this.rotatePoint({
                x: c,
                y: f
            })
        },
        fromPointToLatLng: function(a) {
            var b = this.origin;
            a = this.rotatePoint(a);
            var c = (a.x - b.x) / this.pixelsPerLonDegree
              , d = (a.y - b.y) / -this.pixelsPerLatRadian
              , e = f(2 * Math.atan(Math.exp(d)) - Math.PI / 2);
            return this.rotateLatLng(e, c)
        }
    })
}),
nm_module("nm/const/imagery", function(a, b, c, d) {
    a.HYBRID = "hybrid",
    a.ROAD = "road",
    a.SATELLITE = "sat",
    a.TERRAIN = "terrain",
    a.SURVEY = "survey",
    a.SURVEY_N = "survey_n",
    a.SURVEY_E = "survey_e",
    a.SURVEY_S = "survey_s",
    a.SURVEY_W = "survey_w",
    a.DSM = "DSM"
}),
nm_module("nm/dataproviders/surveys", function(a, b, c, d) {
    function e(a, b) {
        return Math.floor((a + 180) / 360 * Math.pow(2, b))
    }
    function f(a, b) {
        return Math.floor((1 - Math.log(Math.tan(a * Math.PI / 180) + 1 / Math.cos(a * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, b))
    }
    function g(a, b) {
        if ("string" == typeof b && "/Date(" === b.slice(0, 6)) {
            var c = b.slice(6, -2);
            c = parseInt(c, 10),
            b = new Date(c)
        }
        return b
    }
    var h = b("nm/geom", "getNormalizedCoord")
      , i = b("nm/const", "TILE_HOST")
      , j = b("jscore/async", "callWhenIdle")
      , k = b("jscore/functools", "bind")
      , l = b("jscore/objtools", "Dictionary")
      , m = b("jscore/events", "Change")
      , n = b("jscore/events", "Event")
      , o = b("jscore/events", "EventTarget")
      , p = b("jscore/strings", "format")
      , q = b("jscore/types", "isUndefined")
      , r = b("nm/const/imagery", "SURVEY")
      , s = b("nm/const/imagery", "SURVEY_N")
      , t = b("nm/const/imagery", "SURVEY_E")
      , u = b("nm/const/imagery", "SURVEY_S")
      , v = b("nm/const/imagery", "SURVEY_W")
      , w = b("nm/const/imagery", "TERRAIN")
      , x = b("nm/const/imagery", "DSM")
      , y = b("js-libs/jquery", "jQuery")
      , z = new l([[r, "Vert"], [s, "N___"], [t, "E___"], [u, "S___"], [v, "W___"], [w, "Dem_"], [x, "Dsm_"]])
      , A = "{host}/maps/?x={x}&y={y}&z={z}&bbox={bottom},{left},{top},{right}&s={s}&nmq=INFO&return200=true&httpauth=false&nmf=json"
      , B = a.CoverageStatus = {
        PARTIAL: "partial",
        FULL: "full",
        NONE: "none"
    }
      , C = a.SurveyInfoChanged = c(n, {
        constructor: function(a) {
            this.data = a
        }
    })
      , D = a.SurveyInfo = c(o, {
        constructor: function(a, b) {
            D.base.call(this),
            this.map = a,
            this.tmpGoogleMapViewController = a.tmpGoogleMapViewController,
            this._fetchUpperZoomLevels = !0,
            this.useAlternativeAPI = b;
            var c = j(k(this, this.update));
            a.addListener(m, c),
            c()
        },
        update: function() {
            var a = this.map
              , b = a.getZoom()
              , c = this._createRequestData(b);
            this._requestDataFromServer(c, b)
        },
        _requestDataFromServer: function(a, b) {
            var c = p(A, a);
            y.ajax({
                type: "GET",
                url: c,
                dataType: "text",
                success: k(this, function(a) {
                    a = JSON.parse(a, g),
                    this._successCallBack(a, b)
                }),
                error: k(this, function() {
                    this._errorCallBack()
                })
            })
        },
        _successCallBack: function(a, b) {
            if (this.data = a,
            this._fetchUpperZoomLevels && ("full" === a.coverage_status || "partial" === a.coverage_status || null  === a.coverage_status) && q(a.layers.Vert)) {
                if (0 === b)
                    return void this.dispatch(new C(a));
                var c = this._createRequestData(b - 1);
                this._requestDataFromServer(c, b - 1)
            } else {
                var d = new C(a);
                this.dispatch(d)
            }
        },
        _createRequestData: function(a) {
            var b = this.map
              , c = q(a) ? b.getZoom() : a
              , d = b.getCenter()
              , g = this.tmpGoogleMapViewController.getBounds()
              , j = this.useAlternativeAPI ? ["//web10.", i].join("") : ""
              , k = {
                x: e(d.lng, c),
                y: f(d.lat, c)
            };
            k = h(k, c);
            var l = (new Date).getTime()
              , m = {
                host: j,
                x: k.x,
                y: k.y,
                z: c,
                left: g.left,
                right: g.right,
                top: g.top,
                bottom: g.bottom,
                s: l
            };
            return m
        },
        _errorCallBack: function() {},
        getDates: function(a) {
            var b = [];
            try {
                var c = z.get(a);
                b = this.data.layers[c].slice(),
                q(b) && (b = [])
            } catch (d) {}
            return b
        },
        getCoverage: function() {
            return this.getData().coverage_status || B.NONE
        },
        getData: function() {
            return this.data || {}
        }
    })
}),
nm_module("nm/views/google/baselayer", function(a, b, c, d) {
    function e(a, b, c, d, e, f, g, h) {
        var j = new m(256,g,h)
          , l = new C({
            name: a,
            tileSize: new E(256,g),
            minZoom: e,
            maxZoom: f,
            getTileUrl: function(e, f) {
                if (e = j.rotateTile(e, f),
                e = k(e, f),
                null  !== e) {
                    var g = b.getDesiredDate();
                    g instanceof Date ? (g = g.toISOString().split("T")[0],
                    g = "&nmd=" + g.replace(/\-/g, "")) : g = "";
                    var h = Math.abs(e.x + e.y) % 3
                      , l = c;
                    return 10 > f && l === G && (l += "&colorize=6699FF88"),
                    l = i(l, {
                        x: e.x,
                        y: e.y,
                        zoom: f,
                        type: a,
                        dataDate: g,
                        subdomain: d[h]
                    })
                }
            }
        });
        return "V" !== a && "Dem" !== a && (l.projection = j),
        l
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/objtools", "Dictionary")
      , h = b("jscore/events", "Change")
      , i = b("jscore/strings", "format")
      , j = b("jscore/types", "isUndefined")
      , k = b("nm/geom", "getNormalizedCoord")
      , l = b("jscore/dateutils", "isEqualDateTime")
      , m = b("nm/projections/google", "MercatorProjection")
      , n = b("js-libs/google", "maps")
      , o = b("nm/const", "TILE_HOST")
      , p = b("nm/dataproviders/surveys", "CoverageStatus")
      , q = b("nm/const/imagery", "HYBRID")
      , r = b("nm/const/imagery", "ROAD")
      , s = b("nm/const/imagery", "SATELLITE")
      , t = b("nm/const/imagery", "SURVEY")
      , u = b("nm/const/imagery", "SURVEY_N")
      , v = b("nm/const/imagery", "SURVEY_E")
      , w = b("nm/const/imagery", "SURVEY_S")
      , x = b("nm/const/imagery", "SURVEY_W")
      , y = b("nm/const/imagery", "TERRAIN")
      , z = p.FULL
      , A = p.PARTIAL
      , B = p.NONE
      , C = n.ImageMapType
      , D = n.MapTypeId
      , E = n.Size
      , F = "//{subdomain}." + o + "/maps/hl=en&x={x}&y={y}&z={zoom}{dataDate}&nml={type}&httpauth=false&version=2"
      , G = F + "&exclude=background"
      , H = new g([[q, D.HYBRID], [r, D.ROADMAP], [s, D.SATELLITE]])
      , I = a.BaseLayerView = c(Object, {
        constructor: function(a, b, c) {
            I.base.call(this),
            this.layer = a,
            this.map = b,
            this.gMap = c,
            this.currentDate = null ,
            this.surveysCtl = this.layer.getSurveysController(),
            this.resetMapTypes(),
            this.surveysCtl.addListener(h, f(this, this.update)),
            b.addListener(h, f(this, this.update))
        },
        resetMapTypes: function() {
            var a, b = this.gMap, c = this.surveysCtl, d = this.layer, f = d.getSubdomains();
            a = d.useCommingling() ? G : F,
            this.layerVertical = e("V", c, a, f, 1, 24, 256, 0),
            this.layerNorth = e("N", c, F, f, 14, 20, 192, 0),
            this.layerEast = e("E", c, F, f, 14, 20, 128, 90),
            this.layerSouth = e("S", c, F, f, 14, 20, 192, 180),
            this.layerWest = e("W", c, F, f, 14, 20, 128, 270),
            this.layerTerrain = e("Dem", c, F, f, 2, 18, 256, 0);
            var g = b.mapTypes;
            g.set("nm." + t, this.layerVertical),
            g.set("nm." + u, this.layerNorth),
            g.set("nm." + v, this.layerEast),
            g.set("nm." + w, this.layerSouth),
            g.set("nm." + x, this.layerWest),
            g.set("nm." + y, this.layerTerrain)
        },
        update: function() {
            var a = this.gMap
              , b = this.surveysCtl
              , c = this.layer.useCommingling()
              , d = b.getMapType() || ""
              , e = H.get(d)
              , f = b.getCoverageStatus();
            if (f !== z && f !== B && c || this.removeComminglingOverlay(),
            f === B && d === t && a.getZoom() >= 9 && (e = D.SATELLITE),
            j(e)) {
                var g = b.getDisplayDate();
                l(this.currentDate, g) || (this.currentDate = g,
                this.resetMapTypes()),
                e = "nm." + d
            }
            d === t && c && f === A && (this.addSureyOverlay(),
            e = D.SATELLITE),
            a.getMapTypeId() !== e && a.setMapTypeId(e)
        },
        removeComminglingOverlay: function() {
            if (this.overlay) {
                for (var a = this.gMap.overlayMapTypes, b = a.getArray(), c = 0, d = b.length; d > c; c++)
                    if ("V" === b[c].name) {
                        a.removeAt(c);
                        break
                    }
                this.overlay = !1
            }
        },
        addSureyOverlay: function() {
            this.overlay || (this.gMap.overlayMapTypes.insertAt(0, this.layerVertical),
            this.overlay = !0)
        }
    })
}),
nm_module("nm/views/google/solarpanel", function(a, b, c, d) {
    function e(a, b, c) {
        return u.geometry.spherical.computeOffset(a, b, c)
    }
    function f(a, b, c, d) {
        a = new u.LatLng(a.lat,a.lng);
        var f = c / 2
          , g = d / 2
          , h = Math.sqrt(f * f + g * g);
        h /= 1e3;
        var i = 90 - p(Math.atan(g / f))
          , j = 270 + p(Math.atan(g / f))
          , k = i + 180
          , l = j + 180
          , m = [e(a, h, i + b), e(a, h, j + b), e(a, h, k + b), e(a, h, l + b)];
        return m
    }
    function g(a, b) {
        b = b || 0;
        var c = o(a.tilt)
          , d = a.getWidth()
          , e = a.getHeight();
        e = Math.cos(c) * e;
        var g = a.position
          , h = f(g, a.orientation, d + b, e + b);
        return h
    }
    function h(a) {
        var b = a.position
          , c = a.orientation
          , d = o(a.tilt);
        b = new u.LatLng(b.lat,b.lng);
        var f = Math.cos(d) * a.getHeight()
          , g = e(b, f / 4e3, c)
          , h = [e(g, .2, c + 135), g, e(g, .2, c + 225)];
        return h
    }
    function i(a, b, c) {
        var d = a.lng()
          , e = a.lat()
          , f = b.lng()
          , g = b.lat()
          , h = c.lng()
          , i = c.lat();
        return (i - e) * (f - d) > (g - e) * (h - d)
    }
    function j(a, b, c, d) {
        return i(a, c, d) !== i(b, c, d) && i(a, b, c) !== i(a, b, d)
    }
    function k(a, b) {
        for (var c = 0; 3 >= c; c++)
            for (var d = a[c], e = a[(c + 1) % 4], f = 0; 3 >= f; f++) {
                var g = b[f]
                  , h = b[(f + 1) % 4];
                if (j(d, e, g, h))
                    return !0
            }
    }
    var l = b("jscore/events", "Change")
      , m = b("jscore/functools", "bind")
      , n = b("jscore/itertools", "find")
      , o = b("jscore/math", "degreesToRadians")
      , p = b("jscore/math", "radiansToDegrees")
      , q = b("nm/geom", "LatLng")
      , r = b("nm/dom", "createElement")
      , s = b("nm/const", "STATIC_ASSETS_URL")
      , t = b("jscore/async", "callWhenIdle")
      , u = b("js-libs/google", "maps")
      , v = b("js-libs/jquery", "jQuery")
      , w = c(u.OverlayView, {
        constructor: function(a, b) {
            this.div = null ,
            this.panel = a,
            this.setMap(b)
        },
        onAdd: function() {
            var a = this.getPanes()
              , b = r("div");
            b.style.borderWidth = "0px",
            b.style.position = "absolute",
            b.style.zIndex = 999,
            this.div = b,
            a.overlayLayer.appendChild(b)
        },
        draw: function() {
            if (null  !== this.div) {
                var a = this.getProjection()
                  , b = this.panel
                  , c = b.orientation
                  , d = b.position;
                d = new u.LatLng(d.lat,d.lng);
                var e = g(b)
                  , f = e[0]
                  , h = e[1]
                  , i = e[2]
                  , j = a.fromLatLngToDivPixel(d)
                  , k = a.fromLatLngToDivPixel(f)
                  , l = a.fromLatLngToDivPixel(h)
                  , m = a.fromLatLngToDivPixel(i)
                  , n = k.x - l.x
                  , o = k.y - l.y
                  , p = Math.sqrt(n * n + o * o);
                n = m.x - l.x,
                o = m.y - l.y;
                var q = Math.sqrt(n * n + o * o)
                  , r = this.div;
                r.style.left = j.x - p / 2 + "px",
                r.style.top = j.y - q / 2 + "px",
                r.style.width = p + "px",
                r.style.height = q + "px";
                var t;
                switch (b.panelType.type) {
                case "Polycrystalline":
                    t = "solarPoly.jpg";
                    break;
                case "Monocrystalline":
                    t = "solarMono.jpg";
                    break;
                case "Thin-film":
                    t = "solarThin.jpg"
                }
                v(r).css({
                    transform: "rotate(" + c + "deg)",
                    "-ms-transform": "rotate(" + c + "deg)",
                    "-webkit-transform": "rotate(" + c + "deg)",
                    "background-image": "url(" + s + "img/toolbar/" + t + ")",
                    "background-size": p + "px " + q + "px"
                })
            }
        },
        onRemove: function() {
            this.div.parentNode.removeChild(this.div),
            this.div = null 
        }
    });
    a.SolarPanelView = c(Object, {
        constructor: function(a, b, c) {
            this.layerView = a,
            this.layer = a.layer,
            this.selection = a.mapView.getSelection(),
            this.dragHandler = a.mapView.getDragHandler(),
            this.visible = !0,
            this.panel = b,
            this.gMap = c,
            this.poly = null ,
            this.overlay = null ,
            this.updateCollisionsWhenIdle = t(m(this, this.updateCollisions), 50, 100),
            b.addListener(l, m(this, this.updateView)),
            this.layer.addListener(l, m(this, this.updateView)),
            this.selection.addListener(l, m(this, this.updateView)),
            this.update()
        },
        updateView: function() {
            this.update(),
            this.updateCollisionsWhenIdle()
        },
        update: function() {
            "fancy" === this.layer.style ? (this.removeSimple(),
            this.updateFancy()) : (this.removeFancy(),
            this.updateSimple())
        },
        removeFancy: function() {
            null  !== this.overlay && (this.overlay.setMap(null ),
            this.overlay = null )
        },
        updateFancy: function() {
            null  === this.overlay ? this.overlay = new w(this.panel,this.gMap) : this.overlay.draw()
        },
        removeSimple: function() {
            null  !== this.poly && (this.poly.setMap(null ),
            this.indicator.setMap(null ),
            this.poly = null )
        },
        updateSimple: function() {
            var a = this.gMap
              , b = this.panel
              , c = g(b)
              , d = h(b)
              , e = this.selection.isSelected(b)
              , f = "#27324F";
            switch (b.panelType.type) {
            case "Polycrystalline":
                f = "#27324F";
                break;
            case "Monocrystalline":
                f = "#2F3136";
                break;
            case "Thin-film":
                f = "#1D2021"
            }
            var i;
            e ? (f = "#0099ff",
            i = 3e3) : i = 2e3;
            var j = this.layer.getVisible()
              , k = this.poly;
            null  === k ? (this.poly = new u.Polygon({
                paths: [c],
                strokeColor: "#FFF",
                strokeOpacity: .8,
                strokeWeight: 1,
                fillColor: f,
                fillOpacity: .8,
                draggable: !0,
                zIndex: i,
                map: a,
                visible: j
            }),
            k = this.poly,
            k.addListener("mousedown", m(this, this.gMapDown)),
            k.addListener("dragstart", m(this, this.gMapDragStart)),
            k.addListener("drag", m(this, this.gMapDrag)),
            k.addListener("dragend", m(this, this.gMapDragEnd)),
            this.indicator = new u.Polyline({
                path: d,
                geodesic: !1,
                strokeColor: "#FFFFFF",
                strokeOpacity: .8,
                strokeWeight: 1,
                zIndex: i,
                clickable: !1,
                map: a,
                visible: j
            })) : (this.poly.setOptions({
                paths: [c],
                draggable: !0,
                zIndex: i,
                visible: j
            }),
            this.indicator.setOptions({
                path: d,
                zIndex: i,
                visible: j
            }))
        },
        updateCollisions: function() {
            if (null  !== this.poly) {
                var a = this.panel
                  , b = "#27324F";
                switch (a.panelType.type) {
                case "Polycrystalline":
                    b = "#27324F";
                    break;
                case "Monocrystalline":
                    b = "#2F3136";
                    break;
                case "Thin-film":
                    b = "#1D2021"
                }
                var c = this.selection.isSelected(a);
                if (c) {
                    var d = g(a, -1)
                      , e = this.layer.getFeatures()
                      , f = n(e, function(b) {
                        if (b !== a) {
                            var c = g(b, -1);
                            if (k(d, c))
                                return !0
                        }
                    });
                    b = f ? "red" : "#0099ff"
                }
                this.poly.setOptions({
                    fillColor: b
                })
            }
        },
        gMapDown: function() {
            this.selection.handleViewSelect(this.panel, this.layer)
        },
        gMapDragStart: function(a) {
            var b = new q(a.latLng.lat(),a.latLng.lng());
            this.dragHandler.startDrag(b)
        },
        gMapDrag: function(a) {
            var b = new q(a.latLng.lat(),a.latLng.lng());
            this.dragHandler.handleDrag(b)
        },
        gMapDragEnd: function(a) {
            var b = new q(a.latLng.lat(),a.latLng.lng());
            this.dragHandler.endDrag(b)
        },
        destroy: function() {
            this.layer.removeListeners(this),
            this.panel.removeListeners(this),
            this.selection.removeListeners(this),
            this.removeSimple(),
            this.removeFancy()
        }
    })
}),
nm_module("nm/views/google/solarjob", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("jscore/functools", "bind")
      , g = b("nm/geom", "LatLng")
      , h = b("nm/const", "STATIC_ASSETS_URL")
      , i = b("js-libs/google", "maps")
      , j = h + "img/orange-dot.png"
      , k = h + "img/yellow-dot.png";
    a.SolarJobView = c(Object, {
        constructor: function(a, b, c) {
            this.layerView = a,
            this.layer = a.layer,
            this.selection = a.mapView.getSelection(),
            this.job = b,
            this.gMap = c,
            this.marker = null ,
            this.rect = null ,
            b.addListener(e, f(this, this.update)),
            this.layer.addListener(e, f(this, this.update)),
            this.selection.addListener(e, f(this, this.update)),
            this.update()
        },
        update: function() {
            var a = this.gMap
              , b = this.job
              , c = this.layer
              , d = this.selection
              , e = c.getVisible()
              , g = b.position;
            g = new i.LatLng(g.lat,g.lng);
            var h = j
              , l = !1;
            d.isSelected(b) && (h = k,
            l = "with-bounds" === c.style);
            var m = b.ne
              , n = b.sw;
            m = new i.LatLng(m.lat,m.lng),
            n = new i.LatLng(n.lat,n.lng);
            var o = new i.LatLngBounds(n,m);
            this._bounds = o,
            l ? null  === this.rect ? (this.rect = new i.Rectangle({
                bounds: o,
                map: a,
                strokeWeight: 1,
                fillColor: "blue",
                fillOpacity: "0.5",
                editable: !0,
                draggable: !0,
                zIndex: 999999999,
                visible: e
            }),
            this.rect.addListener("bounds_changed", f(this, this.boundsChanged))) : this.rect.setOptions({
                bounds: o
            }) : null  !== this.rect && (this.rect.setMap(null ),
            this.rect = null ),
            null  === this.marker ? (this.marker = new i.Marker({
                position: g,
                title: b.title,
                icon: h,
                draggable: !0,
                map: a,
                visible: e
            }),
            this.marker.addListener("mousedown", f(this, this.mousedown)),
            this.marker.addListener("dragend", f(this, this.dragend))) : this.marker.setOptions({
                position: g,
                icon: h,
                visible: e
            })
        },
        mousedown: function() {
            this.selection.handleViewSelect(this.job)
        },
        dragend: function() {
            var a = this.marker.getPosition();
            a = new g(a.lat(),a.lng()),
            this.job.setPosition(a)
        },
        boundsChanged: function() {
            var a = this.rect.getBounds();
            if (!a.equals(this._bounds)) {
                var b = a.getNorthEast()
                  , c = a.getSouthWest();
                b = new g(b.lat(),b.lng()),
                c = new g(c.lat(),c.lng()),
                this.job.setBounds(b, c)
            }
        },
        destroy: function() {
            this.marker.setMap(null ),
            this.rect && this.rect.setMap(null )
        }
    })
}),
nm_module("nm/views/google/convert", function(a, b, c, d) {
    var e = b("js-libs/google", "maps")
      , f = b("nm/geom", "LatLng")
      , g = b("jscore/itertools", "map")
      , h = b("jscore/itertools", "array");
    a.toGoogle = function(a) {
        if (a instanceof Array) {
            var b = a;
            return h(g(b, function(a) {
                return new e.LatLng(a.getLat(),a.getLon())
            }))
        }
        var c = a;
        return new e.LatLng(c.getLat(),c.getLon())
    }
    ,
    a.toNM = function(a) {
        return new f(a.lat(),a.lng())
    }
}),
nm_module("js-libs/richmarker", function(a, b, c, d) {
    function e(a) {
        var c = a || {};
        b("./google");
        this.ready_ = !1,
        this.dragging_ = !1,
        void 0 == a.visible && (a.visible = !0),
        void 0 == a.shadow && (a.shadow = "7px -3px 5px rgba(88,88,88,0.7)"),
        void 0 == a.anchor && (a.anchor = f.BOTTOM),
        this.setValues(c)
    }
    e.prototype = new google.maps.OverlayView,
    e.prototype.getVisible = function() {
        return this.get("visible")
    }
    ,
    e.prototype.getVisible = e.prototype.getVisible,
    e.prototype.setVisible = function(a) {
        this.set("visible", a)
    }
    ,
    e.prototype.setVisible = e.prototype.setVisible,
    e.prototype.visible_changed = function() {
        this.ready_ && (this.markerWrapper_.style.display = this.getVisible() ? "" : "none",
        this.draw())
    }
    ,
    e.prototype.visible_changed = e.prototype.visible_changed,
    e.prototype.setFlat = function(a) {
        this.set("flat", !!a)
    }
    ,
    e.prototype.setFlat = e.prototype.setFlat,
    e.prototype.getFlat = function() {
        return this.get("flat")
    }
    ,
    e.prototype.getFlat = e.prototype.getFlat,
    e.prototype.getWidth = function() {
        return this.get("width")
    }
    ,
    e.prototype.getWidth = e.prototype.getWidth,
    e.prototype.getHeight = function() {
        return this.get("height")
    }
    ,
    e.prototype.getHeight = e.prototype.getHeight,
    e.prototype.setShadow = function(a) {
        this.set("shadow", a),
        this.flat_changed()
    }
    ,
    e.prototype.setShadow = e.prototype.setShadow,
    e.prototype.getShadow = function() {
        return this.get("shadow")
    }
    ,
    e.prototype.getShadow = e.prototype.getShadow,
    e.prototype.flat_changed = function() {
        this.ready_ && (this.markerWrapper_.style.boxShadow = this.markerWrapper_.style.webkitBoxShadow = this.markerWrapper_.style.MozBoxShadow = this.getFlat() ? "" : this.getShadow())
    }
    ,
    e.prototype.flat_changed = e.prototype.flat_changed,
    e.prototype.setZIndex = function(a) {
        this.set("zIndex", a)
    }
    ,
    e.prototype.setZIndex = e.prototype.setZIndex,
    e.prototype.getZIndex = function() {
        return this.get("zIndex")
    }
    ,
    e.prototype.getZIndex = e.prototype.getZIndex,
    e.prototype.zIndex_changed = function() {
        this.getZIndex() && this.ready_ && (this.markerWrapper_.style.zIndex = this.getZIndex())
    }
    ,
    e.prototype.zIndex_changed = e.prototype.zIndex_changed,
    e.prototype.getDraggable = function() {
        return this.get("draggable")
    }
    ,
    e.prototype.getDraggable = e.prototype.getDraggable,
    e.prototype.setDraggable = function(a) {
        this.set("draggable", !!a)
    }
    ,
    e.prototype.setDraggable = e.prototype.setDraggable,
    e.prototype.draggable_changed = function() {
        this.ready_ && (this.getDraggable() ? this.addDragging_(this.markerWrapper_) : this.removeDragListeners_())
    }
    ,
    e.prototype.draggable_changed = e.prototype.draggable_changed,
    e.prototype.getPosition = function() {
        return this.get("position")
    }
    ,
    e.prototype.getPosition = e.prototype.getPosition,
    e.prototype.setPosition = function(a) {
        this.set("position", a)
    }
    ,
    e.prototype.setPosition = e.prototype.setPosition,
    e.prototype.position_changed = function() {
        this.draw()
    }
    ,
    e.prototype.position_changed = e.prototype.position_changed,
    e.prototype.getAnchor = function() {
        return this.get("anchor")
    }
    ,
    e.prototype.getAnchor = e.prototype.getAnchor,
    e.prototype.setAnchor = function(a) {
        this.set("anchor", a)
    }
    ,
    e.prototype.setAnchor = e.prototype.setAnchor,
    e.prototype.anchor_changed = function() {
        this.draw()
    }
    ,
    e.prototype.anchor_changed = e.prototype.anchor_changed,
    e.prototype.htmlToDocumentFragment_ = function(a) {
        var b = document.createElement("DIV");
        if (b.innerHTML = a,
        1 == b.childNodes.length)
            return b.removeChild(b.firstChild);
        for (var c = document.createDocumentFragment(); b.firstChild; )
            c.appendChild(b.firstChild);
        return c
    }
    ,
    e.prototype.removeChildren_ = function(a) {
        if (a)
            for (var b; b = a.firstChild; )
                a.removeChild(b)
    }
    ,
    e.prototype.setContent = function(a) {
        this.set("content", a)
    }
    ,
    e.prototype.setContent = e.prototype.setContent,
    e.prototype.getContent = function() {
        return this.get("content")
    }
    ,
    e.prototype.getContent = e.prototype.getContent,
    e.prototype.content_changed = function() {
        if (this.markerContent_) {
            this.removeChildren_(this.markerContent_);
            var a = this.getContent();
            if (a) {
                "string" == typeof a && (a = a.replace(/^\s*([\S\s]*)\b\s*$/, "$1"),
                a = this.htmlToDocumentFragment_(a)),
                this.markerContent_.appendChild(a);
                for (var b, c = this, d = this.markerContent_.getElementsByTagName("IMG"), e = 0; b = d[e]; e++)
                    google.maps.event.addDomListener(b, "mousedown", function(a) {
                        c.getDraggable() && (a.preventDefault && a.preventDefault(),
                        a.returnValue = !1)
                    }),
                    google.maps.event.addDomListener(b, "load", function() {
                        c.draw()
                    });
                google.maps.event.trigger(this, "domready")
            }
            this.ready_ && this.draw()
        }
    }
    ,
    e.prototype.content_changed = e.prototype.content_changed,
    e.prototype.setCursor_ = function(a) {
        if (this.ready_) {
            var b = "";
            -1 !== navigator.userAgent.indexOf("Gecko/") ? ("dragging" == a && (b = "-moz-grabbing"),
            "dragready" == a && (b = "-moz-grab"),
            "draggable" == a && (b = "pointer")) : ("dragging" != a && "dragready" != a || (b = "move"),
            "draggable" == a && (b = "pointer")),
            this.markerWrapper_.style.cursor != b && (this.markerWrapper_.style.cursor = b)
        }
    }
    ,
    e.prototype.startDrag = function(a) {
        if (this.getDraggable() && !this.dragging_) {
            this.dragging_ = !0;
            var b = this.getMap();
            this.mapDraggable_ = b.get("draggable"),
            b.set("draggable", !1),
            this.mouseX_ = a.clientX,
            this.mouseY_ = a.clientY,
            this.setCursor_("dragready"),
            this.markerWrapper_.style.MozUserSelect = "none",
            this.markerWrapper_.style.KhtmlUserSelect = "none",
            this.markerWrapper_.style.WebkitUserSelect = "none",
            this.markerWrapper_.unselectable = "on",
            this.markerWrapper_.onselectstart = function() {
                return !1
            }
            ,
            this.addDraggingListeners_(),
            google.maps.event.trigger(this, "dragstart", this.getPosition())
        }
    }
    ,
    e.prototype.stopDrag = function() {
        this.getDraggable() && this.dragging_ && (this.dragging_ = !1,
        this.getMap().set("draggable", this.mapDraggable_),
        this.mouseX_ = this.mouseY_ = this.mapDraggable_ = null ,
        this.markerWrapper_.style.MozUserSelect = "",
        this.markerWrapper_.style.KhtmlUserSelect = "",
        this.markerWrapper_.style.WebkitUserSelect = "",
        this.markerWrapper_.unselectable = "off",
        this.markerWrapper_.onselectstart = function() {}
        ,
        this.removeDraggingListeners_(),
        this.setCursor_("draggable"),
        this.draw(),
        google.maps.event.trigger(this, "dragend", this.getPosition()))
    }
    ,
    e.prototype.drag = function(a) {
        if (!this.getDraggable() || !this.dragging_)
            return void this.stopDrag();
        var b = this.mouseX_ - a.clientX
          , c = this.mouseY_ - a.clientY;
        this.mouseX_ = a.clientX,
        this.mouseY_ = a.clientY;
        var d = parseInt(this.markerWrapper_.style.left, 10) - b
          , e = parseInt(this.markerWrapper_.style.top, 10) - c;
        this.markerWrapper_.style.left = d + "px",
        this.markerWrapper_.style.top = e + "px";
        var f = this.getOffset_()
          , g = new google.maps.Point(d - f.width,e - f.height)
          , h = this.getProjection();
        this.setPosition(h.fromDivPixelToLatLng(g)),
        this.setCursor_("dragging"),
        google.maps.event.trigger(this, "drag", this.getPosition())
    }
    ,
    e.prototype.removeDragListeners_ = function() {
        this.draggableListener_ && (google.maps.event.removeListener(this.draggableListener_),
        delete this.draggableListener_),
        this.setCursor_("")
    }
    ,
    e.prototype.addDragging_ = function(a) {
        if (a) {
            var b = this;
            this.draggableListener_ = google.maps.event.addDomListener(a, "mousedown", function(a) {
                b.startDrag(a)
            }),
            this.setCursor_("draggable")
        }
    }
    ,
    e.prototype.addDraggingListeners_ = function() {
        var a = this;
        this.draggingListeners_ = [google.maps.event.addDomListener(window, "mousemove", function(b) {
            a.drag(b)
        }, !0), google.maps.event.addDomListener(window, "mouseup", function() {
            a.stopDrag()
        }, !0)]
    }
    ,
    e.prototype.removeDraggingListeners_ = function() {
        if (this.draggingListeners_) {
            for (var a, b = 0; a = this.draggingListeners_[b]; b++)
                google.maps.event.removeListener(a);
            this.draggingListeners_.length = 0
        }
    }
    ,
    e.prototype.getOffset_ = function() {
        var a = this.getAnchor();
        if ("object" == typeof a)
            return a;
        var b = new google.maps.Size(0,0);
        if (!this.markerContent_)
            return b;
        var c = this.markerContent_.offsetWidth
          , d = this.markerContent_.offsetHeight;
        switch (a) {
        case f.TOP_LEFT:
            break;
        case f.TOP:
            b.width = -c / 2;
            break;
        case f.TOP_RIGHT:
            b.width = -c;
            break;
        case f.LEFT:
            b.height = -d / 2;
            break;
        case f.MIDDLE:
            b.width = -c / 2,
            b.height = -d / 2;
            break;
        case f.RIGHT:
            b.width = -c,
            b.height = -d / 2;
            break;
        case f.BOTTOM_LEFT:
            b.height = -d;
            break;
        case f.BOTTOM:
            b.width = -c / 2,
            b.height = -d;
            break;
        case f.BOTTOM_RIGHT:
            b.width = -c,
            b.height = -d
        }
        return b
    }
    ,
    e.prototype.onAdd = function() {
        if (this.markerWrapper_ || (this.markerWrapper_ = document.createElement("DIV"),
        this.markerWrapper_.style.position = "absolute"),
        this.getZIndex() && (this.markerWrapper_.style.zIndex = this.getZIndex()),
        this.markerWrapper_.style.display = this.getVisible() ? "" : "none",
        !this.markerContent_) {
            this.markerContent_ = document.createElement("DIV"),
            this.markerWrapper_.appendChild(this.markerContent_);
            var a = this;
            google.maps.event.addDomListener(this.markerContent_, "click", function(b) {
                google.maps.event.trigger(a, "click")
            }),
            google.maps.event.addDomListener(this.markerContent_, "mouseover", function(b) {
                google.maps.event.trigger(a, "mouseover")
            }),
            google.maps.event.addDomListener(this.markerContent_, "mouseout", function(b) {
                google.maps.event.trigger(a, "mouseout")
            })
        }
        this.ready_ = !0,
        this.content_changed(),
        this.flat_changed(),
        this.draggable_changed();
        var b = this.getPanes();
        b && b.overlayMouseTarget.appendChild(this.markerWrapper_),
        google.maps.event.trigger(this, "ready")
    }
    ,
    e.prototype.onAdd = e.prototype.onAdd,
    e.prototype.draw = function() {
        if (this.ready_ && !this.dragging_) {
            var a = this.getProjection();
            if (a) {
                var b = this.get("position")
                  , c = a.fromLatLngToDivPixel(b)
                  , d = this.getOffset_();
                this.markerWrapper_.style.top = c.y + d.height + "px",
                this.markerWrapper_.style.left = c.x + d.width + "px";
                var e = this.markerContent_.offsetHeight
                  , f = this.markerContent_.offsetWidth;
                f != this.get("width") && this.set("width", f),
                e != this.get("height") && this.set("height", e)
            }
        }
    }
    ,
    e.prototype.draw = e.prototype.draw,
    e.prototype.onRemove = function() {
        this.markerWrapper_ && this.markerWrapper_.parentNode && this.markerWrapper_.parentNode.removeChild(this.markerWrapper_),
        this.removeDragListeners_()
    }
    ,
    e.prototype.onRemove = e.prototype.onRemove;
    var f = {
        TOP_LEFT: 1,
        TOP: 2,
        TOP_RIGHT: 3,
        LEFT: 4,
        MIDDLE: 5,
        RIGHT: 6,
        BOTTOM_LEFT: 7,
        BOTTOM: 8,
        BOTTOM_RIGHT: 9
    };
    e.RichMarkerPosition = f,
    a.RichMarker = e
}),
nm_module("nm/views/google/measurementlabel", function(a, b, c, d) {
    var e = b("jscore/itertools", "enumerate")
      , f = b("js-libs/richmarker", "RichMarker")
      , g = b("js-libs/jquery", "jQuery")
      , h = b("nm/views/google/convert", "toGoogle")
      , i = b("nm/geom", "calculateDistance")
      , j = b("nm/geom", "calculateHeading")
      , k = b("nm/geom", "calculateOffset")
      , l = a.MeasurementLabel = c(Object, {
        constructor: function(a, b, c, d) {
            var e = g(['\n      <div class="measurement-label" style="\n        padding-left: 5px;\n        padding-right: 5px;\n        margin-top: -5px\n      ">\n    '].join("")).html(a)[0];
            this.content = e,
            this.rotation = b,
            this.position = c,
            this.gMap = d,
            this.visible = !0,
            this.gMarker = new f({
                content: e,
                position: c,
                visible: this.visible,
                map: d,
                anchor: f.RichMarkerPosition.BOTTOM,
                shadow: !1
            })
        },
        getContent: function() {
            return this.content
        },
        setText: function(a) {
            g(this.content).text(a)
        },
        getPosition: function() {
            return this.position
        },
        setPosition: function(a) {
            this.position !== a && (this.position = a,
            this.gMarker.setPosition(a))
        },
        getVisible: function() {
            return this.visible
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.gMarker.setVisible(a))
        },
        show: function() {
            this.setVisible(!0)
        },
        hide: function() {
            this.setVisible(!1)
        },
        destroy: function() {
            this.gMarker.setMap(null )
        }
    });
    a.MeasurementLabelViewsCtrl = c(Object, {
        constructor: function(a, b, c) {
            b = "undefined" == typeof arguments[1] ? null  : b,
            c = "undefined" == typeof arguments[2] ? !0 : c,
            this.gMap = a,
            this.points = b,
            this.viewsShouldBeDisplayed = c,
            this.measurementLabelViews = [],
            this.setPoints(b)
        },
        getPoints: function() {
            return this.points
        },
        setPoints: function(a) {
            this.points !== a && (this.points = a,
            this.updateViews())
        },
        getVisible: function() {
            return this.viewsShouldBeDisplayed
        },
        setVisible: function(a) {
            this.viewsShouldBeDisplayed !== a && (this.viewsShouldBeDisplayed = a,
            this.updateViews())
        },
        updateViews: function() {
            var a = this.points;
            if (this.destroyViews(),
            this.viewsShouldBeDisplayed)
                for (var b, c = e(a)[d.iterator](); !(b = c.next()).done; ) {
                    var f = b.value
                      , g = f[1]
                      , f = f[0]
                      , m = a[f + 1];
                    if (!m)
                        break;
                    g = h(g),
                    m = h(m);
                    var n = i(g, m)
                      , o = j(g, m)
                      , p = k(g, n / 2, o)
                      , q = n.toFixed(2) + " m";
                    this.measurementLabelViews.push(new l(q,0,p,this.gMap))
                }
        },
        destroyViews: function() {
            for (var a, b = this.measurementLabelViews[d.iterator](); !(a = b.next()).done; ) {
                var c = a.value;
                c.destroy()
            }
            this.measurementLabelViews = []
        },
        destroy: function() {
            this.destroyViews(),
            this.gMap = null ,
            this.points = null 
        }
    })
}),
nm_module("nm/views/google/circle", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("js-libs/google", "maps")
      , h = b("nm/views/google/convert", "toGoogle")
      , i = b("nm/views/google/convert", "toNM")
      , j = b("nm/views/google/measurementlabel", "MeasurementLabel");
    a.CircleView = c(Object, {
        constructor: function(a, b, c) {
            this.circle = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.dragHandler = a.mapView.getDragHandler(),
            this.googleCircleObject = null ,
            this.visible = !0,
            this.googleCircleObject = new g.Circle({
                map: this.gMap,
                center: h(b.getPosition()),
                radius: b.getRadius(),
                editable: !0,
                draggable: !0,
                strokeColor: "#0000ff",
                strokeOpacity: .6,
                strokeWeight: 4,
                fillColor: "#5555FF"
            }),
            this.measurementLabelView = null ;
            var d = this.googleCircleObject;
            d.addListener("mousedown", e(this, this.handleClick)),
            d.addListener("dragstart", e(this, this.handleDragStart)),
            d.addListener("drag", e(this, this.handleDrag)),
            d.addListener("dragend", e(this, this.handleDragEnd)),
            d.addListener("center_changed", e(this, this.updateModel)),
            d.addListener("radius_changed", e(this, this.updateModel)),
            this.circle.addListener(f, e(this, this.updateView)),
            this.layer.addListener(f, e(this, this.updateView)),
            this.selection.addListener(f, e(this, this.updateView)),
            this.updateView()
        },
        handleClick: function() {
            this.selection.handleViewSelect(this.circle, this.layer)
        },
        handleDragStart: function(a) {
            this.dragHandler.startDrag(i(a.latLng))
        },
        handleDrag: function(a) {
            this.dragHandler.handleDrag(i(a.latLng))
        },
        handleDragEnd: function(a) {
            this.dragHandler.endDrag(i(a.latLng))
        },
        updateView: function() {
            var a = this.circle
              , b = this.googleCircleObject
              , c = {}
              , d = h(a.getPosition());
            b.getCenter() !== d && (c.center = d);
            var e = a.getRadius();
            b.getRadius() !== e && (c.radius = e);
            var f = this.selection.isSelected(a);
            c.editable = f;
            var g = this.layer.getVisible();
            if (c.visible = g,
            this.googleCircleObject.setOptions(c),
            this.measurementLabelView && this.measurementLabelView.destroy(),
            f && g) {
                var i = Math.PI * e * e;
                this.measurementLabelView = new j(["Radius: ", e.toFixed(2), " m<br/>\n                Area: ", i.toFixed(2), " m²"].join(""),0,b.getCenter(),this.gMap)
            }
        },
        updateModel: function() {
            var a = this.googleCircleObject
              , b = this.circle
              , c = i(a.getCenter());
            b.getPosition() !== c && b.setPosition(c);
            var d = a.getRadius();
            b.getRadius() !== d && b.setRadius(d)
        },
        destroy: function() {
            this.circle.removeListeners(this),
            this.layer.removeListeners(this),
            this.selection.removeListeners(this),
            this.googleCircleObject.setMap(null ),
            this.measurementLabelView && this.measurementLabelView.destroy()
        }
    })
}),
nm_module("nm/views/google/polygon", function(a, b, c, d) {
    function e(a) {
        return k(j(a, function(a) {
            return new i.LatLng(a.getLat(),a.getLon())
        }))
    }
    var f = b("nm/views/google/measurementlabel", "MeasurementLabelViewsCtrl")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/events", "Change")
      , i = b("js-libs/google", "maps")
      , j = b("jscore/itertools", "map")
      , k = b("jscore/itertools", "array")
      , l = b("nm/geom", "LatLng")
      , m = b("jscore/compare", "isEqual")
      , n = b("jscore/async", "setTimeout");
    a.PolygonView = c(Object, {
        constructor: function(a, b, c) {
            var d = this;
            this.polygon = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.visible = !0,
            this.googlePolygonObject = null ,
            b.addListener(h, g(this, this.updateView)),
            this.layer.addListener(h, g(this, this.updateView)),
            this.selection.addListener(h, g(this, this.updateView));
            var j = e(b.getPoints());
            this.googlePolygonObject = new i.Polygon({
                paths: j,
                map: c,
                editable: !0,
                draggable: !0,
                strokeColor: "#0000ff",
                strokeOpacity: .6,
                strokeWeight: 4,
                fillColor: "#5555FF"
            });
            var k = this.googlePolygonObject;
            k.addListener("mousedown", g(this, this.mousedown)),
            k.addListener("mouseup", function() {
                n(g(d, d.updateModel), 0)
            }),
            this.measurementLabelViewsCtrl = new f(c)
        },
        mousedown: function() {
            this.selection.handleViewSelect(this.polygon, this.layer)
        },
        updateView: function() {
            var a = this.polygon
              , b = this.selection.isSelected(a);
            this.googlePolygonObject.setEditable(b);
            var c = e(a.getPoints())
              , d = this.googlePolygonObject.getPath().getArray();
            m(d, c) || this.googlePolygonObject.setPaths(c);
            var f = this.layer.getVisible();
            this.googlePolygonObject.setVisible(f);
            var g = a.getPoints().slice(0);
            g.push(g[0]),
            this.measurementLabelViewsCtrl.setPoints(g),
            this.measurementLabelViewsCtrl.setVisible(b && f)
        },
        updateModel: function() {
            var a = [];
            this.googlePolygonObject.getPath().forEach(function(b) {
                var c = new l(b.lat(),b.lng());
                a.push(c)
            }),
            this.polygon.setPoints(a)
        },
        destroy: function() {
            this.polygon.removeListeners(this),
            this.googlePolygonObject.setMap(null ),
            this.selection.removeListeners(this),
            this.measurementLabelViewsCtrl.destroy()
        }
    })
}),
nm_module("nm/views/google/polygonimage", function(a, b, c, d) {
    function e(a) {
        return j(i(a, function(a) {
            return new n.LatLng(a.getLat(),a.getLon())
        }))
    }
    function f(a, b) {
        return b = b + "&nmx=" + encodeURIComponent(a)
    }
    var g = b("jscore/functools", "bind")
      , h = b("jscore/events", "Change")
      , i = b("jscore/itertools", "map")
      , j = b("jscore/itertools", "array")
      , k = b("nm/geom", "LatLng")
      , l = b("jscore/compare", "isEqual")
      , m = b("jscore/async", "setTimeout")
      , n = b("js-libs/google", "maps");
    a.PolygonImageView = c(Object, {
        constructor: function(a, b, c) {
            var d = this;
            this.polygon = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.googlePolygonObject = null ,
            this.visible = !0,
            b.addListener(h, g(this, this.updateView)),
            this.layer.addListener(h, g(this, this.updateView)),
            this.selection.addListener(h, g(this, this.updateView));
            var f = e(b.getPoints());
            this.googlePolygonObject = new n.Polygon({
                paths: f,
                map: c,
                editable: !0,
                draggable: !0,
                strokeColor: "#0000ff",
                strokeOpacity: .6,
                strokeWeight: 4,
                fillColor: "#5555FF"
            });
            var i = this.googlePolygonObject;
            i.addListener("mousedown", g(this, this.mousedown)),
            i.addListener("mouseup", function() {
                m(g(d, d.updateModel), 0)
            })
        },
        mousedown: function() {
            this.selection.handleViewSelect(this.polygon, this.layer)
        },
        toggleDisplayImage: function() {
            this.polygon.toggleDisplayImage()
        },
        updateView: function() {
            this.googlePolygonObject.setEditable(this.selection.isSelected(this.polygon));
            var a, b = e(this.polygon.getPoints()), c = this.googlePolygonObject.getPath(), d = c.getArray();
            if (this.polygon.isImageEnabled()) {
                this._groundOverlay && (a = this._groundOverlay,
                a.setMap(null ));
                for (var g = this.polygon.getPoints(), h = new n.LatLngBounds, i = 0; i < g.length; i++)
                    h.extend(new n.LatLng(g[i].lat,g[i].lng));
                var j = n.geometry.encoding.encodePath(c)
                  , k = this.polygon.getImageSource();
                k = f(j, k),
                a = new n.GroundOverlay(k,h),
                a.setMap(this.gMap),
                this._groundOverlay = a
            } else
                this._groundOverlay && (a = this._groundOverlay,
                a.setMap(null ));
            l(d, b) || this.googlePolygonObject.setPaths(b),
            this.googlePolygonObject.setVisible(this.layer.getVisible())
        },
        updateModel: function() {
            var a = [];
            this.googlePolygonObject.getPath().forEach(function(b) {
                var c = new k(b.lat(),b.lng());
                a.push(c)
            }),
            this.polygon.setPoints(a)
        },
        destroy: function() {
            this.polygon.isImageEnabled() && this.polygon.toggleDisplayImage(),
            this.polygon.removeListeners(this),
            this.googlePolygonObject.setMap(null ),
            this.selection.removeListeners(this)
        }
    })
}),
nm_module("nm/views/google/line", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("js-libs/google", "maps")
      , h = b("nm/geom", "LatLng")
      , i = b("jscore/compare", "isEqual")
      , j = b("nm/views/google/convert", "toGoogle")
      , k = b("nm/views/google/measurementlabel", "MeasurementLabelViewsCtrl")
      , l = b("jscore/async", "setTimeout");
    a.LineView = c(Object, {
        constructor: function(a, b, c) {
            var d = this;
            this.line = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            b.addListener(f, e(this, this.updateView)),
            this.layer.addListener(f, e(this, this.updateView)),
            this.selection.addListener(f, e(this, this.updateView));
            var h = j(b.getPoints());
            this.googleLineObject = new g.Polyline({
                path: h,
                map: c,
                editable: !0,
                draggable: !0,
                strokeColor: "#0000ff",
                strokeOpacity: .6,
                strokeWeight: 4,
                fillColor: "#5555FF"
            }),
            this.measurementLabelViewsCtrl = new k(c);
            var i = this.googleLineObject;
            i.addListener("mousedown", e(this, this.mousedown)),
            i.addListener("mouseup", function() {
                l(e(d, d.updateModel), 0)
            })
        },
        mousedown: function() {
            this.selection.handleViewSelect(this.line, this.layer)
        },
        updateView: function() {
            var a = this.googleLineObject
              , b = this.selection.isSelected(this.line);
            this.googleLineObject.setEditable(b);
            var c = j(this.line.getPoints())
              , d = a.getPath().getArray();
            i(d, c) || a.setPath(c);
            var e = this.layer.getVisible();
            a.setVisible(e);
            var f = this.measurementLabelViewsCtrl;
            f.setPoints(this.line.getPoints().slice(0)),
            f.setVisible(b && e)
        },
        updateModel: function() {
            var a = [];
            this.googleLineObject.getPath().forEach(function(b) {
                var c = new h(b.lat(),b.lng());
                a.push(c)
            }),
            this.line.setPoints(a)
        },
        destroy: function() {
            this.line.removeListeners(this),
            this.googleLineObject.setMap(null ),
            this.layer.removeListeners(this),
            this.selection.removeListeners(this),
            this.measurementLabelViewsCtrl.destroy()
        }
    })
}),
nm_module("nm/views/google/arrow", function(a, b, c, d) {
    function e(a) {
        return j(i(a, function(a) {
            return new h.LatLng(a.getLat(),a.getLon())
        }))
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/events", "Change")
      , h = b("js-libs/google", "maps")
      , i = b("jscore/itertools", "map")
      , j = b("jscore/itertools", "array")
      , k = b("nm/geom", "LatLng")
      , l = b("jscore/async", "setTimeout")
      , m = b("jscore/compare", "isEqual");
    a.ArrowView = c(Object, {
        constructor: function(a, b, c) {
            var d = this;
            this.arrow = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.visible = !0,
            this._arrowHeads = b._arrowHeads,
            this._googleStartIcon = {
                icon: {
                    path: h.SymbolPath.BACKWARD_CLOSED_ARROW
                },
                offset: "0%"
            },
            this._googleEndIcon = {
                icon: {
                    path: h.SymbolPath.FORWARD_CLOSED_ARROW
                },
                offset: "100%"
            },
            b.addListener(g, f(this, this.updateView)),
            this.layer.addListener(g, f(this, this.updateView)),
            this.selection.addListener(g, f(this, this.updateView));
            var i = e(b.getPoints());
            this._googleArrowObject = new h.Polyline({
                path: i,
                map: c,
                editable: !0,
                draggable: !0,
                strokeColor: "#0000ff",
                strokeOpacity: .6,
                strokeWeight: 4,
                fillColor: "#5555FF"
            });
            var j = this._googleArrowObject;
            j.addListener("mousedown", f(this, this.mousedown)),
            j.addListener("mouseup", function() {
                l(f(d, d.updateModel), 0)
            })
        },
        mousedown: function() {
            this.selection.handleViewSelect(this.arrow, this.layer)
        },
        updateArrowHeads: function() {
            var a = this._arrowHeads
              , b = [];
            "start" !== a && "both" !== a || b.push(this._googleStartIcon),
            "end" !== a && "both" !== a || b.push(this._googleEndIcon),
            this._googleArrowObject.setOptions({
                icons: b
            })
        },
        updateView: function() {
            var a = this._googleArrowObject
              , b = this.selection.isSelected(this.arrow);
            a.setEditable(b);
            var c = e(this.arrow.getPoints())
              , d = a.getPath().getArray();
            m(d, c) || a.setPath(c);
            var f = this.layer.getVisible();
            a.setVisible(f),
            this.updateArrowHeads()
        },
        updateModel: function() {
            var a = [];
            this._googleArrowObject.getPath().forEach(function(b) {
                var c = new k(b.lat(),b.lng());
                a.push(c)
            }),
            this.arrow.setPoints(a)
        },
        destroy: function() {
            this.arrow.removeListeners(this),
            this._googleArrowObject.setMap(null ),
            this.selection.removeListeners(this)
        }
    })
}),
nm_module("nm/views/google/imageoverlay", function(a, b, c, d) {
    function e(a, b, c) {
        return j.geometry.spherical.computeOffset(a, b, c)
    }
    function f(a, b, c, d) {
        var f = c / 2
          , g = d / 2
          , h = Math.sqrt(f * f + g * g);
        h /= 1e3;
        var i = 90 - k(Math.atan(g / f))
          , j = 270 + k(Math.atan(g / f))
          , l = i + 180
          , m = j + 180
          , n = [e(a, h, i + b), e(a, h, j + b), e(a, h, l + b), e(a, h, m + b)];
        return n
    }
    var g = b("jscore/functools", "bind")
      , h = b("jscore/events", "Change")
      , i = b("js-libs/jquery", "jQuery")
      , j = b("js-libs/google", "maps")
      , k = b("jscore/math", "radiansToDegrees")
      , l = b("nm/const", "MetresInKilometres")
      , m = b("nm/views/google/convert", "toGoogle")
      , n = b("nm/views/google/convert", "toNM")
      , o = c(j.OverlayView, {
        constructor: function(a, b, c, d, e) {
            this._element = a,
            this._width = b,
            this._height = c,
            this._position = d,
            this._origin = null ,
            this._mousedownListener = null ,
            this._mousemoveListener = null ,
            this._mouseupListener = null ,
            this.setMap(e)
        },
        getElement: function() {
            return this._element
        },
        getPosition: function() {
            return this._position
        },
        setPosition: function(a) {
            a !== this._position && (this._position = a,
            this.draw())
        },
        onAdd: function() {
            var a = j.event.addDomListener
              , b = this._element;
            b.style.position = "absolute",
            b.draggable = !0,
            this._mousedownListener = a(b, "mousedown", g(this, this.onMousedown)),
            this.getPanes().overlayMouseTarget.appendChild(b)
        },
        onMousedown: function(a) {
            a.preventDefault(),
            this.getMap().set("draggable", !1),
            this._element.style.cursor = "move",
            this._origin = a,
            this._mousemoveListener = j.event.addDomListener(window, "mousemove", g(this, this.onDrag)),
            this._mouseupListener = j.event.addDomListener(window, "mouseup", g(this, this.onMouseup)),
            a.latLng = this.convertXYToLatLng(a.clientX, a.clientY),
            j.event.trigger(this, "mousedown", a)
        },
        convertXYToLatLng: function(a, b) {
            var c = this.getProjection().fromDivPixelToLatLng(new j.Point(a,b));
            return c
        },
        onDrag: function(a) {
            a.preventDefault();
            var b = this._origin
              , c = this.getProjection()
              , d = b.clientX - a.clientX
              , e = b.clientY - a.clientY
              , f = c.fromLatLngToDivPixel(this._position)
              , g = c.fromDivPixelToLatLng(new j.Point(f.x - d,f.y - e));
            this._origin = a,
            this._position = g,
            a.latLng = this.convertXYToLatLng(a.clientX, a.clientY),
            j.event.trigger(this, "position_changed", g),
            j.event.trigger(this, "mousemove", a),
            this.draw()
        },
        onMouseup: function(a) {
            this.getMap().set("draggable", !0),
            this._element.style.cursor = "default",
            j.event.removeListener(this._mousemoveListener),
            j.event.removeListener(this._mouseupListener),
            a.latLng = this.convertXYToLatLng(a.clientX, a.clientY),
            j.event.trigger(this, "mouseup", a)
        },
        draw: function() {
            var a = this._position
              , b = this.getProjection()
              , c = f(a, 0, this._width * l, this._height * l)
              , d = c[0]
              , e = c[1]
              , g = c[2]
              , h = b.fromLatLngToDivPixel(a)
              , i = b.fromLatLngToDivPixel(d)
              , j = b.fromLatLngToDivPixel(e)
              , k = b.fromLatLngToDivPixel(g)
              , m = i.x - j.x
              , n = i.y - j.y
              , o = Math.sqrt(m * m + n * n);
            m = k.x - j.x,
            n = k.y - j.y;
            var p = Math.sqrt(m * m + n * n)
              , q = this._element;
            q.style.left = h.x - o / 2 + "px",
            q.style.top = h.y - p / 2 + "px",
            q.style.width = o + "px",
            q.style.height = p + "px"
        },
        onRemove: function() {
            var a = j.event.removeListener;
            a(this._outOfBoundsListener),
            a(this._mouseupListener),
            a(this._mousedownListener),
            a(this._mousedownListener),
            this._element.parentNode.removeChild(this._element),
            this._element = null 
        }
    });
    a.ImageOverlayView = c(Object, {
        constructor: function(a, b, c) {
            this.imageOverlay = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.dragHandler = a.mapView.getDragHandler(),
            this.visible = !0;
            var d = i("<img>").attr("src", b.getURL());
            d.on("mousedown", g(this, this.handleMouseDown)),
            d.on("click", function(a) {
                a.stopPropagation()
            }),
            d.attr("class", "sp-object");
            var e = m(b.getPosition());
            this.draggableOverlay = new o(d[0],b.getWidth(),b.getHeight(),e,c),
            this.updateRotation(b, d[0]),
            b.addListener(h, g(this, this.updateView)),
            this.layer.addListener(h, g(this, this.updateView)),
            this.selection.addListener(h, g(this, this.updateView));
            var f = this.draggableOverlay
              , j = this.dragHandler;
            f.addListener("position_changed", g(this, this.updateModel)),
            f.addListener("mousedown", function(a) {
                j.startDrag(n(a.latLng))
            }),
            f.addListener("mousemove", function(a) {
                j.handleDrag(n(a.latLng))
            }),
            f.addListener("mouseup", function(a) {
                j.endDrag(n(a.latLng))
            })
        },
        handleMouseDown: function(a) {
            this.selection.handleViewSelect(this.imageOverlay, this.layer),
            a.stopPropagation()
        },
        updateRotation: function(a, b) {
            var c = a.getRotation()
              , d = "rotate(" + c.toString() + "deg)";
            b.style["-webkit-transform"] = d,
            b.style["-ms-transform"] = d,
            b.style.transform = d
        },
        updateView: function() {
            var a = this.imageOverlay
              , b = this.draggableOverlay
              , c = b._element
              , d = m(a.getPosition());
            d.equals(b.getPosition()) || b.setPosition(d);
            var e = this.selection.isSelected(a);
            e ? c.style.border = "2px solid blue" : c.style.border = "2px solid transparent";
            var f = this.layer.getZIndexOfFeature(a) + 10;
            c.style.zIndex = f,
            this.updateRotation(a, c),
            this.layer.getVisible() ? c.style.visibility = "visible" : c.style.visibility = "hidden"
        },
        updateModel: function() {
            var a = n(this.draggableOverlay.getPosition())
              , b = this.imageOverlay;
            a !== b.getPosition() && b.setPosition(a)
        },
        destroy: function() {
            this.draggableOverlay.setMap(null ),
            this.imageOverlay.removeListeners(this),
            this.layer.removeListeners(this),
            this.selection.removeListeners(this)
        }
    })
}),
nm_module("nm/views/google/label", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("nm/views/google/convert", "toGoogle")
      , h = b("nm/views/google/convert", "toNM")
      , i = b("js-libs/richmarker", "RichMarker")
      , j = b("js-libs/jquery", "jQuery")
      , k = a.LabelView = c(Object, {
        constructor: function(a, b, c) {
            k.base.call(this),
            this.label = b,
            this.gMap = c,
            this.layer = a.layer,
            this.selection = a.mapView.layersCtrl.getSelectionCtrl(),
            this.dragHandler = a.mapView.getDragHandler(),
            this.richMarker = null ,
            this.visible = !0;
            var d = j('<div class="map-label sp-object"></div>');
            d.text(b.getText()),
            d.on("mousedown", e(this, this.handleMouseDown)),
            d.on("click", function(a) {
                a.stopPropagation()
            }),
            d.on("dblclick", e(this, this.handleDoubleClick));
            var h = new i({
                position: g(b.position),
                map: c,
                editable: !0,
                draggable: !0,
                anchor: i.RichMarkerPosition.MIDDLE,
                content: d[0]
            });
            this.richMarker = h,
            b.addListener(f, e(this, this.updateView)),
            this.layer.addListener(f, e(this, this.updateView)),
            this.selection.addListener(f, e(this, this.updateView)),
            h.addListener("position_changed", e(this, this.updateModel)),
            h.addListener("dragstart", e(this, this.handleDragStart)),
            h.addListener("drag", e(this, this.handleDrag)),
            h.addListener("dragend", e(this, this.handleDragEnd))
        },
        handleDoubleClick: function(a) {
            a.preventDefault();
            var b = prompt("Enter new text...");
            b && b.length > 0 && this.label.setText(b)
        },
        handleMouseDown: function() {
            this.selection.handleViewSelect(this.label, this.layer)
        },
        handleDragStart: function(a) {
            this.dragHandler.startDrag(h(a))
        },
        handleDrag: function(a) {
            this.dragHandler.handleDrag(h(a))
        },
        handleDragEnd: function(a) {
            this.dragHandler.endDrag(h(a))
        },
        updateView: function() {
            var a = this.richMarker
              , b = this.label
              , c = g(b.getPosition());
            c.equals(a.getPosition()) || a.setPosition(c);
            var d = j(a.getContent())
              , e = b.getText();
            e !== d.text() && d.text(e);
            var f = this.selection.isSelected(this.label);
            f ? d.css({
                border: "2px solid blue"
            }) : d.css({
                border: "none"
            });
            var h = this.label.getZIndex();
            a.setZIndex(h + 10),
            this.layer.getVisible() ? d.css("display", "block") : d.css("display", "none")
        },
        updateModel: function() {
            var a = this.label
              , b = this.richMarker
              , c = h(b.getPosition());
            c.equals(this.label.getPosition()) || a.setPosition(c);
            var d = j(b.getContent()).text();
            d !== a.getText() && a.setText(d)
        },
        destroy: function() {
            this.label.removeListeners(this),
            this.layer.removeListeners(this),
            this.richMarker.setMap(null ),
            this.selection.removeListeners(this)
        }
    })
}),
nm_module("nm/views/google/rectangleview", function(a, b, c, d) {
    function e(a, b) {
        var c = new h.LatLngBounds
          , d = a.getLat()
          , e = a.getLon()
          , f = new h.LatLng(d,e);
        return c.extend(f),
        d = b.getLat(),
        e = b.getLon(),
        f = new h.LatLng(d,e),
        c.extend(f),
        c
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/events", "Change")
      , h = b("js-libs/google", "maps")
      , i = b("nm/views/google/convert", "toGoogle")
      , j = b("nm/views/google/convert", "toNM");
    a.RectangleView = c(Object, {
        constructor: function(a, b, c) {
            this.rectangle = b,
            this.gMap = c,
            this.featureLayer = a.layer,
            this.selection = a.mapView.getSelection(),
            this.dragHandler = a.mapView.getDragHandler(),
            this.googleRectangleObject = null ,
            this.googleRectangleObject = new h.Rectangle;
            var d = b.getSouthWest()
              , i = b.getNorthEast()
              , j = e(d, i)
              , k = {
                strokeColor: "#00f",
                strokeOpacity: .8,
                strokeWeight: 2,
                fillColor: "#00f",
                fillOpacity: .35,
                map: c,
                editable: !0,
                draggable: !0,
                bounds: j
            };
            this.googleRectangleObject.setOptions(k);
            var l = this.googleRectangleObject;
            l.addListener("bounds_changed", f(this, this.updateModel)),
            this.rectangle.addListener(g, f(this, this.updateView)),
            this.featureLayer.addListener(g, f(this, this.updateView))
        },
        handleClick: function() {
            this.selection.handleViewSelect(this.rectangle, this.featureLayer)
        },
        handleDragStart: function(a) {
            this.dragHandler.startDrag(j(a.latLng))
        },
        handleDrag: function(a) {
            this.dragHandler.handleDrag(j(a.latLng))
        },
        handleDragEnd: function() {
            this.updateModel()
        },
        updateView: function() {
            var a = this.rectangle
              , b = this.googleRectangleObject
              , c = i(a.getSouthWest())
              , d = i(a.getNorthEast());
            b.getBounds().getSouthWest().equals(c) || b.getBounds().getNorthEast().equals(d) || b.setBounds(new h.LatLngBounds(c,d))
        },
        updateModel: function() {
            var a = this.googleRectangleObject
              , b = this.rectangle
              , c = j(a.getBounds().getSouthWest())
              , d = j(a.getBounds().getNorthEast());
            b.getSouthWest().equals(c) && b.getNorthEast().equals(d) || b.setBounds(c, d)
        },
        destroy: function() {
            this.rectangle.removeListeners(this),
            this.googleRectangleObject.setMap(null ),
            this.selection.removeListeners(this)
        }
    })
}),
nm_module("nm/features/rectanglemodel", function(a, b, c, d) {
    var e = b("nm/features/geometry", "Geometry")
      , f = a.Rectangle = c(e, {
        constructor: function(a, b) {
            f.base.call(this),
            this._southWest = a,
            this._northEast = b
        },
        getSouthWest: function() {
            return this._southWest
        },
        getNorthEast: function() {
            return this._northEast
        },
        setSouthWest: function(a) {
            this._southWest.equals(a) || (this._southWest = a,
            this.changed())
        },
        setNorthEast: function(a) {
            this._northEast.equals(a) || (this._northEast = a,
            this.changed())
        },
        setBounds: function(a, b) {
            this._southWest.equals(a) && this._northEast.equals(b) || (this._southWest = a,
            this._northEast = b,
            this.changed())
        },
        equals: function(a) {
            return !!(a instanceof f && a.getSouthWest.equals(this._southWest) && a.getNorthEast.equals(this._northEast))
        },
        getName: function() {
            return "Rectangle"
        },
        clone: function() {
            return new f(this._bounds)
        }
    })
}),
nm_module("nm/views/google/featurelayer", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/objtools", "Dictionary")
      , g = b("jscore/events", "Change")
      , h = b("jscore/types", "isUndefinedOrNull")
      , i = b("nm/features/solar", "SolarPanel")
      , j = b("nm/views/google/solarpanel", "SolarPanelView")
      , k = b("nm/features/solar", "SolarJob")
      , l = b("nm/views/google/solarjob", "SolarJobView")
      , m = b("nm/features/circle", "Circle")
      , n = b("nm/views/google/circle", "CircleView")
      , o = b("nm/features/polygon", "Polygon")
      , p = b("nm/views/google/polygon", "PolygonView")
      , q = b("nm/features/polygonimage", "PolygonImage")
      , r = b("nm/views/google/polygonimage", "PolygonImageView")
      , s = b("nm/features/line", "Line")
      , t = b("nm/views/google/line", "LineView")
      , u = b("nm/features/arrow", "Arrow")
      , v = b("nm/views/google/arrow", "ArrowView")
      , w = b("nm/features/imageoverlay", "ImageOverlay")
      , x = b("nm/views/google/imageoverlay", "ImageOverlayView")
      , y = b("nm/features/label", "Label")
      , z = b("nm/views/google/label", "LabelView")
      , A = b("nm/views/google/rectangleview", "RectangleView")
      , B = b("nm/features/rectanglemodel", "Rectangle")
      , C = new f([[i, j], [k, l], [m, n], [o, p], [q, r], [B, A], [s, t], [u, v], [w, x], [y, z]]);
    a.FeatureLayerView = c(Object, {
        constructor: function(a, b, c) {
            this.layer = a,
            this.mapView = b,
            this.selection = b.getSelection(),
            this.gMap = c,
            this.featureViews = new f,
            a.addListener(g, e(this, this.handleLayerChanged)),
            this.handleLayerChanged()
        },
        handleLayerChanged: function() {
            var a = this.layer
              , b = a.getFeaturesDict()
              , c = this.featureViews;
            this._createNewFeatureViewsForAddedFeatures(c, b, this.gMap),
            this._destroyOldFeatureViewsForRemovedFeatures(c, b)
        },
        _createNewFeatureViewsForAddedFeatures: function(a, b, c) {
            for (var e, f = b.values()[d.iterator](); !(e = f.next()).done; ) {
                var g = e.value;
                if (!a.hasKey(g)) {
                    var h = C.get(g.constructor)
                      , i = new h(this,g,c);
                    a.set(g, i)
                }
            }
        },
        _destroyOldFeatureViewsForRemovedFeatures: function(a, b) {
            for (var c, e = a.keys()[d.iterator](); !(c = e.next()).done; ) {
                var f = c.value
                  , g = f.getId();
                if (h(g) || !b.hasKey(g)) {
                    var i = a.pop(f);
                    i.destroy()
                }
            }
        },
        destroy: function() {}
    })
}),
nm_module("js-libs/suncalc", function(a, b, c, d) {
    function e(a) {
        return a.valueOf() / D - .5 + E
    }
    function f(a) {
        return new Date((a + .5 - E) * D)
    }
    function g(a) {
        return e(a) - F
    }
    function h(a, b) {
        return A(w(a) * x(G) - y(b) * w(G), x(a))
    }
    function i(a, b) {
        return z(w(b) * x(G) + x(b) * w(G) * w(a))
    }
    function j(a, b, c) {
        return A(w(a), x(a) * w(b) - y(c) * x(b))
    }
    function k(a, b, c) {
        return z(w(b) * w(c) + x(b) * x(c) * x(a))
    }
    function l(a, b) {
        return C * (280.16 + 360.9856235 * a) - b
    }
    function m(a) {
        return C * (357.5291 + .98560028 * a)
    }
    function n(a) {
        var b = C * (1.9148 * w(a) + .02 * w(2 * a) + 3e-4 * w(3 * a))
          , c = 102.9372 * C;
        return a + b + c + v
    }
    function o(a) {
        var b = m(a)
          , c = n(b);
        return {
            dec: i(c, 0),
            ra: h(c, 0)
        }
    }
    function p(a, b) {
        return Math.round(a - J - b / (2 * v))
    }
    function q(a, b, c) {
        return J + (a + b) / (2 * v) + c
    }
    function r(a, b, c) {
        return F + a + .0053 * w(b) - .0069 * w(2 * c)
    }
    function s(a, b, c) {
        return B((w(a) - w(b) * w(c)) / (x(b) * x(c)))
    }
    function t(a, b, c, d, e, f, g) {
        var h = s(a, c, d)
          , i = q(h, b, e);
        return r(i, f, g)
    }
    function u(a) {
        var b = C * (218.316 + 13.176396 * a)
          , c = C * (134.963 + 13.064993 * a)
          , d = C * (93.272 + 13.22935 * a)
          , e = b + 6.289 * C * w(c)
          , f = 5.128 * C * w(d)
          , g = 385001 - 20905 * x(c);
        return {
            ra: h(e, f),
            dec: i(e, f),
            dist: g
        }
    }
    var v = Math.PI
      , w = Math.sin
      , x = Math.cos
      , y = Math.tan
      , z = Math.asin
      , A = Math.atan2
      , B = Math.acos
      , C = v / 180
      , D = 864e5
      , E = 2440588
      , F = 2451545
      , G = 23.4397 * C
      , H = {};
    H.getPosition = function(a, b, c) {
        var d = C * -c
          , e = C * b
          , f = g(a)
          , h = o(f)
          , i = l(f, d) - h.ra;
        return {
            azimuth: j(i, e, h.dec),
            altitude: k(i, e, h.dec)
        }
    }
    ;
    var I = H.times = [[-.833, "sunrise", "sunset"], [-.3, "sunriseEnd", "sunsetStart"], [-6, "dawn", "dusk"], [-12, "nauticalDawn", "nauticalDusk"], [-18, "nightEnd", "night"], [6, "goldenHourEnd", "goldenHour"]];
    H.addTime = function(a, b, c) {
        I.push([a, b, c])
    }
    ;
    var J = 9e-4;
    H.getTimes = function(a, b, c) {
        var d, e, h, j, k, l = C * -c, o = C * b, s = g(a), u = p(s, l), v = q(0, l, u), w = m(v), x = n(w), y = i(x, 0), z = r(v, w, x), A = {
            solarNoon: f(z),
            nadir: f(z - .5)
        };
        for (d = 0,
        e = I.length; e > d; d += 1)
            h = I[d],
            j = t(h[0] * C, l, o, y, u, w, x),
            k = z - (j - z),
            A[h[1]] = f(k),
            A[h[2]] = f(j);
        return A
    }
    ,
    H.getMoonPosition = function(a, b, c) {
        var d = C * -c
          , e = C * b
          , f = g(a)
          , h = u(f)
          , i = l(f, d) - h.ra
          , m = k(i, e, h.dec);
        return m += .017 * C / y(m + 10.26 * C / (m + 5.1 * C)),
        {
            azimuth: j(i, e, h.dec),
            altitude: m,
            distance: h.dist
        }
    }
    ,
    H.getMoonIllumination = function(a) {
        var b = g(a)
          , c = o(b)
          , d = u(b)
          , e = 149598e3
          , f = B(w(c.dec) * w(d.dec) + x(c.dec) * x(d.dec) * x(c.ra - d.ra))
          , h = A(e * w(f), d.dist - e * x(f))
          , i = A(x(c.dec) * w(c.ra - d.ra), w(c.dec) * x(d.dec) - x(c.dec) * w(d.dec) * x(c.ra - d.ra));
        return {
            fraction: (1 + x(h)) / 2,
            phase: .5 + .5 * h * (0 > i ? -1 : 1) / Math.PI,
            angle: i
        }
    }
    ,
    a.SunCalc = H
}),
nm_module("nm/dataproviders/heighttile", function(a, b, c, d) {
    var e = b("jscore/dateutils", "format")
      , f = b("jscore/events", "ObservableObject")
      , g = b("nm/const", "HOST_URL")
      , h = a.HeightTileProvider = c(f, {
        constructor: function(a, b, c) {
            h.base.call(this),
            this.x = a,
            this.y = b,
            this.z = c,
            this._heightData = new Uint8Array(49923),
            this._loaded = !1
        },
        load: function(a) {
            this._loaded = !1;
            var b = "";
            a && (b = "&nmd=" + e(a, "yyyymmdd", !0));
            var c = g + "maps/hl=en&x=" + this.x + "&y=" + this.y + "&z=" + this.z + "&nml=dsmc" + b + "&httpauth=false&version=2&exclude=background"
              , d = new XMLHttpRequest;
            d.open("GET", c),
            d.responseType = "arraybuffer",
            d.onload = function() {
                200 === d.status && (this._loaded = !0,
                this.setHeightData(new Uint8Array(d.response)))
            }
            .bind(this),
            d.send()
        },
        setHeightData: function(a) {
            this._heightData = a,
            this.changed()
        },
        hasLoaded: function() {
            return this._loaded
        },
        setHeight: function(a, b, c) {
            var d = this._heightData;
            c = 1280 * (c + 1e3);
            var e = 3 * (129 * b + a)
              , f = 255 & c
              , g = c >> 8 & 255
              , h = c >> 16 & 255;
            d[e + 0] = f,
            d[e + 1] = g,
            d[e + 2] = h
        },
        getHeight: function(a, b) {
            var c = this._heightData
              , d = null ;
            if (this.hasLoaded) {
                var e = 3 * (129 * b + a);
                try {
                    d = c[e + 2] << 16 | c[e + 1] << 8 | c[e + 0]
                } catch (f) {}
                d = d / 1280 - 1e3
            }
            return d
        }
    })
}),
nm_module("nm/views/google/shadowlayer", function(a, b, c, d) {
    function e(a) {
        var b = m(a)
          , c = Math.cos(b)
          , d = Math.sin(b);
        return {
            dx: c,
            dy: d
        }
    }
    var f = b("jscore/events", "Change")
      , g = b("jscore/async", "callWhenIdle")
      , h = b("jscore/functools", "bind")
      , i = b("js-libs/google", "maps")
      , j = b("js-libs/suncalc", "SunCalc")
      , k = b("jscore/async", "setTimeout")
      , l = b("jscore/async", "clearTimeout")
      , m = b("jscore/math", "degreesToRadians")
      , n = b("jscore/math", "radiansToDegrees")
      , o = b("nm/dataproviders/heighttile", "HeightTileProvider")
      , p = b("jscore/itertools", "some")
      , q = b("jscore/itertools", "filter")
      , r = b("jscore/objtools", "values")
      , s = b("js-libs/jquery", "jQuery")
      , t = b("nm/layers/feature", "FeatureLayer")
      , u = b("nm/features/polygon", "Polygon")
      , v = b("nm/views/google/convert", "toGoogle")
      , w = .7
      , x = 100
      , y = 90
      , z = 90
      , A = 100
      , B = 50
      , C = a.ShadowLayerView = c(Object, {
        constructor: function(a, b, c) {
            C.base.call(this),
            this.layer = a,
            this.map = b.getMap(),
            this.gMap = c,
            this.tiles = {},
            this.tileSize = new i.Size(256,256),
            this.addOverlay(),
            this.registerListeners()
        },
        registerListeners: function() {
            var a = h(this, this.update)
              , b = g(a, 100);
            this.layer.addListener(f, h(this, this.update)),
            this.map.addListener(f, h(this, b))
        },
        unregisterListeners: function() {
            this.layer.removeListeners(this),
            this.map.removeListeners(this)
        },
        update: function() {
            var a = this.layer;
            if (this.toggleVisibility(a.getVisible()),
            this.visible) {
                var b = a.getSimDate()
                  , c = a.getSurveyDate()
                  , d = a.getColor()
                  , e = a.supportsObjects()
                  , f = this.map
                  , g = f.getCenter()
                  , h = g.lat
                  , i = g.lng
                  , k = f.getZoom()
                  , l = j.getPosition(b, h, i)
                  , o = n(l.azimuth) + z
                  , p = 1 << k
                  , q = Math.cos(m(h))
                  , r = 156543.04 * q / p
                  , s = w * r
                  , t = Math.tan(l.altitude)
                  , u = s * t
                  , v = this.gMap
                  , x = v.getProjection()
                  , y = x.fromLatLngToPoint(v.getCenter())
                  , A = {
                    startX: Math.round(y.x * p),
                    startY: Math.round(y.y * p)
                };
                this.startX = A.startX,
                this.startY = A.startY,
                this.saz = o,
                this.shd = u,
                this.color = d || [0, 0, 0],
                this.surveyDate = c,
                this.shadowDim = this.getAvailableDims(),
                this.supportsObjects = e,
                this.reloadTiles(c)
            }
        },
        simulate: function(a, b, c, d) {
            function f() {
                l(h.simTimeout),
                h.simTimeout = k(function() {
                    for (var a = 0; x > a; a++)
                        h.simulateLine(j, m, c, d),
                        j += n,
                        m += o,
                        i++;
                    h.repaintTiles(),
                    i < h.shadowDim && f()
                }, 1)
            }
            this.clearTiles();
            var g, h = this, i = 0;
            g = e(c - 45);
            var j = a + g.dx * (.5 * this.shadowDim)
              , m = b + g.dy * (.5 * this.shadowDim);
            g = e(c + y);
            var n = g.dx * w
              , o = g.dy * w;
            f()
        },
        simulateLine: function(a, b, c, d) {
            var f, g, h = e(c - 180);
            f = h.dx * w,
            g = h.dy * w;
            for (var i = this.color, j = -(1 / 0), k = 0; k < this.shadowDim; k++) {
                j -= d,
                a += f,
                b += g;
                var l, m = this.getHeight(a, b);
                m && (j > m ? l = A : (j = m,
                l = 0),
                this.setColor(a, b, i[0], i[1], i[2], l))
            }
        },
        setColor: function(a, b, c, d, e, f) {
            a = Math.round(a),
            b = Math.round(b);
            var g = this.getCanvas(a, b);
            if (g) {
                var h = g.imgData
                  , i = h.data;
                a -= g.tileX << 8,
                b -= g.tileY << 8;
                var j = 1024 * b + 4 * a;
                i[j] = c,
                i[j + 1] = d,
                i[j + 2] = e,
                i[j + 3] = f
            }
        },
        addObjectsToSimulation: function() {
            var a = this.map.getLayersCtrl()
              , b = q(a.getLayers(), function(a) {
                return a instanceof t
            }
            .bind(this))
              , c = b[0].getFeatures()
              , e = q(c, function(a) {
                return a instanceof u
            }
            .bind(this));
            if (e.length > 0) {
                var f = e[0].getPoints();
                f = v(f);
                for (var g, h, i, j = this.gMap, k = j.getProjection(), l = j.getZoom(), m = 1 << l, n = 256 * m, o = 0, p = n, r = 0, s = [], w = f[d.iterator](); !(i = w.next()).done; ) {
                    var x = i.value;
                    x = k.fromLatLngToPoint(x),
                    g = x.x * m,
                    h = x.y * m,
                    n = Math.min(n, g),
                    o = Math.max(o, g),
                    p = Math.min(p, h),
                    r = Math.max(r, h),
                    s.push({
                        x: g,
                        y: h
                    })
                }
                var y = Math.ceil(o - n)
                  , z = Math.ceil(r - p)
                  , A = document.createElement("canvas");
                A.style.width = y + "px",
                A.style.height = z + "px",
                A.width = y,
                A.height = z;
                var C = A.getContext("2d");
                C.beginPath(),
                C.setTransform(1, 0, 0, 1, -n, -p),
                C.fillStyle = "#ffffff",
                C.moveTo(s[0].x, s[0].y);
                for (var D, E = s[d.iterator](); !(D = E.next()).done; ) {
                    var F = D.value
                      , G = F.y
                      , F = F.x;
                    C.lineTo(F, G)
                }
                C.closePath(),
                C.fill();
                var H = C.getImageData(0, 0, y, z).data;
                for (F = 0; y > F; F++)
                    for (G = 0; z > G; G++) {
                        var I = H[4 * (G * y + F)];
                        I && this.setHeight(F + n, G + p, B)
                    }
            }
        },
        getTile: function(a, b, c) {
            var d = this.surveyDate
              , e = c.createElement("canvas")
              , g = this.tileSize.width
              , h = this.tileSize.height;
            e.width = g,
            e.height = h,
            e.style.width = g + "px",
            e.style.height = h + "px",
            e.style.visibility = this.visible ? "visible" : "hidden",
            e.tileX = a.x,
            e.tileY = a.y,
            this.tiles[e.tileX + ":" + e.tileY] = e;
            var i = new o(a.x,a.y,b - 1);
            return i.addListener(f, function() {
                if (this.allTilesLoaded()) {
                    var a = this.startX
                      , b = this.startY
                      , c = this.saz
                      , d = this.shd;
                    this.supportsObjects && this.addObjectsToSimulation(),
                    this.simulate(a, b, c, d)
                }
            }
            .bind(this)),
            e.htProvider = i,
            i.load(d),
            e
        },
        setHeight: function(a, b, c) {
            a = Math.round(a),
            b = Math.round(b);
            var d = this.getCanvas(a, b);
            if (d) {
                var e = Math.round((a - (d.tileX << 8)) / 2)
                  , f = Math.round((b - (d.tileY << 8)) / 2)
                  , g = d.htProvider;
                g && g.setHeight(e, f, c)
            }
        },
        getHeight: function(a, b) {
            a = Math.round(a),
            b = Math.round(b);
            var c = this.getCanvas(a, b);
            if (c) {
                var d = Math.round((a - (c.tileX << 8)) / 2)
                  , e = Math.round((b - (c.tileY << 8)) / 2)
                  , f = c.htProvider;
                if (f) {
                    var g = f.getHeight(d, e);
                    return g
                }
                return !1
            }
        },
        getCanvas: function(a, b) {
            var c = a >> 8
              , d = b >> 8
              , e = this.tiles[c + ":" + d];
            return e
        },
        getAvailableDims: function() {
            var a = this.gMap
              , b = s(a.getDiv())
              , c = Math.pow(b.width(), 2)
              , d = Math.pow(b.height(), 2)
              , e = Math.sqrt(c + d)
              , f = +(1 / w).toFixed(1)
              , g = Math.round(e) * f;
            return g
        },
        allTilesLoaded: function() {
            var a = r(this.tiles || {})
              , b = p(a, function(a) {
                return !a.htProvider.hasLoaded()
            }
            .bind(this));
            return !b
        },
        toggleVisibility: function(a) {
            if (a !== this.visible) {
                for (var b, c = r(this.tiles || {}), e = c[d.iterator](); !(b = e.next()).done; ) {
                    var f = b.value;
                    f.style.visibility = a ? "visible" : "hidden"
                }
                this.visible = a
            }
        },
        addOverlay: function() {
            var a = this.gMap;
            a.overlayMapTypes.push(this),
            this.isVisible = !0
        },
        removeOverlay: function() {
            var a = this.gMap
              , b = a.overlayMapTypes.indexOf(this);
            b >= 0 && a.overlayMapTypes.removeAt(b)
        },
        reloadTiles: function(a) {
            var b = r(this.tiles || {});
            l(this.simTimeout),
            this.clearTiles();
            for (var c, e = b[d.iterator](); !(c = e.next()).done; ) {
                var f = c.value;
                f.htProvider.load(a)
            }
        },
        repaintTiles: function() {
            var a = this.tiles;
            if (a)
                for (var b in a)
                    if (a.hasOwnProperty(b)) {
                        var c = a[b];
                        if (!c.ctx)
                            continue;c.ctx.putImageData(c.imgData, 0, 0)
                    }
        },
        clearTiles: function() {
            var a = this.tiles;
            for (var b in a)
                if (a.hasOwnProperty(b)) {
                    var c = a[b];
                    c.ctx = c.getContext("2d"),
                    c.ctx.clearRect(0, 0, 256, 256),
                    c.imgData = c.ctx.getImageData(0, 0, 256, 256)
                }
        },
        releaseTile: function(a) {
            var b = this.tiles
              , c = a.tileX
              , d = a.tileY;
            delete b[c + ":" + d]
        },
        destroy: function() {
            this.removeOverlay();
            for (var a, b = r(this.tiles || {}), c = b[d.iterator](); !(a = c.next()).done; ) {
                var e = a.value;
                e.htProvider.removeListeners(this)
            }
            this.unregisterListeners()
        }
    })
}),
nm_module("nm/views/google/floodlayer", function(a, b, c, d) {
    function e(a, b) {
        for (var c, d = [0, 0, 0], e = 0; 3 > e; e++)
            c = a[e],
            d[e] = Math.min(Math.max(0, c + c * b), 255);
        return d
    }
    function f(a, b, c, d, e) {
        var f = 4 * (128 * c + b);
        a[f] = d[0],
        a[f + 1] = d[1],
        a[f + 2] = d[2],
        a[f + 3] = e
    }
    function g(a, b, c, d, g, h) {
        var i = k("canvas");
        i.width = 128,
        i.height = 128;
        for (var j = i.getContext("2d"), l = j.createImageData(128, 128), m = l.data, n = 0; 128 > n; n++)
            for (var o = 0; 128 > o; o++) {
                var p = 0
                  , q = [0, 0, 0]
                  , r = b.getHeight(o, n);
                if (c > r && (q = g,
                p = d,
                h)) {
                    var s = c - r
                      , t = -Math.min(s / 20, 1);
                    q = e(g, t)
                }
                f(m, o, n, q, p)
            }
        j.putImageData(l, 0, 0, 0, 0, 128, 128);
        var u = a.getContext("2d");
        u.clearRect(0, 0, a.width, a.height),
        u.drawImage(i, 0, 0, a.width, a.height)
    }
    var h = b("jscore/events", "Change")
      , i = b("jscore/functools", "bind")
      , j = b("js-libs/google", "maps")
      , k = b("nm/dom", "createElement")
      , l = b("nm/geom", "getNormalizedCoord")
      , m = b("nm/dataproviders/heighttile", "HeightTileProvider")
      , n = a.FloodLayerView = c(Object, {
        constructor: function(a, b, c) {
            n.base.call(this),
            this.layer = a,
            this.gMap = c,
            this.tileSize = new j.Size(256,256),
            this.maxZoom = 24,
            this.alt = "Flooding simulation",
            this.htProviders = [],
            this.addOverlay(),
            this.setupListeners()
        },
        setupListeners: function() {
            var a = this.layer;
            a.addListener(h, i(this, this.update))
        },
        getTile: function(a, b, c) {
            a = l(a, b);
            var d = c.createElement("canvas")
              , e = this.tileSize.width
              , f = this.tileSize.height;
            if (d.width = e,
            d.height = f,
            d.style.width = e + "px",
            d.style.height = f + "px",
            d.style.visibility = this.visible ? "visible" : "hidden",
            null  === a)
                return d;
            var i = new m(a.x,a.y,b - 1);
            return i.cnv = d,
            i.addListener(h, function() {
                g(d, i, this.threshold, this.transparency, this.color, this.gradient)
            }
            .bind(this)),
            this.htProviders.push(i),
            this.threshold && i.load(this.date),
            d
        },
        releaseTile: function(a) {
            var b = this.htProviders
              , c = b.indexOf(a);
            c >= 0 && b.splice(c, 1)
        },
        update: function() {
            var a = this.layer;
            if (this.toggleVisibility(a.getVisible()),
            this.visible) {
                var b = a.getSurveyDate();
                this.date = b,
                this.threshold = a.getThreshold(),
                this.transparency = a.getTransparency(),
                this.color = a.getColor(),
                this.gradient = a.getGradient();
                for (var c, e = this.htProviders[d.iterator](); !(c = e.next()).done; ) {
                    var f = c.value;
                    f.load(b)
                }
            }
        },
        toggleVisibility: function(a) {
            if (a !== this.visible) {
                for (var b, c = this.htProviders, e = c[d.iterator](); !(b = e.next()).done; ) {
                    var f = b.value
                      , g = f.cnv;
                    g.style.visibility = a ? "visible" : "hidden"
                }
                this.visible = a
            }
        },
        addOverlay: function() {
            var a = this.gMap;
            a.overlayMapTypes.push(this),
            this.isVisible = !0
        },
        removeOverlay: function() {
            var a = this.gMap
              , b = a.overlayMapTypes.indexOf(this);
            b >= 0 && a.overlayMapTypes.removeAt(b)
        },
        destroy: function() {
            this.removeOverlay();
            for (var a, b = this.htProviders[d.iterator](); !(a = b.next()).done; ) {
                var c = a.value;
                c.removeListeners(this)
            }
            this.layer.removeListeners(this)
        }
    })
}),
nm_module("js-libs/geojson", function(a, b, c, d) {
    function e(a, b) {
        var c, d, e = function(a, b, c) {
            var d, i, j, k, l, m, n, o, p, q;
            switch (a.type) {
            case "Point":
                b.position = new f.LatLng(a.coordinates[1],a.coordinates[0]),
                d = new f.Marker(b),
                c && d.set("geojsonProperties", c);
                break;
            case "MultiPoint":
                for (d = [],
                i = 0; i < a.coordinates.length; i++)
                    b.position = new f.LatLng(a.coordinates[i][1],a.coordinates[i][0]),
                    d.push(new f.Marker(b));
                if (c)
                    for (k = 0; k < d.length; k++)
                        d[k].set("geojsonProperties", c);
                break;
            case "LineString":
                for (l = [],
                i = 0; i < a.coordinates.length; i++)
                    n = a.coordinates[i],
                    o = new f.LatLng(n[1],n[0]),
                    l.push(o);
                b.path = l,
                d = new f.Polyline(b),
                c && d.set("geojsonProperties", c);
                break;
            case "MultiLineString":
                for (d = [],
                i = 0; i < a.coordinates.length; i++) {
                    for (l = [],
                    j = 0; j < a.coordinates[i].length; j++)
                        n = a.coordinates[i][j],
                        o = new f.LatLng(n[1],n[0]),
                        l.push(o);
                    b.path = l,
                    d.push(new f.Polyline(b))
                }
                if (c)
                    for (k = 0; k < d.length; k++)
                        d[k].set("geojsonProperties", c);
                break;
            case "Polygon":
                for (m = [],
                i = 0; i < a.coordinates.length; i++) {
                    for (l = [],
                    j = 0; j < a.coordinates[i].length; j++)
                        o = new f.LatLng(a.coordinates[i][j][1],a.coordinates[i][j][0]),
                        l.push(o);
                    i ? 1 == i ? (q = h(l),
                    p == q ? m.push(l.reverse()) : m.push(l)) : p == q ? m.push(l.reverse()) : m.push(l) : (p = h(l),
                    m.push(l))
                }
                b.paths = m,
                d = new f.Polygon(b),
                c && d.set("geojsonProperties", c);
                break;
            case "MultiPolygon":
                for (d = [],
                i = 0; i < a.coordinates.length; i++) {
                    for (m = [],
                    j = 0; j < a.coordinates[i].length; j++) {
                        for (l = [],
                        k = 0; k < a.coordinates[i][j].length; k++)
                            o = new f.LatLng(a.coordinates[i][j][k][1],a.coordinates[i][j][k][0]),
                            l.push(o);
                        j ? 1 == j ? (q = h(l),
                        p == q ? m.push(l.reverse()) : m.push(l)) : p == q ? m.push(l.reverse()) : m.push(l) : (p = h(l),
                        m.push(l))
                    }
                    b.paths = m,
                    d.push(new f.Polygon(b))
                }
                if (c)
                    for (k = 0; k < d.length; k++)
                        d[k].set("geojsonProperties", c);
                break;
            case "GeometryCollection":
                if (d = [],
                a.geometries)
                    for (i = 0; i < a.geometries.length; i++)
                        d.push(e(a.geometries[i], b, c || null ));
                else
                    d = g('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');
                break;
            default:
                d = g('Invalid GeoJSON object: Geometry object must be one of "Point", "LineString", "Polygon" or "MultiPolygon".')
            }
            return d
        }
        , g = function(a) {
            return {
                type: "Error",
                message: a
            }
        }
        , h = function(a) {
            for (var b, c = 0, d = 0; d < a.length - 2; d++)
                c += (a[d + 1].lat() - a[d].lat()) * (a[d + 2].lng() - a[d].lng()) - (a[d + 2].lat() - a[d].lat()) * (a[d + 1].lng() - a[d].lng());
            return b = c > 0
        }
        , i = b || {};
        switch (a.type) {
        case "FeatureCollection":
            if (a.features)
                for (c = [],
                d = 0; d < a.features.length; d++) {
                    var j = a.features[d]
                      , k = j.geometry;
                    if (k) {
                        var l = j.properties
                          , m = e(k, i, l);
                        c.push(m)
                    }
                }
            else
                c = g('Invalid GeoJSON object: FeatureCollection object missing "features" member.');
            break;
        case "GeometryCollection":
            if (a.geometries)
                for (c = [],
                d = 0; d < a.geometries.length; d++)
                    c.push(e(a.geometries[d], i));
            else
                c = g('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');
            break;
        case "Feature":
            c = a.properties && a.geometry ? e(a.geometry, i, a.properties) : g('Invalid GeoJSON object: Feature object missing "properties" or "geometry" member.');
            break;
        case "Point":
        case "MultiPoint":
        case "LineString":
        case "MultiLineString":
        case "Polygon":
        case "MultiPolygon":
            c = a.coordinates ? c = e(a, i) : g('Invalid GeoJSON object: Geometry object missing "coordinates" member.');
            break;
        default:
            c = g('Invalid GeoJSON object: GeoJSON object must be one of "Point", "LineString", "Polygon", "MultiPolygon", "Feature", "FeatureCollection" or "GeometryCollection".')
        }
        return c
    }
    var f = b("./google", "maps");
    a.GeoJSON = e
}),
nm_module("nm/views/google/geojsonlayer", function(a, b, c, d) {
    function e(a, b, c) {
        a.addListener(f, g(b, c))
    }
    var f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/map", "Map")
      , i = b("jscore/itertools", "isIterable")
      , j = b("jscore/types", "isUndefinedOrNull")
      , k = b("jscore/types", "isUndefined")
      , l = b("js-libs/jquery", "jQuery")
      , m = b("js-libs/geojson", "GeoJSON")
      , n = b("js-libs/google", "maps")
      , o = b("js-libs/richmarker", "RichMarker")
      , p = b("nm/geom", "LatLng")
      , q = {
        strokeColor: "#FF7800",
        strokeOpacity: 1,
        strokeWeight: 2,
        fillColor: "#46461F",
        fillOpacity: .5
    };
    a.GeoJSONLayerView = c(Object, {
        constructor: function(a, b, c) {
            var d = b.layersCtrl
              , f = d.getSelectionCtrl();
            this.layer = a,
            this.map = b,
            this.gMap = c,
            this.selectionCtrl = f,
            this.featureObjs = new h,
            this.labels = new h,
            e(a, this, this.update),
            e(f, this, this.layerSelected),
            this.update()
        },
        update: function() {
            var a = this.gMap
              , b = this.layer
              , c = b.getGeoJson()
              , e = b.getShowLabels();
            if (!b.getVisible())
                return void this.clear();
            if (!j(c)) {
                for (var f, g = new h, i = new h, l = [], n = c.features[d.iterator](); !(f = n.next()).done; ) {
                    var o = f.value
                      , p = o.id
                      , q = this.labels.get(p);
                    k(q) || (i.set(p, q),
                    this.labels["delete"](p));
                    var r = this.featureObjs.get(p);
                    k(r) ? l.push(o) : (g.set(p, r),
                    this.featureObjs["delete"](p))
                }
                this.clear(),
                this.featureObjs = g,
                this.labels = i;
                for (var s, t = l[d.iterator](); !(s = t.next()).done; ) {
                    var u = s.value
                      , v = this.getFeatureStyle(u)
                      , w = new m(u,v);
                    this.renderGeoJsonFeature(u.id, a, w, e)
                }
            }
        },
        renderGeoJsonFeature: function(a, b, c, e) {
            if (i(c))
                for (var f, g = c[d.iterator](); !(f = g.next()).done; ) {
                    var h = f.value;
                    this.renderGeoJsonFeature(a, b, h, e)
                }
            else {
                c.setOptions({
                    clickable: !0
                }),
                c.setMap(b);
                var j = this.featureObjs.get(a);
                if (k(j) && (j = [],
                this.featureObjs.set(a, j)),
                j.push(c),
                c.geojsonProperties) {
                    var l = c.geojsonProperties
                      , m = l.description || l.Description;
                    m && this.addInfoWindowListener(c, m),
                    e && this.addLabel(a, b, c)
                }
            }
        },
        layerSelected: function() {
            var a = this.layer
              , b = this.selectionCtrl
              , c = b.isSelected(a);
            if (this._isSelected !== c && (this._isSelected = c,
            c)) {
                var d = a.getGeoJson().properties
                  , e = d._nm_centroid;
                if (e) {
                    var f = this.gMap
                      , g = e.coordinates[1]
                      , h = e.coordinates[0];
                    f.setCenter(new p(g,h));
                    var i = d._nm_areaSqm
                      , j = this.getPreferredLayerZoom(i);
                    f.setZoom(j)
                }
            }
        },
        getPreferredLayerZoom: function(a) {
            return a ? 9e6 >= a ? 14 : 1e8 >= a ? 13 : 1e9 >= a ? 12 : 1e10 >= a ? 11 : 3e10 >= a ? 10 : 6e10 >= a ? 9 : 2e11 >= a ? 8 : 1e12 >= a ? 7 : 1e13 >= a ? 6 : 5 : -1
        },
        addInfoWindowListener: function(a, b) {
            var c = this.map;
            n.event.addListener(a, "click", function(d) {
                a.getIcon || (a = new n.MVCObject,
                a.set("position", d.latLng)),
                c.setInfoWindow(b, a)
            }
            .bind(this))
        },
        addLabel: function(a, b, c) {
            if (!this.labels.has(a) && c.getIcon && !c.getTitle()) {
                var d = c.geojsonProperties.name;
                if (d) {
                    var e = document.createElement("div")
                      , f = l(e).addClass("geojson-label");
                    f.text(d);
                    var g = {
                        map: b,
                        content: f[0],
                        position: c.position,
                        visible: !0,
                        anchor: o.RichMarkerPosition.TOP,
                        shadow: !1
                    }
                      , h = new o(g);
                    this.labels.set(a, h),
                    c.setTitle(d)
                }
            }
        },
        getFeatureStyle: function(a) {
            var b = this.getStyleDefForFeature(a);
            return null  !== b ? l.extend({}, q, b) : q
        },
        getStyleDefForFeature: function(a) {
            var b = a.properties;
            if (!b)
                return null ;
            var c = b._nm_styleRef;
            return j(c) ? null  : this.layer.getStyleDef(c)
        },
        clear: function() {
            for (var a, b = this.featureObjs.values()[d.iterator](); !(a = b.next()).done; )
                for (var c, e = a.value, f = e[d.iterator](); !(c = f.next()).done; ) {
                    var g = c.value;
                    g.setMap(null )
                }
            for (var h, i = this.labels.values()[d.iterator](); !(h = i.next()).done; ) {
                var j = h.value;
                j.setMap(null )
            }
            this.featureObjs.clear(),
            this.labels.clear(),
            this.map.closeInfoWindow()
        },
        destroy: function() {
            this.clear(),
            this.layer.removeListeners(this),
            this.selectionCtrl.removeListeners(this)
        }
    })
}),
nm_module("nm/views/google/map", function(a, b, c, d) {
    var e = b("nm/geom", "LatLng")
      , f = b("jscore/events", "ObservableObject")
      , g = b("nm/maps/map", "Click")
      , h = b("jscore/objtools", "Dictionary")
      , i = b("jscore/async", "clearTimeout")
      , j = b("jscore/async", "setTimeout")
      , k = b("nm/layers/baselayer", "BaseLayer")
      , l = b("nm/layers/feature", "FeatureLayer")
      , m = b("nm/layers/shadowlayer", "ShadowLayer")
      , n = b("nm/layers/floodlayer", "FloodLayer")
      , o = b("nm/layers/geojson", "GeoJSONLayer")
      , p = b("nm/views/google/baselayer", "BaseLayerView")
      , q = b("nm/views/google/featurelayer", "FeatureLayerView")
      , r = b("nm/views/google/shadowlayer", "ShadowLayerView")
      , s = b("nm/views/google/floodlayer", "FloodLayerView")
      , t = b("nm/views/google/geojsonlayer", "GeoJSONLayerView")
      , u = b("nm/views/google/convert", "toGoogle")
      , v = b("jscore/sets", "Set")
      , w = b("jscore/events", "Change")
      , x = b("jscore/functools", "bind")
      , y = b("js-libs/google", "maps")
      , z = a.convertToGoogle = function(a) {
        return new y.LatLng(a.getLat(),a.getLon())
    }
      , A = a.convertToNM = function(a) {
        return new e(a.lat(),a.lng())
    }
      , B = new h([[k, p], [m, r], [n, s], [l, q], [o, t]])
      , C = a.GoogleMapViewController = c(f, {
        constructor: function(a, b, c) {
            C.base.call(this),
            this.container = a,
            this.map = b,
            this.layersCtrl = b.getLayersCtrl(),
            this.layerViews = new h;
            var d = {
                zoom: this.map.getZoom(),
                zoomControlOptions: c.zoomControlOptions,
                center: z(this.map.getCenter()),
                backgroundColor: "#FFFFFF",
                zoomControl: c.zoomControl,
                streetViewControl: c.streetViewControl,
                streetViewControlOptions: c.streetViewControlOptions,
                panControl: c.panControl,
                scaleControl: c.scaleControl,
                mapTypeControl: !1,
                minZoom: 1,
                maxZoom: 24,
                mapTypeId: "SURVEY",
                tilt: 0
            }
              , e = new y.Map(this.container,d);
            e.addListener("zoom_changed", x(this, this.googZoomChanged)),
            e.addListener("center_changed", x(this, this.googCenterChanged)),
            e.addListener("click", x(this, this.googClick)),
            this.gMap = e,
            b.addListener(w, x(this, this.handleModelChanged)),
            this.layersCtrl.addListener(w, x(this, this.handleLayersChanged)),
            this.handleModelChanged()
        },
        handleLayersChanged: function() {
            for (var a, b, c, e = this.gMap, f = this.layerViews, g = new v(this.layersCtrl.getLayers()), h = f.keys()[d.iterator](); !(c = h.next()).done; )
                a = c.value,
                g.contains(a) || (b = f.pop(a),
                b.destroy());
            for (var i, j = g[d.iterator](); !(i = j.next()).done; )
                if (a = i.value,
                !f.hasKey(a)) {
                    var k = B.get(a.constructor);
                    b = new k(a,this,e),
                    f.set(a, b)
                }
        },
        handleModelChanged: function() {
            var a = this.gMap
              , b = {}
              , c = u(this.map.getCenter());
            a.getCenter().equals(c) || (b.center = c);
            var d = this.map.getZoom();
            a.getZoom() !== d && (b.zoom = d),
            a.setOptions(b)
        },
        getMap: function() {
            return this.map
        },
        getLayersCtrl: function() {
            return this.layersCtrl
        },
        getCenter: function() {
            return this.map.getCenter()
        },
        getZoom: function() {
            return this.map.getZoom()
        },
        getSelection: function() {
            return this.map.getSelection()
        },
        getDragHandler: function() {
            return this.map.getDragHandler()
        },
        googZoomChanged: function() {
            var a = this.gMap.getZoom();
            this.map.setView({
                zoom: a
            }, this)
        },
        googCenterChanged: function() {
            var a = this.gMap
              , b = a.getZoom()
              , c = a.getCenter();
            c = A(c),
            this.map.setView({
                center: c,
                zoom: b
            }, this)
        },
        googClick: function(a) {
            var b = this.layersCtrl.getSelectionCtrl();
            b.unselect(b.getSelectedFeatures());
            var c = a.latLng;
            c = new e(c.lat(),c.lng()),
            this.map.dispatch(new g(c))
        },
        mapViewChanged: function() {
            var a = this.map.getCenter();
            a = z(a);
            var b = this.map.getZoom()
              , c = {}
              , d = this.gMap
              , e = d.getCenter();
            e.equals(a) || (c.center = a),
            d.getZoom() !== b && (c.zoom = b),
            d.setOptions(c)
        },
        getBounds: function() {
            var a, b, c = this.gMap.getBounds();
            return "undefined" != typeof c ? (a = c.getNorthEast(),
            b = c.getSouthWest()) : (a = new y.LatLng(90,180),
            b = new y.LatLng(-90,-180)),
            c = {
                top: a.lat(),
                left: b.lng(),
                bottom: b.lat(),
                right: a.lng()
            }
        },
        isLocationVisible: function(a) {
            var b = this.gMap.getBounds()
              , c = new y.LatLng(a.lat,a.lng);
            return b.contains(c)
        },
        showPoints: function(a) {
            for (var b, c = new y.LatLngBounds, e = a[d.iterator](); !(b = e.next()).done; ) {
                var f = b.value;
                f = new y.LatLng(f.lat,f.lng),
                c.extend(f)
            }
            this.gMap.fitBounds(c)
        },
        setCursor: function(a) {
            this.gMap.setOptions({
                draggableCursor: a
            })
        },
        setInfoWindow: function(a, b) {
            var c = this.gMap
              , d = this.infoWindow;
            d || (d = new y.InfoWindow({
                content: ""
            }),
            this.infoWindow = d),
            d.setContent(a),
            d.open(c, b)
        },
        closeInfoWindow: function() {
            var a = this.infoWindow;
            a && a.close()
        },
        highlightLocation: function(a) {
            var b = z(a);
            i(this.locationHighlightTimeout),
            this.tempMarker ? this.tempMarker.setPosition(b) : this.tempMarker = new y.Marker({
                map: this.gMap,
                position: b,
                icon: {
                    path: "m -5,0 a 5,5 0 1,0, 10,0 a 5,5 0 1,0 -10,0 z",
                    strokeColor: "#FFF",
                    strokeWidth: 2,
                    strokeOpacity: .8,
                    fillColor: "#0099ff",
                    fillOpacity: .9,
                    scale: 1
                }
            })
        },
        removeLocationHighlight: function() {
            this.locationHighlightTimeout = j(x(this, function() {
                var a = this.tempMarker;
                a && (this.tempMarker = null ,
                a.setMap(null ))
            }), 100)
        }
    })
}),
nm_module("nm/tools/layerpicker", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/functools", "partial")
      , g = b("jscore/objtools", "Dictionary")
      , h = b("jscore/events", "Change")
      , i = b("nm/const/imagery", "SURVEY")
      , j = b("nm/const/imagery", "SURVEY_N")
      , k = b("nm/const/imagery", "SURVEY_E")
      , l = b("nm/const/imagery", "SURVEY_S")
      , m = b("nm/const/imagery", "SURVEY_W")
      , n = b("nm/const/imagery", "TERRAIN")
      , o = b("nm/const/imagery", "ROAD")
      , p = b("js-libs/jquery", "jQuery")
      , q = new g([[j, "td.nm-N"], [k, "td.nm-E"], [l, "td.nm-S"], [m, "td.nm-W"]]);
    a.LayerPicker = c(Object, {
        constructor: function(a, b, c, d, e) {
            this.auth = a,
            this.map = b,
            this.gMap = b.tmpGoogleMapViewController.gMap,
            this.surveysController = c,
            this.overlays = d,
            this.container = p(e),
            this.streetsUiState = null ,
            this.propertiesUiState = null ,
            this.observe(c, d),
            this.buildUI()
        },
        observe: function() {
            for (var a = 0, b = arguments.length; b > a; a++) {
                var c = arguments[a];
                c.addListener(h, e(this, this.update))
            }
        },
        buildUI: function() {
            var a = p('<div class="layer-picker">   <div class="map-types">       <button class="btn-photo">PhotoMaps</button>       <button class="btn-oblique">MultiView</button>       <button class="btn-terrain">Terrain</button>       <button class="btn-streetmap">Roadmap</button>   </div>   <div class="overlays">       <label>           Street Maps           <input class="btn-street" type="checkbox">       </label>       <label>           Properties          <input class="btn-properties" type="checkbox">       </label>   </div>   <div class="nm-mv" style="float:right;margin:20px">       <table>           <tr>               <td colspan="2" class="nm-N">                   <span class="btn-N">N</span>               </td>           </tr>           <tr>               <td class="nm-W">                   <span class="btn-W">W</span>                   <span class="btn-V nm-O"                        title="Return to PhotoMaps"></span>               </td>               <td class="nm-E">                   <span class="btn-E">E</span>               </td>           </tr>           <tr>               <td colspan="2" class="nm-S">                   <span class="btn-S">S</span>               </td>           </tr>       </table>   </div></div>');
            this.ui = a,
            this.container.append(a),
            this.setupUIListeners(),
            this.update()
        },
        setupUIListeners: function() {
            var a = this.surveysController
              , b = e(a, a.setMapType)
              , c = this.overlays
              , d = this.ui;
            d.find(".btn-photo").click(f(b, i)),
            d.find(".btn-terrain").click(f(b, n)),
            d.find(".btn-streetmap").click(f(b, o)),
            d.find(".btn-oblique").click(f(b, j)),
            d.find(".btn-V").click(f(b, i)),
            d.find(".btn-N").click(f(b, j)),
            d.find(".btn-E").click(f(b, k)),
            d.find(".btn-S").click(f(b, l)),
            d.find(".btn-W").click(f(b, m)),
            d.find("button").click(function(a) {
                p(a.target).blur()
            }),
            d.find(".btn-street").click(function(a) {
                c.setStreetsVisible(p(a.target).prop("checked"))
            }),
            d.find(".btn-properties").click(function(a) {
                c.setPropertiesVisible(p(a.target).prop("checked"))
            }),
            this.setupStreetViewListener()
        },
        setupStreetViewListener: function() {
            var a = this.gMap;
            a.getStreetView().addListener("visible_changed", e(this, this.update))
        },
        update: function() {
            var a = this.surveysController
              , b = this.ui
              , c = this.gMap.getStreetView().getVisible();
            c ? b.hide() : b.show();
            var d = a.getMapType()
              , e = this.overlays
              , f = !1
              , g = !1;
            switch (b.find("button, td").removeClass("active"),
            d) {
            case j:
            case k:
            case l:
            case m:
                f = !0,
                b.find(".btn-oblique").addClass("active"),
                b.find(q.get(d)).addClass("active");
                break;
            case i:
                g = !0,
                b.find(".btn-photo").addClass("active");
                break;
            case n:
                b.find(".btn-terrain").addClass("active"),
                g = !0;
                break;
            case o:
                b.find(".btn-streetmap").addClass("active")
            }
            f ? b.find(".nm-mv").show() : b.find(".nm-mv").hide(),
            g ? (b.find(".overlays").show(),
            null  !== this.streetsUiState && (e.setStreetsVisible(this.streetsUiState),
            this.streetsUiState = null ),
            null  !== this.propertiesUiState && (e.setPropertiesVisible(this.propertiesUiState),
            this.propertiesUiState = null )) : (b.find(".overlays").hide(),
            e.setStreetsVisible(!1),
            e.setPropertiesVisible(!1),
            this.streetsUiState = p(".btn-street").prop("checked"),
            this.propertiesUiState = p(".btn-properties").prop("checked"));
            var h = this.map.getZoom() > 14
              , r = a.getAvailableDates(j).length;
            h = h && r > 0,
            h ? (b.find(".btn-oblique").removeAttr("disabled"),
            b.find("td.nm-N, td.nm-E, td.nm-S, td.nm-W").removeClass("disabled")) : (b.find(".btn-oblique").attr("disabled", "disabled"),
            b.find("td.nm-N, td.nm-E, td.nm-S, td.nm-W").addClass("disabled")),
            b.find(".btn-street").prop("checked", this.streetsUiState || e.getStreetsVisible()),
            b.find(".btn-properties").prop("checked", this.propertiesUiState || e.getPropertiesVisible())
        }
    })
}),
nm_module("nm/cookie", function(a, b, c, d) {
    var e = b("jscore/objtools", "merge")
      , f = b("nm/const", "MAP_STATE_COOKIE")
      , g = 604800
      , h = {
        expireSeconds: g,
        values: "",
        separator: "|"
    }
      , i = a.Cookie = c(Object, {
        constructor: function(a, b) {
            b = e(b, h),
            this._pairs = {},
            this._name = a,
            this._expiry = null ,
            this._expireSeconds = b.expireSeconds,
            this._domain = null ,
            this._separator = b.separator,
            this._values = b.values,
            this._values && this._parseValues(this._values)
        },
        _parseKeyValues: function() {
            var a, b = "", c = this._pairs;
            for (a in c)
                c.hasOwnProperty(a) && (b = (b ? b + this._separator : "") + a + "=" + c[a]);
            return b
        },
        _parseValues: function(a) {
            var b, c, d = a.split(this._separator);
            for (c = d.length; c--; )
                b = d[c].split("="),
                b.length >= 2 && (this._pairs[b[0]] = b[1])
        },
        _formatCookie: function() {
            var a = "; expires=" + this._expiry.toGMTString()
              , b = this._domain ? "; domain=" + this._domain : "";
            return this._name + "=" + (this._parseKeyValues() || this.getContent() || "") + a + b + "; path=/"
        },
        setValue: function(a, b) {
            this._pairs[a] = b
        },
        removeValue: function(a) {
            delete this._pairs[a]
        },
        getValue: function(a) {
            return this._pairs[a]
        },
        getContent: function() {
            return this._values || null 
        },
        getExpiry: function() {
            return this._expiry
        },
        setExpiry: function(a) {
            this._expiry = a
        },
        setDomain: function(a) {
            this._domain = a
        },
        remove: function() {
            this._expiry = new Date(0),
            document.cookie = this._formatCookie()
        },
        save: function(a) {
            this._expiry || (this._expiry = new Date),
            this._expiry.setTime(this._expiry.getTime() + (a ? 0 : 1e3 * this._expireSeconds)),
            document.cookie = this._formatCookie()
        }
    })
      , j = a.getCookie = function(a, b) {
        var c, d, e, f;
        if (document.cookie.length)
            for (c = a + "=",
            d = document.cookie.split(";"),
            f = 0; f < d.length; f++) {
                for (e = d[f]; " " === e.charAt(0); )
                    e = e.substring(1, e.length);
                if (0 === e.indexOf(c))
                    return new i(a,{
                        values: e.substring(c.length, e.length),
                        expireSeconds: b
                    });
                if (new RegExp(a + "$").test(e))
                    return new i(a,{
                        expireSeconds: b
                    })
            }
        return null 
    }
      , k = a.getOrCreateCookie = function(a, b) {
        var c = j(a, b);
        return null  === c && (c = new i(a,{
            expireSeconds: b
        })),
        c
    }
    ;
    a.cookiesEnabled = function() {
        var a, b = "NEARMAPCOOKIESENABLED", c = new i(b);
        return c.save(),
        a = !!j(b),
        c.setExpiry(new Date(0)),
        c.save(),
        a
    }
    ,
    a.MapState = k(f)
}),
nm_module("js-libs/i18next", function(a, b, c, d) {
    function e(a, b) {
        if (!b || "function" == typeof b)
            return a;
        for (var c in b)
            a[c] = b[c];
        return a
    }
    function f(a, b, c) {
        var d, e = 0, f = a.length, g = void 0 === f || "[object Array]" !== Object.prototype.toString.apply(a) || "function" == typeof a;
        if (c)
            if (g) {
                for (d in a)
                    if (b.apply(a[d], c) === !1)
                        break
            } else
                for (; f > e && b.apply(a[e++], c) !== !1; )
                    ;
        else if (g) {
            for (d in a)
                if (b.call(a[d], d, a[d]) === !1)
                    break
        } else
            for (; f > e && b.call(a[e], e, a[e++]) !== !1; )
                ;
        return a
    }
    function g(a) {
        return "string" == typeof a ? a.replace(/[&<>"'\/]/g, function(a) {
            return L[a]
        }) : a
    }
    function h(a) {
        var b = function(a) {
            if (window.XMLHttpRequest)
                return a(null , new XMLHttpRequest);
            if (window.ActiveXObject)
                try {
                    return a(null , new ActiveXObject("Msxml2.XMLHTTP"))
                } catch (b) {
                    return a(null , new ActiveXObject("Microsoft.XMLHTTP"))
                }
            return a(new Error)
        }
          , c = function(a) {
            if ("string" == typeof a)
                return a;
            var b = [];
            for (var c in a)
                a.hasOwnProperty(c) && b.push(encodeURIComponent(c) + "=" + encodeURIComponent(a[c]));
            return b.join("&")
        }
          , d = function(a) {
            a = a.replace(/\r\n/g, "\n");
            for (var b = "", c = 0; c < a.length; c++) {
                var d = a.charCodeAt(c);
                128 > d ? b += String.fromCharCode(d) : d > 127 && 2048 > d ? (b += String.fromCharCode(d >> 6 | 192),
                b += String.fromCharCode(63 & d | 128)) : (b += String.fromCharCode(d >> 12 | 224),
                b += String.fromCharCode(d >> 6 & 63 | 128),
                b += String.fromCharCode(63 & d | 128))
            }
            return b
        }
          , e = function(a) {
            var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
            a = d(a);
            var c, e, f, g, h, i, j, k = "", l = 0;
            do
                c = a.charCodeAt(l++),
                e = a.charCodeAt(l++),
                f = a.charCodeAt(l++),
                g = c >> 2,
                h = (3 & c) << 4 | e >> 4,
                i = (15 & e) << 2 | f >> 6,
                j = 63 & f,
                isNaN(e) ? i = j = 64 : isNaN(f) && (j = 64),
                k += b.charAt(g) + b.charAt(h) + b.charAt(i) + b.charAt(j),
                c = e = f = "",
                g = h = i = j = "";
            while (l < a.length);return k
        }
          , f = function() {
            for (var a = arguments[0], b = 1; b < arguments.length; b++) {
                var c = arguments[b];
                for (var d in c)
                    c.hasOwnProperty(d) && (a[d] = c[d])
            }
            return a
        }
          , g = function(a, d, e, h) {
            "function" == typeof e && (h = e,
            e = {}),
            e.cache = e.cache || !1,
            e.data = e.data || {},
            e.headers = e.headers || {},
            e.jsonp = e.jsonp || !1,
            e.async = void 0 === e.async ? !0 : e.async;
            var i, j = f({
                accept: "*/*",
                "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
            }, g.headers, e.headers);
            if (i = "application/json" === j["content-type"] ? JSON.stringify(e.data) : c(e.data),
            "GET" === a) {
                var k = [];
                if (i && (k.push(i),
                i = null ),
                e.cache || k.push("_=" + (new Date).getTime()),
                e.jsonp && (k.push("callback=" + e.jsonp),
                k.push("jsonp=" + e.jsonp)),
                k = k.join("&"),
                k.length > 1 && (d += d.indexOf("?") > -1 ? "&" + k : "?" + k),
                e.jsonp) {
                    var l = document.getElementsByTagName("head")[0]
                      , m = document.createElement("script");
                    return m.type = "text/javascript",
                    m.src = d,
                    void l.appendChild(m)
                }
            }
            b(function(b, c) {
                if (b)
                    return h(b);
                c.open(a, d, e.async);
                for (var f in j)
                    j.hasOwnProperty(f) && c.setRequestHeader(f, j[f]);
                c.onreadystatechange = function() {
                    if (4 === c.readyState) {
                        var a = c.responseText || "";
                        if (!h)
                            return;
                        h(c.status, {
                            text: function() {
                                return a
                            },
                            json: function() {
                                return JSON.parse(a)
                            }
                        })
                    }
                }
                ,
                c.send(i)
            })
        }
          , h = {
            authBasic: function(a, b) {
                g.headers.Authorization = "Basic " + e(a + ":" + b)
            },
            connect: function(a, b, c) {
                return g("CONNECT", a, b, c)
            },
            del: function(a, b, c) {
                return g("DELETE", a, b, c)
            },
            get: function(a, b, c) {
                return g("GET", a, b, c)
            },
            head: function(a, b, c) {
                return g("HEAD", a, b, c)
            },
            headers: function(a) {
                g.headers = a || {}
            },
            isAllowed: function(a, b, c) {
                this.options(a, function(a, d) {
                    c(-1 !== d.text().indexOf(b))
                })
            },
            options: function(a, b, c) {
                return g("OPTIONS", a, b, c)
            },
            patch: function(a, b, c) {
                return g("PATCH", a, b, c)
            },
            post: function(a, b, c) {
                return g("POST", a, b, c)
            },
            put: function(a, b, c) {
                return g("PUT", a, b, c)
            },
            trace: function(a, b, c) {
                return g("TRACE", a, b, c)
            }
        }
          , i = a.type ? a.type.toLowerCase() : "get";
        h[i](a.url, a, function(b, c) {
            200 === b ? a.success(c.json(), b, null ) : a.error(c.text(), b, null )
        })
    }
    function i(a, b) {
        "function" == typeof a && (b = a,
        a = {}),
        a = a || {},
        O.extend(K, a),
        delete K.fixLng,
        "string" == typeof K.ns && (K.ns = {
            namespaces: [K.ns],
            defaultNs: K.ns
        }),
        "string" == typeof K.fallbackNS && (K.fallbackNS = [K.fallbackNS]),
        "string" != typeof K.fallbackLng && "boolean" != typeof K.fallbackLng || (K.fallbackLng = [K.fallbackLng]),
        K.interpolationPrefixEscaped = O.regexEscape(K.interpolationPrefix),
        K.interpolationSuffixEscaped = O.regexEscape(K.interpolationSuffix),
        K.lng || (K.lng = O.detectLanguage()),
        K.lng ? K.useCookie && O.cookie.create(K.cookieName, K.lng, K.cookieExpirationTime, K.cookieDomain) : (K.lng = K.fallbackLng[0],
        K.useCookie && O.cookie.remove(K.cookieName)),
        I = O.toLanguages(K.lng),
        D = I[0],
        O.log("currentLng set to: " + D);
        var c = x;
        a.fixLng && (c = function(a, b) {
            return b = b || {},
            b.lng = b.lng || c.lng,
            x(a, b)
        }
        ,
        c.lng = D),
        Q.setCurrentLng(D),
        E && K.setJqueryExt && r();
        var d;
        if (E && E.Deferred && (d = E.Deferred()),
        !K.resStore) {
            var e = O.toLanguages(K.lng);
            "string" == typeof K.preload && (K.preload = [K.preload]);
            for (var f = 0, g = K.preload.length; g > f; f++)
                for (var h = O.toLanguages(K.preload[f]), i = 0, j = h.length; j > i; i++)
                    e.indexOf(h[i]) < 0 && e.push(h[i]);
            return F.sync.load(e, K, function(a, e) {
                G = e,
                J = !0,
                b && b(c),
                d && d.resolve(c)
            }),
            d ? d.promise() : void 0
        }
        return G = K.resStore,
        J = !0,
        b && b(c),
        d && d.resolve(c),
        d ? d.promise() : void 0
    }
    function j(a, b) {
        "string" == typeof a && (a = [a]);
        for (var c = 0, d = a.length; d > c; c++)
            K.preload.indexOf(a[c]) < 0 && K.preload.push(a[c]);
        return i(b)
    }
    function k(a, b, c) {
        "string" != typeof b ? (c = b,
        b = K.ns.defaultNs) : K.ns.namespaces.indexOf(b) < 0 && K.ns.namespaces.push(b),
        G[a] = G[a] || {},
        G[a][b] = G[a][b] || {},
        O.extend(G[a][b], c)
    }
    function l(a, b) {
        "string" != typeof b && (b = K.ns.defaultNs),
        G[a] = G[a] || {},
        G[a][b] = {}
    }
    function m(a) {
        K.ns.defaultNs = a
    }
    function n(a, b) {
        o([a], b)
    }
    function o(a, b) {
        var c = {
            dynamicLoad: K.dynamicLoad,
            resGetPath: K.resGetPath,
            getAsync: K.getAsync,
            customLoad: K.customLoad,
            ns: {
                namespaces: a,
                defaultNs: ""
            }
        }
          , d = O.toLanguages(K.lng);
        "string" == typeof K.preload && (K.preload = [K.preload]);
        for (var e = 0, f = K.preload.length; f > e; e++)
            for (var g = O.toLanguages(K.preload[e]), h = 0, i = g.length; i > h; h++)
                d.indexOf(g[h]) < 0 && d.push(g[h]);
        for (var j = [], k = 0, l = d.length; l > k; k++) {
            var m = !1
              , n = G[d[k]];
            if (n)
                for (var o = 0, p = a.length; p > o; o++)
                    n[a[o]] || (m = !0);
            else
                m = !0;
            m && j.push(d[k])
        }
        j.length ? F.sync._fetch(j, c, function(c, d) {
            var e = a.length * j.length;
            O.each(a, function(a, c) {
                K.ns.namespaces.indexOf(c) < 0 && K.ns.namespaces.push(c),
                O.each(j, function(a, f) {
                    G[f] = G[f] || {},
                    G[f][c] = d[f][c],
                    e--,
                    0 === e && b && (K.useLocalStorage && F.sync._storeLocal(G),
                    b())
                })
            })
        }) : b && b()
    }
    function p(a, b, c) {
        return "function" == typeof b ? (c = b,
        b = {}) : b || (b = {}),
        b.lng = a,
        i(b, c)
    }
    function q() {
        return D
    }
    function r() {
        function a(a, b, c) {
            if (0 !== b.length) {
                var d = "text";
                if (0 === b.indexOf("[")) {
                    var e = b.split("]");
                    b = e[1],
                    d = e[0].substr(1, e[0].length - 1)
                }
                b.indexOf(";") === b.length - 1 && (b = b.substr(0, b.length - 2));
                var f;
                if ("html" === d)
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.html()
                    }, c) : c,
                    a.html(E.t(b, f));
                else if ("text" === d)
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.text()
                    }, c) : c,
                    a.text(E.t(b, f));
                else if ("prepend" === d)
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.html()
                    }, c) : c,
                    a.prepend(E.t(b, f));
                else if ("append" === d)
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.html()
                    }, c) : c,
                    a.append(E.t(b, f));
                else if (0 === d.indexOf("data-")) {
                    var g = d.substr("data-".length);
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.data(g)
                    }, c) : c;
                    var h = E.t(b, f);
                    a.data(g, h),
                    a.attr(d, h)
                } else
                    f = K.defaultValueFromContent ? E.extend({
                        defaultValue: a.attr(d)
                    }, c) : c,
                    a.attr(d, E.t(b, f))
            }
        }
        function b(b, c) {
            var d = b.attr(K.selectorAttr);
            if (d || "undefined" == typeof d || d === !1 || (d = b.text() || b.val()),
            d) {
                var e = b
                  , f = b.data("i18n-target");
                if (f && (e = b.find(f) || b),
                c || K.useDataAttrOptions !== !0 || (c = b.data("i18n-options")),
                c = c || {},
                d.indexOf(";") >= 0) {
                    var g = d.split(";");
                    E.each(g, function(b, d) {
                        "" !== d && a(e, d, c)
                    })
                } else
                    a(e, d, c);
                K.useDataAttrOptions === !0 && b.data("i18n-options", c)
            }
        }
        E.t = E.t || x,
        E.fn.i18n = function(a) {
            return this.each(function() {
                b(E(this), a);
                var c = E(this).find("[" + K.selectorAttr + "]");
                c.each(function() {
                    b(E(this), a)
                })
            })
        }
    }
    function s(a, b, c, d) {
        if (!a)
            return a;
        if (d = d || b,
        a.indexOf(d.interpolationPrefix || K.interpolationPrefix) < 0)
            return a;
        var e = d.interpolationPrefix ? O.regexEscape(d.interpolationPrefix) : K.interpolationPrefixEscaped
          , f = d.interpolationSuffix ? O.regexEscape(d.interpolationSuffix) : K.interpolationSuffixEscaped
          , g = "HTML" + f;
        return O.each(b, function(b, h) {
            var i = c ? c + K.keyseparator + b : b;
            "object" == typeof h && null  !== h ? a = s(a, h, i, d) : d.escapeInterpolation || K.escapeInterpolation ? (a = a.replace(new RegExp([e, i, g].join(""),"g"), h),
            a = a.replace(new RegExp([e, i, f].join(""),"g"), O.escape(h))) : a = a.replace(new RegExp([e, i, f].join(""),"g"), h)
        }),
        a
    }
    function t(a, b) {
        var c = ","
          , d = "{"
          , e = "}"
          , f = O.extend({}, b);
        for (delete f.postProcess; -1 != a.indexOf(K.reusePrefix) && (H++,
        !(H > K.maxRecursion)); ) {
            var g = a.lastIndexOf(K.reusePrefix)
              , h = a.indexOf(K.reuseSuffix, g) + K.reuseSuffix.length
              , i = a.substring(g, h)
              , j = i.replace(K.reusePrefix, "").replace(K.reuseSuffix, "");
            if (-1 != j.indexOf(c)) {
                var k = j.indexOf(c);
                if (-1 != j.indexOf(d, k) && -1 != j.indexOf(e, k)) {
                    var l = j.indexOf(d, k)
                      , m = j.indexOf(e, l) + e.length;
                    try {
                        f = O.extend(f, JSON.parse(j.substring(l, m))),
                        j = j.substring(0, k)
                    } catch (n) {}
                }
            }
            var o = A(j, f);
            a = a.replace(i, o)
        }
        return a
    }
    function u(a) {
        return a.context && ("string" == typeof a.context || "number" == typeof a.context)
    }
    function v(a) {
        return void 0 !== a.count && "string" != typeof a.count && 1 !== a.count
    }
    function w(a, b) {
        b = b || {};
        var c = y(a, b)
          , d = B(a, b);
        return void 0 !== d || d === c
    }
    function x(a, b) {
        return b = b || {},
        J ? (H = 0,
        A.apply(null , arguments)) : (O.log("i18next not finished initialization. you might have called t function before loading resources finished."),
        b.defaultValue || "")
    }
    function y(a, b) {
        return void 0 !== b.defaultValue ? b.defaultValue : a
    }
    function z() {
        for (var a = [], b = 1; b < arguments.length; b++)
            a.push(arguments[b]);
        return {
            postProcess: "sprintf",
            sprintf: a
        }
    }
    function A(a, b) {
        if (b && "object" != typeof b ? "sprintf" === K.shortcutFunction ? b = z.apply(null , arguments) : "defaultValue" === K.shortcutFunction && (b = {
            defaultValue: b
        }) : b = b || {},
        void 0 === a || null  === a)
            return "";
        "string" == typeof a && (a = [a]);
        var c = a[0];
        if (a.length > 1)
            for (var d = 0; d < a.length && (c = a[d],
            !w(c, b)); d++)
                ;
        var e, f = y(c, b), g = B(c, b), h = b.lng ? O.toLanguages(b.lng) : I, i = b.ns || K.ns.defaultNs;
        c.indexOf(K.nsseparator) > -1 && (e = c.split(K.nsseparator),
        i = e[0],
        c = e[1]),
        void 0 === g && K.sendMissing && (b.lng ? P.postMissing(h[0], i, c, f, h) : P.postMissing(K.lng, i, c, f, h));
        var j = b.postProcess || K.postProcess;
        void 0 !== g && j && R[j] && (g = R[j](g, c, b));
        var k = f;
        if (f.indexOf(K.nsseparator) > -1 && (e = f.split(K.nsseparator),
        k = e[1]),
        k === c && K.parseMissingKey && (f = K.parseMissingKey(f)),
        void 0 === g && (f = s(f, b),
        f = t(f, b),
        j && R[j])) {
            var l = y(c, b);
            g = R[j](l, c, b)
        }
        return void 0 !== g ? g : f
    }
    function B(a, b) {
        b = b || {};
        var c, d, e = y(a, b), f = I;
        if (!G)
            return e;
        if ("cimode" === f[0].toLowerCase())
            return e;
        if (b.lng && (f = O.toLanguages(b.lng),
        !G[f[0]])) {
            var g = K.getAsync;
            K.getAsync = !1,
            F.sync.load(f, K, function(a, b) {
                O.extend(G, b),
                K.getAsync = g
            })
        }
        var h = b.ns || K.ns.defaultNs;
        if (a.indexOf(K.nsseparator) > -1) {
            var i = a.split(K.nsseparator);
            h = i[0],
            a = i[1]
        }
        if (u(b)) {
            c = O.extend({}, b),
            delete c.context,
            c.defaultValue = K.contextNotFound;
            var j = h + K.nsseparator + a + "_" + b.context;
            if (d = x(j, c),
            d != K.contextNotFound)
                return s(d, {
                    context: b.context
                })
        }
        if (v(b)) {
            c = O.extend({}, b),
            delete c.count,
            c.defaultValue = K.pluralNotFound;
            var k = h + K.nsseparator + a + K.pluralSuffix
              , l = Q.get(f[0], b.count);
            if (l >= 0 ? k = k + "_" + l : 1 === l && (k = h + K.nsseparator + a),
            d = x(k, c),
            d != K.pluralNotFound)
                return s(d, {
                    count: b.count,
                    interpolationPrefix: b.interpolationPrefix,
                    interpolationSuffix: b.interpolationSuffix
                })
        }
        for (var m, n = a.split(K.keyseparator), o = 0, p = f.length; p > o && void 0 === m; o++) {
            for (var q = f[o], r = 0, w = G[q] && G[q][h]; n[r]; )
                w = w && w[n[r]],
                r++;
            if (void 0 !== w) {
                var z = Object.prototype.toString.apply(w);
                if ("string" == typeof w)
                    w = s(w, b),
                    w = t(w, b);
                else if ("[object Array]" !== z || K.returnObjectTrees || b.returnObjectTrees) {
                    if (null  === w && K.fallbackOnNull === !0)
                        w = void 0;
                    else if (null  !== w)
                        if (K.returnObjectTrees || b.returnObjectTrees) {
                            if ("[object Number]" !== z && "[object Function]" !== z && "[object RegExp]" !== z) {
                                var C = "[object Array]" === z ? [] : {};
                                O.each(w, function(c) {
                                    C[c] = A(h + K.nsseparator + a + K.keyseparator + c, b)
                                }),
                                w = C
                            }
                        } else
                            K.objectTreeKeyHandler && "function" == typeof K.objectTreeKeyHandler ? w = K.objectTreeKeyHandler(a, w, q, h, b) : (w = "key '" + h + ":" + a + " (" + q + ")' returned an object instead of string.",
                            O.log(w))
                } else
                    w = w.join("\n"),
                    w = s(w, b),
                    w = t(w, b);
                "string" == typeof w && "" === w.trim() && K.fallbackOnEmpty === !0 && (w = void 0),
                m = w
            }
        }
        if (void 0 === m && !b.isFallbackLookup && (K.fallbackToDefaultNS === !0 || K.fallbackNS && K.fallbackNS.length > 0))
            if (b.isFallbackLookup = !0,
            K.fallbackNS.length) {
                for (var D = 0, E = K.fallbackNS.length; E > D; D++)
                    if (m = B(K.fallbackNS[D] + K.nsseparator + a, b)) {
                        var H = m.indexOf(K.nsseparator) > -1 ? m.split(K.nsseparator)[1] : m
                          , J = e.indexOf(K.nsseparator) > -1 ? e.split(K.nsseparator)[1] : e;
                        if (H !== J)
                            break
                    }
            } else
                m = B(a, b);
        return m
    }
    function C() {
        var a, b = [];
        if ("undefined" != typeof window && (!function() {
            for (var a = window.location.search.substring(1), c = a.split("&"), d = 0; d < c.length; d++) {
                var e = c[d].indexOf("=");
                if (e > 0) {
                    var f = c[d].substring(0, e)
                      , g = c[d].substring(e + 1);
                    b[f] = g
                }
            }
        }(),
        b[K.detectLngQS] && (a = b[K.detectLngQS])),
        !a && "undefined" != typeof document && K.useCookie) {
            var c = O.cookie.read(K.cookieName);
            c && (a = c)
        }
        return a || "undefined" == typeof navigator || (a = navigator.language ? navigator.language : navigator.userLanguage),
        a
    }
    var D, E = b("./jquery", "jQuery"), F = {}, G = {}, H = 0, I = [], J = !1, K = {
        lng: void 0,
        load: "all",
        preload: [],
        lowerCaseLng: !1,
        returnObjectTrees: !1,
        fallbackLng: ["dev"],
        fallbackNS: [],
        detectLngQS: "setLng",
        ns: "translation",
        fallbackOnNull: !0,
        fallbackOnEmpty: !1,
        fallbackToDefaultNS: !1,
        nsseparator: ":",
        keyseparator: ".",
        selectorAttr: "data-i18n",
        debug: !1,
        resGetPath: "locales/__lng__/__ns__.json",
        resPostPath: "locales/add/__lng__/__ns__",
        getAsync: !0,
        postAsync: !0,
        resStore: void 0,
        useLocalStorage: !1,
        localStorageExpirationTime: 6048e5,
        dynamicLoad: !1,
        sendMissing: !1,
        sendMissingTo: "fallback",
        sendType: "POST",
        interpolationPrefix: "__",
        interpolationSuffix: "__",
        reusePrefix: "$t(",
        reuseSuffix: ")",
        pluralSuffix: "_plural",
        pluralNotFound: ["plural_not_found", Math.random()].join(""),
        contextNotFound: ["context_not_found", Math.random()].join(""),
        escapeInterpolation: !1,
        setJqueryExt: !0,
        defaultValueFromContent: !0,
        useDataAttrOptions: !1,
        cookieExpirationTime: void 0,
        useCookie: !0,
        cookieName: "i18next",
        cookieDomain: void 0,
        objectTreeKeyHandler: void 0,
        postProcess: void 0,
        parseMissingKey: void 0,
        shortcutFunction: "sprintf"
    }, L = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;",
        "/": "&#x2F;"
    }, M = {
        create: function(a, b, c, d) {
            var e;
            if (c) {
                var f = new Date;
                f.setTime(f.getTime() + 60 * c * 1e3),
                e = "; expires=" + f.toGMTString()
            } else
                e = "";
            d = d ? "domain=" + d + ";" : "",
            document.cookie = a + "=" + b + e + ";" + d + "path=/"
        },
        read: function(a) {
            for (var b = a + "=", c = document.cookie.split(";"), d = 0; d < c.length; d++) {
                for (var e = c[d]; " " == e.charAt(0); )
                    e = e.substring(1, e.length);
                if (0 === e.indexOf(b))
                    return e.substring(b.length, e.length)
            }
            return null 
        },
        remove: function(a) {
            this.create(a, "", -1)
        }
    }, N = {
        create: function(a, b, c, d) {},
        read: function(a) {
            return null 
        },
        remove: function(a) {}
    }, O = {
        extend: E ? E.extend : e,
        each: E ? E.each : f,
        ajax: E ? E.ajax : "undefined" != typeof document ? h : function() {}
        ,
        cookie: "undefined" != typeof document ? M : N,
        detectLanguage: C,
        escape: g,
        log: function(a) {
            K.debug && "undefined" != typeof console && console.log(a)
        },
        toLanguages: function(a) {
            var b = [];
            if ("string" == typeof a && a.indexOf("-") > -1) {
                var c = a.split("-");
                a = K.lowerCaseLng ? c[0].toLowerCase() + "-" + c[1].toLowerCase() : c[0].toLowerCase() + "-" + c[1].toUpperCase(),
                "unspecific" !== K.load && b.push(a),
                "current" !== K.load && b.push(c[0])
            } else
                b.push(a);
            for (var d = 0; d < K.fallbackLng.length; d++)
                -1 === b.indexOf(K.fallbackLng[d]) && K.fallbackLng[d] && b.push(K.fallbackLng[d]);
            return b
        },
        regexEscape: function(a) {
            return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
        }
    };
    O.applyReplacement = s;
    var P = {
        load: function(a, b, c) {
            b.useLocalStorage ? P._loadLocal(a, b, function(d, e) {
                for (var f = [], g = 0, h = a.length; h > g; g++)
                    e[a[g]] || f.push(a[g]);
                f.length > 0 ? P._fetch(f, b, function(a, b) {
                    O.extend(e, b),
                    P._storeLocal(b),
                    c(null , e)
                }) : c(null , e)
            }) : P._fetch(a, b, function(a, b) {
                c(null , b)
            })
        },
        _loadLocal: function(a, b, c) {
            var d = {}
              , e = (new Date).getTime();
            if (window.localStorage) {
                var f = a.length;
                O.each(a, function(a, g) {
                    var h = window.localStorage.getItem("res_" + g);
                    h && (h = JSON.parse(h),
                    h.i18nStamp && h.i18nStamp + b.localStorageExpirationTime > e && (d[g] = h)),
                    f--,
                    0 === f && c(null , d)
                })
            }
        },
        _storeLocal: function(a) {
            if (window.localStorage)
                for (var b in a)
                    a[b].i18nStamp = (new Date).getTime(),
                    window.localStorage.setItem("res_" + b, JSON.stringify(a[b]))
        },
        _fetch: function(a, b, c) {
            var d = b.ns
              , e = {};
            if (b.dynamicLoad) {
                var f = function(a, b) {
                    c(null , b)
                }
                ;
                if ("function" == typeof b.customLoad)
                    b.customLoad(a, d.namespaces, b, f);
                else {
                    var g = s(b.resGetPath, {
                        lng: a.join("+"),
                        ns: d.namespaces.join("+")
                    });
                    O.ajax({
                        url: g,
                        success: function(a, b, c) {
                            O.log("loaded: " + g),
                            f(null , a)
                        },
                        error: function(a, b, c) {
                            O.log("failed loading: " + g),
                            f("failed loading resource.json error: " + c)
                        },
                        dataType: "json",
                        async: b.getAsync
                    })
                }
            } else {
                var h, i = d.namespaces.length * a.length;
                O.each(d.namespaces, function(d, f) {
                    O.each(a, function(a, d) {
                        var g = function(a, b) {
                            a && (h = h || [],
                            h.push(a)),
                            e[d] = e[d] || {},
                            e[d][f] = b,
                            i--,
                            0 === i && c(h, e)
                        }
                        ;
                        "function" == typeof b.customLoad ? b.customLoad(d, f, b, g) : P._fetchOne(d, f, b, g)
                    })
                })
            }
        },
        _fetchOne: function(a, b, c, d) {
            var e = s(c.resGetPath, {
                lng: a,
                ns: b
            });
            O.ajax({
                url: e,
                success: function(a, b, c) {
                    O.log("loaded: " + e),
                    d(null , a)
                },
                error: function(a, b, c) {
                    if (b && 200 == b || a && a.status && 200 == a.status)
                        O.log("There is a typo in: " + e);
                    else if (b && 404 == b || a && a.status && 404 == a.status)
                        O.log("Does not exist: " + e);
                    else {
                        var f = b ? b : a && a.status ? a.status : null ;
                        O.log(f + " when loading " + e)
                    }
                    d(c, {})
                },
                dataType: "json",
                async: c.getAsync
            })
        },
        postMissing: function(a, b, c, d, e) {
            var f = {};
            f[c] = d;
            var g = [];
            if ("fallback" === K.sendMissingTo && K.fallbackLng[0] !== !1)
                for (var h = 0; h < K.fallbackLng.length; h++)
                    g.push({
                        lng: K.fallbackLng[h],
                        url: s(K.resPostPath, {
                            lng: K.fallbackLng[h],
                            ns: b
                        })
                    });
            else if ("current" === K.sendMissingTo || "fallback" === K.sendMissingTo && K.fallbackLng[0] === !1)
                g.push({
                    lng: a,
                    url: s(K.resPostPath, {
                        lng: a,
                        ns: b
                    })
                });
            else if ("all" === K.sendMissingTo)
                for (var h = 0, i = e.length; i > h; h++)
                    g.push({
                        lng: e[h],
                        url: s(K.resPostPath, {
                            lng: e[h],
                            ns: b
                        })
                    });
            for (var j = 0, k = g.length; k > j; j++) {
                var l = g[j];
                O.ajax({
                    url: l.url,
                    type: K.sendType,
                    data: f,
                    success: function(a, e, f) {
                        O.log("posted missing key '" + c + "' to: " + l.url);
                        for (var g = c.split("."), h = 0, i = G[l.lng][b]; g[h]; )
                            i = h === g.length - 1 ? i[g[h]] = d : i[g[h]] = i[g[h]] || {},
                            h++
                    },
                    error: function(a, b, d) {
                        O.log("failed posting missing key '" + c + "' to: " + l.url)
                    },
                    dataType: "json",
                    async: K.postAsync
                })
            }
        }
    }
      , Q = {
        rules: {
            ach: {
                name: "Acholi",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            af: {
                name: "Afrikaans",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ak: {
                name: "Akan",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            am: {
                name: "Amharic",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            an: {
                name: "Aragonese",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ar: {
                name: "Arabic",
                numbers: [0, 1, 2, 3, 11, 100],
                plurals: function(a) {
                    return Number(0 === a ? 0 : 1 == a ? 1 : 2 == a ? 2 : a % 100 >= 3 && 10 >= a % 100 ? 3 : a % 100 >= 11 ? 4 : 5)
                }
            },
            arn: {
                name: "Mapudungun",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            ast: {
                name: "Asturian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ay: {
                name: "Aymará",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            az: {
                name: "Azerbaijani",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            be: {
                name: "Belarusian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            bg: {
                name: "Bulgarian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            bn: {
                name: "Bengali",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            bo: {
                name: "Tibetan",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            br: {
                name: "Breton",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            bs: {
                name: "Bosnian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            ca: {
                name: "Catalan",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            cgg: {
                name: "Chiga",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            cs: {
                name: "Czech",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(1 == a ? 0 : a >= 2 && 4 >= a ? 1 : 2)
                }
            },
            csb: {
                name: "Kashubian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(1 == a ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            cy: {
                name: "Welsh",
                numbers: [1, 2, 3, 8],
                plurals: function(a) {
                    return Number(1 == a ? 0 : 2 == a ? 1 : 8 != a && 11 != a ? 2 : 3)
                }
            },
            da: {
                name: "Danish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            de: {
                name: "German",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            dz: {
                name: "Dzongkha",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            el: {
                name: "Greek",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            en: {
                name: "English",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            eo: {
                name: "Esperanto",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            es: {
                name: "Spanish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            es_ar: {
                name: "Argentinean Spanish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            et: {
                name: "Estonian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            eu: {
                name: "Basque",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            fa: {
                name: "Persian",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            fi: {
                name: "Finnish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            fil: {
                name: "Filipino",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            fo: {
                name: "Faroese",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            fr: {
                name: "French",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            fur: {
                name: "Friulian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            fy: {
                name: "Frisian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ga: {
                name: "Irish",
                numbers: [1, 2, 3, 7, 11],
                plurals: function(a) {
                    return Number(1 == a ? 0 : 2 == a ? 1 : 7 > a ? 2 : 11 > a ? 3 : 4)
                }
            },
            gd: {
                name: "Scottish Gaelic",
                numbers: [1, 2, 3, 20],
                plurals: function(a) {
                    return Number(1 == a || 11 == a ? 0 : 2 == a || 12 == a ? 1 : a > 2 && 20 > a ? 2 : 3)
                }
            },
            gl: {
                name: "Galician",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            gu: {
                name: "Gujarati",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            gun: {
                name: "Gun",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            ha: {
                name: "Hausa",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            he: {
                name: "Hebrew",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            hi: {
                name: "Hindi",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            hr: {
                name: "Croatian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            hu: {
                name: "Hungarian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            hy: {
                name: "Armenian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ia: {
                name: "Interlingua",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            id: {
                name: "Indonesian",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            is: {
                name: "Icelandic",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a % 10 != 1 || a % 100 == 11)
                }
            },
            it: {
                name: "Italian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ja: {
                name: "Japanese",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            jbo: {
                name: "Lojban",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            jv: {
                name: "Javanese",
                numbers: [0, 1],
                plurals: function(a) {
                    return Number(0 !== a)
                }
            },
            ka: {
                name: "Georgian",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            kk: {
                name: "Kazakh",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            km: {
                name: "Khmer",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            kn: {
                name: "Kannada",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ko: {
                name: "Korean",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            ku: {
                name: "Kurdish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            kw: {
                name: "Cornish",
                numbers: [1, 2, 3, 4],
                plurals: function(a) {
                    return Number(1 == a ? 0 : 2 == a ? 1 : 3 == a ? 2 : 3)
                }
            },
            ky: {
                name: "Kyrgyz",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            lb: {
                name: "Letzeburgesch",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ln: {
                name: "Lingala",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            lo: {
                name: "Lao",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            lt: {
                name: "Lithuanian",
                numbers: [1, 2, 10],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            lv: {
                name: "Latvian",
                numbers: [1, 2, 0],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : 0 !== a ? 1 : 2)
                }
            },
            mai: {
                name: "Maithili",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            mfe: {
                name: "Mauritian Creole",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            mg: {
                name: "Malagasy",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            mi: {
                name: "Maori",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            mk: {
                name: "Macedonian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 == a || a % 10 == 1 ? 0 : 1)
                }
            },
            ml: {
                name: "Malayalam",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            mn: {
                name: "Mongolian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            mnk: {
                name: "Mandinka",
                numbers: [0, 1, 2],
                plurals: function(a) {
                    return Number(1 == a ? 1 : 2)
                }
            },
            mr: {
                name: "Marathi",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ms: {
                name: "Malay",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            mt: {
                name: "Maltese",
                numbers: [1, 2, 11, 20],
                plurals: function(a) {
                    return Number(1 == a ? 0 : 0 === a || a % 100 > 1 && 11 > a % 100 ? 1 : a % 100 > 10 && 20 > a % 100 ? 2 : 3)
                }
            },
            nah: {
                name: "Nahuatl",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            nap: {
                name: "Neapolitan",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            nb: {
                name: "Norwegian Bokmal",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ne: {
                name: "Nepali",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            nl: {
                name: "Dutch",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            nn: {
                name: "Norwegian Nynorsk",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            no: {
                name: "Norwegian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            nso: {
                name: "Northern Sotho",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            oc: {
                name: "Occitan",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            or: {
                name: "Oriya",
                numbers: [2, 1],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            pa: {
                name: "Punjabi",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            pap: {
                name: "Papiamento",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            pl: {
                name: "Polish",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(1 == a ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            pms: {
                name: "Piemontese",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ps: {
                name: "Pashto",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            pt: {
                name: "Portuguese",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            pt_br: {
                name: "Brazilian Portuguese",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            rm: {
                name: "Romansh",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ro: {
                name: "Romanian",
                numbers: [1, 2, 20],
                plurals: function(a) {
                    return Number(1 == a ? 0 : 0 === a || a % 100 > 0 && 20 > a % 100 ? 1 : 2)
                }
            },
            ru: {
                name: "Russian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            sah: {
                name: "Yakut",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            sco: {
                name: "Scots",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            se: {
                name: "Northern Sami",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            si: {
                name: "Sinhala",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            sk: {
                name: "Slovak",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(1 == a ? 0 : a >= 2 && 4 >= a ? 1 : 2)
                }
            },
            sl: {
                name: "Slovenian",
                numbers: [5, 1, 2, 3],
                plurals: function(a) {
                    return Number(a % 100 == 1 ? 1 : a % 100 == 2 ? 2 : a % 100 == 3 || a % 100 == 4 ? 3 : 0)
                }
            },
            so: {
                name: "Somali",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            son: {
                name: "Songhay",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            sq: {
                name: "Albanian",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            sr: {
                name: "Serbian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            su: {
                name: "Sundanese",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            sv: {
                name: "Swedish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            sw: {
                name: "Swahili",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            ta: {
                name: "Tamil",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            te: {
                name: "Telugu",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            tg: {
                name: "Tajik",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            th: {
                name: "Thai",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            ti: {
                name: "Tigrinya",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            tk: {
                name: "Turkmen",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            tr: {
                name: "Turkish",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            tt: {
                name: "Tatar",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            ug: {
                name: "Uyghur",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            uk: {
                name: "Ukrainian",
                numbers: [1, 2, 5],
                plurals: function(a) {
                    return Number(a % 10 == 1 && a % 100 != 11 ? 0 : a % 10 >= 2 && 4 >= a % 10 && (10 > a % 100 || a % 100 >= 20) ? 1 : 2)
                }
            },
            ur: {
                name: "Urdu",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            uz: {
                name: "Uzbek",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            vi: {
                name: "Vietnamese",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            wa: {
                name: "Walloon",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(a > 1)
                }
            },
            wo: {
                name: "Wolof",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            },
            yo: {
                name: "Yoruba",
                numbers: [1, 2],
                plurals: function(a) {
                    return Number(1 != a)
                }
            },
            zh: {
                name: "Chinese",
                numbers: [1],
                plurals: function(a) {
                    return 0
                }
            }
        },
        addRule: function(a, b) {
            Q.rules[a] = b
        },
        setCurrentLng: function(a) {
            if (!Q.currentRule || Q.currentRule.lng !== a) {
                var b = a.split("-");
                Q.currentRule = {
                    lng: a,
                    rule: Q.rules[b[0]]
                }
            }
        },
        get: function(a, b) {
            function c(b, c) {
                var d;
                if (d = Q.currentRule && Q.currentRule.lng === a ? Q.currentRule.rule : Q.rules[b]) {
                    var e = d.plurals(c)
                      , f = d.numbers[e];
                    return 2 === d.numbers.length && 1 === d.numbers[0] && (2 === f ? f = -1 : 1 === f && (f = 1)),
                    f
                }
                return 1 === c ? "1" : "-1"
            }
            var d = a.split("-");
            return c(d[0], b)
        }
    }
      , R = {}
      , S = function(a, b) {
        R[a] = b
    }
      , T = function() {
        function a(a) {
            return Object.prototype.toString.call(a).slice(8, -1).toLowerCase()
        }
        function b(a, b) {
            for (var c = []; b > 0; c[--b] = a)
                ;
            return c.join("")
        }
        var c = function() {
            return c.cache.hasOwnProperty(arguments[0]) || (c.cache[arguments[0]] = c.parse(arguments[0])),
            c.format.call(null , c.cache[arguments[0]], arguments)
        }
        ;
        return c.format = function(c, d) {
            var e, f, g, h, i, j, k, l = 1, m = c.length, n = "", o = [];
            for (f = 0; m > f; f++)
                if (n = a(c[f]),
                "string" === n)
                    o.push(c[f]);
                else if ("array" === n) {
                    if (h = c[f],
                    h[2])
                        for (e = d[l],
                        g = 0; g < h[2].length; g++) {
                            if (!e.hasOwnProperty(h[2][g]))
                                throw T('[sprintf] property "%s" does not exist', h[2][g]);
                            e = e[h[2][g]]
                        }
                    else
                        e = h[1] ? d[h[1]] : d[l++];
                    if (/[^s]/.test(h[8]) && "number" != a(e))
                        throw T("[sprintf] expecting number but found %s", a(e));
                    switch (h[8]) {
                    case "b":
                        e = e.toString(2);
                        break;
                    case "c":
                        e = String.fromCharCode(e);
                        break;
                    case "d":
                        e = parseInt(e, 10);
                        break;
                    case "e":
                        e = h[7] ? e.toExponential(h[7]) : e.toExponential();
                        break;
                    case "f":
                        e = h[7] ? parseFloat(e).toFixed(h[7]) : parseFloat(e);
                        break;
                    case "o":
                        e = e.toString(8);
                        break;
                    case "s":
                        e = (e = String(e)) && h[7] ? e.substring(0, h[7]) : e;
                        break;
                    case "u":
                        e = Math.abs(e);
                        break;
                    case "x":
                        e = e.toString(16);
                        break;
                    case "X":
                        e = e.toString(16).toUpperCase()
                    }
                    e = /[def]/.test(h[8]) && h[3] && e >= 0 ? "+" + e : e,
                    j = h[4] ? "0" == h[4] ? "0" : h[4].charAt(1) : " ",
                    k = h[6] - String(e).length,
                    i = h[6] ? b(j, k) : "",
                    o.push(h[5] ? e + i : i + e)
                }
            return o.join("")
        }
        ,
        c.cache = {},
        c.parse = function(a) {
            for (var b = a, c = [], d = [], e = 0; b; ) {
                if (null  !== (c = /^[^\x25]+/.exec(b)))
                    d.push(c[0]);
                else if (null  !== (c = /^\x25{2}/.exec(b)))
                    d.push("%");
                else {
                    if (null  === (c = /^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))
                        throw "[sprintf] huh?";
                    if (c[2]) {
                        e |= 1;
                        var f = []
                          , g = c[2]
                          , h = [];
                        if (null  === (h = /^([a-z_][a-z_\d]*)/i.exec(g)))
                            throw "[sprintf] huh?";
                        for (f.push(h[1]); "" !== (g = g.substring(h[0].length)); )
                            if (null  !== (h = /^\.([a-z_][a-z_\d]*)/i.exec(g)))
                                f.push(h[1]);
                            else {
                                if (null  === (h = /^\[(\d+)\]/.exec(g)))
                                    throw "[sprintf] huh?";
                                f.push(h[1])
                            }
                        c[2] = f
                    } else
                        e |= 2;
                    if (3 === e)
                        throw "[sprintf] mixing positional and named placeholders is not (yet) supported";
                    d.push(c)
                }
                b = b.substring(c[0].length)
            }
            return d
        }
        ,
        c
    }()
      , U = function(a, b) {
        return b.unshift(a),
        T.apply(null , b)
    }
    ;
    S("sprintf", function(a, b, c) {
        return c.sprintf ? "[object Array]" === Object.prototype.toString.apply(c.sprintf) ? U(a, c.sprintf) : "object" == typeof c.sprintf ? T(a, c.sprintf) : a : a
    }),
    F.init = i,
    F.setLng = p,
    F.preload = j,
    F.addResourceBundle = k,
    F.removeResourceBundle = l,
    F.loadNamespace = n,
    F.loadNamespaces = o,
    F.setDefaultNamespace = m,
    F.t = x,
    F.translate = x,
    F.exists = w,
    F.detectLanguage = O.detectLanguage,
    F.pluralExtensions = Q,
    F.sync = P,
    F.functions = O,
    F.lng = q,
    F.addPostProcessor = S,
    F.options = K,
    a.i18n = F
}),
nm_module("nm/locales/enAU", function(a, b, c, d) {
    a.defs = {
        settings: {
            center: {
                lat: -33.856852,
                lon: 151.215236
            },
            zoom: 3,
            "demo-zoom": 21,
            "demo-center": {
                lat: -34.920959,
                lon: 138.575756
            },
            country: "AU"
        },
        translation: {
            units: {
                length: {
                    cm: {
                        symbol: "cm",
                        name: "Centimetre",
                        plural_name: "Centimetres"
                    },
                    m: {
                        symbol: "m",
                        name: "Metre",
                        plural_name: "Metres"
                    },
                    km: {
                        symbol: "km",
                        name: "Kilometre",
                        plural_name: "Kilometres"
                    },
                    "in": {
                        symbol: "in",
                        name: "Inch",
                        plural_name: "Inches"
                    },
                    ft: {
                        symbol: "ft",
                        name: "Foot",
                        plural_name: "Feet"
                    },
                    yd: {
                        symbol: "yd",
                        name: "Yard",
                        plural_name: "Yards"
                    },
                    mi: {
                        symbol: "mi",
                        name: "Mile",
                        plural_name: "Miles"
                    },
                    nmi: {
                        symbol: "nmi",
                        name: "Nautical Mile",
                        plural_name: "Nautical Miles"
                    }
                }
            },
            formats: {
                number: {
                    thousands_sep: ",",
                    decimal_sep: "."
                },
                "day-date": "ddd dd mmm yyyy"
            },
            defaults: {
                units: {
                    length: {
                        symbol: "m",
                        name: "Metre",
                        plural_name: "Metres"
                    },
                    currency: {
                        symbol: "AU$"
                    }
                }
            },
            tools: {
                Elevation: "Elevation"
            },
            "upsell-message": "<strong>__toolName__</strong> is not available in your current subscription. This feature is only available on selected business packages.<br/><br/>To find out more or to upgrade, please call us on <strong>1800 632 762</strong>."
        }
    }
}),
nm_module("nm/locales/enUS", function(a, b, c, d) {
    a.defs = {
        settings: {
            center: {
                lat: 37.334737,
                lon: -122.008836
            },
            zoom: 15,
            "demo-zoom": 15,
            "demo-center": {
                lat: 37.334737,
                lon: -122.008836
            },
            country: "US"
        },
        translation: {
            units: {
                length: {
                    cm: {
                        symbol: "cm",
                        name: "Centimeter",
                        plural_name: "Centimeters"
                    },
                    m: {
                        symbol: "m",
                        name: "Meter",
                        plural_name: "Meters"
                    },
                    km: {
                        symbol: "km",
                        name: "Kilometer",
                        plural_name: "Kilometers"
                    },
                    "in": {
                        symbol: "in",
                        name: "Inch",
                        plural_name: "Inches"
                    },
                    ft: {
                        symbol: "ft",
                        name: "Foot",
                        plural_name: "Feet"
                    },
                    yd: {
                        symbol: "yd",
                        name: "Yard",
                        plural_name: "Yards"
                    },
                    mi: {
                        symbol: "mi",
                        name: "Mile",
                        plural_name: "Miles"
                    },
                    nmi: {
                        symbol: "nmi",
                        name: "Nautical Mile",
                        plural_name: "Nautical Miles"
                    }
                }
            },
            formats: {
                number: {
                    thousands_sep: ",",
                    decimal_sep: "."
                },
                "day-date": "ddd mmm dd yyyy"
            },
            defaults: {
                units: {
                    length: {
                        symbol: "ft",
                        name: "Foot",
                        plural_name: "Feet"
                    },
                    currency: {
                        symbol: "US$"
                    }
                }
            },
            tools: {
                Elevation: "Elevation"
            },
            "upsell-message": '<p><strong>__toolName__</strong> is only available for registered users.</p><p><a href="__signupUrl__">Sign up now</a> with your business email address to have immediate access to  <strong>__toolName__</strong>.</p>'
        }
    }
}),
nm_module("nm/locales", function(a, b, c, d) {
    var e = b("nm/locales/enAU", "defs")
      , f = b("nm/locales/enUS", "defs");
    a.enAU = e,
    a.enUS = f
}),
nm_module("nm/intl", function(a, b, c, d) {
    var e, f = b("jscore/events", "Change"), g = b("js-libs/i18next", "i18n"), h = b("nm/locales", "enAU"), i = b("nm/locales", "enUS"), j = b("nm/http", "Request"), k = b("nm/console", "log"), l = {
        "en-AU": h,
        "en-US": i
    }, m = {
        lng: "en-AU",
        resStore: l,
        detectLngQS: "nmlang",
        useCookie: !1
    }, n = null , o = null , p = !1, q = a.detect = function() {
        if (p !== !0) {
            var a = null ;
            if (o)
                a = o;
            else {
                var b = n.getAccountData();
                a = b && b.hasOwnProperty("Result") ? b.Result.Culture : g.lng()
            }
            g.setLng(a),
            p = !0,
            k("Locale:", a)
        }
    }
    , r = (a.init = function(a, b) {
        var c = new j(window.location.href);
        n = a,
        e = b || m,
        o = c.getValue(e.detectLngQS),
        n && n.addListener(f, q),
        g.init(e)
    }
    ,
    a.getText = function(a) {
        var b = Array.prototype.slice.call(arguments, 1);
        return g.t.apply(g, [a].concat(b))
    }
    ), s = a.getLang = function() {
        return g.lng()
    }
    ;
    a.getSetting = function(a) {
        var b, c, d = s();
        if (!d || "" === d)
            return a;
        if (b = l[d],
        b && b.hasOwnProperty("settings")) {
            if (c = a.split("."),
            c.length > 1) {
                for (var e = 0, f = b.settings; c[e]; )
                    f = f && f[c[e]],
                    e++;
                return void 0 !== f ? f : a
            }
            return void 0 !== b.settings[a] ? b.settings[a] : a
        }
        return a
    }
    ,
    a.setLang = function(a) {
        g.setLng(a)
    }
    ,
    a.formatNumber = function(a, b) {
        var c, d, e, f, g = a.toString().split("."), h = "", i = r("formats.number.thousands_sep"), j = r("formats.number.decimal_sep");
        for (b || (b = 3),
        c = g[0],
        d = g.length >= 2 ? j + g[1] : "",
        e = c.length - 1,
        f = 0; e >= 0; )
            h = c.charAt(e) + (0 !== f && f % b === 0 ? i : "") + h,
            f++,
            e--;
        return h + d
    }
}),
nm_module("nm/localstorage", function(a, b, c, d) {
    var e, f = c(Object, {
        constructor: function() {
            this.data = {}
        },
        setItem: function(a, b) {
            this.data[a] = b
        },
        getItem: function(a) {
            return this.data[a]
        }
    }), g = a.isLocalStorageEnabled = function() {
        return "undefined" == typeof localStorage ? !1 : null  !== localStorage
    }
    ;
    e = g() ? localStorage : new f;
    a.clear = function() {
        localStorage.clear()
    }
    ,
    a.setItem = function(a, b) {
        try {
            e.setItem(a, b)
        } catch (c) {}
    }
    ,
    a.getItem = function(a) {
        return e.getItem(a)
    }
}),
nm_module("nm/tools/state/statemanager", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/functools", "bind")
      , g = b("jscore/types", "isUndefined")
      , h = b("jscore/types", "isUndefinedOrNull")
      , i = b("jscore/objtools", "Dictionary")
      , j = b("nm/geom", "LatLng")
      , k = b("nm/const", "TILE_DATE_KEY")
      , l = b("nm/const", "ADDRESS_QUERY_KEY")
      , m = b("nm/const", "SEARCH_QUERY_KEY")
      , n = b("nm/const", "LATLNG_KEY")
      , o = b("nm/const", "ZOOM_KEY")
      , p = b("nm/const", "LAYER_KEY")
      , q = b("nm/const", "MAPTYPE_KEY")
      , r = b("nm/const", "OVERLAY_KEY")
      , s = b("nm/cookie", "MapState")
      , t = b("nm/intl", "getSetting")
      , u = b("nm/localstorage", "getItem")
      , v = b("nm/localstorage", "setItem")
      , w = b("jscore/dateutils", "format")
      , x = b("nm/const/imagery", "SURVEY")
      , y = b("nm/const/imagery", "TERRAIN")
      , z = b("nm/const/imagery", "SURVEY_N")
      , A = b("nm/const/imagery", "SURVEY_E")
      , B = b("nm/const/imagery", "SURVEY_S")
      , C = b("nm/const/imagery", "SURVEY_W")
      , D = b("nm/const/imagery", "ROAD")
      , E = a.EMAIL_NOTIFICATION = "EMAIL_NOTIFICATION"
      , F = a.DESIRED_DATE = "DESIRED_DATE"
      , G = a.SEARCH_QUERY_STRING = "SEARCH_QUERY_STRING"
      , H = a.LOCATION_MARKER_QUERY_STRING = "LOCATION_MARKER_QUERY_STRING"
      , I = a.MAP_CENTER = "MAP_CENTER"
      , J = a.MAP_ZOOM = "MAP_ZOOM"
      , K = a.BASE_MAPTYPE = "BASE_MAPTYPE"
      , L = a.STREET_OVERLAYS = "STREET_OVERLAYS"
      , M = new i([["k", x], ["p", y], ["n", z], ["e", A], ["s", B], ["w", C], ["roadmap", D]])
      , N = new i([[x, "k"], [y, "p"], [z, "n"], [A, "e"], [B, "s"], [C, "w"], [D, "roadmap"]])
      , O = a.StateManager = c(e, {
        constructor: function(a) {
            O.base.call(this),
            this._req = a,
            this._cookie = s,
            this._initLoadersAndSaversMap()
        },
        _initLoadersAndSaversMap: function() {
            this._loadersAndSaversMap = {},
            this._loadersAndSaversMap[E] = {
                load: f(this, function() {
                    return this._defaultLoad(E)
                }),
                save: f(this, function(a) {
                    this._defaultSave(E, a)
                })
            },
            this._loadersAndSaversMap[F] = {
                load: f(this, function() {
                    var a = this._defaultLoad(k);
                    if (h(a) || "null" === a)
                        return null ;
                    var b = a.substring(0, 4)
                      , c = a.substring(4, 6)
                      , d = a.substring(6, 8)
                      , e = new Date(Date.UTC(b, c - 1, d));
                    return e
                }),
                save: f(this, function(a) {
                    var b;
                    b = null  !== a ? w(a, "yyyymmdd", !0) : null ,
                    this._saveToCookie(k, b)
                })
            },
            this._loadersAndSaversMap[I] = {
                load: f(this, function() {
                    var a = this._defaultLoad(n);
                    try {
                        a = a.split(",");
                        var b = parseFloat(a[0])
                          , c = parseFloat(a[1]);
                        return a = new j(b,c)
                    } catch (d) {
                        return a = t("center"),
                        new j(a.lat,a.lon)
                    }
                }),
                save: f(this, function(a) {
                    a = a.getLat() + "," + a.getLon(),
                    this._saveToCookie(n, a)
                })
            },
            this._loadersAndSaversMap[K] = {
                load: f(this, function() {
                    var a = this._defaultLoad(q);
                    return h(a) && (a = this._defaultLoad(p)),
                    h(a) && (a = x),
                    a = M.get(a, x)
                }),
                save: f(this, function(a) {
                    this._saveToCookie(p, N.get(a, "k"))
                })
            },
            this._loadersAndSaversMap[J] = {
                load: f(this, function() {
                    var a = this._defaultLoad(o);
                    return a = parseInt(a, 10),
                    isNaN(a) && (a = t("zoom")),
                    a
                }),
                save: f(this, function(a) {
                    this._saveToCookie(o, a)
                })
            },
            this._loadersAndSaversMap[L] = {
                load: f(this, function() {
                    return this._defaultLoad(r) || ""
                }),
                save: f(this, function(a) {
                    this._saveToCookie(r, a)
                })
            },
            this._loadersAndSaversMap[G] = {
                load: f(this, function() {
                    var a = this._readFromUrl(l);
                    return a
                })
            },
            this._loadersAndSaversMap[H] = {
                load: f(this, function() {
                    var a = this._readFromUrl(m);
                    return a
                })
            }
        },
        loadSetting: function(a) {
            var b, c = this._loadersAndSaversMap[a];
            if (h(c.load))
                return null ;
            b = c.load;
            var d = b();
            return d
        },
        saveSetting: function(a, b) {
            var c, d = this._loadersAndSaversMap[a];
            h(d.save) || (c = d.save)(b)
        },
        _defaultLoad: function(a) {
            var b = this._readFromUrl(a);
            return h(b) ? (b = this._readFromCookie(a),
            h(b) ? (b = this._readFromLocalStorage(a),
            h(b) ? void 0 : b) : b) : b
        },
        _defaultSave: function(a, b) {
            this._saveToLocalStorage(a, b),
            this.changed()
        },
        _readFromUrl: function(a) {
            var b = this._req.getValue(a);
            return g(b) ? null  : b
        },
        _readFromCookie: function(a) {
            var b = this._cookie.getValue(a);
            return g(b) ? null  : b
        },
        _readFromLocalStorage: function(a) {
            var b = u(a);
            return g(b) ? null  : b
        },
        _saveToCookie: function(a, b) {
            this._cookie.setValue(a, b),
            this._cookie.save()
        },
        _saveToLocalStorage: function(a, b) {
            v(a, b)
        }
    })
}),
nm_module("nm/views/google/mapoverlays", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("nm/tools/state/statemanager", "STREET_OVERLAYS")
      , g = b("js-libs/google", "maps")
      , h = [{
        featureType: "all",
        stylers: [{
            visibility: "off"
        }]
    }, {
        featureType: "administrative",
        stylers: [{
            visibility: "off"
        }]
    }, {
        featureType: "administrative.country",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.province",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.locality",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.neighborhood",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.land_parcel",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "road",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "road",
        elementType: "geometry",
        stylers: [{
            visibility: "simplified"
        }]
    }, {
        featureType: "poi",
        elementType: "labels.text",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "poi",
        elementType: "labels.icon",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "transit",
        stylers: [{
            visibility: "off"
        }]
    }, {
        featureType: "transit.line",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "transit.station",
        elementType: "labels.icon",
        stylers: [{
            visibility: "simplified"
        }]
    }, {
        featureType: "water",
        elementType: "labels.text",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.land_parcel",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.land_parcel",
        elementType: "geometry",
        stylers: [{
            visibility: "off"
        }]
    }, {
        featureType: "administrative.land_parcel",
        elementType: "labels.text.fill",
        stylers: [{
            color: "#000000"
        }, {
            weight: 1.2
        }]
    }, {
        featureType: "administrative.land_parcel",
        elementType: "labels.text.stroke",
        stylers: [{
            color: "#999999"
        }, {
            weight: 1.2
        }]
    }]
      , i = [{
        featureType: "all",
        stylers: [{
            visibility: "off"
        }]
    }, {
        featureType: "administrative.land_parcel",
        stylers: [{
            visibility: "on"
        }]
    }, {
        featureType: "administrative.land_parcel",
        elementType: "labels.text.fill",
        stylers: [{
            color: "#000000"
        }, {
            weight: 1.2
        }]
    }, {
        featureType: "administrative.land_parcel",
        elementType: "labels.text.stroke",
        stylers: [{
            color: "#999999"
        }, {
            weight: 1.2
        }]
    }]
      , j = new g.StyledMapType(h,{
        name: "styledStreetMap",
        tileSize: new g.Size(256,256),
        nmKey: "hg",
        maxZoom: 22,
        minZoom: 1
    })
      , k = new g.StyledMapType(i,{
        name: "styledPropertiesMap",
        tileSize: new g.Size(256,256),
        nmKey: "po",
        maxZoom: 22,
        minZoom: 15
    })
      , l = a.MapOverlays = c(e, {
        constructor: function(a, b) {
            l.base.call(this),
            this.gMap = a,
            this.stateMgr = b;
            var c = b.loadSetting(f);
            this.streetsVisible = -1 !== c.indexOf("hg"),
            this.propertiesVisible = -1 !== c.indexOf("po"),
            this.changed()
        },
        getStreetsVisible: function() {
            return this.streetsVisible
        },
        setStreetsVisible: function(a) {
            this.streetsVisible !== a && (this.streetsVisible = a,
            this.changed())
        },
        setPropertiesVisible: function(a) {
            this.propertiesVisible !== a && (this.propertiesVisible = a,
            this.changed())
        },
        getPropertiesVisible: function() {
            return this.propertiesVisible
        },
        changed: function() {
            var a = this.gMap.overlayMapTypes
              , b = this.streetsVisible
              , c = this.propertiesVisible
              , d = -1;
            a.forEach(function(a, b) {
                "V" === a.name && (d = b)
            });
            var e = a.indexOf(j);
            b && -1 === e ? a.insertAt(d + 1, j) : !b && e > -1 && a.removeAt(e);
            var g = a.indexOf(k);
            c && -1 === g ? a.insertAt(d + 1, k) : !c && g > -1 && a.removeAt(g),
            this.stateMgr.saveSetting(f, this.getState()),
            l.base.prototype.changed.call(this)
        },
        getState: function() {
            var a = [];
            return this.propertiesVisible && a.push("po"),
            this.streetsVisible && a.push("hg"),
            a.join("_")
        }
    })
}),
nm_module("nm/layers/persistence/service", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/functools", "partial")
      , g = b("jscore/itertools", "array")
      , h = b("jscore/types", "isUndefinedOrNull")
      , i = b("jscore/strings", "format")
      , j = b("js-libs/jquery", "jQuery")
      , k = b("nm/console", "log")
      , l = b("nm/const", "HOST_URL")
      , m = l + "maps/api/usergeom/v1"
      , n = "FeatureCollection"
      , o = "Feature";
    a.LayersPersistenceService = c(Object, {
        constructor: function(a) {
            this.auth = a,
            k("Initialized LayersPersister with auth", a)
        },
        getProjects: function(a, b, c) {
            h(a) && (a = ""),
            h(b) && (b = !1);
            var d = i("{baseUrl}/projects?name={name}&name-ilike={ilike}", {
                baseUrl: m,
                name: encodeURIComponent(a),
                ilike: b
            })
              , g = f(e(this, this.handleGetProjectsResponse), c);
            j.ajax({
                url: d,
                type: "GET",
                dataType: "json",
                success: g,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleGetProjectsResponse: function(a, b) {
            h(a) || a({
                projects: b.projects
            })
        },
        getProject: function(a, b) {
            var c = i("{baseUrl}/project/{projectId}", {
                baseUrl: m,
                projectId: a
            })
              , d = f(e(this, this.handleGetProjectResponse), b);
            j.ajax({
                url: c,
                type: "GET",
                dataType: "json",
                success: d,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleGetProjectResponse: function(a, b) {
            h(a) || a({
                project: b
            })
        },
        mergeProject: function(a, b) {
            var c = i("{baseUrl}/projects?update=merge", {
                baseUrl: m
            })
              , d = JSON.stringify(a)
              , g = f(e(this, this.handleMergeProjectResponse), b);
            j.ajax({
                url: c,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: d,
                success: g,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleMergeProjectResponse: function(a, b) {
            h(a) || a({
                projectId: b.project.projectId,
                children: b.project.children
            })
        },
        deleteProject: function(a, b) {
            var c = i("{baseUrl}/projects?update=delete", {
                baseUrl: m
            })
              , d = JSON.stringify({
                id: a
            })
              , g = f(e(this, this.handleDeleteProjectResponse), b, a);
            j.ajax({
                url: c,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: d,
                success: g,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleDeleteProjectResponse: function(a, b) {
            h(a) || a({
                projectId: b
            })
        },
        getAllProjectLayerFeatures: function(a, b, c) {
            var d = "all=true&fields=properties,geometry";
            this._getProjectLayerFeatures(a, b, d, c)
        },
        getProjectLayerFeaturesByBoundsAndZoom: function(a, b, c, d, e) {
            var f = i("bbox={xmin},{ymin},{xmax},{ymax}&z={zoom}&fields={fields}", {
                xmin: c.left,
                ymin: c.bottom,
                xmax: c.right,
                ymax: c.top,
                zoom: d,
                fields: "properties,geometry"
            });
            this._getProjectLayerFeatures(a, b, f, e)
        },
        _getProjectLayerFeatures: function(a, b, c, d) {
            var g = i("{baseUrl}/project/{projectId}/layers/features?{queryStr}", {
                baseUrl: m,
                projectId: a,
                queryStr: c
            });
            b = this.getLayerIdsAsArray(b);
            var h = JSON.stringify({
                projectItemIds: b
            })
              , l = f(e(this, this.handleGetProjectLayerFeaturesResponse), a, d);
            j.ajax({
                url: g,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: h,
                success: l,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleGetProjectLayerFeaturesResponse: function(a, b, c) {
            if (!c || !c.layerIds)
                return void k("resp was undefined");
            for (var d = {}, e = 0; e < c.layerIds.length; e++)
                d[c.layerIds[e]] = c.featureCollections[e];
            h(b) || b({
                projectId: a,
                layers: d
            })
        },
        mergeLayer: function(a, b, c, d) {
            var g = m + "/project/" + a;
            g += h(b) ? "/layers" : "/layer/" + b + "?update=merge";
            var i = JSON.stringify(c)
              , l = f(e(this, this.handleMergeLayerResponse), a, d);
            j.ajax({
                url: g,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: i,
                success: l,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleMergeLayerResponse: function(a, b, c) {
            h(b) || b({
                projectId: a,
                layerId: c.ids.layerId,
                featureCollectionId: c.ids.featureCollectionId,
                featureIds: c.ids.featureIds
            })
        },
        removeLayers: function(a, b, c) {
            var d = m + "/projects?update=remove";
            b = this.getLayerIdsAsArray(b);
            for (var g = [], h = 0; h < b.length; h++)
                g.push({
                    type: n,
                    id: b[h]
                });
            var i = JSON.stringify({
                id: a,
                children: g
            })
              , l = f(e(this, this.handleRemoveLayersResponse), c);
            j.ajax({
                url: d,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: i,
                success: l,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleRemoveLayersResponse: function(a, b) {
            h(a) || a({
                projectId: b.project.id,
                children: b.project.children
            })
        },
        deleteLayerFeatures: function(a, b, c, d) {
            var h = i("{baseUrl}/project/{projectId}/layer/{layerId}?update={update}", {
                baseUrl: m,
                projectId: a,
                layerId: b,
                update: "deletefeatures"
            })
              , l = {
                type: n,
                properties: {},
                features: []
            };
            c = g(c);
            for (var p = 0; p < c.length; p++) {
                var q = {
                    type: o,
                    properties: {
                        id: c[p]
                    }
                };
                l.features.push(q)
            }
            var r = JSON.stringify(l)
              , s = f(e(this, this.handleDeleteLayerFeaturesResponse), a, b, d);
            j.ajax({
                url: h,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: r,
                success: s,
                error: function(a) {
                    k("ajax call error", a)
                }
            })
        },
        handleDeleteLayerFeaturesResponse: function(a, b, c, d) {
            var e = d.ids;
            h(c) || c({
                projectId: a,
                layerId: b,
                featureCollectionId: e.featureCollectionId,
                featureIds: e.featureIds
            })
        },
        uploadDataUrl: function(a, b, c) {
            var d = m + "/projects/import"
              , g = {
                projectId: a,
                userGeomType: "kml",
                clientName: "layersmanager",
                featureCollectionProperties: {},
                "import": {
                    source: {
                        url: b
                    }
                },
                force2d: !0
            };
            g = JSON.stringify(g);
            var h = f(e(this, this.handleUploadDataUrlResponse), c)
              , i = f(e(this, this.handleUploadDataUrlErrorResponse), c);
            j.ajax({
                url: d,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: g,
                success: h,
                error: i
            })
        },
        handleUploadDataUrlResponse: function(a, b) {
            h(a) || a({
                status: b.status,
                projectId: b.projectId,
                layers: b.children
            })
        },
        handleUploadDataUrlErrorResponse: function(a, b) {
            if (k("ajax call error", b),
            !h(a)) {
                var c = b.responseJSON || {}
                  , d = c.code || "Error"
                  , e = c.message || ""
                  , f = c.properties || {};
                a({
                    status: d,
                    message: e,
                    properties: f
                })
            }
        },
        getLayerIdsAsArray: function(a) {
            if (j.isArray(a))
                return a;
            var b = [];
            return b.push(a),
            a = b
        }
    })
}),
nm_module("nm/layers/persistence/event", function(a, b, c, d) {
    var e = b("jscore/async", "setTimeout")
      , f = b("jscore/async", "clearTimeout")
      , g = b("jscore/objtools", "Dictionary")
      , h = b("jscore/sets", "Set");
    a.LayerFeatureEvents = c(Object, {
        constructor: function() {
            this.idleFeatureUpdates = {},
            this.layerTimeouts = new g
        },
        callWhenLayerUpdatesIdle: function(a, b, c, d, e) {
            d = "undefined" == typeof arguments[3] ? 5e3 : d,
            e = "undefined" == typeof arguments[4] ? 3e4 : e;
            var g = this.layerTimeouts
              , i = g.get(a, null );
            null  === i ? (i = {
                timeout: null ,
                busyTimeout: this.newBusyTimeout(a, e),
                callback: c,
                features: new h
            },
            g.set(a, i)) : f(i.timeout),
            i.features.add(b),
            i.timeout = this.newTimeout(a, d)
        },
        newTimeout: function(a, b) {
            var c = this.layerTimeouts;
            return e(function() {
                var b = c.pop(a);
                f(b.busyTimeout);
                var d = b.callback;
                d(a, b.features)
            }, b)
        },
        newBusyTimeout: function(a, b) {
            var c = this.layerTimeouts;
            return e(function() {
                var b = c.pop(a);
                f(b.timeout);
                var d = b.callback;
                d(a, b.features)
            }, b)
        },
        callAllNow: function() {
            for (var a, b = this.layerTimeouts, c = b.keys()[d.iterator](); !(a = c.next()).done; ) {
                var e = a.value
                  , g = b.pop(e);
                f(g.timeout),
                f(g.busyTimeout);
                var h = g.callback;
                h(e, g.features)
            }
        }
    })
}),
nm_module("nm/layers/persistence/manager", function(a, b, c, d) {
    var e = b("jscore/uuid", "uuid4")
      , f = b("jscore/functools", "bind")
      , g = b("jscore/functools", "partial")
      , h = b("jscore/types", "isUndefinedOrNull")
      , i = b("jscore/itertools", "filter")
      , j = b("jscore/itertools", "array")
      , k = b("jscore/itertools", "isEmpty")
      , l = b("jscore/events", "ObservableObject")
      , m = b("jscore/events", "Change")
      , n = b("jscore/async", "callWhenIdle")
      , o = b("js-libs/jquery", "jQuery")
      , p = b("nm/console", "log")
      , q = b("nm/layers/persistence/service", "LayersPersistenceService")
      , r = b("nm/layers/persistence/event", "LayerFeatureEvents")
      , s = b("nm/layers/feature", "FeatureLayer")
      , t = b("nm/layers/geojson", "GeoJSONLayer")
      , u = b("nm/const/tools", "LAYERS_MANAGER_NO_PERSISTENCE")
      , v = b("nm/const/tools", "LAYER_GEOJSON_LABELS")
      , w = "_default"
      , x = "FeatureCollection";
    a.LayersPersistenceManager = c(Object, {
        constructor: function(a, b, c, d, e) {
            d = "undefined" == typeof arguments[3] ? new q(a) : d,
            e = "undefined" == typeof arguments[4] ? new r : e,
            this.auth = a,
            this.mapViewController = b,
            this.layersController = c,
            this.layersPersister = d,
            this.layerFeatureEvents = e,
            this.project = null 
        },
        init: function() {
            this.loadDefaultProject(),
            this.layersController.addListener(m, f(this, this.layersUpdated));
            var a = f(this, this.mapUpdated);
            this.mapViewController.gMap.addListener("idle", n(a, 500))
        },
        isEnabled: function() {
            var a = this.auth;
            return h(a) ? !1 : a.can(u) ? (this.project = null ,
            !1) : !0
        },
        importGeometry: function(a, b) {
            if (!this.isEnabled())
                return void b({
                    status: "ImportNotEnabled",
                    message: "The KML Import feature is not currently enabled."
                });
            var c = this.project;
            if (h(c))
                return p("WARNING: Project not available for processing layers"),
                void b({
                    status: "ImportNotEnabled",
                    message: "The KML Import feature is not currently enabled."
                });
            var d = g(f(this, this.handleImportGeometryResponse), b);
            this.layersPersister.uploadDataUrl(c.id, a, d)
        },
        handleImportGeometryResponse: function(a, b) {
            if ("ok" === b.status) {
                var c = this.project;
                if (b.projectId === c.id) {
                    for (var e, f = [], g = b.layers[d.iterator](); !(e = g.next()).done; ) {
                        var i = e.value;
                        f.push(i.id),
                        this.addOrUpdateProjectLayerMetadata(c, i.id, i.name)
                    }
                    this.loadProjectLayers(f)
                }
                h(a) || a({
                    status: b.status
                })
            } else if (!h(a)) {
                var j = {
                    status: b.status,
                    message: b.message
                }
                  , k = b.properties;
                k && (j.properties = k),
                a(j)
            }
        },
        layersUpdated: function(a) {
            if (this.isEnabled()) {
                var b = this.project;
                if (h(b))
                    return void p("WARNING: Project not available for processing layers");
                var c = a.properties.deleted;
                if (c)
                    this.deleteLayers(b, c);
                else
                    for (var e, f = this.layersController.getLayers(), g = f[d.iterator](); !(e = g.next()).done; ) {
                        var i = e.value;
                        this.checkAndSaveLayer(i)
                    }
            }
        },
        deleteLayers: function(a, b) {
            if (this.isEnabled()) {
                for (var c, e = [], f = b[d.iterator](); !(c = f.next()).done; ) {
                    var g = c.value
                      , i = g.getId();
                    g.isPersistent() && !h(i) && (e.push(i),
                    this.removeProjectLayer(a, i))
                }
                e.length > 0 && this.layersPersister.removeLayers(a.id, e)
            }
        },
        checkAndSaveLayer: function(a) {
            if (this.isEnabled() && a.isPersistent()) {
                var b = a.getId();
                if (h(b)) {
                    var c = this.project;
                    if (h(c))
                        return void p("WARNING: Project not available for processing layers");
                    a.setId(e()),
                    this.addListenersToLayer(a),
                    this.addOrUpdateProjectLayerMetadata(c, a.getId(), a.getName()),
                    p("Saving new nmLayer: ", a);
                    var d = a.toGeoJson();
                    if (null  !== d) {
                        var i = g(f(this, this.handleInsertLayerResponse), a);
                        this.layersPersister.mergeLayer(c.id, a.getId(), d, i)
                    }
                }
            }
        },
        handleInsertLayerResponse: function(a, b, c) {
            h(a.getId()) && a.setId(c.layerId)
        },
        updateProjectLayer: function(a, b) {
            if (this.isEnabled() && b.isPersistent()) {
                var c = b.getId()
                  , d = this.getProjectLayerWithId(a, c);
                if (h(d))
                    return void p("WARNING: could not find a project layer for ", b);
                this.addOrUpdateProjectLayerMetadata(a, c, b.getName());
                var e = this.getProjectLayerObj(a, d);
                p("Merging project with layer update", e);
                var i = g(f(this, this.handleMergeProjectLayerResponse), b);
                this.layersPersister.mergeProject(e, i)
            }
        },
        handleMergeProjectLayerResponse: function(a, b) {
            if (h(a.getId())) {
                var c = b.children;
                h(c) || 1 !== c.length || a.setId(c[0].id)
            }
        },
        layerUpdated: function(a) {
            if (this.isEnabled()) {
                var b = a.target;
                if (b.isPersistent()) {
                    var c = this.project;
                    if (h(c))
                        return void p("WARNING: Project not available for processing layers");
                    var d = b.getId();
                    if (h(d))
                        return void p("WARNING: persistent layer does not have an id", b);
                    var e = a.properties.deleted;
                    e && this.deleteFeatures(c, b, e);
                    var f = a.properties.inserted;
                    f && this.saveFeatures(b, f),
                    this.isLayerModified(c, b) && this.updateProjectLayer(c, b),
                    a.properties.visible && this.loadProjectLayers([d])
                }
            }
        },
        saveFeatures: function(a, b) {
            if (this.isEnabled())
                for (var c, e = b[d.iterator](); !(c = e.next()).done; ) {
                    var g = c.value;
                    this.addListenersToFeature(a, g),
                    this.layerFeatureEvents.callWhenLayerUpdatesIdle(a, g, f(this, this.mergeLayerFeatures))
                }
        },
        deleteFeatures: function(a, b, c) {
            if (this.isEnabled()) {
                var e = this.getProjectLayerCounterpart(a, b);
                if (null  !== e) {
                    for (var i, j = [], k = c[d.iterator](); !(i = k.next()).done; ) {
                        var l = i.value
                          , m = l.getId();
                        h(m) || (j.push(m),
                        l.setId(null ))
                    }
                    if (j.length > 0) {
                        var n = b.getId();
                        p("Deleting features for layer " + n, j);
                        var o = g(f(this, this.handleDeletedFeatureResponse), b, j);
                        this.layersPersister.deleteLayerFeatures(a.id, n, j, o)
                    }
                }
            }
        },
        handleDeletedFeatureResponse: function(a, b) {
            a.confirmDeletedFeatures(b)
        },
        featureUpdated: function(a, b) {
            if (this.isEnabled()) {
                var c = b.getId();
                h(c) || this.layerFeatureEvents.callWhenLayerUpdatesIdle(a, b, f(this, this.mergeLayerFeatures))
            }
        },
        mergeLayerFeatures: function(a, b) {
            if (this.isEnabled()) {
                b = i(b, function(a) {
                    return !h(a.getId())
                });
                var c = a.toGeoJson(b);
                if (0 === c.features.length)
                    return void p("No features to merge.");
                var d = g(f(this, this.handleMergeFeatureResponse), a, b)
                  , e = this.project;
                if (h(e))
                    return void p("WARNING: Project not available for processing layers");
                p("Merging features for layer " + a.getId(), c),
                this.layersPersister.mergeLayer(e.id, a.getId(), c, d)
            }
        },
        handleMergeFeatureResponse: function(a, b, c, e, f, g) {
            for (var i, j = 0, k = b[d.iterator](); !(i = k.next()).done; ) {
                var l = i.value;
                h(l.getId()) && j < g.length && l.setId(g[j]),
                j++
            }
        },
        addListenersToLayer: function(a) {
            a.isPersistent() && (a.removeListeners(this),
            a.addListener(m, f(this, this.layerUpdated)),
            this.addListenersToLayerFeatures(a))
        },
        addListenersToLayerFeatures: function(a, b) {
            if (a.isPersistent() && !a.isImmutable() && (h(b) && "function" == typeof a.getFeatures && (b = a.getFeatures()),
            !h(b)))
                for (var c, e = b[d.iterator](); !(c = e.next()).done; ) {
                    var f = c.value;
                    this.addListenersToFeature(a, f)
                }
        },
        addListenersToFeature: function(a, b) {
            b instanceof l && (b.removeListeners(this),
            b.addListener(m, g(f(this, this.featureUpdated), a, b)))
        },
        loadDefaultProject: function() {
            this.isEnabled() && (p("Loading default project " + w),
            this.layersPersister.getProjects(w, !1, f(this, this.handleLoadDefaultProjectResponse)))
        },
        handleLoadDefaultProjectResponse: function(a) {
            var b = a.projects;
            if (b.length > 0) {
                var c = b[0];
                this.loadProject(c.id)
            } else
                p("Creating new default project"),
                this.layersPersister.mergeProject({
                    name: w
                }, f(this, this.handleMergeProjectResponse))
        },
        handleMergeProjectResponse: function(a) {
            var b = a.projectId;
            this.loadProject(b)
        },
        loadProject: function(a) {
            this.isEnabled() && this.layersPersister.getProject(a, f(this, this.handleLoadProjectResponse))
        },
        handleLoadProjectResponse: function(a) {
            var b = a.project;
            this.project = b,
            p("Loaded Project", b);
            var c = this.getAllProjectLayerIds(b);
            this.loadProjectLayers(c)
        },
        loadProjectLayers: function(a) {
            if (this.isEnabled()) {
                var b = this.project;
                if (!h(b) && !k(a)) {
                    var c = this.mapViewController
                      , d = c.getZoom()
                      , e = c.getBounds();
                    this.layersPersister.getProjectLayerFeaturesByBoundsAndZoom(b.id, a, e, d, f(this, this.handleLoadProjectLayers))
                }
            }
        },
        handleLoadProjectLayers: function(a) {
            var b = a.projectId
              , c = this.project;
            if (null  !== c && b === c.id)
                for (var e, f = this.layersController, g = a.layers, h = this.getAllProjectLayerIds(c), i = h[d.iterator](); !(e = i.next()).done; ) {
                    var j = e.value
                      , k = this._getFeatureCollectionFromLayers(g, j);
                    if (null  !== k) {
                        var l = this.getProjectLayerWithId(c, j);
                        if (null  !== l) {
                            var m = f.getLayerById(j);
                            null  === m && (m = this.newMapLayer(l, k),
                            this.addMapLayer(m));
                            var n = m.fromGeoJson(k);
                            this.addListenersToLayerFeatures(m, n),
                            this._checkAndSetGeoJsonLabels(m)
                        }
                    }
                }
        },
        _checkAndSetGeoJsonLabels: function(a) {
            if (a.setShowLabels) {
                var b = this.auth.can(v);
                a.setShowLabels(b)
            }
        },
        newMapLayer: function(a, b) {
            var c = a.id
              , d = a.name || "Unknown Layer"
              , e = b.properties.type;
            switch (e) {
            case "kml":
                return new t(d,!0,c);
            default:
                return new s(d,!0,c)
            }
        },
        _getFeatureCollectionFromLayers: function(a, b) {
            if (!a.hasOwnProperty(b))
                return null ;
            var c = a[b];
            return h(c) ? null  : (h(c.properties) && (c.properties = {}),
            h(c.features) && (c.features = []),
            c)
        },
        addMapLayer: function(a) {
            this.addListenersToLayer(a),
            this.layersController.addLayer(a)
        },
        mapUpdated: function() {
            return this.isEnabled() ? void this.loadVisibleLayers() : void this.mapViewController.removeListeners(this)
        },
        loadVisibleLayers: function() {
            var a = this.project;
            if (null  !== a) {
                var b = this.getAllVisibleProjectLayerIds(a);
                this.loadProjectLayers(b)
            }
        },
        getProjectLayerObj: function(a, b) {
            if (h(a))
                return null ;
            var c = o.extend({}, a);
            c.children = [],
            o.isArray(b) || (b = [b]);
            for (var e, f = b[d.iterator](); !(e = f.next()).done; ) {
                var g = e.value
                  , i = o.extend({}, g);
                i.children = [],
                c.children.push(i)
            }
            return c
        },
        getAllVisibleProjectLayerIds: function(a) {
            var b = this.layersController
              , c = this.getAllProjectLayerIds(a);
            return j(i(c, function(a) {
                var c = b.getLayerById(a);
                return null  !== c && c.getVisible()
            }))
        },
        getAllProjectLayerIds: function(a) {
            var b = [];
            return a.children && this.getAllProjectLayerIdsRecurse(b, a.children),
            b
        },
        getAllProjectLayerIdsRecurse: function(a, b) {
            for (var c, e = b[d.iterator](); !(c = e.next()).done; ) {
                var f = c.value;
                f.type !== x || h(f.id) || "" === f.id || a.push(f.id),
                f.children && this.getAllProjectLayerIdsRecurse(a, f.children)
            }
        },
        isLayerModified: function(a, b) {
            var c = this.getProjectLayerCounterpart(a, b);
            return h(c) ? !1 : c.name !== b.getName()
        },
        getProjectLayerCounterpart: function(a, b) {
            if (h(b))
                return null ;
            var c = b.getId();
            return h(c) ? null  : this.getProjectLayerWithId(a, c)
        },
        getProjectLayerWithId: function(a, b) {
            return h(b) ? null  : this.getProjectLayerWithIdRecurse(a.children, b)
        },
        getProjectLayerWithIdRecurse: function(a, b) {
            if (h(a))
                return null ;
            for (var c, e = a[d.iterator](); !(c = e.next()).done; ) {
                var f = c.value;
                if (f.type === x && f.id === b)
                    return f;
                var g = this.getProjectLayerWithIdRecurse(f.children, b);
                if (null  !== g)
                    return g
            }
            return null 
        },
        addOrUpdateProjectLayerMetadata: function(a, b, c) {
            h(a.children) && (a.children = []);
            var d = this.getProjectLayerWithId(a, b);
            return h(d) ? (d = {
                type: x,
                id: b,
                name: c
            },
            a.children.push(d),
            p("Adding ProjectLayer", d)) : d.name = c,
            d
        },
        removeProjectLayer: function(a, b) {
            this.removeProjectLayerRecurse(a.children, b)
        },
        removeProjectLayerRecurse: function(a, b) {
            if (!h(a))
                for (var c = 0; c < a.length; c++) {
                    var d = a[c];
                    d.type === x && d.id === b ? (a.splice(c, 1),
                    c--) : this.removeProjectLayerRecurse(d.children, b)
                }
        }
    })
}),
nm_module("nm/views/timeline/timelineplayer", function(a, b, c, d) {
    var e = b("jscore/async", "clearInterval")
      , f = b("jscore/async", "setInterval")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/itertools", "find")
      , i = b("js-libs/jquery", "jQuery");
    a.TimelinePlayer = c(Object, {
        constructor: function(a) {
            this._surveysController = a,
            this._enabled = !1,
            this._isPlaying = !1,
            this._delay = 1e3;
            var b = i('<div class="play-btn btn" title="Play/pause timeline" style="display:block;"></div>');
            this._playPauseBtn = b,
            this.node = b,
            this.setEnabled(!0),
            this.setupListeners()
        },
        setEnabled: function(a) {
            this._enabled = a,
            this._enabled ? this._playPauseBtn.show() : this._playPauseBtn.hide()
        },
        setupListeners: function() {
            this._playPauseBtn.click(g(this, function() {
                this.toggle()
            }));
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap;
            b.getStreetView().addListener("visible_changed", g(this, this.onStreeViewChange))
        },
        toggle: function() {
            this._isPlaying ? this.pause() : this.play()
        },
        play: function() {
            this._isPlaying || (this._isPlaying = f(g(this, this.update), this._delay),
            this._playPauseBtn.addClass("pause-btn").removeClass("play-btn"),
            this.update())
        },
        pause: function() {
            this._isPlaying && (e(this._isPlaying),
            this._isPlaying = !1,
            this._playPauseBtn.addClass("play-btn").removeClass("pause-btn"))
        },
        onStreeViewChange: function() {
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap;
            this.setEnabled(!b.streetView.getVisible())
        },
        update: function() {
            var a = this._surveysController.getDesiredDate()
              , b = this._surveysController.getAvailableDates()
              , c = h(b, b[0], function(b) {
                return b > a ? !0 : void 0
            });
            this._surveysController.setDesiredDate(c)
        }
    })
}),
nm_module("nm/tools/timeline/surveyscontroller", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/functools", "bind")
      , g = b("nm/dataproviders/surveys", "SurveyInfoChanged")
      , h = b("nm/dataproviders/surveys", "CoverageStatus")
      , i = b("jscore/dateutils", "isEqualDateTime")
      , j = b("jscore/dateutils", "compareDateTimes")
      , k = b("jscore/itertools", "find")
      , l = b("jscore/itertools", "last")
      , m = b("nm/metrics", "trigger")
      , n = b("jscore/objtools", "Dictionary")
      , o = b("nm/const/imagery", "SURVEY")
      , p = b("nm/const/imagery", "TERRAIN")
      , q = b("nm/const/imagery", "ROAD")
      , r = b("nm/const/imagery", "SURVEY_N")
      , s = b("nm/const/imagery", "SURVEY_E")
      , t = b("nm/const/imagery", "SURVEY_S")
      , u = b("nm/const/imagery", "SURVEY_W")
      , v = b("nm/const/tools", "USE_DISCOVERY_SETTINGS")
      , w = new n([[o, "maptype.nmPhotomaps"], [p, "maptype.nmTerrain"], [q, "maptype.roadmap"], [r, "maptype.nmMultiViewN"], [s, "maptype.nmMultiViewE"], [t, "maptype.nmMultiViewS"], [u, "maptype.nmMultiViewW"]])
      , x = a.SurveysController = c(e, {
        constructor: function(a, b, c, d) {
            x.base.call(this),
            this._auth = a,
            this._surveyInfo = b,
            this._mapType = c,
            this._desiredDate = d,
            this._displayDate = null ,
            this.update(),
            this.setupListeners()
        },
        setupListeners: function() {
            this._surveyInfo.addListener(g, f(this, this.updateSurveyInfoChanged))
        },
        updateSurveyInfoChanged: function() {
            this.update() && this.changed()
        },
        update: function() {
            var a = this._desiredDate
              , b = this.getAvailableDates();
            if (0 === b.length)
                return null  !== this._displayDate ? (this._displayDate = null ,
                !0) : !0;
            var c = null ;
            if (null  === a) {
                c = b.slice(),
                c.sort(j);
                var d = l(c);
                return i(d, this._displayDate, !0) ? !0 : (this._displayDate = d,
                !0)
            }
            var e = k(b, null , function(b) {
                return i(a, b, !0)
            });
            if (null  !== e)
                return null  !== this._displayDate && i(a, this._displayDate, !0) ? !0 : (this._displayDate = a,
                !0);
            null  === c && (c = b.slice(),
            c.sort(j));
            for (var f = 0, g = b.length; g - 1 > f; f++) {
                var h = c[f]
                  , m = j(a, h);
                if (-1 === m)
                    break
            }
            0 === f && f++;
            var n = c[f - 1];
            return null  !== this._displayDate && i(n, this._displayDate, !0) ? !0 : (this._displayDate = n,
            !0)
        },
        setDesiredDate: function(a) {
            i(a, this._desiredDate, !0) || (this._desiredDate = a,
            this.update(),
            this.changed())
        },
        setMapType: function(a) {
            if (this._mapType !== a) {
                this._mapType = a;
                var b = w.get(a);
                m(b),
                this.update(),
                this.changed()
            }
        },
        getDesiredDate: function() {
            return this._desiredDate
        },
        getDisplayDate: function() {
            return this._displayDate
        },
        getAvailableDates: function(a) {
            a = a || this._mapType;
            var b = this._surveyInfo.getDates(a);
            return b
        },
        getAllAvailableDates: function() {
            return this._surveyInfo.getData().layers
        },
        getMapType: function() {
            return this._mapType
        },
        isAreaAllowed: function() {
            if (this._auth.can(v))
                return !0;
            var a = this._surveyInfo
              , b = a.getData();
            return b && b.hasOwnProperty("within_allowed_area") ? Boolean(b.within_allowed_area) : !1
        },
        getCoverageStatus: function() {
            return this._surveyInfo.getCoverage()
        },
        hasDSMTiles: function() {
            var a = this._surveyInfo
              , b = a.getData();
            if (b && b.hasOwnProperty("coverage_status")) {
                var c = b.coverage_status;
                if ((c === h.FULL || c === h.PARTIAL) && b.hasOwnProperty("layers")) {
                    var d = b.layers;
                    if (d.hasOwnProperty("Dsm_"))
                        return !0
                }
            }
            return !1
        },
        hasAnyCoverage: function() {
            var a = this._surveyInfo
              , b = a.getCoverage();
            return b !== h.NONE
        },
        hasFullCoverage: function() {
            var a = this._surveyInfo
              , b = a.getData();
            return b.coverage_status === h.FULL
        }
    })
}),
nm_module("nm/views/timeline/dropdowntimeline", function(a, b, c, d) {
    function e(a, b) {
        var c = q(a);
        return c.sort(b),
        c
    }
    var f = b("jscore/dateutils", "isEqualDateTime")
      , g = b("jscore/dateutils", "compareDateTimes")
      , h = b("jscore/dateutils", "format")
      , i = b("jscore/dateutils", "parse")
      , j = b("nm/intl", "getText")
      , k = b("nm/dom/event", "normalizeWheelDelta")
      , l = b("nm/metrics", "trigger")
      , m = b("jscore/events", "Change")
      , n = b("jscore/strings", "format")
      , o = b("jscore/functools", "bind")
      , p = b("jscore/itertools", "find")
      , q = b("jscore/itertools", "array")
      , r = b("js-libs/jquery", "jQuery");
    a.DropDownTimeLine = c(Object, {
        constructor: function(a) {
            this._surveysController = a,
            this._initializeBackgroundColors(),
            this._initMarkupComponents(),
            this._setupListeners(),
            this._updateList()
        },
        _initializeBackgroundColors: function() {
            this._GREEN_BACKGROUND = 0,
            this._WHITE_BACKGROUND = 1;
            var a = [];
            a[this._GREEN_BACKGROUND] = "rgb(0, 157, 81)",
            a[this._WHITE_BACKGROUND] = "white";
            var b = [];
            b[this._GREEN_BACKGROUND] = "white",
            b[this._WHITE_BACKGROUND] = "black",
            this._backGroundColors = a,
            this._fontColors = b
        },
        _initMarkupComponents: function() {
            this.node = r('<div class="dropDownContainer"></div>'),
            this._lstDates = r('<select class="dropDownTimelineControl"><select>'),
            this.node.append(this._lstDates),
            this._setBackgroundColor(this._GREEN_BACKGROUND)
        },
        _setBackgroundColor: function(a) {
            var b = this._backGroundColors[a]
              , c = this._fontColors[a];
            this._lstDates.css("background", b),
            this._lstDates.css("color", c)
        },
        _onNodeChange: function(a) {
            var b = a.target.value;
            b = "" === b ? null  : i(b),
            this._surveysController.setDesiredDate(b),
            l("selectSurveyDropDown", {
                label: "Survey",
                description: b
            })
        },
        _onMouseScroll: function(a) {
            var b = k(a.originalEvent)
              , c = this._lstDates[0]
              , d = c.selectedIndex
              , e = c.options.length - 1
              , f = d + -1 * b;
            0 > f && (f = 0),
            f > e && (f = e),
            c.selectedIndex = f,
            this._onNodeChange(a)
        },
        _onStreeViewChange: function() {
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap;
            this._show(!b.streetView.getVisible())
        },
        _setupListeners: function() {
            this._surveysController.addListener(m, o(this, this._updateList)),
            this._lstDates.change(o(this, this._onNodeChange)),
            this._lstDates.on("mousewheel DOMMouseScroll", o(this, this._onMouseScroll));
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap;
            b.getStreetView().addListener("visible_changed", o(this, this._onStreeViewChange)),
            this._surveysController.addListener(m, o(this, this._onStreeViewChange))
        },
        canRender: function(a) {
            return null  === a && (a = this._surveysController.getAvailableDates()),
            0 === a.length ? (this._show(!1),
            !1) : (this._show(!0),
            !0)
        },
        _show: function(a) {
            a ? this.node.css("display", "block") : a || this.node.css("display", "none")
        },
        _updateList: function() {
            var a = this._surveysController.getAvailableDates();
            if (this.canRender(a)) {
                var b = this._surveysController;
                a = e(a, g);
                var c, i = b.getDesiredDate(), k = b.getDisplayDate();
                c = null  !== k ? h(k, "yyyy-mm-dd", !0) : "";
                var l = !0;
                if (null  !== i) {
                    var m = p(a, null , function(a) {
                        return f(i, a)
                    });
                    null  === m && (l = !1,
                    a.push(i),
                    a = e(a, g))
                }
                var o = this._lstDates;
                o.empty();
                for (var q, r = "yyyy-mm-dd", s = j("formats.day-date"), t = a[d.iterator](); !(q = t.next()).done; ) {
                    var u, v = q.value, w = h(v, r, !0), x = h(v, s, !0);
                    u = !l && f(v, i) ? n('<option disabled="true" value="{iso}">{lbl}</option>', {
                        iso: w,
                        lbl: x
                    }) : n('<option value="{iso}">{lbl}</option>', {
                        iso: w,
                        lbl: x
                    }),
                    o.prepend(u)
                }
                var y = a.length - 1
                  , z = h(a[y], s, !0);
                o.prepend('<option value="">Latest (' + z + ")</option>"),
                null  === i ? o.val("") : o.val(c),
                null  === i ? this._setBackgroundColor(this._WHITE_BACKGROUND) : f(k, i) ? this._setBackgroundColor(this._GREEN_BACKGROUND) : this._setBackgroundColor(this._WHITE_BACKGROUND)
            }
        }
    })
}),
nm_module("nm/dataproviders/search/isearchprovider", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.ISearchProvider = c(e, {
        constructor: function(a) {
            f.base.call(this),
            this._latestSearchResults = null ,
            this._limit = a
        },
        search: function() {},
        getLatestSearchResults: function() {},
        getSearchQuery: function() {}
    })
}),
nm_module("nm/boundingbox", function(a, b, c, d) {
    var e = b("nm/geom", "LatLng");
    a.BoundingBox = c(Object, {
        constructor: function(a, b) {
            this._topRight = a,
            this._bottomLeft = b
        },
        getTopRight: function() {
            return this._topRight
        },
        getBottomLeft: function() {
            return this._bottomLeft
        },
        equals: function(a) {
            return !(!this._topRight.equals(a.getTopRight()) && !this._bottomLeft.equals(a.getBottomLeft()))
        },
        toJSON: function() {
            var a = {
                topright: this._topRight,
                bottomleft: this._bottomLeft
            };
            return a
        },
        fromJSON: function(a) {
            var b = new e
              , c = new e;
            b.fromJSON(a.topright),
            c.fromJSON(a.bottomleft),
            this._topRight = b,
            this._bottomLeft = c
        }
    })
}),
nm_module("nm/dataproviders/search/addresscomponents", function(a, b, c, d) {
    a.AddressComponents = c(Object, {
        constructor: function(a, b, c, d, e, f, g, h, i) {
            this._streetNumber1 = a,
            this._streetNumber2 = b,
            this._streetName = c,
            this._streetType = d,
            this._streetSuffix = e,
            this._locality = f,
            this._stateTerritory = g,
            this._postCode = h,
            this._country = i
        },
        getStreetNumber1: function() {
            return this._streetNumber1
        },
        getStreetNumber2: function() {
            return this._streetNumber2
        },
        getStreetName: function() {
            return this._streetName
        },
        getStreetType: function() {
            return this._streetType
        },
        getStreetSuffix: function() {
            return this._streetSuffix
        },
        getLocality: function() {
            return this._locality
        },
        getStateTerritory: function() {
            return this._stateTerritory
        },
        getPostCode: function() {
            return this._postCode
        },
        getCountry: function() {
            return this._country
        },
        toJSON: function() {
            var a = this._streetNumber1
              , b = this._streetNumber2
              , c = this._streetName
              , d = this._streetType
              , e = this._streetSuffix
              , f = this._locality
              , g = this._stateTerritory
              , h = this._postCode
              , i = this._country
              , j = {
                streetNumber1: a,
                streetNumber2: b,
                streetName: c,
                streetType: d,
                streetSuffix: e,
                locality: f,
                stateTerritory: g,
                postCode: h,
                country: i
            };
            return j
        },
        equals: function(a) {
            return this._streetNumber1 === a.getStreetNumber1() && this._streetNumber2 === a.getStreetNumber2() && this._streetName === a.getStreetName() && this._streetType === a.getStreetType() && this._streetSuffix === a.getStreetType() && this._locality === a.getLocality() && this._stateTerritory === a.getStateTerritory() && this._postCode === a.getPostCode() && this._country === a.getCountry()
        },
        fromJSON: function(a) {
            this._streetNumber1 = a.streetNumber1,
            this._streetNumber2 = a.streetNumber2,
            this._streetName = a.streetName,
            this._streetType = a.streetType,
            this._streetSuffix = a.streetSuffix,
            this._locality = a.locality,
            this._stateTerritory = a.stateTerritory,
            this._postCode = a.postCode,
            this._country = a.country
        }
    })
}),
nm_module("nm/dataproviders/search/searchresult", function(a, b, c, d) {
    var e = b("nm/geom", "LatLng")
      , f = b("nm/boundingbox", "BoundingBox")
      , g = b("nm/dataproviders/search/addresscomponents", "AddressComponents");
    a.SearchResult = c(Object, {
        constructor: function(a, b, c, d, e) {
            this._displayName = a,
            this._position = b,
            this._boundingBox = c,
            this._isPartialMatch = d,
            this._addressComponents = e
        },
        getDisplayName: function() {
            return this._displayName
        },
        getPosition: function() {
            return this._position
        },
        getBoundingBox: function() {
            return this._boundingBox
        },
        getAddressComponents: function() {
            return this._addressComponents
        },
        isPartialMatch: function() {
            return this._isPartialMatch
        },
        toJSON: function() {
            var a = this._displayName
              , b = this._position
              , c = this._boundingBox
              , d = this._isPartialMatch
              , e = this._addressComponents
              , f = {
                displayName: a,
                position: b,
                boundingBox: c,
                isPartialMatch: d,
                addressComponents: e
            };
            return f
        },
        equals: function(a) {
            return !!(this._displayName === a.getDisplayName() && this._position.equals(a.getPosition()) && this._boundingBox.equals(a.getBoundingBox()) && this._isPartialMatch === a.isPartialMatch() && this._addressComponents.equals(a.getAddressComponents()))
        },
        fromJSON: function(a) {
            this._displayName = a.displayName;
            var b = new e
              , c = new f
              , d = new g;
            b.fromJSON(a.position),
            c.fromJSON(a.boundingBox),
            this._position = b,
            this._boundingBox = c,
            this._isPartialMatch = a.isPartialMatch,
            d.fromJSON(a.addressComponents),
            this._addressComponents = d
        }
    })
}),
nm_module("nm/dataproviders/search/googlesearchprovider", function(a, b, c, d) {
    function e(a, b, c) {
        c = c || "long_name";
        for (var d = 0; d < b.length; d += 1) {
            var e = b[d];
            if (e.types.indexOf(a) > -1)
                return e[c]
        }
        return null 
    }
    function f(a) {
        for (var b = [], c = 0; c < a.length; c++) {
            var d = a[c]
              , f = a[c].geometry
              , g = d.formatted_address
              , h = new n(f.location.lat(),f.location.lng())
              , i = f.viewport.getNorthEast().lat()
              , k = f.viewport.getNorthEast().lng()
              , l = new n(i,k)
              , m = f.viewport.getSouthWest().lat()
              , p = f.viewport.getSouthWest().lng()
              , r = new n(m,p)
              , s = new o(l,r)
              , z = d.hasOwnProperty("partial_match")
              , A = d.address_components
              , B = null 
              , C = null 
              , D = null 
              , E = e(t, A)
              , F = e(u, A)
              , G = e(v, A)
              , H = e(w, A)
              , I = e(x, A)
              , J = e(y, A)
              , K = new q(E,D,F,B,C,G,H,I,J)
              , L = new j(g,h,s,z,K);
            b.push(L)
        }
        return b
    }
    function g(a) {
        for (var b = [], c = [], d = 0; d < a.length; d++) {
            var e = a[d];
            -1 === l.inArray(e.formatted_address, c) && (b.push(e),
            c.push(e.formatted_address))
        }
        return b
    }
    function h(a, b) {
        if (1 === a.length && b) {
            var c = a[0]
              , d = e("country", c.address_components, "short_name");
            if (c.partial_match && d === b && 1 === c.address_components.length)
                return []
        }
        return a
    }
    var i = b("nm/dataproviders/search/isearchprovider", "ISearchProvider")
      , j = b("nm/dataproviders/search/searchresult", "SearchResult")
      , k = b("jscore/functools", "bind")
      , l = b("js-libs/jquery", "jQuery")
      , m = b("nm/intl", "getSetting")
      , n = b("nm/geom", "LatLng")
      , o = b("nm/boundingbox", "BoundingBox")
      , p = b("jscore/types", "isUndefinedOrNull")
      , q = b("nm/dataproviders/search/addresscomponents", "AddressComponents")
      , r = b("nm/const/tools", "SEARCH_WITH_RESTRICTION")
      , s = b("js-libs/google", "maps")
      , t = "street_number"
      , u = "route"
      , v = "locality"
      , w = "administrative_area_level_1"
      , x = "postal_code"
      , y = "country"
      , z = 10
      , A = a.GoogleSearchProvider = c(i, {
        constructor: function(a, b) {
            A.base.call(this),
            this.tmpGoogleMapViewController = b.tmpGoogleMapViewController,
            this.auth = a,
            this._geocoder = new s.Geocoder,
            this._limit = z
        },
        search: function(a) {
            if (this._query = a,
            -1 !== a.indexOf("@")) {
                var b = a.split("@")
                  , c = b[0]
                  , d = b[1];
                if (-1 !== d.indexOf(",")) {
                    var e = d.split(",")
                      , i = new n(parseFloat(e[0]),parseFloat(e[1]))
                      , l = 5e-4
                      , p = new o(new n(i.getLat() - l,i.getLon() + l),new n(i.getLat() + l,i.getLon() - l))
                      , t = new j(c,i,p,!1,new q);
                    this._broadcastResults([t])
                } else
                    this._broadcastResults([])
            } else {
                var u = m("country")
                  , v = {
                    address: a,
                    region: u.toLowerCase()
                };
                if (this.auth.can(r))
                    v.componentRestrictions = {
                        country: u
                    };
                else {
                    var w = this.tmpGoogleMapViewController.getBounds();
                    w = new s.LatLngBounds(new s.LatLng(w.bottom,w.left),new s.LatLng(w.top,w.right)),
                    v.bounds = w
                }
                this._geocoder.geocode(v, k(this, function(a, b) {
                    b === s.GeocoderStatus.OK ? (a = g(a),
                    a = h(a, u),
                    a = f(a),
                    this._broadcastResults(a)) : this._broadcastResults([])
                }))
            }
        },
        getLatestSearchResults: function() {
            var a = this._latestSearchResults;
            return p(a) ? [] : a
        },
        getSearchQuery: function() {
            return this._query
        },
        _broadcastResults: function(a, b) {
            this._query = b,
            this._latestSearchResults = a,
            this.changed()
        }
    })
}),
nm_module("nm/dataproviders/property/boundaries", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/functools", "bind")
      , g = b("nm/const/endpoints", "MAPS")
      , h = b("jscore/types", "isFunction")
      , i = b("nm/console", "log")
      , j = b("nm/ajax", "ajax")
      , k = g + "?nml=overlay&nmprovider=propintel&cmd=propgeom"
      , l = a.PropertyBoundsProvider = c(e, {
        constructor: function(a) {
            l.base.call(this),
            this.coords = a,
            this.lastCoords = null ,
            this.enabled = !1,
            this._data = null ,
            this.callback = null 
        },
        update: function(a) {
            if (this.coords) {
                if (this.lastCoords && this.lastCoords.equals(this.coords))
                    return void this.process(this._data, "success");
                this.callback = a,
                this._data = null ;
                var b = k;
                j({
                    type: "GET",
                    url: b,
                    data: {
                        coords: this.coords.lng() + "," + this.coords.lat()
                    },
                    dataType: "json"
                }).done(f(this, this.process)).fail(f(this, this.processError))
            }
        },
        process: function(a, b) {
            return "success" === b && a && a.hasOwnProperty("type") && a.hasOwnProperty("properties") ? (this.lastCoords = this.coords,
            this._data = a,
            h(this.callback) && this.callback(a),
            void this.changed()) : void this.processError()
        },
        processError: function(a, b, c) {
            this._data || (this.lastCoords = null ,
            this._data = null ,
            i("Error during propertyintel geom request: " + b + ", " + c),
            h(this.callback) && this.callback(null ),
            this.changed())
        },
        getData: function() {
            return this._data
        },
        setCoords: function(a, b) {
            a && (this.coords = a,
            this.enabled && this.update(b),
            this.changed())
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a && this.update(),
            this.changed())
        },
        destroy: function() {
            this.enabled = !1
        }
    })
}),
nm_module("nm/tools", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.Tool = c(e, {
        constructor: function() {
            f.base.call(this),
            this.enabled = !1
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            this.changed())
        }
    })
}),
nm_module("nm/tools/property/boundsselector", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("jscore/functools", "bind")
      , g = b("nm/dataproviders/property/boundaries", "PropertyBoundsProvider")
      , h = b("nm/tools", "Tool")
      , i = b("nm/const/tools", "PROPERTY_KEY")
      , j = b("jscore/dateutils", "format")
      , k = b("js-libs/jquery", "jQuery")
      , l = a.settings = {
        boundsInfo: !0,
        label: "Boundaries:"
    }
      , m = a.PropertyBoundsAttributes = {
        prop: {
            created: {
                label: "Created",
                type: "date"
            },
            state: {
                label: "State",
                type: "string"
            }
        },
        cad: {
            created: {
                label: "Created",
                type: "date"
            },
            locality: {
                label: "Locality",
                type: "string"
            },
            parcelStatus: {
                label: "Parcel Status",
                type: "string"
            },
            parcelType: {
                label: "Parcel Type",
                type: "string"
            },
            state: {
                label: "State",
                type: "string"
            }
        }
    }
      , n = a.PropertyBoundsSelectorTool = c(h, {
        constructor: function(a, b) {
            n.base.call(this),
            this.options = k.extend({}, l, b),
            this.auth = a,
            this.enabled = !1,
            this.visible = !1,
            this.boundsInfo = this.options.boundsInfo,
            this.provider = new g(null ),
            this._$node = null ,
            this._$selectors = null ,
            this._$infoNode = null ,
            this._$arrows = null ,
            this._selectedFeatures = ["prop", "cad"],
            this.init()
        },
        createHTML: function() {
            this._$node = k('<ul class="pi-slc">   <li>' + this.options.label + '</li>   <li>       <label>           <input type="checkbox" name="radio-selection"                class="pi-chk" value="prop" />            Property       </label>   </li>   <li>       <label>           <input type="checkbox" name="radio-selection"                class="pi-chk" value="cad" />            Cadastre       </label>   </li></ul>'),
            this._$selectors = this._$node.find("input:checkbox[name=radio-selection]");
            for (var a = 0; a < this._$selectors.length; a++) {
                var b = this._$selectors[a];
                -1 !== this._selectedFeatures.indexOf(b.value) && (b.checked = !0)
            }
        },
        init: function(a, b) {
            this.createHTML(),
            this.boundsInfo && this._setExpanders(),
            this.setupListeners(),
            this.setVisible(b || this.visible),
            this.enable(a)
        },
        setupListeners: function() {
            this.auth.addListener(e, f(this, this.enable)),
            this._$selectors.on("change", f(this, this._onchange))
        },
        setCoords: function(a, b) {
            this.provider.setCoords(a, b)
        },
        enable: function(a) {
            var b;
            b = void 0 === a ? this.auth.can(i) : a,
            this.setEnabled(b),
            this.provider.setEnabled(b && this.visible)
        },
        isEnabled: function() {
            return this.enabled
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.changed())
        },
        getSelectedFeatures: function() {
            return this._selectedFeatures
        },
        setSelectedFeatures: function() {
            var a = [];
            this._$selectors.each(function() {
                var b = this;
                b.checked && a.push(b.value)
            }),
            this._selectedFeatures = a
        },
        getContainerElem: function() {
            return this._$node[0]
        },
        getInfoElem: function() {
            return this._$infoNode[0]
        },
        _setExpanders: function() {
            if (this.getContainerElem()) {
                var a = k('<span class="pi-img-sml show-detail"  title="Click to show or hide details">&nbsp;</span>')
                  , b = this._$selectors.parent();
                b.after(a),
                this._$infoNode = k('<div class="pi-bounds-info" />'),
                this._$node.append(this._$infoNode),
                this._$arrows = b.parent().find(".pi-img-sml"),
                this._$arrows.on("click", f(this, this._onClickExpanders))
            }
        },
        _onClickExpanders: function(a) {
            var b = k(a.target)
              , c = b.parent()
              , d = this._$selectors.parent().parent()
              , e = c.find("input").val();
            e && (d.removeClass("pi-selected"),
            this._$infoNode.hide(),
            b.hasClass("rotated") ? d.find(".pi-img-sml").removeClass("rotated") : (d.find(".pi-img-sml").removeClass("rotated"),
            b.addClass("rotated"),
            c.addClass("pi-selected"),
            this._$infoNode.show(),
            this._displayBoundsInfo(this.provider.getData(), e)))
        },
        _displayBoundsInfo: function(a, b) {
            if (a) {
                for (var c, d, e, f, g = m, h = k("<table>", {
                    "class": "pi"
                }), i = 0; i < a.features.length; i++)
                    if (c = a.features[i],
                    c.hasOwnProperty("properties") && c.properties.hasOwnProperty("type") && c.properties.hasOwnProperty("fields") && (f = c.properties,
                    d = f.type,
                    e = f.fields),
                    b === d) {
                        var l = g[d];
                        f.hasOwnProperty("name") && a.features.length > 2 && h.append('<tr><th colspan="2">' + c.properties.name + "</th></tr>");
                        for (var n in l)
                            if (e.hasOwnProperty(n)) {
                                var o = l[n].label
                                  , p = l[n].type
                                  , q = e[n].value;
                                "date" === p && (q = j(new Date(q), "d mmm yyyy", !0)),
                                h.append(k("<tr>").append(k("<td>", {
                                    "class": "pi-val-detail pi-lab"
                                }).append(o + " "), k("<td>", {
                                    "class": "pi-val-detail"
                                }).append(q)))
                            }
                    }
                this._$infoNode.empty().append(h)
            }
        },
        _onchange: function() {
            this.setSelectedFeatures(),
            this.changed()
        },
        changed: function() {
            this.provider.setEnabled(this.visible && this.enabled),
            n.base.prototype.changed.call(this)
        },
        destroy: function() {
            this.enabled = !1,
            this.visible = !1,
            this.auth.removeListeners(this),
            this._$selectors.off("change", f(this, this._onchange)),
            this.boundsInfo && (this._$arrows.off("click", f(this, this._onClickExpanders)),
            this._$infoNode = null ),
            this._$node = null ,
            this._$selectors = null 
        }
    })
}),
nm_module("nm/dataproviders/property/conditions", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/functools", "bind")
      , g = b("nm/const/endpoints", "MAPS")
      , h = b("nm/console", "log")
      , i = b("nm/ajax", "ajax")
      , j = g + "?nml=overlay&nmprovider=propintel&cmd=conditions"
      , k = 5e3
      , l = a.PropertyConditionsProvider = c(e, {
        constructor: function(a, b, c) {
            l.base.call(this),
            this.auth = a,
            this.bounds = b || null ,
            this.zoom = c || null ,
            this.conditions = [],
            this.enabled = !1,
            this._lastConditions = null ,
            this._lastBounds = null ,
            this._lastZoom = null ,
            this._data = null ,
            this._errorXhr = null 
        },
        update: function() {
            if (this.enabled && this.bounds && this.zoom && (this.zoom !== this._lastZoom || !this.bounds.equals(this._lastBounds) || JSON.stringify(this.conditions) !== JSON.stringify(this._lastConditions))) {
                var a = this.bounds
                  , b = j + "&bbox=" + a.getSouthWest().lng() + "," + a.getSouthWest().lat() + "," + a.getNorthEast().lng() + "," + a.getNorthEast().lat() + "&z=" + this.zoom;
                this._errorXhr = null ;
                var c = JSON.stringify({
                    conditions: this.conditions
                });
                i({
                    type: "POST",
                    url: b,
                    data: c,
                    contentType: "application/json",
                    dataType: "json",
                    timeout: k
                }).done(f(this, this.process)).fail(f(this, this.processError))
            }
        },
        process: function(a, b) {
            return "success" === b && a && a.hasOwnProperty("type") && a.hasOwnProperty("properties") ? (this._lastConditions = this.conditions,
            this._lastBounds = this.bounds,
            this._lastZoom = this.zoom,
            this._data = a,
            void this.changed()) : void this.processError()
        },
        processError: function(a, b, c) {
            this._errorXhr = a,
            this._data = null ,
            this.bounds = null ,
            this.zoom = null ,
            this._lastConditions = null ,
            this._lastBounds = null ,
            this._lastZoom = null ,
            h("Error during propertyintel conditions request: " + b + ", " + c, a),
            this.changed()
        },
        getData: function() {
            return this._data
        },
        getFailedXhr: function() {
            return this._errorXhr
        },
        sendData: function(a, b, c) {
            a && b && c && (this.conditions = a,
            this.bounds = b,
            this.zoom = c,
            this.enabled && this.update(),
            this.changed())
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a && this.update(),
            this.changed())
        },
        destroy: function() {
            this.enabled = !1,
            this.bounds = null ,
            this.zoom = null ,
            this._lastConditions = null ,
            this._lastBounds = null ,
            this._lastZoom = null ,
            this._data = null 
        }
    })
}),
nm_module("nm/views/search/searchview", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("js-libs/jquery", "jQuery")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/functools", "partial")
      , i = b("jscore/async", "setTimeout")
      , j = b("jscore/async", "clearTimeout")
      , k = b("nm/client", "isTabletDevice");
    a.SearchView = c(Object, {
        constructor: function(a, b, c, d, e, f) {
            this.mapView = a,
            this._searchController = c,
            this._notificationController = b,
            this._locationMarker = e,
            this._isExpanded = !1,
            this._isHistoryViewOpen = !1,
            this._addSubscriptionLink = d,
            this._appManager = f,
            this._closeSearchBoxTimeoutId = null ,
            this._preventSerachBoxFocus = !0,
            this._initMarkupComponents(),
            this._setupListeners()
        },
        show: function(a) {
            a ? (this.node.css("display", "block"),
            this._focus()) : a || this.node.css("display", "none"),
            this._preventSerachBoxFocus = !1
        },
        _focus: function() {
            this._preventSerachBoxFocus || k() || this._inputText.focus()
        },
        _resetWidth: function() {
            this._isExpanded && (this.node.css("width", ""),
            this._isExpanded = !1)
        },
        _setWidth: function(a, b) {
            if (!this._isExpanded)
                for (var c = b, d = 50, e = this.node.width(), f = this._inputText.width(), g = .1, h = 0, i = 8; i > 0; i--) {
                    h = parseInt(f * (1 + i * g), 10);
                    var j = e - c - d - h;
                    if (-j >= d)
                        return a ? this.node.css({
                            width: h + "px"
                        }) : this.node.animate({
                            width: h + "px"
                        }, 150),
                        void (this._isExpanded = !0)
                }
        },
        _initMarkupComponents: function() {
            this.node = f('<div class="nm-search"style="display: block; z-index: 1; position:absolute; left:42px; top: 0px;"></div>'),
            this._formContainer = f("<form></form>"),
            this._inputSubmit = f('<input type="submit" value="Go" class="button primary">'),
            this._inputText = f('<input type="text" placeholder="Search" class="input">'),
            this._formContainer.append(this._inputSubmit),
            this._formContainer.append(this._inputText),
            this._resultsContainer = f('<ul class="results"></ul>'),
            this._historyLabel = f('<div class="history-label">Search History</div>'),
            this._historyList = f("<ul></ul>"),
            this._historyClear = f('<div class="clear">Clear</div>'),
            this._historyContainer = f('<div class="history"></div>'),
            this._historyContainer.append(this._historyList),
            this._historyContainer.append(this._historyLabel),
            this._historyContainer.append(this._historyClear),
            this.node.append(this._formContainer),
            this.node.append(this._resultsContainer),
            this.node.append(this._historyContainer)
        },
        _setupListeners: function() {
            this._searchController.addListener(e, g(this, this._updateSearchResults)),
            this._formContainer.on("submit", g(this, this._onSearchSubmit)),
            this._historyLabel.on("click", g(this, this._toggleHistoryView)),
            this._historyClear.on("click", g(this, this._clearHistoryView)),
            this._closeSleepTimeout = null ,
            this._inputText.focus(g(this, this._onSearchBoxFocus)),
            this._inputText.blur(g(this, this._onSearchBoxBlur));
            var a = this.mapView.tmpGoogleMapViewController.gMap;
            a.getStreetView().addListener("visible_changed", g(this, this._onStreeViewChange))
        },
        setSearchString: function(a) {
            this._inputText.val(this._sanitize(a))
        },
        _onSearchSubmit: function(a) {
            a.preventDefault();
            var b = this._sanitize(this._inputText.val());
            this._searchController.search(b)
        },
        _onSearchBoxFocus: function() {
            null  !== this._closeSearchBoxTimeoutId && j(this._closeSearchBoxTimeoutId),
            this._setWidth(!1, 2e3)
        },
        _onSearchBoxBlur: function() {
            this._isHistoryViewOpen || (this._closeSearchBoxTimeoutId = i(g(this, function() {
                this._resetWidth()
            }), 750))
        },
        _toggleHistoryView: function() {
            this._isHistoryViewOpen ? (this._closeHistoryView(),
            this._onSearchBoxBlur()) : (null  !== this._closeSearchBoxTimeoutId && j(this._closeSearchBoxTimeoutId),
            this._isExpanded || this._onSearchBoxFocus(),
            this._openHistoryView())
        },
        _openHistoryView: function() {
            this._refreshHistoryView(),
            this._isHistoryViewOpen = !0,
            this._historyContainer.removeClass().addClass("history open")
        },
        _closeHistoryView: function() {
            this._isHistoryViewOpen = !1,
            this._historyContainer.removeClass().addClass("history")
        },
        _clearHistoryView: function() {
            this._searchController.clearHistory(),
            this._refreshHistoryView(),
            this._toggleHistoryView()
        },
        _refreshHistoryView: function() {
            this._historyList.empty();
            for (var a = this._searchController.getSearchHistory(), b = a.length - 1, c = 0; b >= c; c++) {
                var d = a[c]
                  , e = "<li>" + d.getDisplayName() + "</li>"
                  , i = f(e)
                  , j = h(g(this, this._clickSelectSearchHistory), d);
                if (i.click(j),
                this._historyList.append(i),
                this._addSubscriptionLink) {
                    var k = f('<div class="notify">Keep me updated</div>')
                      , l = h(g(this, this._onNotifyClick), d);
                    k.click(l),
                    i.append(k)
                }
            }
        },
        _onNotifyClick: function(a) {
            this._notificationController.createNotification(a)
        },
        _showAllSearchResults: function() {
            var a, b = this._searchController.getLatestSearchResults();
            if (0 === b.length)
                return void this._displayNoResults();
            this._openResults();
            var c = this._getEmptyContainer();
            if (b.length > 1)
                for (var d = 0, e = b.length; e > d; d++)
                    a = b[d],
                    this._addResultToContainer(a, c);
            else
                1 === b.length && (a = b[0],
                a.isPartialMatch() ? this._addResultToContainer(a, c) : (this._updateInputText(a),
                this._closeResults()),
                this._searchController.setSearchSelection(a))
        },
        _addResultToContainer: function(a, b) {
            var c = f("<li></li>");
            c.html(a.getDisplayName()),
            c.click(h(g(this, this._clickSelectResult), a)),
            b.append(c)
        },
        _updateInputText: function(a) {
            var b = a.getDisplayName();
            this._inputText.val(b)
        },
        _clickSelectResult: function(a) {
            this._searchController.setSearchSelection(a),
            this._updateInputText(a),
            this._closeResults()
        },
        _clickSelectSearchHistory: function(a) {
            this._searchController.setSearchSelection(a),
            this._updateInputText(a)
        },
        _getEmptyContainer: function() {
            var a = this._resultsContainer;
            return a.empty(),
            a
        },
        _displayNoResults: function() {
            this._openResults();
            var a = this._getEmptyContainer()
              , b = f('<li class="noresults">No results found</li>')
              , c = f('<div class="close">&times;</div>');
            b.click(g(this, this._closeResults)),
            b.append(c),
            a.append(b)
        },
        _updateSearchResults: function() {
            this._isHistoryViewOpen && this._closeHistoryView(),
            null  === this._searchController.getSearchSelection() && this._showAllSearchResults(),
            this._refreshHistoryView()
        },
        _openResults: function() {
            var a = this.node.attr("class");
            a = a.replace(/(^| )results-open($| )/g, " "),
            a += " results-open",
            this.node.removeClass().addClass(a)
        },
        _closeResults: function() {
            var a = this.node.attr("class");
            a = a.replace(/(^| )results-open($| )/g, " "),
            this.node.removeClass().addClass(a)
        },
        _sanitize: function(a) {
            var b = f.parseHTML(a, null , !1);
            return f(b).text()
        },
        _onStreeViewChange: function() {
            var a = this.mapView.tmpGoogleMapViewController.gMap;
            this.show(!a.streetView.getVisible())
        }
    })
}),
nm_module("nm/tools/search/searchcontroller", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("nm/metrics", "trigger")
      , i = a.SearchController = c(e, {
        constructor: function(a, b) {
            i.base.call(this),
            this._searchProvider = a,
            this._searchHistoryManager = b,
            this._searchSelection = null ,
            this._query = null ,
            this._setupListeners()
        },
        search: function(a) {
            this._searchProvider.search(a),
            h("search", {
                label: "Query",
                description: a
            })
        },
        clearHistory: function() {
            this._searchHistoryManager.clearHistory(),
            h("search.history.clear", {
                label: "Query",
                description: ""
            })
        },
        setSearchSelection: function(a) {
            this._searchSelection = a,
            this._searchHistoryManager.addHistoryItem(a),
            h("search.history.selected", {
                label: "Query",
                description: a
            }),
            this.changed({
                searchSelection: a
            })
        },
        getSearchSelection: function() {
            return this._searchSelection
        },
        getLatestSearchResults: function() {
            return this._searchProvider.getLatestSearchResults()
        },
        getSearchHistory: function() {
            return this._searchHistoryManager.getSearchHistory()
        },
        _setupListeners: function() {
            this._searchProvider.addListener(f, g(this, this._updateSearchInfoChanged))
        },
        _updateSearchInfoChanged: function() {
            this._searchSelection = null ;
            var a = this._searchProvider.getLatestSearchResults()
              , b = this._searchProvider.getSearchQuery();
            0 === a.length && h("search", {
                label: "Query",
                description: b
            }),
            this.changed({
                searchSelection: null 
            })
        }
    })
}),
nm_module("nm/dataproviders/search/searchhistorymanager", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("nm/dataproviders/search/searchresult", "SearchResult")
      , g = b("nm/localstorage", "getItem")
      , h = b("nm/localstorage", "setItem")
      , i = b("jscore/types", "isUndefinedOrNull")
      , j = a.SearchHistoryManager = c(e, {
        constructor: function(a) {
            j.base.call(this),
            this._historyData = null ,
            this._historyDataId = "search-history",
            this._init(),
            this._maxLength = a
        },
        addHistoryItem: function(a) {
            if (a instanceof f) {
                var b = this._indexOf(a);
                return b >= 0 && this._historyData.splice(b, 1),
                this._historyData.unshift(a),
                this._historyData.length > this._maxLength && this._historyData.pop(),
                this._save(),
                !0
            }
            return !1
        },
        _indexOf: function(a) {
            var b = this._historyData.length
              , c = 0;
            for (c; b > c; c++) {
                var d = this._historyData[c];
                if (d.equals(a))
                    return c
            }
            return -1
        },
        getSearchHistory: function() {
            return this._historyData
        },
        clearHistory: function() {
            this._historyData = [],
            this._save()
        },
        _save: function() {
            var a = JSON.stringify(this._historyData);
            h(this._historyDataId, a)
        },
        _load: function() {
            this._historyData = [];
            var a = g(this._historyDataId);
            if (!i(a))
                for (var b = JSON.parse(a), c = b.length, d = 0; c > d; d++) {
                    var e = new f;
                    try {
                        e.fromJSON(b[d]),
                        this._historyData.push(e)
                    } catch (h) {}
                }
        },
        _init: function() {
            this._load()
        }
    })
}),
nm_module("nm/tools/notifications/notificationcontroller", function(a, b, c, d) {
    var e = b("js-libs/jquery", "jQuery")
      , f = b("nm/const/endpoints", "API")
      , g = b("jscore/events", "ObservableObject")
      , h = b("jscore/functools", "bind")
      , i = b("nm/tools/state/statemanager", "EMAIL_NOTIFICATION")
      , j = b("nm/metrics", "trigger")
      , k = a.NOTIFICATION_SENT = 1
      , l = a.SHOW_DIALOG_REQUEST = 2
      , m = a.NotificationController = c(g, {
        constructor: function(a) {
            m.base.call(this),
            this._searchHistoryItem = null ,
            this._stateManager = a,
            this._flags = null ,
            this._currentStatusFlag = 0
        },
        getCurrentStatusFlags: function() {
            return this._currentStatusFlag
        },
        getEmailAddress: function() {
            var a = this._stateManager.loadSetting(i);
            return a
        },
        createNotification: function(a) {
            this._searchHistoryItem = a,
            this._currentStatusFlag = l,
            this.changed(),
            j("search.surveynotif.open", {
                label: "Notification",
                description: a
            })
        },
        getHistoryItem: function() {
            return this._searchHistoryItem
        },
        submitNotification: function(a, b) {
            var c = this._searchResultToSubscription(a, b);
            this._stateManager.saveSetting(i, a),
            e.ajax({
                type: "POST",
                url: f.SURVEY_NOTIFICATION,
                dataType: "json",
                data: c,
                success: h(this, this._successEmailCaptureCallback),
                error: h(this, this._errorEmailCaptureCallback)
            })
        },
        isEmailSubmittedSuccessfully: function() {
            return this._isEmailSubmittedSuccessfully
        },
        _successEmailCaptureCallback: function() {
            this._currentStatusFlag = k,
            this._isEmailSubmittedSuccessfully = !0,
            this.changed(),
            j("search.surveynotif.emailsaved", {
                label: "Notification",
                description: this._searchHistoryItem
            })
        },
        _errorEmailCaptureCallback: function() {
            this._currentStatusFlag = k,
            this._isEmailSubmittedSuccessfully = !1,
            this.changed(),
            j("search.surveynotif.error", {
                label: "Notification",
                description: this._searchHistoryItem
            })
        },
        _searchResultToSubscription: function(a, b) {
            var c = b.getAddressComponents()
              , d = b.getPosition()
              , e = {
                lat: d.lat,
                lon: d.lng,
                streetNumber1: c.getStreetNumber1(),
                streetNumber2: null ,
                streetName: c.getStreetName(),
                streetType: null ,
                streetSuffix: null ,
                locality: c.getLocality(),
                stateTerritory: c.getStateTerritory(),
                postCode: c.getPostCode(),
                country: c.getCountry(),
                email: a
            };
            return e
        }
    })
}),
nm_module("nm/views/dialog/useremaildialog", function(a, b, c, d) {
    var e = b("js-libs/jquery", "jQuery")
      , f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/types", "isUndefined")
      , i = b("nm/tools/notifications/notificationcontroller", "NOTIFICATION_SENT")
      , j = b("nm/tools/notifications/notificationcontroller", "SHOW_DIALOG_REQUEST");
    a.UserEmailDialog = c(Object, {
        constructor: function(a) {
            this._notificationController = a,
            this._isVisible = !1,
            this._searchHistoryItem = null ,
            this._initMarkupComponents(),
            this._setupListeners()
        },
        _initMarkupComponents: function() {
            this.node = e('<div class="notify-modalContainer"></div>')
        },
        _show: function() {
            if (!this._isVisible) {
                var a = this._notificationController.getEmailAddress();
                this._createDialogMarkup(a),
                this._initDialogEvents(),
                this._isVisible = !0;
                var b = this._searchHistoryItem.getDisplayName();
                this._addItemToMarkup(b, a),
                this.node.append(this._notifyItem),
                this._enableButtonSubmit()
            }
        },
        _createDialogMarkup: function(a) {
            var b;
            b = h(a) || null  === a ? "" : a,
            this._notifyItem = e('<div class="notify-item notify-information"></div>'),
            this._searchUpdateNotifyContainer = e('<form><div class="search-update-notify"></div></form>'),
            this._keepMeUpdatedContainer = e('<input type="email" style="width: 100%; border: 1px solid red;"placeholder="Email Address" class="keep-me-updated-email"value="' + b + '"><br>'),
            this._buttonSubmitContainer = e('<input type="submit" value="Register" class="button" disabled="">'),
            this._notifyCloseButton = e('<div class="notify-close"></div>'),
            this._searchUpdateNotifyContainer.append(this._keepMeUpdatedContainer),
            this._searchUpdateNotifyContainer.append(this._buttonSubmitContainer),
            this._notifyItem.append(this._searchUpdateNotifyContainer),
            this._notifyItem.append(this._notifyCloseButton)
        },
        _initDialogEvents: function() {
            this._searchUpdateNotifyContainer.on("submit", g(this, function(a) {
                a.preventDefault(),
                this._submitEmail()
            })),
            this._notifyCloseButton.click(g(this, function() {
                this._hide()
            }))
        },
        _hide: function() {
            this._isVisible && (this._isVisible = !1,
            this._htmlMessage.remove(),
            this.node.empty())
        },
        _addItemToMarkup: function(a) {
            this._htmlMessage = e("<div class='message'>Enter your email address and we'll notify you when we've updated the imagery for <strong>" + a + "</strong> <br></div>"),
            this._searchUpdateNotifyContainer.prepend(this._htmlMessage)
        },
        _setupListeners: function() {
            this._notificationController.addListener(f, g(this, this._checkEmailNotification))
        },
        _checkEmailNotification: function() {
            var a = this._notificationController.getCurrentStatusFlags();
            if ((a & j) === j) {
                var b = this._notificationController.getHistoryItem();
                return this._searchHistoryItem = b,
                void this._show()
            }
            if ((a & i) === i) {
                var c;
                return c = this._notificationController.isEmailSubmittedSuccessfully() ? "Email successfully saved." : "An error occurred, email not saved.Please try again later.",
                void this._buttonSubmitContainer.replaceWith(c)
            }
        },
        _enableButtonSubmit: function() {
            this._keepMeUpdatedContainer.css({
                border: "1px solid #666"
            }),
            this._buttonSubmitContainer.removeAttr("disabled")
        },
        _disableButtonSubmit: function() {},
        _submitEmail: function() {
            this._enableButtonSubmit(),
            this._keepMeUpdatedContainer.blur(),
            this._buttonSubmitContainer.attr("disabled", "disabled"),
            this._buttonSubmitContainer.val("Submitting...");
            var a = this._keepMeUpdatedContainer.val();
            this._notificationController.submitNotification(a, this._searchHistoryItem)
        }
    })
}),
nm_module("nm/tools/search/searchtool", function(a, b, c, d) {
    var e = b("nm/tools", "Tool")
      , f = b("jscore/events", "Change")
      , g = b("nm/geom", "LatLng")
      , h = b("nm/views/search/searchview", "SearchView")
      , i = b("nm/tools/search/searchcontroller", "SearchController")
      , j = b("nm/dataproviders/search/searchhistorymanager", "SearchHistoryManager")
      , k = b("nm/tools/notifications/notificationcontroller", "NotificationController")
      , l = b("nm/views/dialog/useremaildialog", "UserEmailDialog")
      , m = b("jscore/functools", "bind")
      , n = b("jscore/types", "isUndefinedOrNull")
      , o = b("nm/tools/state/statemanager", "LOCATION_MARKER_QUERY_STRING")
      , p = b("nm/metrics", "trigger")
      , q = 10
      , r = a.SEARCH_TITLE = "Search";
    a.SearchTool = c(e, {
        constructor: function(a, b, c, d, e, f, g, h) {
            this._auth = a,
            this._map = b,
            this._tmpGoogleMapViewController = b.tmpGoogleMapViewController,
            this._locationMarker = c,
            this._searchDivContainer = d,
            this._popupDivContainer = e,
            this._stateManager = g,
            this._searchProvider = f,
            this._surveysController = h,
            this._latest_imagery = !0,
            this.name = r,
            this._initializeViewsAndControllers(),
            this._searchDivContainer.append(this._searchView.node),
            this._popupDivContainer.append(this._userEmailDialog.node),
            this._setupListeners(),
            this._initializeSearchState()
        },
        _initializeSearchState: function() {
            var a = this._stateManager.loadSetting(o);
            if (!n(a) && null  !== this._locationMarker) {
                var b = a.split("@");
                if (2 !== b.length)
                    return;
                var c = b[0]
                  , d = b[1].split(",")
                  , e = new g(parseFloat(d[0]),parseFloat(d[1]));
                this._locationMarker.setMarker(e, c, null ),
                this._map.setCenter(e),
                this._searchView.setSearchString(a)
            }
        },
        _initializeViewsAndControllers: function() {
            this._searchHistoryManager = new j(q),
            this._searchController = new i(this._searchProvider,this._searchHistoryManager,this._surveysController),
            this._notificationController = new k(this._stateManager),
            this._userEmailDialog = new l(this._notificationController),
            this._searchView = new h(this._map,this._notificationController,this._searchController,!0,this._locationMarker)
        },
        start: function() {
            this._searchView.show(!0)
        },
        stop: function() {
            this._searchView.show(!1)
        },
        _setupListeners: function() {
            this._searchController.addListener(f, m(this, this._onSearchSelected))
        },
        getSearchController: function() {
            return this._searchController
        },
        enableLatestImagery: function() {
            this._latest_imagery = !0
        },
        disableLatestImagery: function() {
            this._latest_imagery = !1
        },
        _onSearchSelected: function(a) {
            var b = a.properties.searchSelection;
            if (null  !== b) {
                var c = b.getPosition()
                  , d = b.getDisplayName()
                  , e = [];
                e.push(c);
                var f = b.getBoundingBox()
                  , g = f.getTopRight()
                  , h = f.getBottomLeft();
                e.push(g),
                e.push(h);
                var i = this._map.getCenter()
                  , j = this._tmpGoogleMapViewController.getBounds()
                  , k = JSON.stringify({
                    address: d,
                    searchResultPosition: c,
                    searchResultBoundingBox: f,
                    mapsViewCenter: i,
                    mapsViewBoundingBox: j
                });
                p("search", {
                    label: "search tool - value: " + k,
                    description: "search item selected"
                }),
                this._tmpGoogleMapViewController.showPoints(e),
                this._latest_imagery && this._surveysController.setDesiredDate(null ),
                null  !== this._locationMarker && this._locationMarker.setMarker(c, null , d),
                this._latest_imagery = !0
            }
        }
    })
}),
nm_module("nm/dataproviders/elevation/nmelev", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/async", "callWhenIdle")
      , i = b("nm/ajax", "ajax")
      , j = b("jscore/dateutils", "format")
      , k = b("nm/views/google/convert", "toGoogle")
      , l = b("nm/geom", "LatLng")
      , m = b("js-libs/google", "maps")
      , n = b("nm/const", "HOST_URL")
      , o = n + "maps/api/demtools/v1/calculateprofile"
      , p = a.ElevationProvider = c(e, {
        constructor: function(a) {
            p.base.call(this),
            this.enabled = !1,
            this.feature = null ,
            this.elevations = null ,
            this.source = "nearmap",
            this.date = null ,
            this.surveysCtl = a,
            this.changeHandler = g(this, h(g(this, this.update))),
            this.surveysCtl.addListener(f, this.changeHandler)
        },
        setFeature: function(a) {
            var b = this.feature;
            b && b.removeListeners(this),
            this.feature = a || null ,
            this.elevations = null ,
            a && (a.addListener(f, this.changeHandler),
            this.changeHandler(),
            this.elevations = []),
            this.changed()
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a && this.update(),
            this.changed())
        },
        getDate: function() {
            return this.date
        },
        getSource: function() {
            return this.source
        },
        getElevations: function() {
            return this.elevations
        },
        update: function() {
            var a = this
              , b = a.surveysCtl
              , a = a.feature;
            if (this.enabled && a && a.coordinates.length > 1) {
                this.date = b.getDisplayDate();
                var c = j(this.date, "yyyymmdd")
                  , d = k(a.coordinates)
                  , e = m.geometry.encoding.encodePath(d)
                  , f = 500;
                i({
                    type: "GET",
                    url: o,
                    dataType: "json",
                    data: {
                        nmx: e,
                        numsamples: f,
                        nmd: c
                    },
                    contentType: "application/json",
                    success: function(a) {
                        return this.handleData(a)
                    }
                    .bind(this),
                    error: function(a) {
                        return this.handleError(a)
                    }
                    .bind(this)
                }),
                !(this.enabled && a && a.coordinates.length > 1)
            }
        },
        handleData: function(a) {
            this.elevations = function(b) {
                for (var c, e = a.geometry.coordinates[d.iterator](); !(c = e.next()).done; ) {
                    var f = c.value
                      , g = f[2]
                      , h = f[1]
                      , f = f[0];
                    b.push({
                        location: new l(h,f),
                        elevation: g
                    })
                }
                return b
            }
            .call(this, []),
            this.changed()
        },
        handleError: function() {
            this.elevations = null 
        }
    })
}),
nm_module("nm/dataproviders/elevation", function(a, b, c, d) {
    function e(a) {
        return m(a, function(a) {
            return "undefined" != typeof a
        }
        .bind(this))
    }
    var f = b("jscore/async", "callWhenIdle")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/functools", "partial")
      , i = b("jscore/events", "ObservableObject")
      , j = b("jscore/itertools", "map")
      , k = b("jscore/itertools", "array")
      , l = b("jscore/itertools", "chunks")
      , m = b("jscore/itertools", "filter")
      , n = b("jscore/itertools", "ichain")
      , o = b("jscore/events", "Change")
      , p = b("nm/geom", "LatLng")
      , q = b("js-libs/google", "maps")
      , r = a.ElevationProvider = c(i, {
        constructor: function() {
            r.base.call(this),
            this.enabled = !1,
            this.feature = null ,
            this.elevations = null ,
            this.source = "Google",
            this.date = null ,
            this.changeHandler = g(this, f(g(this, this.update), 500))
        },
        setFeature: function(a) {
            var b = this.feature;
            b && b.removeListeners(this),
            this.feature = a || null ,
            this.elevations = null ,
            a && (a.addListener(o, this.changeHandler),
            this.changeHandler(),
            this.elevations = []),
            this.changed()
        },
        update: function() {
            var a = new q.ElevationService
              , b = this.feature;
            if (this.enabled && b && b.coordinates.length > 1) {
                var c = k(j(b.coordinates, function(a) {
                    return new q.LatLng(a.lat,a.lng)
                }))
                  , d = 100;
                c.length % d === 1 && c.push(c[c.length - 1]);
                var f = k(l(c, d))
                  , i = new Array(f.length)
                  , m = Math.round(500 / f.length);
                f.forEach(g(this, function(c, d) {
                    c = k(e(c));
                    var f = {
                        path: c,
                        samples: m
                    };
                    a.getElevationAlongPath(f, g(this, h(this.handleResponse, b, i, d)))
                }))
            }
        },
        handleResponse: function(a, b, c, d, f) {
            if (this.elevations = [],
            f === q.ElevationStatus.OK && this.feature === a) {
                var g = j(d, function(a) {
                    var b = a.location;
                    return b = new p(b.lat(),b.lng()),
                    {
                        location: b,
                        elevation: a.elevation
                    }
                });
                b[c] = k(g),
                this.elevations = k(n(e(b)))
            }
            this.changed()
        },
        getDate: function() {
            return this.date
        },
        getSource: function() {
            return this.source
        },
        getElevations: function() {
            return this.elevations
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a && this.update(),
            this.changed())
        }
    })
}),
nm_module("nm/tools/elevation/elevationdto", function(a, b, c, d) {
    function e(a, b, c) {
        var d = k.geometry.spherical.computeDistanceBetween(a, b);
        return d * m[c]
    }
    var f = b("nm/intl", "getText")
      , g = b("jscore/strings", "format")
      , h = b("jscore/itertools", "array")
      , i = b("jscore/itertools", "map")
      , j = b("jscore/dateutils", "format")
      , k = b("js-libs/google", "maps")
      , l = '   <div class="elevation-container-tooltip">   <div class="elevation-row">     <div class="elevation-cell        elevation-cell-left-align"><span>{name} Elevation: </span> </div>     <div class="elevation-cell elevation-cell-right-align">        {el:,.0f} {unit} </div>     </div>     <div class="elevation-row">       <div class="elevation-cell elevation-cell-left-align">       <span>{name} Slope: </span>  </div>       <div class="elevation-cell elevation-cell-right-align">        {sl:0.1%} </div>     </div>   <div class="elevation-row">     <div class="elevation-cell elevation-cell-left-align">       <span>{name} Distance: </span>  </div>     <div class="elevation-cell elevation-cell-right-align">        {dist:,.0f} {unit} </div>     </div>   </div>'
      , m = {
        cm: 100,
        m: 1,
        km: .001,
        "in": 39.3700787,
        ft: 3.2808399,
        yd: 1.0936133,
        mi: .000621371192,
        nmi: .000539956803
    }
      , n = a.ElevationDTO = c(Object, {
        constructor: function(a, b, c, d) {
            n.base.call(this),
            b = h(i(b, function(a) {
                var b = a
                  , c = b.elevation
                  , b = b.location;
                return c *= m[d],
                {
                    location: b,
                    elevation: c
                }
            }
            .bind(this))),
            this._elevations = b,
            this._date = c,
            this._name = a,
            this.measurementUnit = d,
            this.initializeData(),
            this.createSummary(b, c)
        },
        initializeData: function() {
            this._totalDistance = 0,
            this._totalSlope = 0,
            this._maxElevation = 0,
            this._minElevation = 0,
            this._totalElevation = 0,
            this._maxSlopePos = 0,
            this._maxSlopeNeg = 0,
            this._avgElevation = 0,
            this._avgSlope = 0,
            this._isEmpty = !0,
            this._elevationChartData = []
        },
        createSummary: function(a, b) {
            if (a.length <= 0)
                return void (this._isEmpty = !0);
            this._isEmpty = !1;
            var c, d = 0, h = 0, i = 0, m = 0, n = 0, o = 0, p = 0, q = 0, r = 0, s = [], t = null , u = f("formats.day-date");
            c = b ? j(b, u, !0) : "N/A";
            var v = a.length;
            v > 0 && (i = a[0].elevation,
            m = a[0].elevation);
            for (var w = this.measurementUnit, x = 0; v > x; x++) {
                var y = a[x].location
                  , z = y.lat
                  , A = y.lng
                  , B = a[x] ? a[x].elevation : null 
                  , C = 0;
                n += B,
                i = Math.max(i, B),
                m = Math.min(m, B);
                var D, E;
                null  !== t && (D = t.location,
                E = e(new k.LatLng(D.lat,D.lng), new k.LatLng(z,A), w),
                d += E,
                C = (B - t.elevation) / E,
                h += C,
                o = Math.max(o, C),
                p = Math.min(p, C)),
                t = a[x];
                var F = g(l, {
                    name: this._name,
                    el: B,
                    sl: C,
                    dist: d,
                    unit: w
                })
                  , G = {
                    totalDistance: d,
                    elevation: B,
                    itemTooltip: F
                };
                s.push(G)
            }
            q = n / a.length,
            r = h / a.length,
            this._elevationChartData = s,
            this._date = c,
            this._minElevation = m,
            this._maxElevation = i,
            this._avgElevation = q,
            this._maxSlopePos = o,
            this._maxSlopeNeg = p,
            this._avgSlope = r
        },
        getName: function() {
            return this._name
        },
        getTotalDistance: function() {
            return this._totalDistance
        },
        isEmpty: function() {
            return this._isEmpty
        },
        getTotalSlope: function() {
            return this._totalSlope
        },
        getMaxElevation: function() {
            return this._maxElevation
        },
        getMinElevation: function() {
            return this._minElevation
        },
        getTotalElevation: function() {
            return this._totalElevation
        },
        getMaxSlopePos: function() {
            return this._maxSlopePos
        },
        getMaxSlopeNeg: function() {
            return this._maxSlopeNeg
        },
        getAvgElevation: function() {
            return this._avgElevation
        },
        getAvgSlope: function() {
            return this._avgSlope
        },
        getElevationChartData: function() {
            return this._elevationChartData
        },
        getDate: function() {
            return this._date
        }
    })
}),
nm_module("nm/tools/elevation/header", function(a, b, c, d) {
    a.html = '<div class="elevation-container elevation-container-width">\n    <div class="elevation-row">\n        <div class="elevation-cell elevation-cell-left-align\n        elevation-cell-border">Source</div>\n        <div class="elevation-cell elevation-cell-left-align\n        elevation-cell-border">Date</div>\n        <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">Min</div>\n        <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">Avg</div>\n        <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">Max</div>\n        <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">Max/Min slope</div>\n        <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">Avg slope</div>\n    </div>\n</div>\n'
}),
nm_module("nm/tools/elevation/headerrow", function(a, b, c, d) {
    a.html = '<div class="elevation-row {Color}">\n    <div class="elevation-cell elevation-cell-left-align\n        elevation-cell-border">{Name}</div>\n    <div class="elevation-cell elevation-cell-left-align\n        elevation-cell-border">{DateEl:,.0f}</div>\n    <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">{MinEl:,.0f} {Unit}\n    </div>\n    <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">{AvgEl:,.0f} {Unit}\n    </div>\n    <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">{MaxEl:,.0f} {Unit}\n    </div>\n    <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">\n        {MaxSlopePos:.1%}, {MaxSlopeNeg:.1%}</div>\n    <div class="elevation-cell elevation-cell-right-align\n        elevation-cell-border">{AvgSlope:.1%}</div>\n</div>'
}),
nm_module("nm/tools/elevation", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("nm/dataproviders/elevation/nmelev", "ElevationProvider")
      , g = b("nm/dataproviders/elevation", "ElevationProvider")
      , h = b("jscore/strings", "format")
      , i = b("jscore/events", "Change")
      , j = b("nm/tools", "Tool")
      , k = b("nm/const/tools", "VIEW_ELEVATION_PROFILE")
      , l = b("nm/const/tools", "VIEW_ELEVATION_PROFILE_NM")
      , m = b("js-libs/google", "visualization")
      , n = b("jscore/itertools", "zipLongest")
      , o = b("js-libs/jquery", "jQuery")
      , p = b("nm/tools/elevation/elevationdto", "ElevationDTO")
      , q = b("nm/tools/elevation/header", "html")
      , r = b("nm/tools/elevation/headerrow", "html")
      , s = "Google"
      , t = "nearmap"
      , u = a.ElevationTool = c(j, {
        constructor: function(a, b, c, d, e) {
            u.base.call(this),
            this.visible = !1,
            this.auth = b,
            this.container = a,
            this.map = c,
            this.locationTool = e,
            this.unit = "m",
            this.nearmapProvider = new f(d),
            this.googleProvider = new g;
            var h = this.auth.can(k);
            this.setEnabled(h),
            m && m.DataTable && m.LineChart && (this.createHTML(),
            this.setupListeners())
        },
        createHTML: function() {
            this.contentNode = this.container.node.find(".content"),
            this.headerNode = o('<div class="elevation-header" />'),
            this.googleSourceNode = o('<div class="google-elevation-source google-color"></div>'),
            this.nearmapSourceNode = o('<div class="nearmap-elevation-source nearmap-color"></div>');
            var a = o('<div class="elevation-chart"/>');
            this.chart = new m.LineChart(a[0]),
            this.contentNode.append(this.headerNode),
            this.contentNode.append(a),
            this.update()
        },
        setupListeners: function() {
            this.auth.addListener(i, e(this, this.checkAuthorization)),
            this.container.addListener(i, e(this, this.setVisibilityDependingOnContainersVisibility)),
            this.nearmapProvider.addListener(i, e(this, this.update)),
            this.googleProvider.addListener(i, e(this, this.update));
            var a = this.map.tmpGoogleMapViewController
              , b = this.chart;
            m.events.addListener(b, "onmouseover", function(b) {
                var c = this.googleProvider.getElevations() || [];
                if (c) {
                    var d = c[b.row];
                    a.highlightLocation(d.location)
                }
            }
            .bind(this)),
            m.events.addListener(b, "onmouseout", function() {
                a.removeLocationHighlight()
            }
            .bind(this)),
            m.events.addListener(b, "select", function() {
                var a = this.googleProvider.getElevations() || []
                  , c = b.getSelection()[0];
                if (c) {
                    var d = a[c.row];
                    if (d) {
                        var e = h("Elevation: {minEl:,.0f}", d.elevation);
                        this.locationTool.addMarker(d.location, e)
                    }
                }
            }
            .bind(this)),
            o(window).resize(function() {
                return this.update()
            }
            .bind(this))
        },
        setFeature: function(a) {
            this.googleProvider.setFeature(a),
            this.auth.can(l) && this.nearmapProvider.setFeature(a);
        },
        getHeaderDataFromSummary: function(a) {
            var b = a.getDate()
              , c = a.getMinElevation()
              , d = a.getAvgElevation()
              , e = a.getMaxElevation()
              , f = a.getMaxSlopePos()
              , g = a.getMaxSlopeNeg()
              , h = a.getAvgSlope()
              , i = a.getName().toLowerCase()
              , j = a.getName()
              , k = this.unit
              , l = {
                Name: j,
                Color: i + "-color",
                DateEl: b,
                MinEl: c,
                AvgEl: d,
                MaxEl: e,
                MaxSlopePos: f,
                MaxSlopeNeg: g,
                AvgSlope: h,
                Unit: k
            };
            return l
        },
        createChartDataTable: function(a, b) {
            var c;
            c = new m.DataTable;
            var e = a.getName()
              , f = b.getName();
            c.addColumn("number", ""),
            c.addColumn("number", e + "Elevation"),
            c.addColumn({
                type: "string",
                role: "tooltip",
                p: {
                    html: !0
                }
            }),
            b.isEmpty() || (c.addColumn("number", f + "Elevation"),
            c.addColumn({
                type: "string",
                role: "tooltip",
                p: {
                    html: !0
                }
            }));
            for (var g, h = a.getElevationChartData(), i = b.getElevationChartData(), j = n(h, i)[d.iterator](); !(g = j.next()).done; ) {
                var k = g.value
                  , l = k[1]
                  , k = k[0]
                  , o = 0
                  , p = 0
                  , q = null 
                  , r = 0
                  , s = null ;
                k && (o = k.totalDistance,
                p = k.elevation,
                q = k.itemTooltip),
                l && (r = l.elevation,
                s = l.itemTooltip),
                b.isEmpty() ? c.addRow([o, p, q]) : c.addRow([o, p, q, r, s])
            }
            return c
        },
        updateHeader: function(a, b) {
            var c = this.headerNode;
            if (c.empty(),
            !a.isEmpty() || !b.isEmpty()) {
                var d, e, f = o(q);
                if (b.isEmpty() || (d = this.getHeaderDataFromSummary(b),
                e = h(r, d),
                f.append(e)),
                !a.isEmpty()) {
                    var g = this.getHeaderDataFromSummary(a)
                      , i = h(r, g);
                    f.append(i)
                }
                var j = o("<div>").append(f.clone()).html();
                c.append(j)
            }
        },
        updateChart: function(a, b) {
            if (this.visible) {
                var c = this.contentNode
                  , d = this.unit
                  , e = {
                    backgroundColor: "#222",
                    colors: ["#FF9900", "#0099ff"],
                    vAxis: {
                        format: "#,### " + d,
                        textStyle: {
                            color: "#DDD"
                        },
                        baselineColor: "#999",
                        gridlines: {
                            color: "#555"
                        }
                    },
                    hAxis: {
                        format: "#,### " + d,
                        textStyle: {
                            color: "#DDD"
                        },
                        gridlines: {
                            color: "#555"
                        }
                    },
                    legend: {
                        position: "none"
                    },
                    tooltip: {
                        isHtml: !0
                    },
                    chartArea: {
                        top: 0,
                        height: "100%"
                    },
                    titlePosition: "none"
                };
                e.chartArea = {
                    left: "0px",
                    width: c.width() + "px"
                };
                var f = this.createChartDataTable(a, b)
                  , g = this.chart;
                g.draw(f, e)
            }
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.container.setVisible(a),
            this.changed())
        },
        setUnit: function(a) {
            this.unit = a,
            this.googleProvider.update(),
            this.auth.can(l) && this.nearmapProvider.update()
        },
        changed: function() {
            this.nearmapProvider.setEnabled(this.visible && this.enabled),
            this.googleProvider.setEnabled(this.visible && this.enabled),
            u.base.prototype.changed.call(this)
        },
        setVisibilityDependingOnContainersVisibility: function() {
            this.setVisible(this.container.visible)
        },
        checkAuthorization: function() {
            var a = this.auth.can(k);
            this.setEnabled(a)
        },
        update: function() {
            var a = this.googleProvider.getElevations() || []
              , b = this.googleProvider.getDate()
              , c = this.nearmapProvider.getElevations() || []
              , d = this.nearmapProvider.getDate()
              , e = this.unit
              , f = new p(s,a,b,e)
              , g = new p(t,c,d,e);
            this.updateChart(f, g),
            this.updateHeader(f, g)
        }
    })
}),
nm_module("nm/ui/wizzard", function(a, b, c, d) {
    function e() {
        o.remove(),
        p.hide(),
        j = !1,
        "function" == typeof m && m(n)
    }
    function f(a) {
        if (!(k && a in k))
            return !1;
        l = a;
        var b = k[a];
        return h({
            stepNumber: a,
            totalSteps: k.length,
            content: b.content,
            title: b.title
        })
    }
    function g(a) {
        return i(a).hasClass("disabled") ? (alert("Please check the confirmation box to proceed."),
        !1) : !0
    }
    function h(a) {
        if (!a.content)
            return !1;
        j = !0,
        o.remove(),
        o = i("<div>", {
            "class": "nm-tour-modal"
        });
        var b = i("<h1>", {
            "class": "nm-tour-header",
            text: a.title
        })
          , c = i("<div>", {
            "class": "nm-tour-content"
        }).append(a.content)
          , d = i("<div>", {
            "class": "nm-tour-footer"
        })
          , h = i("<div>", {
            "class": "nm-tour-close",
            html: "&times;"
        });
        a.stepNumber > 0 && i("<div>", {
            "class": "button nm-tour-back",
            text: "Back"
        }).appendTo(d).on("click", function() {
            f(a.stepNumber - 1)
        });
        var k;
        a.stepNumber < a.totalSteps - 1 ? (k = i("<div>", {
            "class": "button nm-tour-next",
            text: "Next"
        }),
        k.appendTo(d),
        k.on("click", function() {
            g(this) && f(a.stepNumber + 1)
        })) : (k = i("<div>", {
            "class": "button nm-tour-finish",
            text: "Finish"
        }),
        k.appendTo(d),
        k.on("click", function() {
            g(this) && (n = !0,
            e())
        }));
        var l = c.find(".confirm-step");
        l.length && (l.click(function(a) {
            var b = a.target.checked;
            b ? k.removeClass("disabled") : k.addClass("disabled")
        }),
        l.prop("checked") ? k.removeClass("disabled") : k.addClass("disabled")),
        h.appendTo(b).on("click", e),
        o.append(b).append(c).append(d).appendTo(document.body);
        var m = p.height();
        m -= o.offset().top,
        m -= b.outerHeight(),
        m -= 2 * d.outerHeight(),
        c.css("max-height", m),
        p.show()
    }
    var i = b("js-libs/jquery", "jQuery")
      , j = !1
      , k = null 
      , l = null 
      , m = null 
      , n = !1
      , o = i()
      , p = i("<div>", {
        "class": "nm-tour-background"
    }).hide().appendTo(document.body);
    a.startWizzard = function(a, b) {
        return j || !a ? !1 : (n = !1,
        k = a,
        m = b,
        f(0))
    }
}),
nm_module("nm/tools/solar/disclaimer", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "ObservableObject")
      , g = b("nm/ui/wizzard", "startWizzard")
      , h = b("nm/localstorage", "getItem")
      , i = b("nm/localstorage", "setItem")
      , j = "solar-disclaimer-accepted"
      , k = [{
        title: "Solar Disclaimer",
        content: '<p>The nearmap Solar tool is provided for estimation purposes only and does not replace quotes from licensed professional solar panel installers.</p><p>Energy Output is calculated based on historical solar irradiance and temperature data at this location, factoring in panel tilt, orientation, and all of the System Parameters including System Efficiency.</p><p>System Efficiency should be set in the tool by the solar installer to account for losses that may include shading, inverter efficiency for DC to AC conversion, battery efficiency, cable losses, dirt, manufacturer tolerances, grid-tie system outages, maintenance downtime, and other factors.</p><p>Estimated maximum savings assume full consumption of generated electricity and are based on average residential electricity prices for the area. Emission reduction is based on average emissions for electricity generation in the region. Please see our Support pages for more details. </p><label>   <input type="checkbox" class="confirm-step"/>   I have read and understood the disclaimer</label>'
    }, {
        title: "Solar Tutorial",
        content: '<p>You will get a lot from reading our <a href=" https://support.nearmap.com/customer/portal/articles/1483179" target="_blank">tutorial</a>.<br/>If you are short on time, please view our quick <a href="http://support.nearmap.com/customer/portal/articles/1487431" target="_blank">video tutorial</a> instead.</p><label>   <input type="checkbox" class="confirm-step"/>   I have read or watched the tutorial</label>'
    }]
      , l = a.Disclaimer = c(f, {
        constructor: function() {
            l.base.call(this)
        },
        hasBeenAccepted: function() {
            return "1" === h(j)
        },
        show: function(a) {
            g(k, e(this, function(b) {
                this.handleClose(b),
                a()
            }))
        },
        handleClose: function(a) {
            this._accepted = a,
            i(j, a ? "1" : "0"),
            this.changed()
        }
    })
}),
nm_module("nm/dataproviders/solar/jobs", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "ObservableObject")
      , g = b("jscore/events", "Change")
      , h = b("nm/geom", "LatLng")
      , i = b("nm/features/solar", "SolarJob")
      , j = b("jscore/async", "callWhenIdle")
      , k = b("jscore/itertools", "array")
      , l = b("jscore/sets", "Set")
      , m = b("jscore/strings", "format")
      , n = b("nm/const", "HOST_URL")
      , o = b("nm/const/tools", "PERSIST_SOLAR_DATA")
      , p = b("js-libs/jquery", "jQuery")
      , q = b("jscore/dateutils", "parse")
      , r = n + "maps?nml=overlay&nmprovider=usergeom&cmd={cmd}"
      , s = a.JobsManager = c(f, {
        constructor: function(a, b, c) {
            s.base.call(this),
            this.auth = a,
            this.layer = b,
            this.geocoder = c,
            this.modifiedJobs = new l,
            this.deletedJobs = new l,
            this.saveWhenIdle = j(e(this, this.save), 200)
        },
        disable: function() {
            this.enabled = !1
        },
        getJobListId: function() {
            var a = this.auth
              , b = a.getAccountData().Result.Id;
            return "solar-jobs-" + b
        },
        load: function() {
            if (this.auth.can(o)) {
                var a = m(r, {
                    cmd: "usergeojson"
                });
                p.ajax(a, {
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json",
                    cache: !1,
                    data: {
                        allfeatures: "true",
                        id: this.getJobListId()
                    },
                    success: e(this, this.loadData)
                })
            }
        },
        loadData: function(a) {
            a = a || {};
            var b = a.features || []
              , c = this.layer;
            b.sort(function(a, b) {
                var c = q(a.properties._nm_modified).getTime()
                  , d = q(b.properties._nm_modified).getTime();
                return c = a.properties.modifiedTime || c,
                d = b.properties.modifiedTime || d,
                c > d ? -1 : d > c ? 1 : 0
            });
            var d = [];
            b.forEach(function(a) {
                var b = a.properties
                  , c = b.name
                  , e = b.id
                  , f = b.address
                  , g = b.efficiency
                  , j = b.shadingLosses
                  , k = b.surveyDate;
                k && (k = new Date(k));
                var l = b.imageTimestamp;
                l && (l = new Date(l));
                var m = a.geometry.coordinates;
                m = new h(m[1],m[0]);
                var n = new h(b.sw.lat,b.sw.lng)
                  , o = new h(b.ne.lat,b.ne.lng)
                  , p = new i(e,m,c,f,k,l,g,j,n,o);
                p._nm_modified = b._nm_modified,
                this.manageJob(p),
                d.push(p)
            }
            .bind(this)),
            c.addAllFeatures(d)
        },
        save: function() {
            this.persistDeleted(),
            this.persistChanged()
        },
        persistChanged: function() {
            if (this.auth.can(o)) {
                var a = m(r, {
                    cmd: "usergeojson"
                });
                a += "&update=merge";
                var b = {
                    type: "FeatureCollection",
                    properties: {
                        id: this.getJobListId(),
                        name: "All Solar Jobs",
                        type: "solar-jobs-list"
                    },
                    features: k(this.modifiedJobs)
                };
                b = JSON.stringify(b),
                p.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: b
                }),
                this.modifiedJobs.clear()
            }
        },
        persistDeleted: function() {
            if (this.auth.can(o)) {
                var a = m(r, {
                    cmd: "usergeojson"
                });
                a += "&update=delete";
                var b = {
                    type: "FeatureCollection",
                    properties: {
                        id: this.getJobListId(),
                        name: "All Solar Jobs",
                        type: "solar-jobs-list"
                    },
                    features: k(this.deletedJobs)
                };
                b = JSON.stringify(b),
                p.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: b
                }),
                a = m(r, {
                    cmd: "usergeojson"
                }) + "&update=deletefeaturecollection",
                k(this.deletedJobs).forEach(function(c) {
                    b = {
                        type: "FeatureCollection",
                        properties: {
                            type: "solar-job",
                            id: c.id
                        }
                    },
                    b = JSON.stringify(b),
                    p.ajax(a, {
                        type: "POST",
                        dataType: "json",
                        contentType: "application/json",
                        data: b
                    })
                }),
                this.deletedJobs.clear()
            }
        },
        jobChanged: function(a) {
            var b = a.target;
            "position" in a.properties && this.geocoder.lookup(b.position, function(a) {
                a && (b.setAddress(a),
                b.setTitle(a.formatted))
            });
            var c = a.properties;
            "undefined" == typeof c.index && (b.setModified(),
            this.modifiedJobs.add(b),
            this.saveWhenIdle())
        },
        manageJob: function(a) {
            a.addListener(g, e(this, this.jobChanged))
        },
        addJob: function(a) {
            this.manageJob(a),
            this.modifiedJobs.add(a),
            this.layer.addNewFeature(a),
            this.save()
        },
        deleteJob: function(a) {
            a.removeListeners(this),
            this.deletedJobs.add(a),
            this.modifiedJobs.discard(a),
            this.layer.removeFeature(a),
            this.save()
        }
    })
}),
nm_module("nm/tools/solar/jobs", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "ObservableObject")
      , g = b("jscore/events", "Change")
      , h = b("jscore/events", "Event")
      , i = b("nm/maps/map", "Click")
      , j = b("nm/features/solar", "SolarJob")
      , k = b("jscore/itertools", "array")
      , l = b("jscore/itertools", "isEmpty")
      , m = b("nm/dataproviders/solar/jobs", "JobsManager")
      , n = b("js-libs/jquery", "jQuery")
      , o = "Click anywhere on the map to add a job."
      , p = a.JobSelected = c(h, {
        constructor: function(a) {
            p.base.call(this),
            this.job = a
        }
    })
      , q = a.JobsPanel = c(f, {
        constructor: function(a, b, c, d, f, h, j) {
            q.base.call(this),
            this.auth = a,
            this.map = b,
            this.mapViewController = b.tmpGoogleMapViewController,
            this.selection = c,
            this.jobsLayer = f,
            this.geocoder = h,
            this.tooltipMgr = j,
            this.surveysController = d,
            this.jobsMgr = new m(a,f,h);
            var k = n('<div class="solar-jobs">   <select class="jobs" size="10"></select>   <div class="new-job-instructions">       Click anywhere on the map to add a job.   </div>   <div class="buttons">       <div class="del-btn button"            title="Delete job.">Delete</div>       <div class="btn-show button" title="Show job.">Show</div>   </div></div>');
            this.node = k,
            f.addListener(g, e(this, this.layerChanged)),
            this.selection.addListener(g, e(this, this.layerChanged)),
            k.find(".del-btn").click(e(this, this.delJobClicked)),
            k.find(".btn-show").click(e(this, this.showJobClicked)),
            k.find(".btn-show").focus(),
            k.find("select.jobs").change(e(this, this.selectionChanged)),
            k.find("select.jobs").dblclick(e(this, this.showJobClicked)),
            k.find("select.jobs").hide(),
            b.addListener(i, e(this, this.mapClicked)),
            this.layerChanged(),
            this.enableAddMode(),
            this.jobsMgr.load(),
            this.jobsOpt = {}
        },
        layerChanged: function() {
            var a = this.node
              , b = this.jobsLayer
              , c = this.selection
              , d = a.find(".jobs");
            d.empty();
            var e = this.jobsOpt
              , f = b.getFeatures().slice();
            f.sort(function(a, b) {
                return a._nm_modified === b._nm_modified ? 0 : a._nm_modified > b._nm_modified ? -1 : 1
            }),
            f.forEach(function(a) {
                var b = n("<option>");
                b.text(a.title || "--no name--"),
                b.val(a.id);
                var f = e[a.id];
                "undefined" == typeof f && a.addListener(g, function() {
                    e[a.id].text(a.title || "--no name--")
                }),
                e[a.id] = b,
                c.isSelected(a) && b.attr("selected", !0),
                d.append(b)
            }),
            l(b.getFeatures()) ? a.find("select.jobs").hide() : (a.find("select.jobs").show(),
            a.find("select.jobs").focus())
        },
        selectionChanged: function() {
            var a = this.getSelectedJob();
            this.selectJob(a)
        },
        showJobClicked: function() {
            var a = this.getSelectedJob();
            a && this.dispatch(new p(a))
        },
        mapClicked: function(a) {
            if (this.addJobWhenMappedClicked) {
                var b = a.latLng;
                this.addAndShowJob(b)
            }
        },
        delJobClicked: function() {
            var a = this.getSelectedJob();
            if (a) {
                var b = this.jobsLayer
                  , c = k(b.getFeatures())
                  , d = c.indexOf(a);
                d === c.length - 1 && (d -= 1);
                var e = this.jobsMgr;
                e.deleteJob(a),
                a = c[d],
                this.selectJob(a)
            }
        },
        getSelectedJob: function() {
            var a = this.node.find(".jobs")
              , b = a.val()
              , c = this.jobsLayer.getFeatureById(b);
            return c
        },
        addAndShowJob: function(a) {
            var b = this.surveysController.getDisplayDate()
              , c = new j(null ,a,"New Job",null ,b);
            this.geocoder.lookup(a, function(a) {
                a && (c.setAddress(a),
                c.setTitle(a.formatted))
            }),
            this.jobsMgr.addJob(c),
            this.selectJob(c),
            this.dispatch(new p(c))
        },
        enableAddMode: function() {
            this.addJobWhenMappedClicked = !0,
            this.mapViewController.setCursor("crosshair"),
            this.tooltipMgr.set(o),
            l(this.jobsLayer.getFeatures()) && this.node.find(".new-job-instructions").show()
        },
        disableAddMode: function() {
            this.addJobWhenMappedClicked = !1,
            this.mapViewController.setCursor(null ),
            this.tooltipMgr.unset(),
            this.node.find(".new-job-instructions").hide()
        },
        selectJob: function(a) {
            a && this.selection.select(a)
        },
        destroy: function() {
            this.disableAddMode(),
            this.mapViewController.setCursor(null ),
            this.jobsLayer.removeListeners(this),
            this.map.removeListeners(this)
        }
    })
}),
nm_module("nm/tools/solar/paneltypes", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/async", "setTimeout")
      , g = b("jscore/functools", "partial")
      , h = b("jscore/events", "ObservableObject")
      , i = b("jscore/events", "Change")
      , j = b("jscore/objtools", "id")
      , k = b("js-libs/jquery", "jQuery")
      , l = a.populatePanelTypesList = function(a, b) {
        function c(a, b) {
            var c = k("<option></option>");
            c.text(b.manufacturer + " - " + b.model),
            c.val(j(b)),
            a.append(c)
        }
        a.empty();
        var d, e, f = b.getPanelTypesGrouped();
        f.custom.length ? (d = k('<optgroup label="Custom Panels" />'),
        e = k('<optgroup label="Library Panels" />'),
        a.append(d),
        a.append(e)) : (d = a,
        e = a),
        f.custom.forEach(g(c, d)),
        f.library.forEach(g(c, e))
    }
      , m = a.PanelTypesUI = c(h, {
        constructor: function(a, b) {
            m.base.call(this),
            this.defaultPanelType = b,
            this.panelTypesMgr = a,
            this.buildUI(),
            this.setupListeners()
        },
        buildUI: function() {
            var a = k('<div class="solar-panel-types">   <ul>       <li>           <div class="prop-row">               <label>Panel</label>               <select class="panel-types" />            </div>       </li>       <li>           <div class="prop-row">               <label>Manufacturer</label>               <input type="text" class="manufacturer" />           </div>           <div class="prop-row">               <label>Model</label>               <input type="text" class="model" />           </div>           <div class="prop-row">               <label>Type</label>               <select class="type">                   <option value="Monocrystalline">                       Monocrystalline                   </option>                   <option value="Polycrystalline">                       Polycrystalline                   </option>                   <option value="Thin-film">                       Thin-film                   </option>               </select>           </div>           <div class="prop-row">               <label>Length</label>               <input type="number" class="length" />               <span class="unit">mm</span>           </div>           <div class="prop-row">               <label>Width</label>               <input type="number" class="width" />               <span class="unit">mm</span>           </div>           <div class="prop-row">               <label>Nominal Power</label>               <input type="number" class="power" />               <span class="unit">W</span>           </div>           <div class="prop-row">               <label>NOCT</label>               <input type="number" class="noct" />               <span class="unit">°C</span>           </div>           <div class="prop-row">               <label>Temp Coeff</label>               <input type="number" class="tempCoef" />               <span class="unit">%/K</span>           </div>           <div class="job-buttons">               <div class="btn-duplicate button">                   Make a copy               </div>               <div class="btn-delete button">Delete</div>           </div>       </li>   </ul></div>');
            this.node = a,
            a.find(".btn-del").addClass("disabled"),
            f(function() {
                a.find(".panel-types").focus()
            }, 10),
            this.panelTypesMgrChanged()
        },
        setupListeners: function() {
            var a = this.node;
            this.panelTypesMgr.addListener(i, e(this, this.panelTypesMgrChanged)),
            a.find(".manufacturer").change(e(this, this.manufacturerChanged)),
            a.find(".model").change(e(this, this.modelChanged)),
            a.find(".type").change(e(this, this.typeChanged)),
            a.find(".length").change(e(this, this.lengthChanged)),
            a.find(".width").change(e(this, this.widthChanged)),
            a.find(".power").change(e(this, this.powerChanged)),
            a.find(".noct").change(e(this, this.noctChanged)),
            a.find(".tempCoef").change(e(this, this.tempCoefChanged)),
            a.find(".btn-duplicate").click(e(this, this.duplicateClicked)),
            a.find(".btn-delete").click(e(this, this.deleteClicked));
            var b = a.find(".panel-types");
            b.change(e(this, this.panelTypeChanged))
        },
        panelTypesMgrChanged: function() {
            var a = this.node.find(".panel-types")
              , b = this.defaultPanelType;
            b ? this.defaultPanelType = null  : b = this.getSelectedPanelType(),
            l(a, this.panelTypesMgr),
            b ? a.val(j(b)) : a.prop("selectedIndex", 0),
            this.updateUI()
        },
        manufacturerChanged: function() {
            var a = this.node.find(".manufacturer").val();
            this.getSelectedPanelType().setManufacturer(a),
            this.panelTypesMgrChanged()
        },
        modelChanged: function() {
            var a = this.node.find(".model").val();
            this.getSelectedPanelType().setModel(a),
            this.panelTypesMgrChanged()
        },
        typeChanged: function() {
            var a = this.node.find(".type").val();
            this.getSelectedPanelType().setType(a)
        },
        lengthChanged: function() {
            var a = parseInt(this.node.find(".length").val(), 10) || 1e3;
            this.getSelectedPanelType().setLength(a)
        },
        widthChanged: function() {
            var a = parseInt(this.node.find(".width").val(), 10) || 1e3;
            this.getSelectedPanelType().setWidth(a)
        },
        powerChanged: function() {
            var a = parseInt(this.node.find(".power").val(), 10) || 0;
            this.getSelectedPanelType().setPower(a)
        },
        noctChanged: function() {
            var a = parseInt(this.node.find(".noct").val(), 10) || 0;
            this.getSelectedPanelType().setNoct(a)
        },
        tempCoefChanged: function() {
            var a = parseFloat(this.node.find(".tempCoef").val()) || 0;
            this.getSelectedPanelType().setTempCoef(a)
        },
        updateUI: function() {
            var a = this.node
              , b = this.getSelectedPanelType();
            if (null  === b) {
                var c = this.node.find(".panel-types");
                c.prop("selectedIndex", 0),
                c.change(),
                b = this.getSelectedPanelType()
            }
            this.panelTypesMgr.isCustomPanelType(b) ? (a.find(".btn-delete").removeClass("disabled"),
            a.find("input").prop("disabled", !1),
            a.find("select.type").prop("disabled", !1)) : (a.find(".btn-delete").addClass("disabled"),
            a.find("input").prop("disabled", !0),
            a.find("select.type").prop("disabled", !0)),
            a.find(".manufacturer").val(b.manufacturer),
            a.find(".model").val(b.model),
            a.find(".type").val(b.type),
            a.find(".length").val(b.length),
            a.find(".width").val(b.width),
            a.find(".power").val(b.power),
            a.find(".noct").val(b.noct),
            a.find(".tempCoef").val(b.tempCoef),
            a.find(".panel-types").val(j(b))
        },
        getSelectedPanelType: function() {
            var a = this.node.find(".panel-types").val()
              , b = this.panelTypesMgr.getPanelTypeById(a);
            return b
        },
        panelTypeChanged: function() {
            this.updateUI()
        },
        duplicateClicked: function() {
            var a = this.getSelectedPanelType().clone();
            this.panelTypesMgr.addPanelType(a),
            this.node.find(".panel-types").val(j(a)),
            this.updateUI()
        },
        deleteClicked: function() {
            var a = this.node.find(".panel-types")
              , b = this.getSelectedPanelType()
              , c = a.prop("selectedIndex");
            0 === c ? c = 1 : c -= 1,
            this.panelTypesMgr.deletePanelType(b),
            a.prop("selectedIndex", c),
            a.change()
        },
        destroy: function() {}
    })
}),
nm_module("nm/dataproviders/solar/job", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/objtools", "id")
      , g = b("jscore/events", "ObservableObject")
      , h = b("nm/features/solar", "SolarPanel")
      , i = b("nm/features/solar", "PanelType")
      , j = b("jscore/itertools", "filter")
      , k = b("jscore/itertools", "find")
      , l = b("jscore/itertools", "map")
      , m = b("jscore/itertools", "array")
      , n = b("jscore/sets", "Set")
      , o = b("jscore/strings", "format")
      , p = b("nm/geom", "LatLng")
      , q = b("jscore/events", "Change")
      , r = b("jscore/async", "callWhenIdle")
      , s = b("nm/const", "HOST_URL")
      , t = b("nm/const/tools", "PERSIST_SOLAR_DATA")
      , u = b("nm/const/tools", "AUTO_CALC_SOLAR_DATA")
      , v = b("js-libs/jquery", "jQuery")
      , w = s + "maps?nml=overlay&nmprovider={provider}&cmd={cmd}"
      , x = s + "maps/api/solar/v1"
      , y = a.JobManager = c(g, {
        constructor: function(a, b, c, d) {
            y.base.call(this, this),
            this.auth = a,
            this.panelsMgr = d,
            this.annualOutput = null ,
            this.annualSavings = null ,
            this.job = b,
            this.layer = c,
            this.modifiedPanels = new n,
            this.deletedPanels = new n,
            this.managedPanels = new n,
            this.saveWhenIdle = r(e(this, this.save), 200),
            this.saveJobWhenIdle = r(e(this, this.persistJob)),
            this.updateCalcDataWhenIdle = r(e(this, this.updateCalcData), 200),
            b.addListener(q, e(this, this.jobChanged))
        },
        load: function() {
            if (this.auth.can(t)) {
                var a = o(w, {
                    provider: "usergeom",
                    cmd: "usergeojson"
                });
                v.ajax(a, {
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json",
                    data: {
                        allfeatures: "true",
                        id: this.job.id
                    },
                    success: e(this, this.loadData)
                }),
                this.updateCalcData()
            }
        },
        loadData: function(a) {
            a = a || {};
            var b = a.features || []
              , c = this.layer
              , d = a.properties || {}
              , g = this.panelsMgr
              , n = m(l(d.panelTypes || [], function(a) {
                "undefined" == typeof a.id && (a.id = a.manufacturer + ":" + a.model);
                var b = new i(a.id,a.width,a.length,a.manufacturer,a.model,a.power,a.type,a.noct,a.tempCoef);
                return b = g.findOrManagePanelType(b)
            }))
              , o = m(j(b, function(a) {
                var b = a.properties;
                return "undefined" == typeof b.manufacturer
            }));
            o.sort(function(a, b) {
                var c = a.properties.index
                  , d = b.properties.index;
                return c === d ? 0 : c > d ? 1 : -1
            }
            .bind(this));
            var q = l(o, e(this, function(a) {
                var b = a.properties
                  , c = a.geometry.coordinates;
                c = new p(c[1],c[0]);
                var d = k(n, function(a) {
                    return f(a) === b.panelType
                });
                d || (d = n[0]);
                var e = b.mountPortrait;
                "undefined" == typeof e && (e = !0);
                var g = new h(b.id,c,b.orientation,b.tilt,e,d);
                return g.setIndex(b.index),
                this.managePanel(g),
                g
            }));
            c.addAllFeatures(q)
        },
        save: function() {
            this.persistDeletedPanels(),
            this.persistModifiedPanels()
        },
        persistJob: function() {
            if (this.auth.can(t)) {
                var a = o(w, {
                    provider: "usergeom",
                    cmd: "usergeojson"
                });
                a += "&update=merge";
                var b = this.job
                  , c = b.toJSON().properties;
                c.type = "solar-job";
                var d = {
                    type: "FeatureCollection",
                    properties: c
                };
                d = JSON.stringify(d),
                v.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: d,
                    success: e(this, function() {
                        this.updateCalcDataWhenIdle()
                    }),
                    error: function(a) {
                        console.log("not saved", a)
                    }
                })
            }
        },
        persistModifiedPanels: function() {
            if (this.auth.can(t)) {
                var a = o(w, {
                    provider: "usergeom",
                    cmd: "usergeojson"
                });
                a += "&update=merge";
                var b = this.job
                  , c = m(l(this.managedPanels, function(a) {
                    return a.panelType
                }));
                c = m(new n(c));
                var d = b.toJSON().properties;
                d.type = "solar-job",
                d.panelTypes = c;
                var f = {
                    type: "FeatureCollection",
                    properties: d,
                    features: m(this.modifiedPanels)
                };
                f = JSON.stringify(f),
                v.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: f,
                    success: e(this, function() {
                        this.updateCalcDataWhenIdle()
                    }),
                    error: function(a) {
                        console.log("not saved", a)
                    }
                }),
                this.modifiedPanels.clear()
            }
        },
        persistDeletedPanels: function() {
            if (this.auth.can(t)) {
                var a = m(this.deletedPanels);
                if (0 !== a.length) {
                    var b = o(w, {
                        provider: "usergeom",
                        cmd: "usergeojson"
                    });
                    b += "&update=delete";
                    var c = this.job
                      , d = {
                        type: "FeatureCollection",
                        properties: {
                            type: "solar-job",
                            id: c.id
                        },
                        features: a
                    };
                    d = JSON.stringify(d),
                    v.ajax(b, {
                        type: "POST",
                        dataType: "json",
                        contentType: "application/json",
                        data: d,
                        success: e(this, function() {
                            this.updateCalcDataWhenIdle()
                        }),
                        error: function(a) {
                            console.log("not saved", a)
                        }
                    }),
                    this.deletedPanels.clear()
                }
            }
        },
        updateCalcData: function() {
            if (this.auth.can(u)) {
                var a = o("{solarUrl}/jobs/{jobId}/pvprediction", {
                    solarUrl: x,
                    jobId: this.job.id
                });
                v.ajax(a, {
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json",
                    cache: !1,
                    success: e(this, function(a) {
                        this.setAnnualOutput(a.totalEnergyOutput),
                        this.setAnnualSavings(a.electricitySavings)
                    }),
                    error: e(this, function() {
                        this.setAnnualOutput(null ),
                        this.setAnnualSavings(null )
                    })
                })
            }
        },
        jobChanged: function() {
            this.saveJobWhenIdle()
        },
        panelChanged: function(a) {
            this.modifiedPanels.add(a.target),
            this.job.panelsChanged(),
            this.saveWhenIdle()
        },
        setAnnualOutput: function(a) {
            this.annualOutput !== a && (this.annualOutput = a,
            this.changed())
        },
        setAnnualSavings: function(a) {
            this.annualSavings !== a && (this.annualSavings = a,
            this.changed())
        },
        managePanel: function(a) {
            this.managedPanels.add(a),
            a.addListener(q, e(this, this.panelChanged))
        },
        addPanel: function() {
            for (var a, b = Array.prototype.slice.call(arguments, 0), c = 0, e = this.layer[d.iterator](); !(a = e.next()).done; ) {
                var f = a.value;
                c = Math.max(f.getIndex(), c)
            }
            c += 1;
            for (var g, h = b[d.iterator](); !(g = h.next()).done; ) {
                var i = g.value;
                i.setIndex(c++),
                this.managePanel(i),
                this.modifiedPanels.add(i)
            }
            this.layer.addAllFeatures(b),
            this.job.panelsChanged(),
            this.saveWhenIdle()
        },
        deletePanels: function(a) {
            for (var b, c = this.deletedPanels, e = this.managedPanels, f = a[d.iterator](); !(b = f.next()).done; ) {
                var g = b.value;
                c.add(g),
                e.discard(g),
                g.destroy()
            }
            this.layer.removeFeatures(a),
            this.job.panelsChanged(),
            this.saveWhenIdle()
        },
        destroy: function() {
            this.job.removeListeners(this)
        }
    })
}),
nm_module("nm/dataproviders/solar/report", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Event")
      , g = b("jscore/async", "setTimeout")
      , h = b("jscore/functools", "bind")
      , i = b("jscore/functools", "partial")
      , j = b("jscore/strings", "format")
      , k = b("jscore/sets", "Set")
      , l = b("js-libs/jquery", "jQuery")
      , m = b("nm/const", "HOST_URL")
      , n = new k(["Available", "EmailSent", "Downloaded"])
      , o = m + "api/0/"
      , p = m + "maps/api/solar/v1"
      , q = a.ReportGenerated = c(f, {
        constructor: function(a, b) {
            q.base.call(this),
            this.reportId = a,
            this.job = b,
            this.reportURL = j("{}solarreport/files{}", o, a)
        }
    })
      , r = a.ReportError = c(f, {
        constructor: function(a, b) {
            r.base.call(this),
            this.reportId = a,
            this.job = b
        }
    })
      , s = a.ReportGenerator = c(e, {
        constructor: function(a) {
            s.base.call(this),
            this.auth = a
        },
        generate: function(a) {
            var b = {
                timezoneOffset: -(new Date).getTimezoneOffset()
            };
            b = JSON.stringify(b);
            var c = this.auth.getTicket().getValue()
              , d = j("{solarUrl}/jobs/{jobId}/reports?ticket={ticket}", {
                solarUrl: p,
                jobId: a.id,
                ticket: c
            });
            l.ajax(d, {
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: b,
                error: i(h(this, this.handleError), null , a)
            })
        },
        handleReportRequested: function(a, b) {
            console.log("report requested");
            var c = b.Result;
            if (c) {
                var d = b.Result.ResourceId;
                if (d)
                    return void this.checkProgress(d, a)
            }
            this.handleError(null , a)
        },
        checkProgress: function(a, b) {
            var c = this.auth.getTicket().getValue()
              , d = j("{}solarreport/status/{}", o, a);
            console.log("checking progress"),
            l.ajax(d, {
                type: "GET",
                dataType: "json",
                contentType: "application/json",
                data: {
                    ticket: c,
                    return200: !0
                },
                success: i(h(this, this.handleProgress), a, b),
                error: i(h(this, this.handleError), a, b)
            })
        },
        handleProgress: function(a, b, c) {
            var d = this.auth.getTicket().getValue();
            console.log("progress"),
            n.contains(c.Result.Status) ? this.handleReportReady(a, b) : g(i(h(this, this.checkProgress), d, a, b), 1e3)
        },
        handleReportReady: function(a, b) {
            console.log("report ready"),
            this.dispatch(new q(a,b))
        },
        handleError: function(a, b) {
            this.dispatch(new r(a,b))
        }
    })
}),
nm_module("nm/dataproviders/timestamp", function(a, b, c, d) {
    function e(a) {
        var b = a[0]
          , c = a[a.length - 1]
          , d = parseInt((c - b) / 2, 10)
          , e = parseInt(d / 1e3 / 60, 10)
          , f = new Date(c - d);
        return {
            date: f,
            span: e
        }
    }
    function f(a) {
        var b = null 
          , c = null 
          , d = t("formats.day-date");
        if (a.length > 1) {
            var f = e(a)
              , g = f.span
              , f = f.date;
            c = y(f, d, !0),
            b = y(f, z.shortTime, !0) + (g > 0 ? " &#177;" + g + " mins" : "")
        } else
            c = y(a[0], d, !0),
            b = y(a[0], z.shortTime, !0);
        return c + " " + b
    }
    var g = b("nm/const", "NMQ_KEY")
      , h = b("nm/const", "LATLNG_KEY")
      , i = b("nm/const", "LAYER_KEY")
      , j = b("nm/const", "TILE_DATE_KEY")
      , k = b("nm/const/endpoints", "MAPS")
      , l = b("nm/const/imagery", "SURVEY")
      , m = b("nm/const/imagery", "SURVEY_N")
      , n = b("nm/const/imagery", "SURVEY_E")
      , o = b("nm/const/imagery", "SURVEY_S")
      , p = b("nm/const/imagery", "SURVEY_W")
      , q = b("nm/const/imagery", "TERRAIN")
      , r = b("nm/const/imagery", "ROAD")
      , s = b("nm/ajax", "ajax")
      , t = b("nm/intl", "getText")
      , u = b("jscore/async", "callWhenIdle")
      , v = b("jscore/events", "Change")
      , w = b("jscore/events", "ObservableObject")
      , x = b("jscore/functools", "bind")
      , y = b("jscore/dateutils", "format")
      , z = b("jscore/dateutils", "formats")
      , A = b("jscore/dateutils", "parse")
      , B = b("jscore/itertools", "map")
      , C = b("jscore/itertools", "array")
      , D = k + "?" + g + "=photolist&" + h + "={0}&" + j + "={1}&" + i + "={2}"
      , E = {};
    E[l] = "vert",
    E[m] = "N___",
    E[n] = "E___",
    E[o] = "S___",
    E[p] = "W___",
    E[q] = null ,
    E[r] = null ;
    var F = a.TimestampProvider = c(w, {
        constructor: function(a, b, c) {
            F.base.call(this),
            this.map = a,
            this.coordinates = b,
            this.surveyController = c,
            this.enabled = !1,
            this.timestamp = null ,
            this.formattedTimestamp = null ,
            this.lastImageryType = null ,
            this.lastCoordinates = null ,
            this.lastDataDate = null 
        },
        getFormatted: function() {
            return this.formattedTimestamp
        },
        getValue: function() {
            return this.timestamp
        },
        getTimeZoneOffset: function() {
            return this._timeZoneOffset
        },
        getMapTypeKey: function() {
            return E[this.surveyController.getMapType()]
        },
        update: function() {
            var a = this.surveyController;
            if (this.enabled && this.coordinates && (this.lastImageryType !== a.getMapType() || !this.lastCoordinates || !this.lastCoordinates.equals(this.coordinates) || this.lastDataDate !== a.getDisplayDate())) {
                var b = this.coordinates.toUrlValue()
                  , c = this.surveyController.getDisplayDate()
                  , d = this.getMapTypeKey();
                if (!d || "" === d)
                    return void this.processError();
                d = d.toLowerCase(),
                c = c ? y(c, "yyyymmdd", !0) : "";
                var e = D.replace("{0}", b).replace("{1}", c).replace("{2}", d);
                s({
                    type: "GET",
                    url: e,
                    dataType: "json"
                }).done(x(this, this.process)).fail(x(this, this.processError))
            }
        },
        process: function(a, b) {
            if ("success" !== b || !a || !a.hasOwnProperty("Photos") || !a.Photos.hasOwnProperty("Photo") || 0 === a.Photos.Photo.length)
                return void this.processError();
            var c = a.Photos.Photo
              , d = a.Photos.timeZoneOffset;
            d = null  !== d ? 60 * d * 60 * 1e3 : 0,
            this._timeZoneOffset = d;
            var g = [];
            c.forEach(function(a) {
                var b = A(a.timestamp);
                b && (b = b.getTime(),
                g.push(b))
            }),
            g.sort(function(a, b) {
                return a - b
            }),
            g.length > 1 ? this.timestamp = e(g).date : this.timestamp = new Date(g[0]),
            g = B(g, function(a) {
                return a + d
            }),
            this.formattedTimestamp = f(C(g));
            var h = this.surveyController;
            this.lastImageryType = h.getMapType(),
            this.lastCoordinates = this.coordinates,
            this.lastDataDate = h.getDisplayDate(),
            this.changed()
        },
        processError: function() {
            this.timestamp = null ,
            this.formattedTimestamp = null ,
            this.lastImageryType = null ,
            this.lastCoordinates = null ,
            this.changed()
        },
        setCoordinates: function(a) {
            !a || null  !== this.coordinates && a.equals(this.coordinates) || (this.coordinates = a,
            this.enabled && this.update(),
            this.changed())
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a ? (this.registerListeners(),
            this.update()) : this.destroy(),
            this.changed())
        },
        registerListeners: function() {
            this.changeHandler = u(x(this, this.update), 5),
            this.map.addListener(v, this.changeHandler),
            this.surveyController.addListener(v, this.changeHandler)
        },
        destroy: function() {
            this.enabled = !1,
            this.map.removeListeners(this),
            this.surveyController.removeListeners(this)
        }
    })
}),
nm_module("nm/const/keys", function(a, b, c, d) {
    a.DELETE_KEY = 46,
    a.BACKSPACE_KEY = 8,
    a.C_KEY = 67,
    a.D_KEY = 68,
    a.J_KEY = 74,
    a.V_KEY = 86
}),
nm_module("nm/tools/solar/singlejob", function(a, b, c, d) {
    function e(a, b) {
        a = new O.LatLng(a.lat,a.lng),
        b = new O.LatLng(b.lat,b.lng);
        var c = {
            distance: O.geometry.spherical.computeDistanceBetween(a, b),
            heading: O.geometry.spherical.computeHeading(a, b)
        };
        return c
    }
    function f(a, b) {
        a = new O.LatLng(a.lat,a.lng);
        var c = O.geometry.spherical.computeOffset(a, b.distance, b.heading);
        return c = new G(c.lat(),c.lng())
    }
    function g(a) {
        for (var b, c = new O.LatLngBounds, e = a[d.iterator](); !(b = e.next()).done; ) {
            var f = b.value
              , g = f.position;
            c.extend(new O.LatLng(g.lat,g.lng))
        }
        var h = c.getCenter();
        return new G(h.lat(),h.lng())
    }
    function h(a, b) {
        var c = parseFloat(a.val()) || 0;
        a.val(c + b),
        a.focus()
    }
    function i(a) {
        function b() {
            D(c),
            F(d)
        }
        var c, d;
        l(a).mousedown(function(a) {
            var e = l(a.target);
            d = E(function() {
                c = C(function() {
                    e.click()
                }
                .bind(this), 10)
            }
            .bind(this), 200),
            l(window).mouseup(b),
            l(document).mouseup(b)
        }
        .bind(this))
    }
    function j(a) {
        for (var b, c = a.toArray()[d.iterator](); !(b = c.next()).done; ) {
            var e = b.value;
            i(e)
        }
    }
    function k(a) {
        return Math.round(10 * (parseFloat(a) || 0)) / 10
    }
    var l = b("js-libs/jquery", "jQuery")
      , m = b("jscore/functools", "bind")
      , n = b("jscore/functools", "partial")
      , o = b("jscore/events", "ObservableObject")
      , p = b("jscore/events", "Change")
      , q = b("jscore/events", "Event")
      , r = b("nm/dataproviders/solar/job", "JobManager")
      , s = b("nm/dataproviders/solar/report", "ReportError")
      , t = b("nm/dataproviders/solar/report", "ReportGenerator")
      , u = b("nm/dataproviders/solar/report", "ReportGenerated")
      , v = b("nm/dataproviders/timestamp", "TimestampProvider")
      , w = b("jscore/itertools", "filter")
      , x = b("jscore/itertools", "array")
      , y = b("jscore/itertools", "find")
      , z = b("jscore/itertools", "first")
      , A = b("jscore/itertools", "last")
      , B = b("jscore/itertools", "size")
      , C = b("jscore/async", "setInterval")
      , D = b("jscore/async", "clearInterval")
      , E = b("jscore/async", "setTimeout")
      , F = b("jscore/async", "clearTimeout")
      , G = b("nm/geom", "LatLng")
      , H = b("nm/maps/map", "Click")
      , I = b("jscore/objtools", "Dictionary")
      , J = b("nm/features/solar", "SolarPanel")
      , K = b("nm/features/solar", "SolarJob")
      , L = b("jscore/objtools", "id")
      , M = b("nm/tools/solar/paneltypes", "populatePanelTypesList")
      , N = b("jscore/strings", "format")
      , O = b("js-libs/google", "maps")
      , P = b("nm/const/urls", "ACCOUNT")
      , Q = b("nm/const/tools", "AUTO_CALC_SOLAR_DATA")
      , R = b("nm/const/tools", "TILT_DEFAULT")
      , S = b("nm/const/keys", "DELETE_KEY")
      , T = b("gooscr/notify", "fire")
      , U = 1e3
      , V = a.Close = c(q, {})
      , W = a.SingleJobPanel = c(o, {
        constructor: function(a, b, c, d, e, f, g, h, i) {
            W.base.call(this),
            this.auth = a,
            this.job = b,
            this.map = c,
            this.mapViewController = c.tmpGoogleMapViewController,
            this.selection = c.getSelection(),
            this.panelsLayer = f,
            this.tooltipMgr = i,
            this.jobsLayer = g,
            this.surveysController = e,
            this.panelTypesMgr = h,
            this.jobMgr = new r(a,b,f,h),
            this.reportGenerator = new t(a),
            this.timestampProvider = new v(this.mapViewController,b.position,e),
            this.selCenter = null ,
            this.selVectors = null ,
            this.selOrientation = null ,
            this.buildUI(),
            this.setupListeners(),
            this.jobMgr.load(),
            this.panelTypesMgrChanged(),
            this.activate()
        },
        setupListeners: function() {
            var a = this.job;
            this.reportGenerator.addListener(u, m(this, this.reportReady)),
            this.reportGenerator.addListener(s, m(this, this.reportError)),
            this.panelsLayer.addListener(p, m(this, this.panelsChanged)),
            a.addListener(p, m(this, this.jobChanged)),
            this.map.addListener(H, m(this, this.mapClicked)),
            this.surveysController.addListener(p, m(this, this.surveyChanged)),
            this.timestampProvider.addListener(p, m(this, this.timestampChanged)),
            this.timestampProvider.setEnabled(!0),
            this.jobMgr.addListener(p, m(this, this.jobMgrChanged)),
            this.panelTypesMgr.addListener(p, m(this, this.panelTypesMgrChanged)),
            this.selection.addListener(p, m(this, this.updateUI))
        },
        buildUI: function() {
            var a = this.job
              , b = l('<div class="solar-job">   <ul>       <li>           <div class="prop-row">               <label>Title</label>               <input type="text" class="title" />           </div>           <div class="prop-row">               <label>Panel</label>               <select class="panel-types" />                <a href="#" class="btn-panel-info">info</a>           </div>           <div class="prop-row">               <label>Photo time</label>               <span class="photo-time"></span>           </div>           <div class="prop-row">               <label class="preview">                  <input type="checkbox" class="bounds" />                  Set report image boundaries               </label>           </div>       </li>       <li class="panel-props panel-add">           <div class="prop-row addition">               <label>Panels</label>               <label class="max-num-panels">' + ["                   (max ", U, ")"].join("") + '               </label>               <input type="number" class="panels" value="1"                    max="500" min="0" />               <div class="btn-add button">Add</div>           </div>           <div class="prop-row selection">               <span class="num-selected"></span>               <label>selected</label>               <span class="num-total"></span>               <label>total</label>               <div class="btn-del button delete-btn"                   title="Delete selected"></div>               <div class="btn-sel-all button">                   Select All               </div>           </div>       </li>       <li class="panel-props panel-controls">           <div class="prop-row tilt" title="range= 0°-90°">               <label>                   Tilt <span>(relative to ground)</span>               </label>               <div class="btn-minus"></div>               <input type="number" class="tilt"                   max="90" min="0" step="0.5" />°                <div class="btn-plus" />           </div>           <div class="prop-row orientation"                title="range= -360°-360°">               <label>                   Rotate <span>(relative to North)</span>               </label>               <div class="btn-minus"></div>               <input type="number" class="orientation"                     max="360" min="-360" step="1" />°                <div class="btn-plus" />           </div>           <div class="prop-row mounting">               <label>Mounting</label>               <label class="mounting">                   <input type="radio" name="mounting"                       class="mount-portrait" checked />                   Portrait               </label>               <label class="mounting">                   <input type="radio" name="mounting"                       class="mount-landscape" />                   Landscape               </label>           </div>       </li>       <li>           <div class="prop-row">               <label class="system-efficiency">                   System efficiency                   <a href="#" target="_blank">info</a>               </label>               <input type="number" class="efficiency"                   min="0" max="100" /> %           </div>           <div class="prop-row">               <label class="lbl-output">                   Annual output                   <a href="#" target="_blank">info</a>               </label>               <span class="auto-calc-data hint">                  unavailable for this account               </span>               <span class="output"></span> kWh           </div>           <div class="prop-row">               <label class="lbl-savings">                   Annual savings (max)                   <a href="#" target="_blank">info</a>               </label>               <span class="auto-calc-data hint">                  unavailable for this account               </span>               $ <span class="savings"></span>           </div>           <div class="job-buttons">               <a class="btn-preview button" target="_blank"                    href="#" title="Preview in new window">                   Preview</a>               <div class="btn-report button"                    title="Generate Report">Report</div>               <div class="btn-close button"                    title="Finish the job">Finish</div>           </div>       </li>   </ul></div>');
            this.node = b,
            b.find(".title").val(a.title),
            b.find(".title").change(m(this, this.titleChanged)),
            b.find("input.efficiency").val(a.efficiency),
            b.find("input.efficiency").change(m(this, this.efficChanged)),
            b.find("input.orientation").bind("keyup input focus", m(this, this.orientationChanged)),
            b.find("div.orientation .btn-plus").click(m(this, n(h, b.find("input.orientation"), 1))),
            b.find("div.orientation .btn-minus").click(m(this, n(h, b.find("input.orientation"), -1))),
            b.find("input.tilt").bind("keyup input focus", m(this, this.tiltChanged)),
            b.find("div.tilt .btn-plus").click(m(this, n(h, b.find("input.tilt"), 1))),
            b.find("div.tilt .btn-minus").click(m(this, n(h, b.find("input.tilt"), -1))),
            b.find("input.mount-landscape").click(m(this, this.mountingClicked)),
            b.find("input.mount-portrait").click(m(this, this.mountingClicked)),
            j(b.find(".btn-minus")),
            j(b.find(".btn-plus")),
            b.find("a.btn-preview").attr("href", N("/?solar-job={}&output=0", a.id)),
            b.find("input.bounds").change(m(this, this.showBoundsChange)),
            b.find("input.bounds").prop("checked", "with-bounds" === this.jobsLayer.style),
            b.find(".system-efficiency").attr("title", "Edit the System Efficiency to account for losses in the physical system."),
            b.find(".system-efficiency a").attr("href", "https://support.nearmap.com/customer/portal/articles/1487551"),
            b.find(".lbl-output").attr("title", "This estimate is based on factors outlined on our support page."),
            b.find(".lbl-output a").attr("href", "https://support.nearmap.com/customer/portal/articles/1499132"),
            b.find(".lbl-savings").attr("title", "Assumes full utilisation of generated electricity. See our support page for more details."),
            b.find(".lbl-savings a").attr("href", "https://support.nearmap.com/customer/portal/articles/1483179"),
            b.find(".disclosure").click(m(this, this.advancedViewClicked)),
            b.find(".advanced-content").hide(),
            b.find("a.btn-panel-info").click(m(this, this.showPanelInfo)),
            b.find(".btn-arrange").addClass("disabled"),
            b.find(".btn-del").addClass("disabled"),
            b.find("input.panels").change(function() {
                return this.updateRestrictions()
            }
            .bind(this)),
            b.find(".btn-add").click(m(this, this.addPanelClick)),
            b.find(".btn-del").click(m(this, this.delPanelClick)),
            b.find(".btn-arrange").click(m(this, this.arrangeClick)),
            b.find(".btn-sel-all").click(m(this, this.selectAllClick)),
            b.find(".btn-report").click(m(this, this.genReport)),
            b.find(".btn-close").click(m(this, this.closeClicked));
            var c = b.find(".panel-types");
            c.change(m(this, this.panelTypeChanged)),
            E(function() {
                c.focus()
            }, 10),
            l(document).keydown(m(this, this.handleKeyDown))
        },
        activate: function() {
            this.active = !0,
            this.mapViewController.setCursor("crosshair"),
            this.tooltipMgr.set("Click anywhere on the map to add a panel")
        },
        deactivate: function() {
            this.mapViewController.setCursor(null ),
            this.tooltipMgr.unset(),
            this.active = !1
        },
        handleKeyDown: function(a) {
            a.which === S && this.active && !l(a.target).is("input") && this.delPanelClick()
        },
        showPanelInfo: function() {
            var a = this.getSelectedPanelType()
              , b = l(N('<div class="popup">    <div>        <div><b>Manufacturer:</b>{manufacturer}</div>        <div><b>Model:</b>{model}</div>        <div><b>Type:</b>{type}</div>        <div><b>Length:</b>{length} mm</div>        <div><b>Width:</b>{width} mm</div>        <div><b>Nominal Power:</b>{power} W</div>        <div><b>NOCT:</b>{noct} °C</div>        <div><b>Temp Coeff:</b>{tempCoef} %/K</div>    </div></div>', a))
              , c = this.node.find("a.btn-panel-info")
              , d = c.offset()
              , e = d.left + c.width() + 10
              , f = d.top;
            return b.css({
                left: e + "px",
                top: f + "px"
            }),
            b.appendTo("body"),
            l(window).mousedown(function(a) {
                var c = l(a.target)
                  , d = c.parents().index(b);
                -1 === d && b.remove()
            }),
            b.find(".btn-delete").click(m(this, function() {
                var a = this.getSelectedPanelType();
                this.panelTypesMgr.deletePanelType(a),
                b.remove()
            })),
            b.find(".btn-duplicate").click(m(this, function() {
                var a = this.getSelectedPanelType();
                a = a.clone(),
                this.panelTypesMgr.addPanelType(a),
                this.node.find(".panel-types").val(L(a)).change(),
                this.showPanelInfo()
            })),
            this.panelTypesMgr.isCustomPanelType(a) ? b.find(".btn-delete").removeClass("disabled") : b.find(".btn-delete").addClass("disabled"),
            !1
        },
        advancedViewClicked: function() {
            var a = this.node
              , b = a.find(".disclosure")
              , c = a.find(".advanced-content");
            c.is(":visible") ? (b.find("span").removeClass("down-triangle-btn"),
            b.find("span").addClass("right-triangle-btn")) : (b.find("span").removeClass("right-triangle-btn"),
            b.find("span").addClass("down-triangle-btn")),
            c.slideToggle()
        },
        showBoundsChange: function(a) {
            var b = this.jobsLayer;
            a.target.checked ? (b.setStyle("with-bounds"),
            this.selection.select(this.job)) : b.setStyle("simple")
        },
        getSelectedPanels: function() {
            return x(w(this.selection.getItems(), function(a) {
                return a instanceof J
            }))
        },
        isJobSelected: function() {
            var a = y(this.selection.getItems(), null , function(a) {
                return a instanceof K
            });
            return null  !== a
        },
        updateUI: function() {
            var a = this.getSelectedPanels()
              , b = null 
              , c = null 
              , d = !1
              , e = !1
              , f = a[0];
            a.length && (this.lastSelectedPanel = A(a));
            var g = "Select All"
              , h = this.node
              , i = this.panelsLayer
              , j = a.length
              , l = B(i.getFeatures())
              , m = h.find(".panel-controls")
              , n = h.find(".btn-del")
              , o = h.find(".btn-sel-all");
            if (l > 1 ? o.show() : o.hide(),
            f)
                b = f.orientation,
                c = f.tilt,
                d = y(a, function(a) {
                    return a.orientation !== b
                }),
                e = y(a, function(a) {
                    return a.tilt !== c
                }),
                h.find(".panel-types").val(L(f.panelType)),
                j === l && (g = "Unselect All"),
                n.removeClass("disabled"),
                f.mountPortrait ? h.find("input.mount-portrait").prop("checked", "checked") : h.find("input.mount-landscape").prop("checked", "checked"),
                m.show(),
                n.show();
            else {
                var p = z(i.getFeatures());
                p && h.find(".panel-types").val(L(p.panelType)),
                n.addClass("disabled"),
                m.hide(),
                n.hide()
            }
            j > 1 ? h.find(".btn-arrange").removeClass("disabled") : h.find(".btn-arrange").addClass("disabled");
            var q = h.find(".panel-total");
            0 === l ? (q.hide(),
            h.find(".btn-report").addClass("disabled")) : (q.show(),
            h.find(".btn-report").removeClass("disabled")),
            h.find("span.num-selected").text(j),
            h.find("span.num-total").text(l),
            b = k(b),
            k(h.find("input.orientation").val()) !== b && h.find("input.orientation").val(b),
            c = k(c),
            k(h.find("input.tilt").val()) !== c && h.find("input.tilt").val(c),
            h.find("input.tilt").css("color", e ? "red" : ""),
            h.find("input.orientation").css("color", d ? "red" : ""),
            o.text(g),
            this.isJobSelected() || (this.jobsLayer.setStyle("simple"),
            h.find("input.bounds").prop("checked", "with-bounds" === this.jobsLayer.style)),
            this.auth.can(Q) ? h.find(".auto-calc-data").hide() : h.find(".auto-calc-data").show(),
            this.updateRestrictions()
        },
        updateRestrictions: function() {
            var a = this.node
              , b = this.panelsLayer
              , c = B(b.getFeatures())
              , d = a.find("input.panels").val() || 1;
            d = parseInt(d, 0);
            var e = c + d > U;
            this.setRestricted(e)
        },
        setRestricted: function(a) {
            if (this.isRestricted !== a) {
                this.isRestricted = a;
                var b = this.node;
                a ? (b.find(".btn-add").addClass("disabled"),
                b.find(".max-num-panels").show(),
                this.mapViewController.setCursor(null ),
                this.tooltipMgr.unset()) : (b.find(".btn-add").removeClass("disabled"),
                b.find(".max-num-panels").hide(),
                this.mapViewController.setCursor("crosshair"),
                this.tooltipMgr.set("Click anywhere on the map to add a panel"))
            }
        },
        addMultiplePanels: function(a) {
            var b, c, d = [], e = null , g = z(this.getSelectedPanels());
            g = g || z(this.panelsLayer),
            g ? a > 1 ? (b = 180,
            c = g.getHeight()) : (b = 90,
            c = g.getWidth()) : (g = this.createPanel(),
            a -= 1,
            b = 90,
            c = g.getWidth(),
            d.push(g));
            for (var h = 0; a > h; h++) {
                var i = g.clone()
                  , j = i.orientation;
                j > 135 && 315 > j && (j += 180),
                e = {
                    distance: c / 1e3,
                    heading: b + j
                };
                var k = f(i.getPosition(), e);
                i.setPosition(k),
                d.push(i),
                g = i,
                b = 90,
                c = i.getWidth()
            }
            this.jobMgr.addPanel.apply(this.jobMgr, d),
            this.selection.select(d)
        },
        addPanelClick: function() {
            var a = this.node;
            if (!this.isRestricted) {
                var b = a.find("input.panels").val() || 1;
                b = parseInt(b, 0),
                this.addMultiplePanels(b)
            }
        },
        getSelectedPanelType: function() {
            var a = this.node.find(".panel-types").val()
              , b = this.panelTypesMgr.getPanelTypeById(a);
            return b
        },
        createPanel: function(a) {
            a = "undefined" == typeof arguments[0] ? this.map.getCenter() : a;
            var b = z(this.getSelectedPanels());
            if (b = b || this.lastSelectedPanel,
            b = b || A(this.panelsLayer))
                b = b.clone(),
                b.setPosition(a);
            else {
                var c = a.lat < 0 ? 0 : 180
                  , d = d || R
                  , e = e || !0
                  , f = f || this.getSelectedPanelType();
                b = new J(null ,a,c,d,e,f)
            }
            return b
        },
        delPanelClick: function() {
            var a = this.selection
              , b = this.getSelectedPanels();
            this.jobMgr.deletePanels(b);
            var c = A(this.panelsLayer);
            c ? a.select(c) : a.unselect(b),
            this.updateUI()
        },
        titleChanged: function() {
            var a = this.node
              , b = a.find(".title").val();
            this.job.setTitle(b)
        },
        efficChanged: function() {
            var a = this.node
              , b = a.find("input.efficiency").val();
            this.job.setEfficiency(b)
        },
        orientationChanged: function() {
            var a, b = this.node, c = k(b.find("input.orientation").val()), h = this.getSelectedPanels();
            if (0 !== h.length) {
                var i = h[0];
                if (h.length > 1) {
                    for (var j, l = g(h), m = new I, n = h[d.iterator](); !(j = n.next()).done; ) {
                        var o = j.value;
                        a = e(l, o.position),
                        a.orientation = o.orientation,
                        m.set(o, a)
                    }
                    for (var p, q = c - i.orientation, r = h[d.iterator](); !(p = r.next()).done; ) {
                        var s = p.value;
                        a = m.get(s);
                        var t = a.orientation + q;
                        a = {
                            heading: a.heading + q,
                            distance: a.distance
                        };
                        var u = f(l, a);
                        s.setPosition(u),
                        s.setOrientation(t)
                    }
                } else
                    i.setOrientation(c);
                this.updateUI()
            }
        },
        tiltChanged: function() {
            var a = this.selection.getItems()
              , b = this.node
              , c = k(b.find("input.tilt").val());
            c = Math.max(0, c);
            for (var e, f = a[d.iterator](); !(e = f.next()).done; ) {
                var g = e.value;
                g.setTilt && g.setTilt(c)
            }
            this.updateUI()
        },
        mountingClicked: function() {
            for (var a, b = this.selection.getItems(), c = this.node.find("input.mount-portrait").prop("checked"), e = b[d.iterator](); !(a = e.next()).done; ) {
                var f = a.value;
                f.setMountPortrait(c)
            }
            this.updateUI()
        },
        panelTypeChanged: function() {
            for (var a, b = this.panelsLayer.getFeatures(), c = this.getSelectedPanelType(), e = b[d.iterator](); !(a = e.next()).done; ) {
                var f = a.value;
                f.setPanelType(c)
            }
        },
        arrangeClick: function() {
            var a = this.getSelectedPanels()
              , b = this.panelsLayer;
            if (0 !== a.length) {
                var c = a.pop(0);
                b.bringFeatureToFront(c);
                for (var e, g = a[d.iterator](); !(e = g.next()).done; ) {
                    var h = e.value
                      , i = c.getWidth() / 1e3
                      , j = h.getWidth() / 1e3
                      , k = i / 2 + j / 2
                      , l = c.orientation
                      , m = f(c.position, {
                        heading: l + 90,
                        distance: k
                    });
                    h.setPosition(m),
                    h.setOrientation(l),
                    c = h,
                    b.bringFeatureToFront(h)
                }
                this.updateUI()
            }
        },
        selectAllClick: function() {
            var a = this.getSelectedPanels()
              , b = this.panelsLayer.getFeatures();
            B(a) === B(b) ? this.selection.unselectAll() : this.selection.select(b)
        },
        genReport: function() {
            if (!this.node.find(".btn-report").hasClass("disabled")) {
                var a, b, c = this.auth.getAccountData().Result;
                c.Email ? (this.reportGenerator.generate(this.job),
                a = "A report is being generated and will be sent to your email.",
                b = "information") : (a = N('Please set up an email address to receive solar panel reports by going to <a href="{}" target="_blank">My Account.</a>', P),
                b = "error"),
                T(a, {
                    type: b
                })
            }
        },
        closeClicked: function() {
            this.dispatch(new V)
        },
        reportError: function(a) {
            var b = N('There was an error generating a report for job "{}".', a.job.title);
            T(b, {
                type: "error"
            })
        },
        reportReady: function() {},
        jobChanged: function() {
            this.timestampProvider.setCoordinates(this.job.position),
            this.node.find(".title").val(this.job.title)
        },
        mapClicked: function(a) {
            if (this.active && !this.isRestricted) {
                var b = a.latLng
                  , c = this.createPanel(b);
                this.jobMgr.addPanel(c),
                this.selection.select(c)
            }
        },
        panelsChanged: function() {
            this.updateUI()
        },
        panelTypesMgrChanged: function() {
            var a = this.node.find(".panel-types");
            M(a, this.panelTypesMgr),
            this.updateUI()
        },
        jobMgrChanged: function() {
            var a = this.node
              , b = this.jobMgr
              , c = b.annualOutput / 1e3;
            c = Math.round(c) || "",
            a.find("span.output").text(c);
            var d = b.annualSavings;
            d = Math.round(d) || "",
            a.find("span.savings").text(d)
        },
        surveyChanged: function() {
            var a = this.surveysController.getDisplayDate();
            this.job.setSurveyDate(a)
        },
        timestampChanged: function() {
            var a = this.timestampProvider;
            this.job.setImageTimestamp(a.getValue());
            var b = a.getFormatted() || "N/A";
            this.node.find(".photo-time").html(b)
        },
        destroy: function() {
            this.deactivate(),
            this.jobMgr.destroy(),
            this.timestampProvider.destroy(),
            this.mapViewController.removeListeners(this),
            this.surveysController.removeListeners(this),
            this.panelsLayer.removeListeners(this),
            this.panelTypesMgr.removeListeners(this),
            this.job.removeListeners(this)
        }
    })
}),
nm_module("nm/dataproviders/solar/libpanels", function(a, b, c, d) {
    function e(a, b, c, d, e, h, i, j) {
        var k = new f(a + ":" + b,d,c,a,b,e,h,i,j);
        g.push(k)
    }
    var f = b("nm/features/solar", "PanelType")
      , g = a.libraryPanelTypes = [];
    e("Aleo Solar", "S18K240", 1660, 990, 240, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S18K245", 1660, 990, 245, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S18K250", 1660, 990, 250, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S18K255", 1660, 990, 255, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S18K260", 1660, 990, 260, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S18K265", 1660, 990, 265, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S19G250", 1660, 990, 250, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S19G255", 1660, 990, 255, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S19G260", 1660, 990, 260, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S19G265", 1660, 990, 265, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S19G270", 1660, 990, 270, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S19G275", 1660, 990, 275, "Monocrystalline", 48, -.44),
    e("Aleo Solar", "S24K195", 1345, 990, 195, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S24K200", 1345, 990, 200, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S24K205", 1345, 990, 205, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S24K210", 1345, 990, 210, "Polycrystalline", 48, -.43),
    e("Aleo Solar", "S79K255", 1660, 990, 255, "Monocrystalline", 49, -.44),
    e("Aleo Solar", "S79K260", 1660, 990, 260, "Monocrystalline", 49, -.44),
    e("Aleo Solar", "S79K265", 1660, 990, 265, "Monocrystalline", 49, -.44),
    e("BenQ Solar (AU Optronics)", "PM060M02_280", 1639, 983, 280, "Monocrystalline", 46, -.42),
    e("BenQ Solar (AU Optronics)", "PM060M02_275", 1639, 983, 275, "Monocrystalline", 46, -.42),
    e("BenQ Solar (AU Optronics)", "PM060M02_270", 1639, 983, 270, "Monocrystalline", 46, -.42),
    e("BenQ Solar (AU Optronics)", "PM096B00_320", 1559, 1046, 320, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM096B00_325", 1559, 1046, 325, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM096B00_327", 1559, 1046, 327, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM096B00_330", 1559, 1046, 330, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM200M00_190", 1318, 983, 190, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM200M00_195", 1318, 983, 195, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM200M00_200", 1318, 983, 200, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM200M00_205", 1318, 983, 205, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM200M00_210", 1318, 983, 210, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM220P00_205", 1668, 1e3, 205, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_210", 1668, 1e3, 210, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_215", 1668, 1e3, 215, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_220", 1668, 1e3, 220, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_225", 1668, 1e3, 225, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_230", 1668, 1e3, 230, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_235", 1668, 1e3, 235, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_240", 1668, 1e3, 240, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_245", 1668, 1e3, 245, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM220P00_250", 1668, 1e3, 250, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_220", 1668, 1e3, 220, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_225", 1668, 1e3, 225, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_230", 1668, 1e3, 230, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_235", 1668, 1e3, 235, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_240", 1668, 1e3, 240, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_245", 1668, 1e3, 245, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM240P00_250", 1668, 1e3, 250, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM245P00_240", 1639, 983, 240, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM245P00_245", 1639, 983, 245, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM245P00_250", 1639, 983, 250, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM245P00_255", 1639, 983, 255, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM245P00_260", 1639, 983, 260, "Polycrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M00_245", 1651, 992, 245, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M00_250", 1651, 992, 250, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M00_255", 1651, 992, 255, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M00_260", 1651, 992, 260, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M00_265", 1651, 992, 265, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M00_270", 1651, 992, 270, "Monocrystalline", 46, -.48),
    e("BenQ Solar (AU Optronics)", "PM250M01_255", 1639, 983, 255, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M01_260", 1639, 983, 260, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M01_265", 1639, 983, 265, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M01_270", 1639, 983, 270, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M01_275", 1639, 983, 275, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM250M01_280", 1639, 983, 280, "Monocrystalline", 46, -.44),
    e("BenQ Solar (AU Optronics)", "PM300P00_290", 1956, 983, 290, "Polycrystalline", 45, -.43),
    e("BenQ Solar (AU Optronics)", "PM300P00_295", 1956, 983, 295, "Polycrystalline", 45, -.43),
    e("BenQ Solar (AU Optronics)", "PM300P00_300", 1956, 983, 300, "Polycrystalline", 45, -.43),
    e("BenQ Solar (AU Optronics)", "PM300P00_305", 1956, 983, 305, "Polycrystalline", 45, -.43),
    e("BenQ Solar (AU Optronics)", "PM318B01_315", 1559, 1046, 315, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM318B01_320", 1559, 1046, 320, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM318B01_325", 1559, 1046, 325, "Monocrystalline", 45, -.38),
    e("BenQ Solar (AU Optronics)", "PM318B01_327", 1559, 1046, 327, "Monocrystalline", 45, -.38),
    e("Bosch Solar", "c-Si M 60 EU30117 235", 1660, 990, 235, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30117 240", 1660, 990, 240, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30117 245", 1660, 990, 245, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30117 250", 1660, 990, 250, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30123 235", 1660, 990, 235, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30123 240", 1660, 990, 240, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30123 245", 1660, 990, 245, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU30123 250", 1660, 990, 250, "Monocrystalline", 48.4, -.46),
    e("Bosch Solar", "c-Si M 60 EU42117 245", 1660, 990, 245, "Monocrystalline", 48.4, -.44),
    e("Bosch Solar", "c-Si M 60 EU42117 250", 1660, 990, 250, "Monocrystalline", 48.4, -.44),
    e("Bosch Solar", "c-Si M 60 EU42117 255", 1660, 990, 255, "Monocrystalline", 48.4, -.44),
    e("Bosch Solar", "c-Si M 60 EU42117 260", 1660, 990, 260, "Monocrystalline", 48.4, -.44),
    e("Canadian Solar", "CS5A-200M", 1595, 801, 200, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS5A-205M", 1595, 801, 205, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-240M", 1638, 982, 240, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-245M", 1638, 982, 245, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-250M", 1638, 982, 250, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-250P", 1638, 982, 250, "Polycrystalline", 45, -.43),
    e("Canadian Solar", "CS6P-255M", 1638, 982, 255, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-255MM", 1638, 982, 255, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-255P", 1638, 982, 255, "Polycrystalline", 45, -.43),
    e("Canadian Solar", "CS6P-260M", 1638, 982, 260, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-260MM", 1638, 982, 255, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6P-260P", 1638, 982, 260, "Polycrystalline", 45, -.43),
    e("Canadian Solar", "CS6P-265MM", 1638, 982, 255, "Monocrystalline", 45, -.45),
    e("Canadian Solar", "CS6X-300P", 1954, 982, 300, "Polycrystalline", 45, -.43),
    e("Canadian Solar", "CS6X-305P", 1954, 982, 305, "Polycrystalline", 45, -.43),
    e("China Sunergy", "CSUN 190-72M", 1630, 1120, 190, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 195-72M", 1630, 1120, 195, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 200-72M", 1630, 1120, 200, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 205-72M", 1630, 1120, 205, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 235-60M", 1690, 1120, 235, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 240-60M", 1690, 1120, 240, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 240-60P", 1690, 1120, 240, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 245-60M", 1690, 1120, 245, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 245-60P", 1690, 1120, 245, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 250-60M", 1690, 1120, 250, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 250-60P", 1690, 1120, 250, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 255-60P", 1690, 1120, 255, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 260-60P", 1690, 1120, 260, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 285-72M", 1990, 1120, 285, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 290-72M", 1990, 1120, 290, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 290-72P", 1990, 1120, 290, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 295-72M", 1990, 1120, 295, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 295-72P", 1990, 1120, 295, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 300-72M", 1990, 1120, 300, "Monocrystalline", 45, -.423),
    e("China Sunergy", "CSUN 300-72P", 1990, 1120, 300, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 305-72P", 1990, 1120, 305, "Polycrystalline", 45, -.408),
    e("China Sunergy", "CSUN 310-72P", 1990, 1120, 310, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST190-72M", 1630, 1120, 190, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST195-72M", 1630, 1120, 195, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST200-72M", 1630, 1120, 200, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST205-72M", 1630, 1120, 205, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST235-60M", 1690, 1120, 235, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST240-60M", 1690, 1120, 240, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST240-60P", 1690, 1120, 240, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST245-60M", 1690, 1120, 245, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST245-60P", 1690, 1120, 245, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST250-60M", 1690, 1120, 250, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST250-60P", 1690, 1120, 250, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST255-60P", 1690, 1120, 255, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST260-60P", 1690, 1120, 260, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST285-72M", 1990, 1120, 285, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST290-72M", 1990, 1120, 290, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST290-72P", 1990, 1120, 290, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST295-72M", 1990, 1120, 295, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST295-72P", 1990, 1120, 295, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST300-72M", 1990, 1120, 300, "Monocrystalline", 45, -.423),
    e("China Sunergy", "SST300-72P", 1990, 1120, 300, "Polycrystalline", 45, -.408),
    e("China Sunergy", "SST305-72P", 1990, 1120, 305, "Polycrystalline", 45, -.408),
    e("CNPV", "CNPV-100M", 1200, 540, 100, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-105M", 1200, 540, 105, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-120P", 1492, 674, 120, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-125M", 1492, 674, 125, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-125P", 1492, 674, 125, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-130M", 1492, 674, 130, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-130P", 1492, 674, 130, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-135M", 1492, 674, 135, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-135P", 1492, 674, 135, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-140M", 1492, 674, 140, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-140P", 1492, 674, 140, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-145M", 1492, 674, 145, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-145P", 1492, 674, 145, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-150M", 1492, 674, 150, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-150P", 1492, 674, 150, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-155M", 1492, 674, 155, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-155P", 1492, 674, 155, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-160M", 1492, 674, 160, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-170M", 1581, 809, 170, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-175M", 1581, 809, 175, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-180M", 1581, 809, 180, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-185M", 1581, 809, 185, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-190M", 1581, 809, 190, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-190MB", 1581, 809, 190, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-195M", 1581, 809, 195, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-195MB", 1581, 809, 195, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-200M", 1581, 809, 200, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-200MB", 1581, 809, 200, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-200P", 1650, 992, 200, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-205M", 1581, 809, 205, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-205MB", 1581, 809, 205, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-210M", 1650, 992, 210, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-210P", 1650, 992, 210, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-215M-54", 1482, 992, 215, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-220M", 1650, 992, 220, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-220M-54", 1482, 992, 220, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-220P", 1650, 992, 220, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-225M", 1650, 992, 225, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-225M-54", 1482, 992, 225, "Monocrystalline", 45, -.45),
    e("CNPV", "CNPV-230M", 1650, 992, 230, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-230P", 1650, 992, 230, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-235M", 1650, 992, 235, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-235P", 1650, 992, 235, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-240M", 1650, 992, 240, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-240P", 1650, 992, 240, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-240PB", 1650, 992, 240, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-245M", 1650, 992, 245, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-245MB", 1650, 992, 245, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-245PB", 1650, 992, 245, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-250M", 1650, 992, 250, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-250MB", 1650, 992, 250, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-250P", 1965, 992, 250, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-250PB", 1650, 992, 250, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-255M", 1650, 992, 255, "Monocrystalline", 46, -.4),
    e("CNPV", "CNPV-255MB", 1650, 992, 255, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-260M", 1650, 992, 260, "Monocrystalline", 46, -.4),
    e("CNPV", "CNPV-260MB", 1650, 992, 260, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-260P", 1965, 992, 260, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-270M", 1965, 992, 270, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-270P", 1965, 992, 270, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-280M", 1965, 992, 280, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-280P", 1965, 992, 280, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-285M", 1965, 992, 285, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-285P", 1965, 992, 285, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-290M", 1965, 992, 290, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-290P", 1965, 992, 290, "Polycrystalline", 45, -.45),
    e("CNPV", "CNPV-290PB", 1965, 992, 290, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-295M", 1965, 992, 295, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-295PB", 1965, 992, 295, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-300M", 1965, 992, 300, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-300MB", 1965, 992, 300, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-300PB", 1965, 992, 300, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-305M", 1965, 992, 305, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-305MB", 1965, 992, 305, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-305PB", 1965, 992, 305, "Polycrystalline", 45, -.4),
    e("CNPV", "CNPV-310MB", 1965, 992, 310, "Monocrystalline", 45, -.4),
    e("CNPV", "CNPV-315MB", 1965, 992, 315, "Monocrystalline", 45, -.4),
    e("Conergy", "P 170M", 1580, 808, 170, "Monocrystalline", 45, -.44),
    e("Conergy", "P 175M", 1580, 808, 175, "Monocrystalline", 45, -.44),
    e("Conergy", "P 180M", 1580, 808, 180, "Monocrystalline", 45, -.44),
    e("Conergy", "P 185M", 1580, 808, 185, "Monocrystalline", 45, -.44),
    e("Conergy", "P 190M", 1566, 800, 190, "Monocrystalline", 45, -.44),
    e("Conergy", "P 190P", 1494, 1e3, 190, "Polycrystalline", 45, -.45),
    e("Conergy", "P 195M", 1566, 800, 195, "Monocrystalline", 45, -.44),
    e("Conergy", "P 195P", 1494, 1e3, 195, "Polycrystalline", 45, -.45),
    e("Conergy", "P 200P", 1494, 1e3, 200, "Polycrystalline", 45, -.45),
    e("Conergy", "P 205P", 1494, 1e3, 205, "Polycrystalline", 45, -.45),
    e("Conergy", "P 210PA", 1652, 1e3, 210, "Polycrystalline", 45, -.45),
    e("Conergy", "P 215PA", 1652, 1e3, 215, "Polycrystalline", 45, -.45),
    e("Conergy", "P 220PA", 1652, 1e3, 220, "Polycrystalline", 45, -.45),
    e("Conergy", "P 225PA", 1652, 1e3, 225, "Polycrystalline", 45, -.45),
    e("Conergy", "P 230PA", 1652, 1e3, 230, "Polycrystalline", 45, -.45),
    e("Conergy", "P 235PA", 1652, 1e3, 235, "Polycrystalline", 45, -.45),
    e("Conergy", "P 240PA", 1652, 1e3, 240, "Polycrystalline", 45, -.45),
    e("Conergy", "PH 175M", 1580, 808, 175, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 180M", 1580, 808, 180, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 185M", 1580, 808, 185, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 190M", 1580, 808, 190, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 195M", 1580, 808, 195, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 200M", 1580, 808, 200, "Monocrystalline", 47, -.48),
    e("Conergy", "PH 220P", 1652, 994, 220, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 225P", 1652, 994, 225, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 230P", 1652, 994, 230, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 235P", 1652, 994, 235, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 240P", 1652, 994, 240, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 245P", 1652, 994, 240, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 250P", 1652, 994, 240, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 255P", 1652, 994, 240, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 260P", 1652, 994, 240, "Polycrystalline", 43, -.47),
    e("Conergy", "PH 290P", 1652, 994, 290, "Polycrystalline", 46, -.45),
    e("Conergy", "PH 295P", 1652, 994, 295, "Polycrystalline", 46, -.45),
    e("Conergy", "PH 300P", 1652, 994, 300, "Polycrystalline", 46, -.45),
    e("Conergy", "PH 305P", 1652, 994, 305, "Polycrystalline", 46, -.45),
    e("Conergy", "PH 310P", 1652, 994, 310, "Polycrystalline", 46, -.45),
    e("Conergy", "PM 220P", 1668, 1e3, 220, "Polycrystalline", 44.4, -.44),
    e("Conergy", "PM 225P", 1668, 1e3, 225, "Polycrystalline", 44.4, -.44),
    e("Conergy", "PM 230P", 1668, 1e3, 230, "Polycrystalline", 44.4, -.44),
    e("Conergy", "PM 235P", 1668, 1e3, 235, "Polycrystalline", 44.4, -.44),
    e("Conergy", "PowerPlus 190M", 1651, 986, 190, "Monocrystalline", 45, -.48),
    e("Conergy", "PowerPlus 200M", 1651, 986, 200, "Monocrystalline", 45, -.48),
    e("Conergy", "PowerPlus 200P", 1651, 986, 200, "Polycrystalline", 43.4, -.45),
    e("Conergy", "PowerPlus 210M", 1651, 986, 210, "Monocrystalline", 45, -.48),
    e("Conergy", "PowerPlus 210P", 1651, 986, 210, "Polycrystalline", 43.4, -.45),
    e("Conergy", "PowerPlus 215P", 1651, 986, 215, "Polycrystalline", 44, -.44),
    e("Conergy", "PowerPlus 220M", 1651, 986, 220, "Monocrystalline", 45, -.48),
    e("Conergy", "PowerPlus 220P", 1651, 986, 220, "Polycrystalline", 44, -.44),
    e("Conergy", "PowerPlus 225P", 1651, 986, 225, "Polycrystalline", 44, -.44),
    e("Conergy", "PowerPlus 230M", 1651, 986, 230, "Monocrystalline", 45, -.48),
    e("Conergy", "PowerPlus 230P", 1651, 986, 230, "Polycrystalline", 46, -.44),
    e("Conergy", "PowerPlus 235P", 1651, 986, 235, "Polycrystalline", 46, -.44),
    e("Conergy", "PowerPlus 240M", 1651, 986, 240, "Monocrystalline", 48, -.44),
    e("Conergy", "PowerPlus 240P", 1651, 986, 240, "Polycrystalline", 46, -.44),
    e("Conergy", "PowerPlus 245M", 1651, 986, 245, "Monocrystalline", 48, -.44),
    e("Conergy", "PowerPlus 245P", 1651, 986, 245, "Polycrystalline", 46, -.44),
    e("Conergy", "PowerPlus 250M", 1651, 986, 250, "Monocrystalline", 48, -.44),
    e("Conergy", "PowerPlus 250P", 1651, 986, 250, "Polycrystalline", 46, -.44),
    e("Conergy", "PowerPlus 255M", 1651, 986, 255, "Monocrystalline", 48, -.44),
    e("Conergy", "PowerPlus 260M", 1651, 986, 260, "Monocrystalline", 48, -.44),
    e("Conergy", "PX 240P", 1650, 992, 240, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 245P", 1650, 992, 245, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 250P", 1650, 992, 250, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 285P", 1956, 992, 285, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 290P", 1956, 992, 290, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 295P", 1956, 992, 295, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 300P", 1956, 992, 300, "Polycrystalline", 45, -.45),
    e("Conergy", "PX 305P", 1956, 992, 305, "Polycrystalline", 45, -.45),
    e("Daqo New Energy", "DQ165MFAa", 1580, 808, 165, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ170MFAa", 1580, 808, 170, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ175MFA", 1580, 808, 175, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ175MFAa", 1580, 808, 175, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ175PSBa", 1482, 992, 175, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ180MFA", 1580, 808, 180, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ180MFAa", 1580, 808, 180, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ180PSBa", 1482, 992, 180, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ185MFA", 1580, 808, 185, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ185MFAa", 1580, 808, 185, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ185PSBa", 1482, 992, 185, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ190MFA", 1580, 808, 190, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ190MFAa", 1580, 808, 190, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ190PSBa", 1482, 992, 190, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ195MFA", 1580, 808, 195, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ195PSBa", 1482, 992, 195, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ200MFA", 1580, 808, 200, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ200PSBa", 1482, 992, 200, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ205MFA", 1580, 808, 205, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ205PSBa", 1482, 992, 205, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ210MFA", 1580, 808, 210, "Monocrystalline", 45, -.4),
    e("Daqo New Energy", "DQ210PSBa", 1482, 992, 210, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ215PSBa", 1482, 992, 215, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ215PSCa", 1640, 992, 215, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ220PSBa", 1482, 992, 220, "Polycrystalline", 45, -.46),
    e("Daqo New Energy", "DQ220PSCa", 1640, 992, 220, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ225PSCa", 1640, 992, 225, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ230PSCa", 1640, 992, 230, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ235PSCa", 1640, 992, 235, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ240PSCa", 1640, 992, 240, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ245PSCa", 1640, 992, 245, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ250PSCa", 1640, 992, 250, "Polycrystalline", 45, -.44),
    e("Daqo New Energy", "DQ255PSCa", 1640, 992, 255, "Polycrystalline", 45, -.44),
    e("ET Solar", "ET-M572195BB", 1580, 808, 195, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M572200BB", 1580, 808, 200, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M572200WW", 1580, 808, 200, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M572205WW", 1580, 808, 205, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M648200BB", 1324, 992, 200, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M648200WW", 1324, 992, 200, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M648205WW", 1324, 992, 205, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M648210WW", 1324, 992, 210, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M660245BB", 1640, 992, 245, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660250BB", 1640, 992, 250, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660250WW", 1640, 992, 250, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660255BB", 1640, 992, 255, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660255WW", 1640, 992, 255, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660260BB", 1640, 992, 260, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660260WW", 1640, 992, 260, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M660265WW", 1640, 992, 265, "Monocrystalline", 45.3, -.44),
    e("ET Solar", "ET-M672295BB", 1956, 992, 295, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672300BB", 1956, 992, 300, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672300WW", 1956, 992, 300, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672305BB", 1956, 992, 305, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672305WW", 1956, 992, 305, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672310BB", 1956, 992, 310, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672310WW", 1956, 992, 310, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-M672315WW", 1956, 992, 315, "Monocrystalline", 44.4, -.44),
    e("ET Solar", "ET-P648195WW", 1324, 992, 195, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P648200WW", 1324, 992, 200, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660240BB", 1640, 992, 240, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660245BB", 1640, 992, 245, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660245WB", 1640, 992, 245, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660245WW", 1640, 992, 245, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660250BB", 1640, 992, 250, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660250WB", 1640, 992, 250, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660250WW", 1640, 992, 250, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660255BB", 1640, 992, 255, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660255WB", 1640, 992, 255, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660255WW", 1640, 992, 255, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660260WB", 1640, 992, 260, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P660260WW", 1640, 992, 260, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672290BB", 1956, 992, 290, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672290WB", 1956, 992, 290, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672290WW", 1956, 992, 290, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672295BB", 1956, 992, 295, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672295WB", 1956, 992, 295, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672295WW", 1956, 992, 295, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672300BB", 1956, 992, 300, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672300WB", 1956, 992, 300, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672300WW", 1956, 992, 300, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672305WB", 1956, 992, 305, "Polycrystalline", 45.3, -.44),
    e("ET Solar", "ET-P672305WW", 1956, 992, 305, "Polycrystalline", 45.3, -.44),
    e("First Solar", "FS-375", 1200, 600, 75, "Thin-film", 45, -.25),
    e("First Solar", "FS-377", 1200, 600, 77.5, "Thin-film", 45, -.25),
    e("First Solar", "FS-380", 1200, 600, 80, "Thin-film", 45, -.25),
    e("First Solar", "FS-382", 1200, 600, 82.5, "Thin-film", 45, -.25),
    e("First Solar", "FS-385", 1200, 600, 85, "Thin-film", 45, -.25),
    e("Gista Sunnyenrgy", "GS5M36-100", 1196, 534, 100, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M36-105", 1196, 534, 105, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M36-110", 1196, 534, 110, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M36-90", 1196, 534, 90, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M36-95", 1196, 534, 95, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M60-150", 1326, 808, 150, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M60-155", 1326, 808, 155, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M60-160", 1326, 808, 160, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M60-165", 1326, 808, 165, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M60-170", 1326, 808, 170, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M72-180", 1580, 808, 180, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M72-185", 1580, 808, 185, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M72-190", 1580, 808, 190, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M72-195", 1580, 808, 195, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M72-200", 1580, 808, 200, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-240", 1580, 1064, 240, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-245", 1580, 1064, 245, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-250", 1580, 1064, 250, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-255", 1580, 1064, 255, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-260", 1580, 1064, 260, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-265", 1580, 1064, 265, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS5M96-270", 1580, 1064, 270, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M60-240", 1640, 992, 240, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M60-245", 1640, 992, 245, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M60-250", 1640, 992, 250, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M60-255", 1640, 992, 255, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M60-260", 1640, 992, 260, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-270", 1956, 992, 270, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-280", 1956, 992, 280, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-290", 1956, 992, 290, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-295", 1956, 992, 295, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-300", 1956, 992, 300, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-305", 1956, 992, 305, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6M72-310", 1956, 992, 310, "Monocrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P36-135", 1480, 680, 135, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P36-140", 1480, 680, 140, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P36-145", 1480, 680, 145, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P36-150", 1480, 680, 150, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P36-155", 1480, 680, 155, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-200", 1480, 992, 200, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-205", 1480, 992, 205, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-210", 1480, 992, 210, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-215", 1480, 992, 215, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-220", 1480, 992, 220, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-225", 1480, 992, 225, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P54-230", 1480, 992, 230, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-230", 1640, 992, 230, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-235", 1640, 992, 235, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-240", 1640, 992, 240, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-245", 1640, 992, 245, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-250", 1640, 992, 250, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-255", 1640, 992, 255, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P60-260", 1640, 992, 260, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-280", 1956, 992, 280, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-285", 1956, 992, 285, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-290", 1956, 992, 290, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-295", 1956, 992, 295, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-300", 1956, 992, 300, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-305", 1956, 992, 305, "Polycrystalline", 45, -.43),
    e("Gista Sunnyenrgy", "GS6P72-310", 1956, 992, 310, "Polycrystalline", 45, -.43),
    e("Hanwha SolarOne", "HSL60S-245", 1670, 1e3, 245, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-245B", 1670, 1e3, 245, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-250", 1670, 1e3, 250, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-250B", 1670, 1e3, 250, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-255", 1670, 1e3, 255, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-255B", 1670, 1e3, 255, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-260", 1670, 1e3, 260, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-260B", 1670, 1e3, 260, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-265", 1670, 1e3, 265, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-265B", 1670, 1e3, 265, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-270", 1670, 1e3, 270, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL60S-270B", 1670, 1e3, 270, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-290", 1972, 992, 290, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-295", 1972, 992, 295, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-300", 1972, 992, 300, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-305", 1972, 992, 305, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-310", 1972, 992, 310, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "HSL72S-315", 1972, 992, 315, "Polycrystalline", 45, -.41),
    e("Hanwha SolarOne", "SF160-24-1M170L", 1580, 808, 170, "Monocrystalline", 45, -.44),
    e("Hanwha SolarOne", "SF160-24-1M175L", 1580, 808, 175, "Monocrystalline", 45, -.44),
    e("Hanwha SolarOne", "SF160-24-1M180L", 1580, 808, 180, "Monocrystalline", 45, -.44),
    e("Hanwha SolarOne", "SF160-24-1M185L", 1580, 808, 185, "Monocrystalline", 45, -.44),
    e("Hanwha SolarOne", "SF160-24-1M190L", 1580, 808, 190, "Monocrystalline", 45, -.44),
    e("Hanwha SolarOne", "SF160-24-1M195L", 1580, 808, 195, "Monocrystalline", 45, -.44),
    e("Hanwha Q CELLS", "Q-PLUS-G4-1-270", 1670, 1e3, 270, "Polycrystalline", 45, -.4),
    e("Hanwha Q CELLS", "Q-PLUS-G4-1-275", 1670, 1e3, 275, "Polycrystalline", 45, -.4),
    e("Hanwha Q CELLS", "Q-PLUS-G4-1-280", 1670, 1e3, 280, "Polycrystalline", 45, -.4),
    e("Hanwha Q CELLS", "Q-PRO-G4-1-255", 1670, 1e3, 255, "Polycrystalline", 45, -.41),
    e("Hanwha Q CELLS", "Q-PRO-G4-1-260", 1670, 1e3, 260, "Polycrystalline", 45, -.41),
    e("Hanwha Q CELLS", "Q-PRO-G4-1-265", 1670, 1e3, 265, "Polycrystalline", 45, -.41),
    e("Hyundai Solar", "HiS-M230MG", 1645, 983, 230, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M233MG", 1645, 983, 233, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M235MG", 1645, 983, 235, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M238MG", 1645, 983, 238, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M240MG", 1645, 983, 240, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M245MG", 1645, 983, 245, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-M250MG", 1645, 983, 250, "Polycrystalline", 46, -.43),
    e("Hyundai Solar", "HiS-S245MG", 1645, 983, 245, "Monocrystalline", 46, -.45),
    e("Hyundai Solar", "HiS-S248MG", 1645, 983, 248, "Monocrystalline", 46, -.45),
    e("Hyundai Solar", "HiS-S250MG", 1645, 983, 250, "Monocrystalline", 46, -.45),
    e("Hyundai Solar", "HiS-S255MG", 1645, 983, 255, "Monocrystalline", 46, -.45),
    e("Hyundai Solar", "HiS-S260MG", 1645, 983, 260, "Monocrystalline", 46, -.45),
    e("Hyundai Solar", "HiS-S265MG", 1645, 983, 265, "Monocrystalline", 46, -.45),
    e("JA Solar", "JAM5(L)(BK)-72-190", 1580, 808, 190, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)(BK)-72-195", 1580, 808, 195, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)(BK)-72-200", 1580, 808, 200, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)(BK)-72-205", 1580, 808, 205, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)(BK)-72-210", 1580, 808, 210, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)-72-195", 1580, 808, 195, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)-72-200", 1580, 808, 200, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)-72-205", 1580, 808, 205, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)-72-210", 1580, 808, 210, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM5(L)-72-215", 1580, 808, 215, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6(BK)-60-245/SI", 1650, 991, 245, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6(BK)-60-250/SI", 1650, 991, 250, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6(BK)-60-255/SI", 1650, 991, 255, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6(BK)-60-260/SI", 1650, 991, 260, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6(BK)-60-265/SI", 1650, 991, 265, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-60-250/SI", 1650, 991, 250, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-60-255/SI", 1650, 991, 255, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-60-260/SI", 1650, 991, 260, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-60-265/SI", 1650, 991, 265, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-60-270/SI", 1650, 991, 270, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-72-300/SI", 1956, 991, 300, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-72-305/SI", 1956, 991, 305, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-72-310/SI", 1956, 991, 310, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-72-315/SI", 1956, 991, 315, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAM6-72-320/SI", 1956, 991, 320, "Monocrystalline", 45, -.41),
    e("JA Solar", "JAP6(BK)-60-240/3BB", 1650, 991, 240, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6(BK)-60-245/3BB", 1650, 991, 245, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6(BK)-60-250/3BB", 1650, 991, 250, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6(BK)-60-255/3BB", 1650, 991, 255, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6(BK)-60-260/3BB", 1650, 991, 260, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-60-245/3BB", 1650, 991, 245, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-60-250/3BB", 1650, 991, 250, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-60-255/3BB", 1650, 991, 255, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-60-260/3BB", 1650, 991, 260, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-60-265/3BB", 1650, 991, 265, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-72-295/3BB", 1956, 991, 295, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-72-300/3BB", 1956, 991, 300, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-72-305/3BB", 1956, 991, 305, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-72-310/3BB", 1956, 991, 310, "Polycrystalline", 45, -.43),
    e("JA Solar", "JAP6-72-315/3BB", 1956, 991, 315, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT185SAb", 1580, 808, 185, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT190SAb", 1580, 808, 190, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT195SAb", 1580, 808, 195, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT200SAb", 1580, 808, 200, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT235PLe", 1638, 982, 235, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT240PLe", 1638, 982, 240, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT240SBb", 1580, 1069, 240, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT245PLe", 1638, 982, 245, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT245SBb", 1580, 1069, 245, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT250PLe", 1638, 982, 250, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT250SBb", 1580, 1069, 250, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT250SLc", 1638, 982, 250, "Monocrystalline", 45, -.41),
    e("Jetion Solar", "JT255PLe", 1638, 982, 255, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT255SBb", 1580, 1069, 255, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT255SLc", 1638, 982, 255, "Monocrystalline", 45, -.41),
    e("Jetion Solar", "JT260PLe", 1638, 982, 260, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT260SBb", 1580, 1069, 260, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT260SLc", 1638, 982, 260, "Monocrystalline", 45, -.41),
    e("Jetion Solar", "JT265PLe", 1638, 982, 265, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT265SLc", 1638, 982, 265, "Monocrystalline", 45, -.41),
    e("Jetion Solar", "JT270SLc", 1638, 982, 270, "Monocrystalline", 45, -.41),
    e("Jetion Solar", "JT285PMe", 1954, 982, 285, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT290PMe", 1954, 982, 290, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT295PMe", 1954, 982, 295, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT300PMe", 1954, 982, 300, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT300SMc", 1954, 982, 300, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT305PMe", 1954, 982, 305, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT305SMc", 1954, 982, 305, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT310PMe", 1954, 982, 310, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT310SMc", 1954, 982, 310, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT315PMe", 1954, 982, 315, "Polycrystalline", 45, -.43),
    e("Jetion Solar", "JT315SMc", 1954, 982, 315, "Monocrystalline", 45, -.42),
    e("Jetion Solar", "JT320SMc", 1954, 982, 320, "Monocrystalline", 45, -.42),
    e("Jiawei", "JW-G2150/QC6660", 1653, 982, 215, "Polycrystalline", 46, -.43),
    e("Jiawei", "JW-G2200/JW6660", 1653, 982, 220, "Polycrystalline", 46, -.4),
    e("Jiawei", "JW-G2200/QC6660", 1653, 982, 220, "Polycrystalline", 46, -.43),
    e("Jiawei", "JW-G2250/JW6660", 1653, 982, 225, "Polycrystalline", 46, -.4),
    e("Jiawei", "JW-G2250/QC6660", 1653, 982, 225, "Polycrystalline", 46, -.43),
    e("Jiawei", "JW-G2300/JW6660", 1653, 982, 230, "Polycrystalline", 46, -.4),
    e("Jiawei", "JW-G2300/QC6660", 1653, 982, 230, "Polycrystalline", 46, -.43),
    e("Jiawei", "JW-G2350/JW6660", 1653, 982, 235, "Polycrystalline", 46, -.4),
    e("Jinko Solar", "JKM190M-72", 1580, 808, 190, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM195M-72", 1580, 808, 195, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM200M-72", 1580, 808, 200, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM205M-72", 1580, 808, 205, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM210M-72", 1580, 808, 210, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM245P-60", 1650, 992, 245, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM250M-60", 1650, 992, 250, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM250P-60", 1650, 992, 250, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM255M-60", 1650, 992, 255, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM255M-96", 1575, 1082, 255, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM255P-60", 1650, 992, 255, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM260M-60", 1650, 992, 260, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM260M-96", 1575, 1082, 260, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM260P-60", 1650, 992, 260, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM265M-60", 1650, 992, 265, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM265M-96", 1575, 1082, 265, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM265P-60", 1650, 992, 265, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM270M-60", 1650, 992, 270, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM270M-96", 1575, 1082, 270, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM275M-96", 1575, 1082, 275, "Monocrystalline", 45, -.4),
    e("Jinko Solar", "JKM295P-72", 1956, 992, 295, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM300P-72", 1956, 992, 300, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM305P-72", 1956, 992, 305, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM310P-72", 1956, 992, 310, "Polycrystalline", 45, -.41),
    e("Jinko Solar", "JKM315P-72", 1956, 992, 315, "Polycrystalline", 45, -.41),
    e("Kaneka", "U-EA100", 1210, 1008, 100, "Thin-film", 45, -.35),
    e("Kaneka", "U-EA105", 1210, 1008, 105, "Thin-film", 45, -.35),
    e("Kaneka", "U-EA110", 1210, 1008, 110, "Thin-film", 45, -.35),
    e("Kaneka", "U-EA115", 1210, 1008, 115, "Thin-film", 45, -.35),
    e("Kaneka", "U-EA120", 1210, 1008, 120, "Thin-film", 45, -.35),
    e("KL Solar", "KL008", 345, 285, 8, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL010", 345, 285, 10, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL012", 405, 345, 12, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL015", 405, 345, 15, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL018", 525, 345, 18, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL020", 525, 345, 20, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL024", 665, 345, 24, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL025", 665, 345, 25, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL030", 890, 345, 30, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL037", 890, 345, 37, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL040", 890, 345, 40, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL045", 670, 665, 45, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL050", 670, 665, 50, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL055", 670, 665, 55, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL060", 775, 665, 60, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL065", 775, 665, 65, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL070", 775, 665, 70, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL075", 900, 665, 75, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL080", 900, 665, 80, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL085", 900, 665, 85, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL090", 900, 665, 90, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL100", 1480, 665, 100, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL110", 1480, 665, 110, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL120", 1480, 665, 120, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL130", 1480, 665, 130, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL140", 1480, 665, 140, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL150", 1480, 665, 150, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL170", 1630, 840, 170, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL180", 1630, 840, 180, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL190", 1630, 840, 190, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL200", 1636, 991, 200, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL210", 1636, 991, 210, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL220", 1636, 991, 220, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL230", 1636, 991, 230, "Polycrystalline", 45, -.43),
    e("KL Solar", "KL240", 1636, 991, 240, "Polycrystalline", 45, -.43),
    e("Kyocera", "KD135SX-1PU", 1500, 668, 135, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD140GH-2PU", 1500, 668, 140, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD140SX-1FBS", 1500, 668, 140, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD215GH-4FBS", 1500, 990, 215, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD245GH-4FB2", 1662, 990, 245, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD250GH-4FB2", 1662, 990, 250, "Polycrystalline", 45, -.46),
    e("Kyocera", "KD325GH-4FB", 1662, 1320, 325, "Polycrystalline", 45, -.45),
    e("LG", "LG250S1C-G2", 1632, 986, 250, "Monocrystalline", 46, -.42),
    e("LG", "LG250S1C-G3", 1640, 1e3, 250, "Monocrystalline", 44.9, -.459),
    e("LG", "LG250S1K-G3", 1640, 1e3, 250, "Monocrystalline", 47, -.445),
    e("LG", "LG255S1C-G2", 1632, 986, 255, "Monocrystalline", 46, -.42),
    e("LG", "LG255S1C-G3", 1640, 1e3, 255, "Monocrystalline", 44.9, -.459),
    e("LG", "LG255S1K", 1640, 1e3, 255, "Monocrystalline", 47, -.45),
    e("LG", "LG255S1K-A3", 1640, 1e3, 255, "Monocrystalline", 47, -.44),
    e("LG", "LG260S1C-A3", 1640, 1e3, 260, "Monocrystalline", 45, -.43),
    e("LG", "LG260S1C-G2", 1632, 986, 260, "Monocrystalline", 46, -.42),
    e("LG", "LG260S1C-G3", 1640, 1e3, 260, "Monocrystalline", 44.9, -.459),
    e("LG", "LG260S1K-A3", 1640, 1e3, 260, "Monocrystalline", 47, -.44),
    e("LG", "LG260S1K-G3", 1640, 1e3, 260, "Monocrystalline", 47, -.445),
    e("LG", "LG265S1C-A3", 1640, 1e3, 265, "Monocrystalline", 45, -.43),
    e("LG", "LG265S1C-G3", 1640, 1e3, 265, "Monocrystalline", 44.9, -.459),
    e("LG", "LG265S1K-A3", 1640, 1e3, 265, "Monocrystalline", 47, -.44),
    e("LG", "LG270S1C-A3", 1640, 1e3, 270, "Monocrystalline", 45, -.43),
    e("LG", "LG280N1C-G3", 1640, 1e3, 280, "Monocrystalline", 45, -.42),
    e("LG", "LG285N1C-A3", 1640, 1e3, 285, "Monocrystalline", 45, -.41),
    e("LG", "LG285N1C-G3", 1640, 1e3, 285, "Monocrystalline", 45, -.42),
    e("LG", "LG290N1C-A3", 1640, 1e3, 290, "Monocrystalline", 45, -.41),
    e("LG", "LG290N1C-G3", 1640, 1e3, 290, "Monocrystalline", 45, -.42),
    e("LG", "LG295N1C-A3", 1640, 1e3, 295, "Monocrystalline", 45, -.41),
    e("LG", "LG295N1C-G3", 1640, 1e3, 295, "Monocrystalline", 45, -.42),
    e("LG", "LG300N1C-A3", 1640, 1e3, 300, "Monocrystalline", 45, -.41),
    e("LG", "LG300N1C-G3", 1640, 1e3, 300, "Monocrystalline", 45, -.42),
    e("LG", "LG300N1K-G4", 1640, 1e3, 300, "Monocrystalline", 46, -.38),
    e("LG", "LG310N1C-G4", 1640, 1e3, 310, "Monocrystalline", 46, -.38),
    e("LG", "LG315N1C-G4", 1640, 1e3, 315, "Monocrystalline", 46, -.38),
    e("MAGE Solar", "POWERTEC PLUS 230/6 PE", 1640, 992, 230, "Polycrystalline", 46, -.44),
    e("MAGE Solar", "POWERTEC PLUS 235/6 PE", 1640, 992, 235, "Polycrystalline", 46, -.44),
    e("MAGE Solar", "POWERTEC PLUS 240/6 PE", 1640, 992, 240, "Polycrystalline", 46, -.44),
    e("MAGE Solar", "POWERTEC PLUS 245/6 PE", 1640, 992, 245, "Polycrystalline", 46, -.44),
    e("Mitsubishi", "PV-TD175MF5", 1658, 834, 175, "Polycrystalline", 47.5, -.478),
    e("Mitsubishi", "PV-TD180HA6", 1658, 834, 180, "Polycrystalline", 47, -.41),
    e("Mitsubishi", "PV-TD180MF5", 1658, 834, 180, "Polycrystalline", 47.5, -.478),
    e("Mitsubishi", "PV-TD185HA6", 1658, 834, 185, "Polycrystalline", 47, -.41),
    e("Mitsubishi", "PV-TD185MF5", 1658, 834, 185, "Polycrystalline", 47.5, -.478),
    e("Mitsubishi", "PV-TD190HA6", 1658, 834, 190, "Polycrystalline", 47, -.41),
    e("Mitsubishi", "PV-TD190MF5", 1658, 834, 190, "Polycrystalline", 47.5, -.478),
    e("Mitsubishi", "PV-TD195HA6", 1658, 834, 195, "Polycrystalline", 47, -.41),
    e("Mitsubishi", "PV-TJ210GA6", 1658, 994, 210, "Polycrystalline", 47, -.452),
    e("Mitsubishi", "PV-TJ220GA6", 1658, 994, 220, "Polycrystalline", 47, -.452),
    e("Mitsubishi", "PV-TJ225GA6", 1658, 994, 225, "Polycrystalline", 47, -.452),
    e("Mitsubishi", "PV-TJ230GA6", 1658, 994, 230, "Polycrystalline", 47, -.452),
    e("Mitsubishi", "PV-TJ235GA6", 1658, 994, 235, "Polycrystalline", 47, -.452),
    e("Perlight", "PLM-180M-72", 1580, 808, 180, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-185M-72", 1580, 808, 185, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-190M-72", 1580, 808, 190, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-195M-72", 1580, 808, 195, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-200M-54", 1495, 992, 200, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-200M-72", 1580, 808, 200, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-200P-54", 1495, 992, 200, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-205M-54", 1495, 992, 205, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-205M-72", 1580, 808, 205, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-205P-54", 1495, 992, 205, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-210M-54", 1495, 992, 210, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-210M-72", 1580, 808, 210, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-210P-54", 1495, 992, 210, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-215M-54", 1495, 992, 215, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-215M-72", 1580, 808, 215, "Monocrystalline", 47, -.45),
    e("Perlight", "PLM-215P-54", 1495, 992, 215, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-220M-54", 1495, 992, 220, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-220P-54", 1495, 992, 220, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-225M-54", 1495, 992, 225, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-225P-54", 1495, 992, 225, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-225P-60", 1650, 992, 225, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-230M-54", 1495, 992, 230, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-230P-54", 1495, 992, 230, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-230P-60", 1650, 992, 230, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-235P-60", 1650, 992, 235, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-240P-60", 1650, 992, 240, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-245M-60", 1650, 992, 245, "Monocrystalline", 47, -.459),
    e("Perlight", "PLM-245P-60", 1650, 992, 245, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-250M-60", 1650, 992, 250, "Monocrystalline", 47, -.459),
    e("Perlight", "PLM-250MB-60F", 1650, 992, 250, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-250P-60", 1650, 992, 250, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-255M-60", 1650, 992, 255, "Monocrystalline", 47, -.459),
    e("Perlight", "PLM-255P-60", 1650, 992, 255, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-260M-60", 1650, 992, 260, "Monocrystalline", 47, -.459),
    e("Perlight", "PLM-260P-60", 1650, 992, 260, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-265P-72", 1966, 992, 265, "Polycrystalline", 47, -.459),
    e("Perlight", "PLM-270P-72", 1966, 992, 270, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-275M-72", 1966, 992, 275, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-275P-72", 1966, 992, 275, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-280M-72", 1966, 992, 280, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-280P-72", 1966, 992, 280, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-285M-72", 1966, 992, 285, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-285P-72", 1966, 992, 285, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-290M-72", 1966, 992, 290, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-290P-72", 1966, 992, 290, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-295M-72", 1966, 992, 295, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-295P-72", 1966, 992, 295, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-300M-72", 1966, 992, 300, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-300P-72", 1966, 992, 300, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-305M-72", 1966, 992, 305, "Monocrystalline", 45, -.45),
    e("Perlight", "PLM-305P-72", 1966, 992, 305, "Polycrystalline", 45, -.45),
    e("Perlight", "PLM-310M-72", 1966, 992, 310, "Monocrystalline", 45, -.45),
    e("Phono Solar", "PS140P-12/G", 1482, 676, 140, "Polycrystalline", 45, -.46),
    e("Phono Solar", "PS190M-24/F", 1580, 808, 190, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS230P-20/U", 1640, 992, 230, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS235M-20/U", 1640, 992, 235, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS235P-20/U", 1640, 992, 235, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS240M-20/U", 1640, 992, 240, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS240P-20/U", 1640, 992, 240, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS245M-20/U", 1640, 992, 245, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS245P-20/U", 1640, 992, 245, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS250M-20/U", 1640, 992, 250, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS250P-20/U", 1640, 992, 250, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS255M-20/U", 1640, 992, 255, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS255P-20/U", 1640, 992, 255, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS260M-20/U", 1640, 992, 260, "Monocrystalline", 45, -.48),
    e("Phono Solar", "PS260P-20/U", 1640, 992, 260, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS265P-20/U", 1640, 992, 265, "Polycrystalline", 45, -.4),
    e("Phono Solar", "PS280M-24/T", 1956, 992, 280, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS280P-24/T", 1956, 992, 280, "Polycrystalline", 45, -.48),
    e("Phono Solar", "PS290M-24/T", 1956, 992, 290, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS290P-24/T", 1956, 992, 290, "Polycrystalline", 45, -.48),
    e("Phono Solar", "PS300M-24/T", 1956, 992, 300, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS300P-24/T", 1956, 992, 300, "Polycrystalline", 45, -.48),
    e("Phono Solar", "PS310M-24/T", 1956, 992, 310, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS310P-24/T", 1956, 992, 310, "Polycrystalline", 45, -.42),
    e("Phono Solar", "PS320M-24/T", 1956, 992, 320, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS320P-24/T", 1956, 992, 320, "Polycrystalline", 45, -.42),
    e("Phono Solar", "PS330M-24/T", 1956, 992, 330, "Monocrystalline", 45, -.44),
    e("Phono Solar", "PS330P-24/T", 1956, 992, 330, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.BASE-G2 235", 1670, 1e3, 235, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.BASE-G2 240", 1670, 1e3, 240, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.BASE-G2 245", 1670, 1e3, 245, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.PEAK 245", 1670, 1e3, 245, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK 250", 1670, 1e3, 250, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK 265", 1670, 1e3, 265, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK 235", 1670, 1e3, 235, "Monocrystalline", 47, -.46),
    e("Q.Cells", "Q.PEAK BLK 240", 1670, 1e3, 240, "Monocrystalline", 47, -.46),
    e("Q.Cells", "Q.PEAK BLK 245", 1670, 1e3, 245, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK 250", 1670, 1e3, 250, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G2 245", 1670, 1e3, 245, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G2 250", 1670, 1e3, 250, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G2 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G2 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G3 250", 1670, 1e3, 250, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G3 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G3 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G3 265", 1670, 1e3, 265, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK BLK-G3 270", 1670, 1e3, 270, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G2 250", 1670, 1e3, 250, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G2 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G2 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G2 265", 1670, 1e3, 265, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G2 270", 1670, 1e3, 270, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G3 255", 1670, 1e3, 255, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G3 260", 1670, 1e3, 260, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G3 265", 1670, 1e3, 265, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G3 270", 1670, 1e3, 270, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PEAK-G3 275", 1670, 1e3, 275, "Monocrystalline", 47, -.43),
    e("Q.Cells", "Q.PRO-G2 235", 1670, 1e3, 235, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.PRO-G2 240", 1670, 1e3, 240, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.PRO-G2 245", 1670, 1e3, 245, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.PRO-G2 250", 1670, 1e3, 250, "Polycrystalline", 47, -.45),
    e("Q.Cells", "Q.PRO-G2 255", 1670, 1e3, 255, "Polycrystalline", 47, -.43),
    e("Q.Cells", "Q.PRO-G2 260", 1670, 1e3, 260, "Polycrystalline", 47, -.43),
    e("Q.Cells", "Q.PRO-G2 265", 1670, 1e3, 265, "Polycrystalline", 47, -.43),
    e("Q.Cells", "Q.PRO-G3 250", 1670, 1e3, 250, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.PRO-G3 255", 1670, 1e3, 255, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.PRO-G3 260", 1670, 1e3, 260, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.PRO-G3 265", 1670, 1e3, 265, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.PRO-G3 270", 1670, 1e3, 270, "Polycrystalline", 45, -.42),
    e("Q.Cells", "Q.SMART 80", 1196, 636, 80, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART 85", 1196, 636, 85, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART 90", 1196, 636, 90, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART 95", 1196, 636, 95, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART UF 70", 1190, 630, 70, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART UF 75", 1190, 630, 75, "Thin-film", 52, -.38),
    e("Q.Cells", "Q.SMART UF 80", 1190, 630, 80, "Thin-film", 53, -.38),
    e("Q.Cells", "Q.SMART UF 85", 1190, 630, 85, "Thin-film", 54, -.38),
    e("Q.Cells", "Q.SMART UF 90", 1190, 630, 90, "Thin-film", 55, -.38),
    e("Q.Cells", "Q.SMART UFL 100", 1190, 789.5, 100, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART UFL 105", 1190, 789.5, 105, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART UFL 110", 1190, 789.5, 110, "Thin-film", 51, -.38),
    e("Q.Cells", "Q.SMART UFL 115", 1190, 789.5, 115, "Thin-film", 51, -.38),
    e("REC Group", "REC210PE", 1665, 991, 210, "Polycrystalline", 47.5, -.45),
    e("REC Group", "REC215PE", 1665, 991, 215, "Polycrystalline", 47.5, -.45),
    e("REC Group", "REC220PE", 1665, 991, 220, "Polycrystalline", 47.5, -.45),
    e("REC Group", "REC225PE", 1665, 991, 225, "Polycrystalline", 47.5, -.45),
    e("REC Group", "REC225PE(BLK)", 1665, 991, 225, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC230PE", 1665, 991, 230, "Polycrystalline", 47.5, -.45),
    e("REC Group", "REC230PE(BLK)", 1665, 991, 230, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC235PE", 1665, 991, 235, "Polycrystalline", 45.7, -.4),
    e("REC Group", "REC235PE(BLK)", 1665, 991, 235, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC240PE", 1665, 991, 240, "Polycrystalline", 45.7, -.4),
    e("REC Group", "REC240PE(BLK)", 1665, 991, 240, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC245PE", 1665, 991, 245, "Polycrystalline", 45.7, -.4),
    e("REC Group", "REC245PE(BLK)", 1665, 991, 245, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC250PE", 1665, 991, 250, "Polycrystalline", 45.7, -.4),
    e("REC Group", "REC250PE(BLK)", 1665, 991, 250, "Polycrystalline", 47.9, -.43),
    e("REC Group", "REC255PE", 1665, 991, 255, "Polycrystalline", 45.7, -.4),
    e("REC Group", "REC260PE", 1665, 991, 260, "Polycrystalline", 45.7, -.4),
    e("ReneSola", "JC190S-24/Db-b", 1580, 808, 190, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC195S-24/Db", 1580, 808, 195, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC195S-24/Db-b", 1580, 808, 195, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC200S-24/Db", 1580, 808, 200, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC200S-24/Db-b", 1580, 808, 200, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC205S-24/Db", 1580, 808, 205, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC210S-24/Db", 1580, 808, 210, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC235M-24/Bb", 1640, 992, 235, "Polycrystalline", 45, -.4),
    e("ReneSola", "JC235M-24/Bbv", 1640, 992, 235, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC240M-24/Bb", 1640, 992, 240, "Polycrystalline", 45, -.4),
    e("ReneSola", "JC240M-24/Bbv", 1640, 992, 240, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC245M-24/Bb", 1640, 992, 245, "Polycrystalline", 45, -.4),
    e("ReneSola", "JC245M-24/Bbv", 1640, 992, 245, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC245S-24/Bb", 1640, 992, 245, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC245S-24/Bb-b", 1640, 992, 245, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC250F-24/Bb-b", 1640, 992, 250, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC250M-24/Bb", 1640, 992, 250, "Polycrystalline", 45, -.4),
    e("ReneSola", "JC250M-24/Bbv", 1640, 992, 250, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC250S-24/Bb", 1640, 992, 250, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC250S-24/Bb-b", 1640, 992, 250, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC255F-24/Bb", 1640, 992, 255, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC255F-24/Bb-b", 1640, 992, 255, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC255S-24/Bb", 1640, 992, 255, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC255S-24/Bb-b", 1640, 992, 255, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC260F-24/Bb", 1640, 992, 260, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC260F-24/Bb-b", 1640, 992, 260, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC260S-24/Bb", 1640, 992, 260, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC260S-24/Bb-b", 1640, 992, 260, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC265F-24/Bb", 1640, 992, 265, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC265F-24/Bb-b", 1640, 992, 265, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC265S-24/Bb", 1640, 992, 265, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC265S-24/Bb-b", 1640, 992, 265, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC270F-24/Bb", 1640, 992, 270, "Monocrystalline", 45, -.43),
    e("ReneSola", "JC285M-24/Abv", 1956, 992, 285, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC290M-24/Abv", 1956, 992, 290, "Monocrystalline", 45, -.39),
    e("ReneSola", "JC295M-24/Abv", 1956, 992, 295, "Monocrystalline", 45, -.39),
    e("Sanyo", "HIT-N235SE10", 1580, 798, 235, "Monocrystalline", 44, -.3),
    e("Schott", "ASI 100", 1308, 1108, 100, "Thin-film", 49, -.2),
    e("Schott", "ASI 103", 1308, 1108, 103, "Thin-film", 49, -.2),
    e("Schott", "ASI 105", 1308, 1108, 105, "Thin-film", 49, -.2),
    e("Schott", "ASI 81", 1308, 1108, 81, "Thin-film", 49, -.2),
    e("Schott", "ASI 86", 1308, 1108, 86, "Thin-film", 49, -.2),
    e("Schott", "ASI 90", 1308, 1108, 90, "Thin-film", 49, -.2),
    e("Schott", "ASI 95", 1308, 1108, 95, "Thin-film", 49, -.2),
    e("Schott", "ASI 97", 1308, 1108, 97, "Thin-film", 49, -.2),
    e("Schott", "PERFORM MONO 180", 1620, 810, 180, "Monocrystalline", 46, -.44),
    e("Schott", "PERFORM MONO 185", 1620, 810, 185, "Monocrystalline", 46, -.44),
    e("Schott", "PERFORM MONO 190", 1620, 810, 190, "Monocrystalline", 46, -.44),
    e("Schott", "PERFORM MONO 195", 1620, 810, 195, "Monocrystalline", 46, -.44),
    e("Schott", "PERFORM POLY 225", 1685, 993, 225, "Polycrystalline", 47.2, -.45),
    e("Schott", "PERFORM POLY 230", 1685, 993, 230, "Polycrystalline", 47.2, -.45),
    e("Schott", "PERFORM POLY 235", 1685, 993, 235, "Polycrystalline", 47.2, -.45),
    e("Schott", "PERFORM POLY 240", 1685, 993, 240, "Polycrystalline", 47.2, -.45),
    e("Schott", "PERFORM POLY 245", 1685, 993, 245, "Polycrystalline", 47.2, -.45),
    e("Schott", "PROTECT ASI 100", 1308, 1108, 100, "Thin-film", 49, -.2),
    e("Schott", "PROTECT ASI 103", 1308, 1108, 103, "Thin-film", 49, -.2),
    e("Schott", "PROTECT ASI 105", 1308, 1108, 105, "Thin-film", 49, -.2),
    e("Schott", "PROTECT ASI 107", 1308, 1108, 107, "Thin-film", 49, -.2),
    e("Schott", "PROTECT POLY 175", 1350.5, 993, 175, "Polycrystalline", 48, -.45),
    e("Schott", "PROTECT POLY 180", 1350.5, 993, 180, "Polycrystalline", 48, -.45),
    e("Schott", "PROTECT POLY 185", 1350.5, 993, 185, "Polycrystalline", 48, -.45),
    e("Shanghai Topsolar", "TSM60 - 156P POLY BLK", 1650, 992, 250, "Polycrystalline", 45, -.34),
    e("Shanghai Topsolar", "TSM60 - 156P POLY", 1650, 992, 250, "Polycrystalline", 45, -.34),
    e("Sharp", "ND-R240A5", 1652, 994, 240, "Polycrystalline", 47.5, -.44),
    e("Sharp", "ND-R245A5", 1652, 994, 245, "Polycrystalline", 47.5, -.44),
    e("Sharp", "NT-R5E3E", 1575, 826, 175, "Monocrystalline", 47.5, -.485),
    e("Sharp", "NU-185A1H", 1318, 994, 185, "Monocrystalline", 47.5, -.485),
    e("Sharp", "NU-S0E3E", 1318, 994, 180, "Monocrystalline", 47.5, -.485),
    e("Sharp", "NU-S5E3E", 1318, 994, 185, "Monocrystalline", 47.5, -.485),
    e("Simax", "SM660-210W", 1650, 992, 210, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-215W", 1650, 992, 215, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-220W", 1650, 992, 220, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-225W", 1650, 992, 225, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-230W", 1650, 992, 230, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-235W", 1650, 992, 235, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-240W", 1650, 992, 240, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-245W", 1650, 992, 245, "Monocrystalline", 45, -.39),
    e("Simax", "SM660-250W", 1650, 992, 250, "Monocrystalline", 45, -.39),
    e("Simax", "SP660-240W", 1640, 992, 240, "Polycrystalline", 45, -.39),
    e("Simax", "SP660-245W", 1640, 992, 245, "Polycrystalline", 45, -.39),
    e("Simax", "SP660-250W", 1640, 992, 250, "Polycrystalline", 45, -.39),
    e("Simax", "SP660-255W", 1640, 992, 255, "Polycrystalline", 45, -.39),
    e("Simax", "SP660-260W", 1640, 992, 260, "Polycrystalline", 45, -.39),
    e("Solar Frontier", "SC75-EX-B", 1235, 641, 75, "Thin-film", 47, -.33),
    e("Solar Frontier", "SC80-EX-B", 1235, 641, 80, "Thin-film", 47, -.33),
    e("Solar Frontier", "SC85-EX-B", 1235, 641, 85, "Thin-film", 47, -.33),
    e("Solar Frontier", "SF140-S", 1257, 977, 140, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF145-S", 1257, 977, 145, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF150-L", 1257, 977, 150, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF150-S", 1257, 977, 150, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF155-S", 1257, 977, 155, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF160-S", 1257, 977, 160, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF165-S", 1257, 977, 165, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF170-S", 1257, 977, 170, "Thin-film", 47, -.31),
    e("Solar Frontier", "SF70-EX-B", 1235, 641, 70, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF75-EX-B", 1235, 641, 75, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF77H-EX-B", 1235, 641, 77.5, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF80-EX-B", 1235, 641, 80, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF82H-EX-B", 1235, 641, 82.5, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF85-EX-B", 1235, 641, 85, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF87H-EX-B", 1235, 641, 87.5, "Thin-film", 47, -.35),
    e("Solar Frontier", "SF90-EX-B", 1235, 641, 90, "Thin-film", 47, -.35),
    e("SolarWorld", "Sunmodule-Plus-SW250-Mono", 1675, 1001, 250, "Monocrystalline", 46, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW250-Poly", 1675, 1001, 250, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-Plus-SW255-Poly", 1675, 1001, 255, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-Plus-SW260-Mono-Black", 1675, 1001, 260, "Monocrystalline", 48, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW265-Mono", 1675, 1001, 265, "Monocrystalline", 46, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW265-Mono-Black", 1675, 1001, 265, "Monocrystalline", 48, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW270-Mono", 1675, 1001, 270, "Monocrystalline", 46, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW270-Mono-Black", 1675, 1001, 270, "Monocrystalline", 48, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW275-Mono", 1675, 1001, 275, "Monocrystalline", 46, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW275-Mono-Black", 1675, 1001, 275, "Monocrystalline", 48, -.45),
    e("SolarWorld", "Sunmodule-Plus-SW280-Mono", 1675, 1001, 280, "Monocrystalline", 46, -.45),
    e("SolarWorld", "Sunmodule-Protect-SW245-Poly", 1675, 1001, 245, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-Protect-SW250-Poly", 1675, 1001, 250, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-Protect-SW255-Poly", 1675, 1001, 255, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-Protect-SW260-Poly", 1675, 1001, 260, "Polycrystalline", 46, -.41),
    e("SolarWorld", "Sunmodule-SW320-XL-Mono", 1993, 1001, 320, "Monocrystalline", 46, -.43),
    e("SolarWorld", "Sunmodule-SW325-XL-Mono", 1992, 1001, 325, "Monocrystalline", 46, -.43),
    e("Suniva", "MVP235-60-5-401", 1640, 992, 235, "Polycrystalline", 45, -.47),
    e("Suniva", "MVP240-60-5-401", 1640, 992, 240, "Polycrystalline", 45, -.47),
    e("Suniva", "MVP245-60-5-401", 1640, 992, 245, "Polycrystalline", 45, -.47),
    e("Suniva", "MVP280-72-5-401", 1952, 992, 280, "Polycrystalline", 45, -.47),
    e("Suniva", "MVP285-72-5-401", 1952, 992, 285, "Polycrystalline", 45, -.47),
    e("Suniva", "MVP290-72-5-401", 1952, 992, 290, "Polycrystalline", 45, -.47),
    e("Suniva", "OPT255-60-4-1B0", 1652, 982, 255, "Monocrystalline", 46, -.42),
    e("Suniva", "OPT260-60-4-100", 1652, 982, 260, "Monocrystalline", 46, -.42),
    e("Suniva", "OPT260-60-4-1B0", 1652, 982, 260, "Monocrystalline", 46, -.42),
    e("Suniva", "OPT265-60-4-100", 1652, 982, 265, "Monocrystalline", 46, -.42),
    e("Suniva", "OPT310-72-4-100", 1971, 982, 310, "Monocrystalline", 46, -.42),
    e("Suniva", "OPT315-72-4-100", 1971, 982, 315, "Monocrystalline", 46, -.42),
    e("Sunpower", "SPR-210-WHT-I", 1559, 798, 210, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-220-BLK-I", 1559, 798, 220, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-225-WHT-I", 1559, 798, 225, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-300-WHT-I", 1559, 1046, 300, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-310E-WHT-D", 1559, 1046, 310, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-318E-WHT-D", 1559, 1046, 318, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-327NE-WHT-D", 1559, 1046, 327, "Monocrystalline", 45, -.38),
    e("Sunpower", "SPR-333NE-WHT-D", 1559, 1046, 333, "Monocrystalline", 45, -.38),
    e("Suntech", "STP170S-24/Ad", 1580, 808, 170, "Monocrystalline", 45, -.48),
    e("Suntech", "STP175S-24/Ad", 1580, 808, 175, "Monocrystalline", 45, -.48),
    e("Suntech", "STP180S-24/Ad", 1580, 808, 180, "Monocrystalline", 45, -.48),
    e("Suntech", "STP185S-24/Ad", 1580, 808, 185, "Monocrystalline", 45, -.48),
    e("Suntech", "STP190S-24/Ad+", 1580, 808, 190, "Monocrystalline", 45, -.45),
    e("Suntech", "STP195S-24/Ad+", 1580, 808, 195, "Monocrystalline", 45, -.45),
    e("Suntech", "STP200-18/Ud", 1482, 942, 200, "Polycrystalline", 45, -.44),
    e("Suntech", "STP200S-24/Ad+", 1580, 808, 200, "Monocrystalline", 45, -.45),
    e("Suntech", "STP205-18/Ud", 1482, 942, 205, "Polycrystalline", 45, -.44),
    e("Suntech", "STP210-18/Ud", 1482, 942, 210, "Polycrystalline", 45, -.44),
    e("Suntech", "STP220-20/Wd", 1665, 991, 220, "Polycrystalline", 45, -.47),
    e("Suntech", "STP225-20/Wd", 1665, 991, 225, "Polycrystalline", 45, -.47),
    e("Suntech", "STP230-20/Wd", 1665, 991, 230, "Polycrystalline", 45, -.44),
    e("Suntech", "STP240-20/Wd", 1640, 992, 240, "Polycrystalline", 45, -.43),
    e("Suntech", "STP240S-20/Wd", 1665, 991, 240, "Monocrystalline", 45, -.48),
    e("Suntech", "STP245-20/Wd", 1640, 992, 245, "Polycrystalline", 45, -.43),
    e("Suntech", "STP245S-20/Wd", 1665, 991, 245, "Monocrystalline", 45, -.48),
    e("Suntech", "STP250-20/Wd", 1640, 992, 250, "Polycrystalline", 45, -.43),
    e("Suntech", "STP250S-20/Wd", 1640, 992, 250, "Monocrystalline", 45, -.45),
    e("Suntech", "STP255S-20/Wd", 1640, 992, 255, "Monocrystalline", 45, -.44),
    e("Suntech", "STP260-24/Vb", 1956, 992, 260, "Polycrystalline", 45, -.47),
    e("Suntech", "STP260S-20/Wd", 1640, 992, 260, "Monocrystalline", 45, -.44),
    e("Suntech", "STP260S-24/Vb", 1956, 992, 260, "Monocrystalline", 48, -.48),
    e("Suntech", "STP270-24/Vb", 1956, 992, 270, "Polycrystalline", 45, -.47),
    e("Suntech", "STP270S-24/Vb", 1956, 992, 270, "Monocrystalline", 48, -.48),
    e("Suntech", "STP280-24/Vb", 1956, 992, 280, "Polycrystalline", 45, -.47),
    e("Suntech", "STP280-24/Vd", 1956, 992, 280, "Polycrystalline", 45, -.44),
    e("Suntech", "STP280S-24/Vb", 1956, 992, 280, "Monocrystalline", 48, -.48),
    e("Suntech", "STP285-24/Vd", 1956, 992, 285, "Polycrystalline", 45, -.44),
    e("Suntech", "STP285-24/Ve", 1956, 992, 285, "Polycrystalline", 45, -.43),
    e("Suntech", "STP290-24/Ve", 1956, 992, 290, "Polycrystalline", 45, -.43),
    e("Suntech", "STP295-24/Vd", 1956, 992, 295, "Polycrystalline", 45, -.44),
    e("Suntech", "STP295-24/Ve", 1956, 992, 295, "Polycrystalline", 45, -.43),
    e("Suntech", "STP300-24/Vd", 1956, 992, 300, "Polycrystalline", 45, -.44),
    e("Suntech", "STP305-24/Vd", 1956, 992, 305, "Polycrystalline", 45, -.44),
    e("Tianwei", "TW195P54-CA", 1495, 995, 195, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW200P54-CA", 1495, 995, 200, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW205P54-CA", 1495, 995, 205, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW210P54-CA", 1495, 995, 210, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW215P54-CA", 1495, 995, 215, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW220P60-AA", 1653, 995, 220, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW225P60-AA", 1653, 995, 225, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW230P60-AA", 1653, 995, 230, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW230P60-FA", 1640, 992, 230, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW235P60-AA", 1653, 995, 235, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW235P60-FA", 1640, 992, 235, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW240P60-AA", 1653, 995, 240, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW240P60-FA", 1640, 992, 240, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW245P60-FA", 1640, 992, 245, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW250B60-PA", 1620, 980, 250, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW250P60-FA", 1640, 992, 250, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW255B60-PA", 1620, 980, 255, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW255P60-FA", 1640, 992, 255, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW260B60-PA", 1620, 980, 260, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW265B60-PA", 1620, 980, 265, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW270B60-PA", 1620, 980, 270, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW275B60-PA", 1620, 980, 275, "Polycrystalline", 44, -.47),
    e("Tianwei", "TW275P72-EA", 1956, 992, 275, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW280P72-EA", 1956, 992, 280, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW285P72-EA", 1956, 992, 285, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW290P72-EA", 1956, 992, 290, "Polycrystalline", 47, -.44),
    e("Tianwei", "TW295P72-EA", 1956, 992, 295, "Polycrystalline", 47, -.44),
    e("Topray Solar", "TPSM5U-185W", 1581, 809, 185, "Monocrystalline", 47, -.47),
    e("Topray Solar", "TPSM5U-190W", 1581, 809, 190, "Monocrystalline", 47, -.47),
    e("Topray Solar", "TPSM5U-195W", 1581, 809, 195, "Monocrystalline", 47, -.47),
    e("Topray Solar", "TPSM5U-200W", 1581, 809, 200, "Monocrystalline", 47, -.47),
    e("Topray Solar", "TPSP6U-230W", 1650, 992, 230, "Polycrystalline", 47, -.43),
    e("Topray Solar", "TPSP6U-235W", 1650, 992, 235, "Polycrystalline", 47, -.43),
    e("Topray Solar", "TPSP6U-240W", 1650, 992, 240, "Polycrystalline", 47, -.43),
    e("Topray Solar", "TPSP6U-245W", 1650, 992, 245, "Polycrystalline", 47, -.43),
    e("Topray Solar", "TPSP6U-250W", 1650, 992, 250, "Polycrystalline", 47, -.43),
    e("Trina Solar", "TSM-210DC80.08", 1581, 809, 210, "Monocrystalline", 45, -.39),
    e("Trina Solar", "TSM-215DC80.08", 1581, 809, 215, "Monocrystalline", 45, -.39),
    e("Trina Solar", "TSM-240PC05A", 1650, 992, 240, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-240PC05A.05", 1650, 992, 240, "Polycrystalline", 45, -.41),
    e("Trina Solar", "TSM-240PC05A.08", 1650, 992, 240, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-245PC05A", 1650, 992, 245, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-245PC05A.05", 1650, 992, 245, "Polycrystalline", 45, -.41),
    e("Trina Solar", "TSM-245PC05A.08", 1650, 992, 245, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-245PDG5", 1685, 997, 245, "Polycrystalline", 45, -.43),
    e("Trina Solar", "TSM-250PC05A", 1650, 992, 250, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-250PC05A.05", 1650, 992, 250, "Polycrystalline", 45, -.41),
    e("Trina Solar", "TSM-250PC05A.08", 1650, 992, 250, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-250PDG5", 1685, 997, 250, "Polycrystalline", 45, -.43),
    e("Trina Solar", "TSM-255PC05A", 1650, 992, 255, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-255PC05A.05", 1650, 992, 255, "Polycrystalline", 45, -.41),
    e("Trina Solar", "TSM-255PC05A.08", 1650, 992, 255, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-255PDG5", 1685, 997, 255, "Polycrystalline", 45, -.43),
    e("Trina Solar", "TSM-260DC05A", 1650, 992, 260, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-260DC05A.05", 1650, 992, 260, "Monocrystalline", 45, -.41),
    e("Trina Solar", "TSM-260DC05A.08", 1650, 992, 260, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-260PC05A", 1650, 992, 260, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-260PC05A.05", 1650, 992, 260, "Polycrystalline", 45, -.41),
    e("Trina Solar", "TSM-260PC05A.08", 1650, 992, 260, "Polycrystalline", 44, -.41),
    e("Trina Solar", "TSM-265DC05A", 1650, 992, 265, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-265DC05A.05", 1650, 992, 265, "Monocrystalline", 45, -.41),
    e("Trina Solar", "TSM-265DC05A.08", 1650, 992, 265, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-270DC05A", 1650, 992, 270, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-270DC05A.05", 1650, 992, 270, "Monocrystalline", 45, -.41),
    e("Trina Solar", "TSM-270DC05A.08", 1650, 992, 270, "Monocrystalline", 44, -.41),
    e("Trina Solar", "TSM-290PD14", 1956, 992, 290, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-295PC14", 1956, 992, 295, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-295PD14", 1956, 992, 295, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-300PC14", 1956, 992, 300, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-300PD14", 1956, 992, 300, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-305PC14", 1956, 992, 305, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-305PD14", 1956, 992, 305, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-310PC14", 1956, 992, 310, "Polycrystalline", 45, -.44),
    e("Trina Solar", "TSM-310PD14", 1956, 992, 310, "Polycrystalline", 45, -.44),
    e("Universal Solar", "USP M6-235/60", 1640, 992, 235, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-240/60", 1640, 992, 240, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-245/60", 1640, 992, 245, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-250/60", 1640, 992, 250, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-255/60", 1640, 992, 255, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-285/72", 1956, 992, 285, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-290/72", 1956, 992, 290, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-295/72", 1956, 992, 295, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-300/72", 1956, 992, 300, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP M6-305/72", 1956, 992, 305, "Monocrystalline", 45, -.45),
    e("Universal Solar", "USP P6-230/60", 1640, 992, 230, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-235/60", 1640, 992, 235, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-240/60", 1640, 992, 240, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-245/60", 1640, 992, 245, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-250/60", 1640, 992, 250, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-280/72", 1956, 992, 280, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-285/72", 1956, 992, 285, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-290/72", 1956, 992, 290, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-295/72", 1956, 992, 295, "Polycrystalline", 45, -.47),
    e("Universal Solar", "USP P6-300/72", 1956, 992, 300, "Polycrystalline", 45, -.47),
    e("WINAICO", "WSP-245P6", 1665, 999, 245, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WSP-250P6", 1665, 999, 250, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WSP-255P6", 1665, 999, 255, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WSP-260P6", 1665, 999, 260, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WSP-270M6", 1665, 999, 270, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-275M6", 1665, 999, 275, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-280M6", 1665, 999, 280, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-285M6", 1665, 999, 285, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-290M6", 1665, 999, 290, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-300M6", 1665, 999, 300, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WSP-305M6", 1665, 999, 305, "Monocrystalline", 44.7, -.4371),
    e("WINAICO", "WST-250P6", 1665, 999, 250, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WST-255P6", 1665, 999, 255, "Polycrystalline", 44.7, -.43),
    e("WINAICO", "WST-260P6", 1665, 999, 260, "Polycrystalline", 44.7, -.43),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-210", 1652, 1e3, 210, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-220", 1652, 1e3, 220, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-230", 1652, 1e3, 230, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-240", 1652, 1e3, 240, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-250", 1652, 1e3, 250, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-60-6M-260", 1652, 1e3, 260, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-160", 1580, 808, 160, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-170", 1580, 808, 170, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-180", 1580, 808, 180, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-190", 1580, 808, 190, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-200", 1580, 808, 200, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing Australia", "ASP-72-5M-210", 1580, 808, 210, "Monocrystalline", 45, -.48),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-160W", 1580, 808, 160, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-165W", 1580, 808, 165, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-170W", 1580, 808, 170, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-175W", 1580, 808, 175, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-180W", 1580, 808, 180, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-5M-185W", 1580, 808, 185, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-170W", 1494, 1e3, 170, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-175W", 1494, 1e3, 175, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-180W", 1494, 1e3, 180, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-185W", 1494, 1e3, 185, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-190W", 1494, 1e3, 190, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-195W", 1494, 1e3, 195, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-200W", 1494, 1e3, 200, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-205W", 1494, 1e3, 205, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M27-210W", 1494, 1e3, 210, "Monocrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-200W", 1652, 1e3, 200, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-210W", 1652, 1e3, 210, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-220W", 1652, 1e3, 220, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-230W", 1652, 1e3, 230, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-240W", 1652, 1e3, 240, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6M30-250W", 1652, 1e3, 250, "Monocrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-170W", 1494, 1e3, 170, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-175W", 1494, 1e3, 175, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-180W", 1494, 1e3, 180, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-185W", 1494, 1e3, 185, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-190W", 1494, 1e3, 190, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-195W", 1494, 1e3, 195, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-200W", 1494, 1e3, 200, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-205W", 1494, 1e3, 205, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P27-210W", 1494, 1e3, 210, "Polycrystalline", 45, -.4),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-200W", 1652, 1e3, 200, "Polycrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-210W", 1652, 1e3, 210, "Polycrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-220W", 1652, 1e3, 220, "Polycrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-230W", 1652, 1e3, 230, "Polycrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-240W", 1652, 1e3, 240, "Polycrystalline", 47, -.47),
    e("Worldwide Energy and Manufacturing USA", "AS-6P30-250W", 1652, 1e3, 250, "Polycrystalline", 47, -.47),
    e("Yingli Green Energy", "YL190P-23b", 1310, 990, 190, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL195P-23b", 1310, 990, 195, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL200P-23b", 1310, 990, 200, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL205C-24b", 1330, 990, 205, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL205P-23b", 1310, 990, 205, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL210C-24b", 1330, 990, 210, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL210P-23b", 1310, 990, 210, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL215C-24b", 1330, 990, 215, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL220C-24b", 1330, 990, 220, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL225C-24b", 1330, 990, 225, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL240P-29b", 1650, 990, 240, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL245P-29b", 1650, 990, 245, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL250C-30b", 1650, 990, 250, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL250P-29b", 1650, 990, 250, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL255C-30b", 1650, 990, 255, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL255P-29b", 1650, 990, 255, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL260C-30b", 1650, 990, 260, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL260P-29b", 1650, 990, 260, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL265C-30b", 1650, 990, 265, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL270C-30b", 1650, 990, 270, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL275C-30b", 1650, 990, 275, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL280C-30b", 1650, 990, 280, "Monocrystalline", 46, -.42),
    e("Yingli Green Energy", "YL290P-35b", 1970, 990, 290, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL295P-35b", 1970, 990, 295, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL300P-35b", 1970, 990, 300, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL305P-35b", 1970, 990, 305, "Polycrystalline", 46, -.42),
    e("Yingli Green Energy", "YL310P-35b", 1970, 990, 310, "Polycrystalline", 46, -.42),
    e("ZEN Energy Systems", "ET-P660250BB", 1640, 992, 250, "Polycrystalline", 45.3, -.44)
}),
nm_module("nm/dataproviders/solar/paneltypes", function(a, b, c, d) {
    function e(a) {
        return p(n(a, function(a) {
            var b = a.toJSON()
              , c = {
                type: "Feature",
                geometry: {
                    type: "Point",
                    coordinates: [0, 0]
                },
                properties: b
            };
            return c
        }))
    }
    function f(a, b) {
        var c = a.manufacturer + " - " + a.model
          , d = b.manufacturer + " - " + b.model;
        return d > c ? -1 : c > d ? 1 : 0
    }
    var g = b("jscore/objtools", "id")
      , h = b("jscore/events", "ObservableObject")
      , i = b("nm/features/solar", "PanelType")
      , j = b("nm/dataproviders/solar/libpanels", "libraryPanelTypes")
      , k = b("jscore/functools", "bind")
      , l = b("jscore/async", "callWhenIdle")
      , m = b("jscore/events", "Change")
      , n = b("jscore/itertools", "map")
      , o = b("jscore/itertools", "find")
      , p = b("jscore/itertools", "array")
      , q = b("jscore/sets", "Set")
      , r = b("jscore/strings", "format")
      , s = b("nm/const", "HOST_URL")
      , t = b("nm/const/tools", "PERSIST_SOLAR_PANELTYPES")
      , u = b("js-libs/jquery", "jQuery")
      , v = s + "maps?nml=overlay&nmprovider=usergeom&cmd={cmd}"
      , w = a.PanelTypesManager = c(h, {
        constructor: function(a) {
            w.base.call(this),
            this.auth = a;
            var b = a.getAccountData().Result.Id;
            this.customListId = "solar-panel-types-" + b,
            this.customPanels = new q,
            this.modifiedPanels = new q,
            this.deletedPanels = new q,
            this.saveWhenIdle = l(k(this, this.save), 200)
        },
        load: function() {
            if (this.auth.can(t)) {
                var a = r(v, {
                    cmd: "usergeojson"
                });
                u.ajax(a, {
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json",
                    cache: !1,
                    data: {
                        allfeatures: "true",
                        id: this.customListId
                    },
                    success: k(this, this.loadData)
                })
            }
        },
        loadData: function(a) {
            if (this.auth.can(t)) {
                a = a || {};
                var b = a.features || [];
                b.forEach(function(a) {
                    var b = a.properties
                      , c = new i(b.id,b.width,b.length,b.manufacturer,b.model,b.power,b.type,b.noct,b.tempCoef);
                    this.customPanels.contains(c) || this.managePanelType(c)
                }
                .bind(this)),
                this.changed()
            }
        },
        save: function() {
            this.persistDeleted(),
            this.persistChanged()
        },
        persistChanged: function() {
            if (this.auth.can(t)) {
                var a = r(v, {
                    cmd: "usergeojson"
                });
                a += "&update=merge";
                var b = {
                    type: "FeatureCollection",
                    properties: {
                        id: this.customListId,
                        name: "All Solar Panel Types",
                        type: "solar-panel-types"
                    },
                    features: e(this.modifiedPanels)
                };
                b = JSON.stringify(b),
                u.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: b
                }),
                this.modifiedPanels.clear()
            }
        },
        persistDeleted: function() {
            if (this.auth.can(t)) {
                var a = r(v, {
                    cmd: "usergeojson"
                });
                a += "&update=delete";
                var b = {
                    type: "FeatureCollection",
                    properties: {
                        id: this.customListId,
                        name: "All Solar Panel Types",
                        type: "solar-panel-types"
                    },
                    features: e(this.deletedPanels)
                };
                b = JSON.stringify(b),
                u.ajax(a, {
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: b
                }),
                this.deletedPanels.clear()
            }
        },
        findOrManagePanelType: function(a) {
            var b = o(this.getPanelTypes(), function(b) {
                return g(b) === g(a)
            });
            return b ? b : (this.managePanelType(a),
            a)
        },
        panelTypeChanged: function(a) {
            var b = a.target;
            this.modifiedPanels.add(b),
            this.save()
        },
        managePanelType: function(a) {
            this.customPanels.add(a),
            a.addListener(m, k(this, this.panelTypeChanged))
        },
        addPanelType: function(a) {
            this.modifiedPanels.add(a),
            this.managePanelType(a),
            this.changed(),
            this.save()
        },
        deletePanelType: function(a) {
            this.customPanels.contains(a) && (this.deletedPanels.add(a),
            this.modifiedPanels.discard(a),
            this.customPanels.discard(a),
            this.changed(),
            this.save())
        },
        getPanelTypes: function() {
            var a = p(this.customPanels)
              , b = a.concat(j);
            return b.sort(f),
            b
        },
        getPanelTypesGrouped: function() {
            var a = p(this.customPanels)
              , b = j.slice();
            a.sort(f),
            b.sort(f);
            var c = {
                custom: a,
                library: b
            };
            return c
        },
        isCustomPanelType: function(a) {
            return this.customPanels.contains(a)
        },
        getPanelTypeById: function(a) {
            var b = this.getPanelTypes();
            return o(b, function(b) {
                return a === g(b)
            })
        }
    })
}),
nm_module("nm/tools/solar", function(a, b, c, d) {
    function e(a) {
        var b = B(".tool-popup-container")
          , c = b.find(".popup-close")
          , d = b.find(".solar-help");
        0 !== b.length && 0 !== c.length && 1 !== d.length && (d = B("<div>", {
            "class": "solar-help"
        }),
        d.on("click", function() {
            var b = [{
                text: "Give us feedback on our Solar tool!",
                link: w,
                target: "solar-feedback"
            }, {
                text: "Full Tutorial",
                link: x,
                target: "solar-tutorial"
            }, {
                text: "Quick Video Overview",
                link: y,
                target: "solar-tutorial"
            }];
            a.open(c, {
                links: b,
                position: ["right", "top"]
            })
        }),
        d.insertBefore(c))
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/itertools", "filter")
      , h = b("jscore/itertools", "first")
      , i = b("jscore/async", "setTimeout")
      , j = b("jscore/async", "callWhenIdle")
      , k = b("nm/tools", "Tool")
      , l = b("nm/features/solar", "SolarJob")
      , m = b("nm/tools/solar/disclaimer", "Disclaimer")
      , n = b("nm/tools/solar/jobs", "JobsPanel")
      , o = b("nm/tools/solar/jobs", "JobSelected")
      , p = b("nm/tools/solar/paneltypes", "PanelTypesUI")
      , q = b("nm/tools/solar/singlejob", "SingleJobPanel")
      , r = b("nm/tools/solar/singlejob", "Close")
      , s = b("nm/dataproviders/solar/jobs", "JobsManager")
      , t = b("nm/dataproviders/solar/job", "JobManager")
      , u = b("nm/dataproviders/solar/paneltypes", "PanelTypesManager")
      , v = b("nm/const/tools", "SOLAR_TOOL_KEY")
      , w = b("nm/const/tools", "SOLAR_FEEDBACK_URL")
      , x = b("nm/const/tools", "SOLAR_TUTORIAL_URL")
      , y = b("nm/const/tools", "SOLAR_VIDEO_TUTORIAL_URL")
      , z = b("nm/layers/feature", "FeatureLayer")
      , A = b("jscore/events", "Change")
      , B = b("js-libs/jquery", "jQuery")
      , C = a.SolarTool = c(k, {
        constructor: function(a, b, c, d, e, g, h) {
            C.base.call(this),
            this.auth = a,
            this.geocoder = e,
            this.tooltipMgr = g,
            this.popupMrg = h,
            this.surveysController = d,
            this.name = "Solar",
            this.accessKey = v,
            this.map = b,
            this.layersCtrl = b.layersCtrl,
            this.tmpGoogleMapViewController = b.tmpGoogleMapViewController,
            this.selection = c,
            this.jobsUI = null ,
            this.singleJobUI = null ,
            this.panelsUI = null ,
            this.disclaimer = new m;
            var i = new z("Solar Jobs Layer",!0,null ,!1);
            this.jobsLayer = i;
            var j = new z("Current Solar Job Layer",!0,null ,!1);
            j.autoSelect = !0,
            this.panelsLayer = j;
            var k = new u(a);
            this.panelTypesMgr = k;
            var l = B('<div>    <a href="#" class="disclaimer">Show Disclaimer</a>    <div class="solar-tabs">       <ul>           <li>               <button type="button" class="btn-jobs">                   Jobs</button>           </li>           <li>               <button type="button" class="btn-job">                   Active Job</button>           </li>           <li>               <button type="button" class="btn-panels">                   Panels               </button>           </li>       </ul>    </div>    <div class="solar-content"></div></div>');
            this.popup = l,
            this.contentNode = l.find(".solar-content"),
            l.find(".btn-jobs").click(f(this, this.jobsClicked)),
            l.find(".btn-job").click(f(this, this.jobClicked)),
            l.find(".btn-panels").click(f(this, this.panelsClicked)),
            l.find(".disclaimer").click(f(this, this.showDisclaimer)),
            this.disclaimerChanged(),
            this.disclaimer.addListener(A, f(this, this.disclaimerChanged)),
            this.jobsLayer.addListener(A, f(this, this.jobsChanged)),
            this.selection.addListener(A, f(this, this.jobsChanged))
        },
        jobsClicked: function() {
            this.showJobsUI()
        },
        jobClicked: function() {
            this.showSelectedJob()
        },
        panelsClicked: function() {
            this.showPanelsUI()
        },
        getSelectedJob: function() {
            var a = g(this.selection.getItems(), function(a) {
                return a instanceof l
            });
            return h(a)
        },
        showSelectedJob: function() {
            var a = this.getSelectedJob();
            a && this.showSingleJobUI(a, !0)
        },
        disclaimerChanged: function() {
            var a = this.popup;
            this.disclaimer.hasBeenAccepted() ? (a.find(".disclaimer").hide(),
            a.find(".solar-tabs").show()) : (a.find(".disclaimer").show(),
            a.find(".solar-tabs").hide())
        },
        jobsChanged: function() {
            var a = this.getSelectedJob();
            this.showingJob && a && this.showSingleJobUI(a, !1)
        },
        loadJobHeadlessHackidyHackWack: function(a) {
            var b = this.jobsLayer
              , c = this.panelsLayer;
            c.setStyle("fancy");
            var d = new s(this.auth,b)
              , e = this.panelTypesMgr
              , f = !1
              , g = this.auth
              , h = this.surveysController
              , i = 0
              , k = this.tmpGoogleMapViewController
              , l = k.gMap;
            return this.layersCtrl.addLayer(c),
            b.addListener(A, function() {
                if (!f) {
                    var d = b.getFeatureById(a);
                    if (d) {
                        f = !0,
                        h.setDesiredDate(d.surveyDate || null );
                        var m = new t(g,d,c,e);
                        m.load();
                        var n = l.addListener("tilesloaded", j(function() {
                            k.showPoints([d.ne, d.sw]),
                            i > 2 && n.remove(),
                            i++
                        }, 10))
                    }
                }
            }),
            d.load(),
            a
        },
        showSingleJobUI: function(a, b) {
            if (this.showingJob !== a || null  === this.singleJobUI) {
                var c = this.map
                  , d = this.surveysController;
                this.showingJob = a,
                this.removePanelUI(),
                this.removeSingleJobUI(),
                this.removeJobsUI(),
                this.popup.find(".btn-job").prop("disabled", !1);
                var e = this.panelsLayer;
                e.removeAllFeatures(),
                d.setDesiredDate(a.surveyDate || null );
                var g = this.jobsLayer
                  , h = new q(this.auth,a,c,this.selection,d,e,g,this.panelTypesMgr,this.tooltipMgr);
                h.addListener(r, f(this, this.showJobsUI)),
                this.singleJobUI = h,
                this.contentNode.append(h.node),
                this.popup.find(".btn-job").addClass("selected"),
                b && this.tmpGoogleMapViewController.showPoints([a.ne, a.sw, a.position])
            }
        },
        showJobsUI: function() {
            if (this.auth.can(v)) {
                this.showingJob = null ,
                this.removeJobsUI(),
                this.removePanelUI(),
                this.removeSingleJobUI(),
                this.jobsLayer.setStyle("simple"),
                this.jobsLayer.removeAllFeatures(),
                this.panelsLayer.removeAllFeatures();
                var a = new n(this.auth,this.map,this.selection,this.surveysController,this.jobsLayer,this.geocoder,this.tooltipMgr);
                return this.jobsUI = a,
                this.contentNode.append(a.node),
                this.popup.find(".btn-job").prop("disabled", !0),
                this.popup.find(".btn-jobs").addClass("selected"),
                a.addListener(o, f(this, this.showSelectedJob)),
                !1
            }
        },
        showPanelsUI: function() {
            var a = null 
              , b = this.singleJobUI;
            if (b) {
                a = b.getSelectedPanelType();
                var c = this.showingJob;
                c && this.selection.select(c)
            }
            this.removeSingleJobUI(),
            this.removeJobsUI(),
            this.removePanelUI();
            var d = new p(this.panelTypesMgr,a);
            return this.panelsUI = d,
            this.contentNode.append(d.node),
            this.popup.find(".btn-panels").addClass("selected"),
            !1
        },
        removeJobsUI: function() {
            this.contentNode.empty(),
            this.popup.find(".btn-jobs").removeClass("selected"),
            this.jobsUI && (this.jobsUI.destroy(),
            this.jobsUI = null )
        },
        removeSingleJobUI: function() {
            this.contentNode.empty(),
            this.popup.find(".btn-job").removeClass("selected"),
            this.singleJobUI && (this.singleJobUI.destroy(),
            this.singleJobUI = null )
        },
        removePanelUI: function() {
            this.contentNode.empty(),
            this.popup.find(".btn-panels").removeClass("selected"),
            this.panelsUI && (this.panelsUI.destroy(),
            this.panelsUI = null )
        },
        hasAccess: function() {
            return this.auth.can(v)
        },
        start: function() {
            this.disclaimerChanged(),
            this.disclaimer.hasBeenAccepted() ? this.startTool() : this.showDisclaimer()
        },
        showDisclaimer: function() {
            return this.disclaimer.show(f(this, function() {
                this.disclaimer.hasBeenAccepted() && this.startTool()
            })),
            !1
        },
        startTool: function() {
            this.panelTypesMgr.load(),
            this.active = !0,
            i(f(this, function() {
                e(this.popupMrg)
            }), 1);
            var a = this.map
              , b = a.getLayersCtrl();
            if (this.showingJob) {
                var c = this.showingJob.position;
                if (this.tmpGoogleMapViewController.isLocationVisible(c))
                    return void this.singleJobUI.activate();
                this.showingJob = null 
            }
            this.layersAddedHackidyHackWackTODO || (b.addLayer(this.jobsLayer),
            b.addLayer(this.panelsLayer),
            this.layersAddedHackidyHackWackTODO = !0),
            this.showJobsUI()
        },
        stop: function() {
            this.active = !1,
            this.singleJobUI && this.singleJobUI.deactivate(),
            this.showingJob || (this.jobsLayer.removeAllFeatures(),
            this.panelsLayer.removeAllFeatures(),
            this.removeJobsUI(),
            this.removeSingleJobUI())
        }
    })
}),
nm_module("nm/tools/compare/complayer", function(a, b, c, d) {
    function e(a, b, c) {
        var d, e = a.tileX << 8, f = a.tileY << 8, g = Math.min(Math.max(b.x - e, 0), 256), h = Math.min(Math.max(b.y - f, 0), 256);
        d = c === y ? "rect(0px, " + g + "px, 256px, 0px)" : "rect(0px, 256px, " + h + "px, 0px)",
        a.style.clip = d
    }
    function f(a, b, c, d) {
        var e = A.get(c)
          , f = a.tileX
          , g = a.tileY
          , h = Math.abs(f + g) % 3
          , i = d.getSubdomains()[h]
          , k = j(b, "yyyymmdd", !0)
          , l = ["//", i, ".", t, "/maps/hl=en"].join("") + ["&x=", f, "&y=", g, "&z=", a.tileZ].join("") + ["&nml=", e, "&httpauth=false&version=2&nmd=", k].join("");
        a.style.backgroundImage = "url(" + l + ")"
    }
    var g = b("jscore/itertools", "find")
      , h = b("jscore/functools", "bind")
      , i = b("jscore/events", "Change")
      , j = b("jscore/dateutils", "format")
      , k = b("jscore/objtools", "Dictionary")
      , l = b("nm/const/imagery", "SURVEY")
      , m = b("nm/const/imagery", "SURVEY_N")
      , n = b("nm/const/imagery", "SURVEY_E")
      , o = b("nm/const/imagery", "SURVEY_S")
      , p = b("nm/const/imagery", "SURVEY_W")
      , q = b("nm/const/imagery", "TERRAIN")
      , r = b("nm/const/imagery", "DSM")
      , s = b("nm/geom", "getNormalizedCoord")
      , t = b("nm/const", "TILE_HOST")
      , u = b("nm/intl", "getText")
      , v = b("js-libs/google", "maps")
      , w = b("js-libs/richmarker", "RichMarker")
      , x = b("js-libs/jquery", "jQuery")
      , y = "horizontal"
      , z = "vertical"
      , A = new k([[l, "Vert"], [m, "N"], [n, "E"], [o, "S"], [p, "W"], [q, "Dem_"], [r, "Dsm_"]]);
    a.CompLayer = c(Object, {
        constructor: function(a, b, c, d) {
            this.tileSize = new v.Size(256,256),
            this.tiles = {},
            this.gMap = a,
            this.comparePosition = b,
            this.baseLayer = c,
            this.mapType = d.getMapType(),
            this.compareMode = y,
            this.surveysController = d,
            this.initCompareDate(),
            this.buildUI(),
            this.setupListeners(),
            this.updateDraggerContent()
        },
        buildUI: function() {
            var a = this.gMap
              , b = this.comparePosition;
            a.overlayMapTypes.push(this);
            var c = x('<div class="compare-dragger horizontal">   <select class="comp-date"/>   <span class="arrow">⇔</span>   <select class="survey-date"/></div>');
            this.$draggerContent = c,
            this.$compDateList = c.find(".comp-date"),
            this.$surveyDateList = c.find(".survey-date"),
            this.$arrowSpan = c.find(".arrow");
            var d = new w({
                position: b,
                map: a,
                draggable: !0,
                anchor: w.RichMarkerPosition.MIDDLE,
                content: c[0],
                flat: !0
            });
            this.dragger = d
        },
        initCompareDate: function() {
            var a = this.surveysController
              , b = a.getAvailableDates().reverse()
              , c = a.getDisplayDate()
              , d = b[0];
            d = g(b, d, function(a) {
                return c > a
            }),
            this.compareDate = d
        },
        setupListeners: function() {
            var a = this
              , b = this.$draggerContent.find("select")
              , c = this.dragger
              , d = !1;
            v.event.addListener(c, "drag", function() {
                a.setComparePosition(c.getPosition()),
                d = !0,
                b.blur()
            }),
            this.boundsListener = v.event.addListener(this.gMap, "bounds_changed", h(this, this.handleBoundsChange)),
            this.$draggerContent.mouseup(function() {
                d ? d = !1 : a.toggleMode()
            }),
            b.mousedown(function(a) {
                a.stopPropagation(),
                d = !0
            }),
            b.mouseup(function(a) {
                a.stopPropagation()
            }),
            b.change(function(b) {
                b.target.blur(),
                a.datesChanged()
            }),
            this.surveysController.addListener(i, h(this, this.surveysChanged))
        },
        datesChanged: function() {
            this.compareDate = new Date(this.$compDateList.val());
            var a = new Date(this.$surveyDateList.val());
            this.surveysController.setDesiredDate(a),
            this.reloadTiles()
        },
        surveysChanged: function() {
            this.updateDraggerContent();
            var a = this.surveysController.getMapType();
            this.mapType !== a && (this.mapType = a,
            this.reloadTiles())
        },
        updateDraggerContent: function() {
            var a = this.surveysController
              , b = a.getAvailableDates()
              , c = a.getDisplayDate()
              , d = this.compareDate
              , e = this.$compDateList
              , f = this.$surveyDateList;
            e.empty(),
            f.empty();
            var g = u("formats.day-date");
            b.reverse().forEach(function(a) {
                var b = j(a, g, !0)
                  , c = j(a, "yyyy-mm-dd", !0);
                e.append('<option value="' + c + '">' + b + "</option>"),
                f.append('<option value="' + c + '">' + b + "</option>")
            }),
            e.val(j(d, "yyyy-mm-dd", !0)),
            f.val(j(c, "yyyy-mm-dd", !0))
        },
        getTile: function(a, b, c) {
            var d = c.createElement("div");
            if (a = s(a, b),
            null  === a)
                return d;
            var g = this.tileSize.width
              , h = this.tileSize.height;
            return d.style.width = g + "px",
            d.style.height = h + "px",
            d.tileX = a.x,
            d.tileY = a.y,
            d.tileZ = b,
            this.tiles[a.x + ":" + a.y] = d,
            f(d, this.compareDate, this.mapType, this.baseLayer),
            e(d, this.getCompareXY(), this.compareMode),
            d
        },
        setComparePosition: function(a) {
            this.comparePosition = a,
            this.updateTiles()
        },
        toggleMode: function() {
            var a = this.$draggerContent
              , b = this.$arrowSpan;
            this.compareMode === y ? (a.removeClass("horizontal").addClass("vertical"),
            b.text("⇕"),
            this.compareMode = z) : (a.removeClass("vertical").addClass("horizontal"),
            b.text("⇔"),
            this.compareMode = y),
            this.dragger.setContent(a[0]),
            this.updateTiles()
        },
        updateTiles: function() {
            var a = this.getCompareXY()
              , b = this.tiles;
            for (var c in b)
                b.hasOwnProperty(c) && e(b[c], a, this.compareMode)
        },
        reloadTiles: function() {
            var a = this.tiles;
            for (var b in a)
                a.hasOwnProperty(b) && f(a[b], this.compareDate, this.mapType, this.baseLayer)
        },
        releaseTile: function(a) {
            var b = this.tiles
              , c = a.tileX
              , d = a.tileY;
            delete b[c + ":" + d]
        },
        getCompareXY: function() {
            var a = this.gMap
              , b = this.comparePosition
              , c = a.getProjection()
              , d = c.fromLatLngToPoint(b)
              , e = 1 << a.getZoom()
              , f = {
                x: Math.round(d.x * e),
                y: Math.round(d.y * e)
            };
            return f
        },
        handleBoundsChange: function() {
            var a = this.gMap.getBounds();
            if (!a.contains(this.comparePosition)) {
                var b = a.getCenter();
                this.setComparePosition(b),
                this.dragger.setPosition(b)
            }
        },
        destroy: function() {
            var a = this.gMap
              , b = a.overlayMapTypes
              , c = b.indexOf(this);
            c > -1 && b.removeAt(c),
            this.dragger.setMap(null ),
            this.surveysController.removeListeners(this),
            this.boundsListener.remove()
        }
    })
}),
nm_module("nm/tools/compare", function(a, b, c, d) {
    var e = b("nm/tools/compare/complayer", "CompLayer")
      , f = b("nm/tools", "Tool")
      , g = b("nm/metrics", "trigger")
      , h = b("nm/const/tools", "COMPARE_TOOL_KEY")
      , i = b("nm/views/google/convert", "toGoogle")
      , j = a.CompareTool = c(f, {
        constructor: function(a, b, c, d) {
            j.base.call(this),
            this.auth = a,
            this.map = b,
            this.baseLayer = c,
            this.surveysController = d,
            this.name = "Compare",
            this.accessKey = h
        },
        hasAccess: function() {
            return this.auth.can(h)
        },
        start: function() {
            this.layer && this.layer.destroy();
            var a = this.surveysController
              , b = this.map
              , c = b.getCenter()
              , d = b.tmpGoogleMapViewController.gMap
              , f = this.baseLayer
              , h = new e(d,i(c),f,a);
            this.layer = h;
            var j = a.getDesiredDate();
            g("compare.start_tool", {
                label: "compare tool",
                description: "compare tool started",
                value: JSON.stringify({
                    date: j,
                    center: c,
                    zoom: b.getZoom()
                })
            })
        },
        stop: function() {
            this.layer.destroy(),
            this.layer = null 
        },
        toggleOnOff: function() {
            this.layer ? this.stop() : this.start()
        }
    })
}),
nm_module("nm/views/timeline/timeline", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("jscore/functools", "bind")
      , g = b("js-libs/jquery", "jQuery")
      , h = b("jscore/dateutils", "isEqualDateTime")
      , i = b("jscore/dateutils", "compareDateTimes")
      , j = b("jscore/dateutils", "format")
      , k = b("nm/dom/event", "normalizeWheelDelta")
      , l = b("nm/metrics", "trigger")
      , m = b("nm/intl", "getText");
    a.TimeLine = c(Object, {
        constructor: function(a) {
            this._surveysController = a,
            this._isHidden = !1,
            this._mouseIsDown = !1,
            this._initMarkerTypes(),
            this._initMarkupComponents(),
            this._setupListeners(),
            this._setupEvents(),
            this._update()
        },
        _initMarkerTypes: function() {
            this._GREEN_MARKER = 0,
            this._BLUE_MARKER = 1,
            this._markerTypes = [],
            this._markerTypes[this._BLUE_MARKER] = "blueDateMarker",
            this._markerTypes[this._GREEN_MARKER] = "greenDateMarker"
        },
        _initMarkupComponents: function() {
            var a = g('<div class="timelineCtrl"></div>')
              , b = g('<div class="timelineContainer" unselectable="on"></div>')
              , c = g('<div class="timelineLineContainer"></div>')
              , d = g('<div class="timelineButtonContainer"></div>')
              , e = g('<div class="timelineLine"></div><div class="timelineLatestMarker"><a class="timelineLatestButtonControl"></a></div>')
              , f = g('<div class="timelineNotAvailableMessage" style="display:none;" >Timeline is not available in the currently selected view</div>');
            this._notAvailableMessage = f,
            this.node = a,
            this.node.append(b),
            this.node.append(f),
            this._timelineLineContainer = c,
            this._timelineButtonContainer = d,
            b.append(c),
            b.append(d),
            this._timelineContainer = b,
            this._dateLine = e,
            this._latestDateMarker = e.children(".timelineLatestButtonControl")
        },
        _setupListeners: function() {
            this._surveysController.addListener(e, f(this, this._update));
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap;
            b.getStreetView().addListener("visible_changed", f(this, this._onStreeViewChange)),
            this._surveysController.addListener(e, f(this, this._onStreeViewChange))
        },
        _setupEvents: function() {
            this._timelineButtonContainer.click(f(this, this._onButtonContainerClick)),
            this._latestDateMarker.click(f(this, this._onLatestMarkerClick)),
            this.node.on("mousewheel DOMMouseScroll", f(this, this._onMouseScroll))
        },
        _onMouseOut: function() {
            this._mouseIsDown && null  !== this._currentDragDropSelectedDate && (this._surveysController.setDesiredDate(this._currentDragDropSelectedDate),
            this._currentDragDropSelectedDate = null ),
            this._mouseIsDown = !1
        },
        _onMouseMove: function(a) {
            this._mouseIsDown && this._onButtonContainerClick(a)
        },
        _onMouseUp: function() {
            this._mouseIsDown = !1,
            this._currentDragDropSelectedDate = null 
        },
        _onMouseDown: function() {
            var a = this._surveysController.getDisplayDate();
            this._currentDragDropSelectedDate = a,
            this._mouseIsDown = !0
        },
        _createNormalMarker: function(a, b) {
            var c = m("formats.day-date")
              , d = j(a, c, !0)
              , e = g('<span class="markerContainer" style="left:' + b + '%"><a class="nm-dateButtonTimelineCtl normalDateMarker" title="' + d + '"></a></span>');
            return e
        },
        _createDateMarker: function(a, b, c) {
            var d = this._markerTypes[c]
              , e = m("formats.day-date")
              , f = j(a, e, !0)
              , g = '<span class="dateMarkerContainer" style="left: ' + b + '%"><a class="nm-dateButtonTimelineCtl ' + d + '" title="' + f + '"></a></span>';
            return g
        },
        _update: function() {
            var a = this._surveysController.getAvailableDates();
            if (this.canRender(a)) {
                var b = this._surveysController
                  , c = b.getDesiredDate()
                  , d = b.getDisplayDate();
                h(c, d) || null  === c ? (a.sort(i),
                this._renderDateLine(),
                this._renderDateButtons(a),
                null  === c ? this._showMarkerDate(a, d, this._BLUE_MARKER) : this._showMarkerDate(a, d, this._GREEN_MARKER)) : (a.push(c),
                a.sort(i),
                this._renderDateLine(),
                this._renderDateButtons(a),
                this._showMarkerDate(a, c, this._BLUE_MARKER),
                this._showMarkerDate(a, d, this._GREEN_MARKER))
            } else
                this._timelineButtonContainer.empty(),
                this._timelineLineContainer.empty()
        },
        canRender: function(a) {
            return null  === a && (a = this._surveysController.getAvailableDates()),
            0 === a.length ? (this._showTimeLine(!1),
            !1) : (this._showTimeLine(!0),
            !0)
        },
        _renderDateLine: function() {
            var a = this._timelineLineContainer.children().length;
            0 === a && this._timelineLineContainer.append(this._dateLine)
        },
        _calculateMarkerLocation: function(a, b, c) {
            var d = c - b
              , e = a - b
              , f = 100 * d / e;
            return f
        },
        _renderDateButtons: function(a) {
            if (a.length > 0) {
                var b = a[0]
                  , c = a[a.length - 1]
                  , e = c.getTime()
                  , f = b.getTime();
                this._timelineButtonContainer.empty();
                for (var g, h = a[d.iterator](); !(g = h.next()).done; ) {
                    var i = g.value
                      , j = this._calculateMarkerLocation(e, f, i.getTime())
                      , k = this._createNormalMarker(i, j);
                    this._timelineButtonContainer.append(k)
                }
            }
        },
        _showMarkerDate: function(a, b, c) {
            if (null  !== b) {
                var d = a[0]
                  , e = a[a.length - 1]
                  , f = e.getTime()
                  , g = d.getTime()
                  , h = this._calculateMarkerLocation(f, g, b.getTime())
                  , i = this._createDateMarker(b, h, c);
                this._timelineButtonContainer.append(i)
            }
        },
        _onLatestMarkerClick: function() {
            var a = this._surveysController;
            a.setDesiredDate(null ),
            l("selectSurveyLatestDot", {
                label: "Survey",
                description: null 
            })
        },
        _onButtonContainerClick: function(a) {
            var b = this._surveysController
              , c = g(a.currentTarget)
              , d = c.offset()
              , e = a.clientX
              , f = e - d.left
              , h = b.getAvailableDates().slice();
            h.sort(i);
            for (var j = h[0], k = h[h.length - 1], m = k.getTime(), n = j.getTime(), o = m - n, p = 0, q = c.width(), r = f * o / q, s = h.length - 1; s > 0; s--) {
                var t = h[s]
                  , u = h[s - 1]
                  , v = t.getTime() - n
                  , w = u.getTime() - n;
                if (v >= r && r >= w) {
                    var x = (v - w) / 2
                      , y = r - w;
                    return y > x ? (b.setDesiredDate(t),
                    void l("selectSurvey", {
                        label: "Survey",
                        description: t
                    })) : (b.setDesiredDate(u),
                    void l("selectSurvey", {
                        label: "Survey",
                        description: u
                    }))
                }
            }
            if (0 === s) {
                if (r >= o)
                    return b.setDesiredDate(k),
                    void l("selectMostRecentSurvey", {
                        label: "Survey",
                        description: k
                    });
                if (p >= r)
                    return b.setDesiredDate(j),
                    void l("selectSurvey", {
                        label: "Survey",
                        description: j
                    })
            }
        },
        _onMouseScroll: function(a) {
            var b = this._surveysController
              , c = b.getAvailableDates().slice();
            c.sort(i);
            for (var d = b.getDisplayDate(), e = c.length - 1, f = null , g = 0; e >= g; g++)
                if (h(c[g], d)) {
                    var j = k(a.originalEvent);
                    if (j >= 0) {
                        if (g === e)
                            break;
                        f = c[g + 1];
                        break
                    }
                    if (0 === g)
                        break;
                    f = c[g - 1];
                    break
                }
            f && (b.setDesiredDate(f),
            l("selectSurvey", {
                label: "selectSurveyWheel",
                description: f
            }))
        },
        _onStreeViewChange: function() {
            var a = this._surveysController._surveyInfo
              , b = a.tmpGoogleMapViewController.gMap
              , c = !b.streetView.getVisible();
            this._showTimeLine(c),
            c ? g(".compare-btn").show() : g(".compare-btn").hide()
        },
        _showTimeLine: function(a) {
            a ? (this._notAvailableMessage.css("display", "none"),
            this._timelineContainer.css("display", "block")) : a || (this._notAvailableMessage.css("display", "block"),
            this._timelineContainer.css("display", "none"))
        }
    })
}),
nm_module("nm/tools/site", function(a, b, c, d) {
    var e = b("nm/geom", "LatLng")
      , f = b("nm/tools", "Tool")
      , g = b("nm/const/tools", "SITE_PLANNER_KEY")
      , h = b("nm/const/keys", "V_KEY")
      , i = b("nm/const/keys", "J_KEY")
      , j = b("nm/const/keys", "C_KEY")
      , k = b("nm/const/keys", "D_KEY")
      , l = b("nm/const/keys", "DELETE_KEY")
      , m = b("nm/const/keys", "BACKSPACE_KEY")
      , n = b("nm/features/circle", "Circle")
      , o = b("nm/features/polygon", "Polygon")
      , p = b("nm/features/line", "Line")
      , q = b("nm/features/arrow", "Arrow")
      , r = b("nm/features/label", "Label")
      , s = b("jscore/itertools", "find")
      , t = b("nm/const/urls", "SUPPORT")
      , u = b("jscore/functools", "bind")
      , v = b("nm/views/google/convert", "toNM")
      , w = b("nm/views/google/convert", "toGoogle")
      , x = b("jscore/events", "Change")
      , y = b("nm/geom", "getComfortableDistanceInView")
      , z = b("jscore/itertools", "map")
      , A = b("jscore/itertools", "array")
      , B = b("nm/features/imageoverlay", "ImageOverlay")
      , C = b("js-libs/google", "maps")
      , D = b("js-libs/jquery", "jQuery")
      , E = b("nm/const", "STATIC_ASSETS_URL")
      , F = E + "img/siteplanner/"
      , G = (a.SITE_PLANNER_TITLE = "Site Planner",
    a.SiteTool = c(f, {
        constructor: function(a, b) {
            G.base.call(this),
            this.map = a;
            var c = a.layersCtrl;
            this.layersCtrl = c,
            this.selection = c.getSelectionCtrl(),
            this.auth = b,
            this.gMap = a.tmpGoogleMapViewController.gMap,
            this.name = "Site Planner",
            this.accessKey = g;
            var d = this
              , e = D("<div>");
            D('<a href="' + t + 'customer/portal/articles/1658838" target="_blank">Learn more about Site Planner...</a>').appendTo(e),
            D("<h3>Object Library</h3>").appendTo(e);
            var f = D('<div class="sp-container">');
            f.appendTo(e),
            this.popup = e,
            this.getObjects().forEach(function(a) {
                var b = D("<section>");
                D("<header>" + a.title + "</header>").appendTo(b);
                var c = D('<div class="sp-section-container">').appendTo(b);
                a.items.forEach(function(a) {
                    var b = D('<a href="#" class="sp-item" id="' + a.id + '"><div class="sp-item-container"><div class="sp-item-img"style="background-image: url(' + F + a.id + '.png)"></div><span class="sp-item-label">' + a.label + "</span></div></a>");
                    c.append(b),
                    a.action || (a.action = function() {
                        d.createImageOverlay(a)
                    }
                    ),
                    b.click(function() {
                        a.action.call(d, a)
                    })
                }),
                b.appendTo(f)
            }),
            D('<h3>Object Properties</h3>  <ul class="info"><li>   <div class="label">Rotate</div><div class="data">       <input id="rotate" type="number" disabled>        <small>°</small>   </div></div></ul> <div class="buttons">     <div class="button delete-btn" id="delete"></div> </div>').appendTo(e),
            e.find("#delete").click(function() {
                this.layersCtrl.deleteSelectedFeatures()
            }
            .bind(this)),
            this.rotateElement = e.find("#rotate"),
            this.rotateElement.on("keyup change mousewheel DOMMouseScroll", u(this, this.updateModelRotation)),
            this.selection.addListener(x, u(this, this.updateViewObjectPropertyInputs));
            var n = ["input", "textarea"];
            this.keydownListener = function(a) {
                if (document.activeElement) {
                    var b = document.activeElement.tagName.toLowerCase()
                      , c = s(n, function(a) {
                        return a === b
                    });
                    if (!c) {
                        var d = a.keyCode || a.which
                          , e = l
                          , f = m;
                        if (d === e || d === f)
                            a.preventDefault(),
                            c || this.layersCtrl.deleteSelectedFeatures();
                        else if (a.metaKey || a.ctrlKey)
                            if (d === j)
                                a.preventDefault(),
                                this.clipboardFeature = this.selection.getLastItem(),
                                this.latestClipboardFeature = this.clipboardFeature;
                            else if (d === h && this.clipboardFeature) {
                                a.preventDefault();
                                var g = this.duplicateFeature(this.clipboardFeature, this.latestClipboardFeature);
                                this.latestClipboardFeature = g
                            } else if (d === i || d === k) {
                                a.preventDefault();
                                var o = this.selection.getLastItem();
                                if (o) {
                                    var p = this.duplicateFeature(o, o);
                                    o === this.latestClipboardFeature && (this.latestClipboardFeature = p)
                                }
                            }
                    }
                }
            }
            ,
            D(window).on("keydown", u(this, this.keydownListener))
        },
        updateModelRotation: function() {
            for (var a, b = this.rotateElement.val(), c = this.layersCtrl.getSelectedFeatures(), e = c[d.iterator](); !(a = e.next()).done; ) {
                var f = a.value;
                f.setRotation && f.setRotation(b)
            }
        },
        updateViewObjectPropertyInputs: function() {
            var a = this.rotateElement
              , b = this.layersCtrl.getSelectedFeatures();
            if (1 === b.length) {
                var c = b[0];
                if (c.getRotation) {
                    var d = c.getRotation();
                    a.val(d),
                    a.attr("disabled", !1)
                } else
                    a.attr("disabled", !0)
            } else
                a.attr("disabled", !1),
                a.val("");
            a.blur()
        },
        getDefaultPosition: function() {
            return this.map.getCenter()
        },
        addAndSelectFeature: function(a) {
            this.layersCtrl.newFeature(a)
        },
        duplicateFeature: function(a, b) {
            function c(a, b) {
                var c = e.getProjection()
                  , d = Math.pow(2, e.getZoom())
                  , f = w(a)
                  , g = c.fromLatLngToPoint(f)
                  , h = new C.Point(g.x + b.x / d,g.y + b.y / d)
                  , i = c.fromPointToLatLng(h);
                return v(i)
            }
            var d = a.clone()
              , e = this.gMap
              , f = {
                x: 10,
                y: 10
            };
            if (d.getPoints) {
                var g = A(z(b.getPoints(), function(a) {
                    return c(a, f)
                }));
                d.setPoints(g)
            } else {
                var h = c(b.getPosition(), f);
                d.setPosition(h)
            }
            return this.lastDuplicatedFeature = d,
            this.addAndSelectFeature(d),
            d
        },
        createPolygon: function() {
            var a = this.getDefaultPosition()
              , b = y(this.map)
              , c = [new e(a.getLat() - b,a.getLon() - b), new e(a.getLat() + b,a.getLon() - b), new e(a.getLat() + b,a.getLon() + b), new e(a.getLat() - b,a.getLon() + b)]
              , d = new o(c);
            this.addAndSelectFeature(d)
        },
        createLabel: function() {
            var a = new r("Double-Click to Edit","Label",this.getDefaultPosition());
            this.addAndSelectFeature(a)
        },
        createCircle: function() {
            var a = new n(111111 * y(this.map),"Circle",this.getDefaultPosition());
            this.addAndSelectFeature(a)
        },
        createTriangle: function() {
            var a = this.gMap
              , b = y(this.map)
              , c = a.getCenter()
              , d = [new e(c.lat() - b,c.lng() - b), new e(c.lat() + b,c.lng() - b), new e(c.lat() - b,c.lng() + b)]
              , f = new o(d);
            this.addAndSelectFeature(f)
        },
        createLine: function() {
            var a = this.gMap
              , b = a.getCenter()
              , c = y(this.map)
              , d = [new e(b.lat() + c,b.lng() - c), new e(b.lat() - c,b.lng() + c)]
              , f = new p(d);
            this.addAndSelectFeature(f)
        },
        createArrow: function(a) {
            var b = this.gMap
              , c = b.getCenter()
              , d = y(this.map)
              , f = [new e(c.lat() + d,c.lng() - d), new e(c.lat() - d,c.lng() + d)]
              , g = new q(f,a);
            this.addAndSelectFeature(g)
        },
        createOnewayArrow: function() {
            this.createArrow("end")
        },
        createMultiwayArrow: function() {
            this.createArrow("both")
        },
        createImageOverlay: function(a) {
            a.dimensions || (a.dimensions = [10, 10]);
            var b = new B(F + a.id + ".png",a.dimensions[0],a.dimensions[1],0,a.label,this.getDefaultPosition());
            this.addAndSelectFeature(b)
        },
        hasAccess: function() {
            try {
                return this.auth.can(this.accessKey)
            } catch (a) {
                return !1
            }
        },
        start: function() {
            this.active = !0
        },
        stop: function() {
            D(window).off("keydown", this.keydownListener),
            this.active = !1
        },
        getObjects: function() {
            return [{
                title: "Basic Objects",
                items: [{
                    label: "Circle",
                    id: "circle",
                    action: this.createCircle
                }, {
                    label: "Triangle",
                    id: "triangle",
                    action: this.createTriangle
                }, {
                    label: "Line",
                    id: "line",
                    action: this.createLine
                }, {
                    label: "Arrow",
                    id: "oneway-arrow",
                    action: this.createOnewayArrow
                }, {
                    label: "Arrow",
                    id: "multiway-arrow",
                    action: this.createMultiwayArrow
                }, {
                    label: "Polygon",
                    id: "polygon",
                    action: this.createPolygon
                }, {
                    label: "Text",
                    id: "label",
                    action: this.createLabel
                }]
            }, {
                title: "Home",
                items: [{
                    label: "Water Tank",
                    id: "water-tank",
                    dimensions: [3.7, 3.7]
                }, {
                    label: "Air Conditioner",
                    id: "Residential-Air-Conditioner",
                    dimensions: [.8, .8]
                }, {
                    label: "Swimming Pool",
                    id: "pool-round",
                    dimensions: [5, 5]
                }, {
                    label: "Swimming Pool",
                    id: "pool-kidney",
                    dimensions: [8, 5]
                }, {
                    label: "Swimming Pool",
                    id: "pool-square",
                    dimensions: [5, 5]
                }, {
                    label: "Swimming Pool",
                    id: "pool-rectangle",
                    dimensions: [7.5, 3.5]
                }, {
                    label: "Solar Hot Water",
                    id: "SolarHotWater-Single",
                    dimensions: [1.5, 2.5]
                }, {
                    label: "Solar Hot Water",
                    id: "SolarHotWater-Double",
                    dimensions: [2.5, 2.2]
                }, {
                    label: "Solar Hot Water",
                    id: "SolarHotWater-Europe",
                    dimensions: [1.5, 1.4]
                }, {
                    label: "Wheelie Bin",
                    id: "WheelieBin-Small",
                    dimensions: [.55, .48]
                }, {
                    label: "Wheelie Bin",
                    id: "WheelieBin-Large",
                    dimensions: [.73, .55]
                }, {
                    label: "Trampoline",
                    id: "TrampolineRound",
                    dimensions: [3, 3]
                }, {
                    label: "Trampoline",
                    id: "TrampolineSquare",
                    dimensions: [3, 3]
                }, {
                    label: "Shed",
                    id: "Garden-Shed-Small",
                    dimensions: [1.5, .8]
                }, {
                    label: "Shed",
                    id: "Garden-Shed-Large",
                    dimensions: [2.3, 1.5]
                }, {
                    label: "Rotary Clothes Line",
                    id: "HillsHoist",
                    dimensions: [3.2, 3.2]
                }]
            }, {
                title: "Commercial",
                items: [{
                    label: "Air Conditioner",
                    id: "Commercial-Air-Conditioner",
                    dimensions: [1.3, .9]
                }]
            }, {
                title: "Construction",
                items: [{
                    label: "Portaloo",
                    id: "Portaloo",
                    dimensions: [1.2, 1.2]
                }, {
                    label: "Tower Crane",
                    id: "Tower-Crane-01",
                    dimensions: [50, 8]
                }, {
                    label: "Tower Crane",
                    id: "Tower-Crane-02",
                    dimensions: [40, 8]
                }, {
                    label: "Truck Crane",
                    id: "TruckCrane",
                    dimensions: [13, 7]
                }, {
                    label: "Portable Generator",
                    id: "PortableGenerator",
                    dimensions: [4, 1.7]
                }, {
                    label: "Generator",
                    id: "Large-Generator",
                    dimensions: [3.6, 1.2]
                }, {
                    label: "Shipping Container",
                    id: "ShippingContainer",
                    dimensions: [12, 2.4]
                }, {
                    label: "Shipping Container",
                    id: "ShippingContainerSmall",
                    dimensions: [6, 2.4]
                }, {
                    label: "Skip Bin",
                    id: "Skip-Bin-2-02",
                    dimensions: [2.2, 1.5]
                }, {
                    label: "Skip Bin",
                    id: "Skip-Bin-2-03",
                    dimensions: [3.6, 1.5]
                }, {
                    label: "Skip Bin",
                    id: "Skip-Bin-2-04",
                    dimensions: [2.4, 1.5]
                }, {
                    label: "Skip Bin",
                    id: "Skip-Bin-2-05",
                    dimensions: [1.5, 1.5]
                }, {
                    label: "Cherry Picker",
                    id: "CherryPicker",
                    dimensions: [6.8, 2.8]
                }, {
                    label: "Rubbish Dumpster",
                    id: "Dumpster",
                    dimensions: [1.4, 1.2]
                }, {
                    label: "Scissor Lift",
                    id: "Scissor-lift2",
                    dimensions: [1.8, .9]
                }, {
                    label: "Site Office",
                    id: "SiteOffice",
                    dimensions: [12, 4.8]
                }]
            }, {
                title: "Traffic Control",
                items: [{
                    label: "Barricade",
                    id: "barricade",
                    dimensions: [3, .6]
                }, {
                    label: "Concrete Barrier",
                    id: "Concrete-Barrier",
                    dimensions: [2.4, .6]
                }]
            }, {
                title: "Telecommunications",
                items: [{
                    label: "Microwave Dish",
                    id: "Satellite-Dish-03",
                    dimensions: [2, 2]
                }]
            }, {
                title: "Recreation",
                items: [{
                    label: "Tennis Court",
                    id: "tennis_court",
                    dimensions: [30, 16.8]
                }]
            }]
        }
    }))
}),
nm_module("nm/tools/volume/unitsview", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/strings", "format")
      , g = b("jscore/objtools", "keys")
      , h = b("js-libs/jquery", "jQuery")
      , i = b("nm/intl", "formatNumber");
    a.UnitsView = c(Object, {
        constructor: function(a, b, c) {
            this.conversions = a,
            this.value = c,
            this.buildUI(b),
            this.setupListeners(),
            this.update()
        },
        buildUI: function(a) {
            var b = h('<div class="unit-view">    <span class="value" />    <select class="units" /></div>');
            this.$volumeValue = b.find(".value");
            var c = b.find(".units");
            this.$units = c;
            var d = g(this.conversions);
            d.forEach(function(a) {
                var b = h('<option value="' + a + '">' + a + "</option>");
                c.append(b)
            }),
            c.val(d[0]),
            a.append(b)
        },
        setupListeners: function() {
            this.$units.change(e(this, this.update))
        },
        setValue: function(a) {
            this.value = a,
            this.update()
        },
        update: function() {
            var a = this.$units.val()
              , b = this.$volumeValue
              , c = this.conversions
              , d = this.value;
            null  !== d ? (d *= c[a],
            d = f("{:0.0f}", d),
            d = i(d)) : d = "No data",
            b.text(d)
        }
    })
}),
nm_module("nm/tools/volume/unitsinputview", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/objtools", "keys")
      , g = b("js-libs/jquery", "jQuery")
      , h = b("jscore/events", "ObservableObject")
      , i = a.UnitsInputView = c(h, {
        constructor: function(a, b, c) {
            i.base.call(this),
            this.conversions = a,
            this.value = c,
            this.buildUI(b),
            this.setupListeners(),
            this.update()
        },
        buildUI: function(a) {
            var b = g('<div class="unit-view">    <input class="input-value" type="number"/>    <select class="units" /></div>');
            this.$lengthValue = b.find(".input-value"),
            this.$lengthValue.val(this.value);
            var c = b.find(".units");
            this.$units = c;
            var d = f(this.conversions);
            d.forEach(function(a) {
                var b = g('<option value="' + a + '">' + a + "</option>");
                c.append(b)
            }),
            c.val(d[0]),
            a.append(b)
        },
        setupListeners: function() {
            this.$units.change(e(this, this.update)),
            this.$lengthValue.change(e(this, this.update))
        },
        setValue: function(a) {
            this.value = a,
            this.$lengthValue.val(this.value)
        },
        getValue: function() {
            var a = this.conversions
              , b = this.$lengthValue
              , c = this.$units
              , d = b.val()
              , e = c.val();
            return "" !== d ? "m" !== e && (d /= a[e]) : d = null ,
            d
        },
        update: function() {
            var a = this.$lengthValue.val();
            this.value = a,
            this.changed()
        }
    })
}),
nm_module("nm/tools/volume/unitslabelview", function(a, b, c, d) {
    var e = b("js-libs/jquery", "jQuery")
      , f = b("jscore/types", "isUndefinedOrNull");
    a.UnitsLabelView = c(Object, {
        constructor: function(a, b) {
            this.value = b,
            this.buildUI(a),
            this.update()
        },
        buildUI: function(a) {
            var b = e('<div class="unit-view">    <span class="value" /></div>');
            this.$value = b.find(".value"),
            a.append(b)
        },
        setValue: function(a) {
            this.value = a,
            this.update()
        },
        update: function() {
            var a = this.$value
              , b = this.value;
            f(b) && (b = "No data"),
            a.text(b)
        }
    })
}),
nm_module("nm/tools/volume/views", function(a, b, c, d) {
    var e = b("nm/tools/volume/unitsview", "UnitsView")
      , f = b("nm/tools/volume/unitsinputview", "UnitsInputView")
      , g = b("nm/tools/volume/unitslabelview", "UnitsLabelView")
      , h = {
        m: 1,
        km: .001,
        ft: 3.2808399,
        yd: 1.0936133,
        mi: .000621371192
    }
      , i = {
        "m²": 1,
        "km²": 1e-6,
        "ft²": 10.7639104,
        "yd²": 1.19599005,
        "mi²": 3.86102159e-7
    }
      , j = {
        "m³": 1,
        "km³": 1e-9,
        "ft³": 35.31466672149,
        "yd³": 1.30795061929,
        "mi³": 2.39912759e-10,
        L: 1e3,
        bricks: 600,
        "Cat 797": 1 / 160
    }
      , k = a.LengthUnitView = c(e, {
        constructor: function(a, b) {
            k.base.call(this, h, a, b)
        }
    })
      , l = a.LabelView = c(g, {
        constructor: function(a, b) {
            l.base.call(this, a, b)
        }
    })
      , m = a.LengthUnitInputView = c(f, {
        constructor: function(a, b) {
            m.base.call(this, h, a, b)
        }
    })
      , n = a.AreaUnitView = c(e, {
        constructor: function(a, b) {
            n.base.call(this, i, a, b)
        }
    })
      , o = a.VolumeUnitView = c(e, {
        constructor: function(a, b) {
            o.base.call(this, j, a, b)
        }
    })
}),
nm_module("nm/views/components/progressbar", function(a, b, c, d) {
    var e = b("jscore/async", "setInterval")
      , f = b("jscore/async", "setTimeout")
      , g = b("jscore/async", "clearInterval")
      , h = b("jscore/async", "clearTimeout")
      , i = b("jscore/functools", "bind")
      , j = b("js-libs/jquery", "jQuery")
      , k = b("jscore/events", "Change");
    a.ProgressBar = c(Object, {
        constructor: function(a, b) {
            this._container = a,
            this._progressProvider = b,
            this._progressInterval = null ,
            this._progressTimeout = null ,
            this._initMarkupComponents(),
            this._setupListeners(),
            this._internalProgress = 0
        },
        _initMarkupComponents: function() {
            var a = j('<div class="loading-indicator">');
            this._$progressBar = a,
            this._container.append(a),
            this._drawProgress(0)
        },
        _setupListeners: function() {
            this._progressProvider.addListener(k, i(this, this._progressUpdated))
        },
        _progressUpdated: function() {
            var a = this._progressProvider.getProgress();
            0 === a ? this._internalProgress = 0 : this._startLoop(a)
        },
        _startLoop: function(a) {
            g(this._progressInterval),
            h(this._progressTimeout),
            this._rangeEnd = a,
            this._progressInterval = e(i(this, this._asyncLoop), 15),
            a >= 1 && (g(this._progressInterval),
            this._drawProgress(1),
            this._progressTimeout = f(i(this, function() {
                this.hide()
            }), 500))
        },
        _asyncLoop: function() {
            var a = this._rangeEnd
              , b = this._internalProgress
              , c = a - b;
            b = .0035 * c + b,
            this._internalProgress = b,
            this._drawProgress(b)
        },
        _drawProgress: function(a) {
            var b = this._container.width() * a;
            this._$progressBar.width(b + "px")
        },
        hide: function() {
            this._drawProgress(0)
        }
    })
}),
nm_module("nm/tools/volume/pitui", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("jscore/types", "isUndefinedOrNull")
      , h = b("nm/metrics", "trigger")
      , i = b("nm/tools/volume/views", "VolumeUnitView")
      , j = b("nm/tools/volume/views", "AreaUnitView")
      , k = b("nm/tools/volume/views", "LengthUnitView")
      , l = b("nm/tools/volume/views", "LabelView")
      , m = b("nm/views/components/progressbar", "ProgressBar")
      , n = b("js-libs/jquery", "jQuery");
    a.PitTab = c(Object, {
        constructor: function(a, b) {
            this._errorMessageContainer = b,
            this._volumeProvider = a,
            this.buildUI(),
            this.setupListeners(),
            this.update(),
            h("volume.pit-activated")
        },
        buildUI: function() {
            var a = n('<div class="pit-tab">   <div class="progressbar-container"/>   <div class="prop-row area">       <label>Area</label>   </div>   <div class="prop-row min-height">       <label>Min Height</label>   </div>   <div class="prop-row max-height">       <label>Max Height</label>   </div>   <div class="prop-row volume">       <label>Volume</label>   </div>   <div class="prop-row accuracy">       <label>Accuracy</label>   </div></div>');
            this.areaView = new j(a.find(".area"),null ),
            this.volumeView = new i(a.find(".volume"),null ),
            this.minHeightView = new k(a.find(".min-height"),null ),
            this.maxHeightView = new k(a.find(".max-height"),null ),
            this.accuracyView = new l(a.find(".accuracy"),null ),
            this.$progressBar = a.find(".progressbar-container"),
            this.progressBar = new m(this.$progressBar,this._volumeProvider),
            this.$content = a
        },
        setupListeners: function() {
            this._volumeProvider.addListener(f, e(this, this.update))
        },
        update: function() {
            var a = this._volumeProvider
              , b = a.getErrorMessage()
              , c = this._errorMessageContainer;
            this._clearError(c);
            var d = a.getMissingData();
            if (d > 0) {
                var e = "Missing " + d + "% of data.\n";
                this._addError(e, c)
            }
            g(b) || this._addError(b, c);
            var f = a.getVolumeBelow()
              , h = a.getArea()
              , i = a.getMinHeight()
              , j = a.getMaxHeight()
              , k = a.getAccuracyInPct();
            g(k) || (k = "+/- " + k.toFixed(2) + "%"),
            this.volumeView.setValue(f),
            this.areaView.setValue(h),
            this.minHeightView.setValue(i),
            this.maxHeightView.setValue(j),
            this.accuracyView.setValue(k)
        },
        _clearError: function(a) {
            a.empty()
        },
        _addError: function(a, b) {
            var c = n("<div></div>");
            c.append(a),
            b.append(c),
            b.show()
        },
        destroy: function() {
            this._volumeProvider.removeListeners(this)
        }
    })
}),
nm_module("nm/tools/volume/moundui", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("nm/metrics", "trigger")
      , h = b("jscore/types", "isUndefinedOrNull")
      , i = b("nm/tools/volume/views", "VolumeUnitView")
      , j = b("nm/tools/volume/views", "AreaUnitView")
      , k = b("nm/tools/volume/views", "LengthUnitView")
      , l = b("nm/tools/volume/views", "LabelView")
      , m = b("nm/views/components/progressbar", "ProgressBar")
      , n = b("js-libs/jquery", "jQuery");
    a.MoundTab = c(Object, {
        constructor: function(a, b) {
            this._errorMessageContainer = b,
            this._volumeProvider = a,
            this.buildUI(),
            this.setupListeners(),
            this.update(),
            g("volume.mound-activated")
        },
        buildUI: function() {
            var a = n('<div class="pit-tab">   <div class="progressbar-container"/>   <div class="prop-row area">       <label>Area</label>   </div>   <div class="prop-row min-height">       <label>Min Height</label>   </div>   <div class="prop-row max-height">       <label>Max Height</label>   </div>   <div class="prop-row volume">       <label>Volume</label>   </div>   <div class="prop-row accuracy">       <label>Accuracy</label>   </div></div>');
            this.areaView = new j(a.find(".area"),null ),
            this.volumeView = new i(a.find(".volume"),null ),
            this.minHeightView = new k(a.find(".min-height"),null ),
            this.maxHeightView = new k(a.find(".max-height"),null ),
            this.accuracyView = new l(a.find(".accuracy"),null ),
            this.$progressBar = a.find(".progressbar-container"),
            this.progressBar = new m(this.$progressBar,this._volumeProvider),
            this.$content = a
        },
        setupListeners: function() {
            this._volumeProvider.addListener(f, e(this, this.update))
        },
        update: function() {
            var a = this._volumeProvider
              , b = a.getErrorMessage()
              , c = this._errorMessageContainer;
            this._clearError(c);
            var d = a.getMissingData();
            if (d > 0) {
                var e = "Missing " + d + "% of data.\n";
                this._addError(e, c)
            }
            h(b) || this._addError(b, c);
            var f = a.getVolumeAbove()
              , g = a.getArea()
              , i = a.getMinHeight()
              , j = a.getMaxHeight()
              , k = a.getAccuracyInPct();
            h(k) || (k = "+/- " + k.toFixed(2) + "%"),
            this.volumeView.setValue(f),
            this.areaView.setValue(g),
            this.minHeightView.setValue(i),
            this.maxHeightView.setValue(j),
            this.accuracyView.setValue(k)
        },
        _clearError: function(a) {
            a.empty()
        },
        _addError: function(a, b) {
            var c = n("<div></div>");
            c.append(a),
            b.append(c),
            b.show()
        },
        destroy: function() {
            this._volumeProvider.removeListeners(this)
        }
    })
}),
nm_module("nm/tools/volume/excavationui", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "Change")
      , g = b("nm/metrics", "trigger")
      , h = b("nm/tools/volume/views", "VolumeUnitView")
      , i = b("nm/tools/volume/views", "LengthUnitView")
      , j = b("nm/tools/volume/views", "LabelView")
      , k = b("nm/layers/feature", "FeatureLayer")
      , l = b("nm/tools/volume/views", "LengthUnitInputView")
      , m = b("js-libs/jquery", "jQuery")
      , n = b("jscore/types", "isUndefinedOrNull")
      , o = b("nm/views/components/progressbar", "ProgressBar");
    a.ExcavationTab = c(Object, {
        constructor: function(a, b, c) {
            this._excavationVolumeProvider = a,
            this._map = b,
            this._errorMessageContainer = c,
            this._mapFeaturesLayer = new k("Excavation Tool Layer",!0,null ,!1),
            b.getLayersCtrl().addLayer(this._mapFeaturesLayer),
            this._buildUI(),
            this._setupListeners(),
            this._volumeExcavationUpdated(),
            g("volume.excavation-activated")
        },
        _buildUI: function() {
            var a = m('<div class="pit-tab">   <div class="progressbar-container"/>   <div class="prop-row excavation-depth">       <label>Excavation Depth</label>   </div>   <div class="prop-row lowest-point">       <label>Measured from lowest point at</label>   </div>   <div class="prop-row volume">       <label>Volume</label>   </div>   <div class="prop-row accuracy">       <label>Accuracy</label>   </div></div>');
            this._volumeView = new h(a.find(".volume"),null ),
            this._lowestPointView = new i(a.find(".lowest-point"),null ),
            this._excavationDepthView = new l(a.find(".excavation-depth"),null ),
            this._accuracyView = new j(a.find(".accuracy"),null ),
            this.$progressBar = a.find(".progressbar-container"),
            this.progressBar = new o(this.$progressBar,this._excavationVolumeProvider),
            this.$content = a
        },
        _setupListeners: function() {
            this._excavationVolumeProvider.addListener(f, e(this, this._volumeExcavationUpdated)),
            this._excavationDepthView.addListener(f, e(this, this._depthViewUpdated))
        },
        setPolygon: function(a) {
            n(a) && (n(this._polygon) || this._polygon.toggleDisplayImage()),
            this._polygon = a
        },
        removeImageOverlay: function() {
            if (!n(this._volumeImageOverlay)) {
                var a = this._volumeImageOverlay;
                this._mapFeaturesLayer.deleteFeature(a),
                this._volumeImageOverlay = null 
            }
        },
        _volumeExcavationUpdated: function() {
            var a = this._excavationVolumeProvider
              , b = a.getErrorMessage()
              , c = this._errorMessageContainer;
            this._clearError(c);
            var d = a.getMissingData();
            if (d > 0) {
                var e = "Missing " + d + "% of data in this area.\n";
                this._addError(e, c)
            }
            n(b) || this._addError(b, c);
            var f = a.getVolume()
              , g = a.getLowestElevation()
              , h = a.getAccuracyInPct();
            n(h) || (h = "+/- " + h.toFixed(2) + "%");
            var i = a.getDepth();
            this._volumeView.setValue(f),
            this._lowestPointView.setValue(g),
            this._excavationDepthView.setValue(i),
            this._accuracyView.setValue(h)
        },
        _depthViewUpdated: function() {
            var a = this._excavationVolumeProvider
              , b = this._excavationDepthView
              , c = a.getPoints()
              , d = a.getDate()
              , e = b.getValue();
            a.setParams(c, d, e)
        },
        _clearError: function(a) {
            a.empty()
        },
        _addError: function(a, b) {
            var c = m("<div></div>");
            c.append(a),
            b.append(c),
            b.show()
        },
        getDepth: function() {
            var a = this._excavationDepthView;
            return a.getValue()
        },
        destroy: function() {
            this._excavationVolumeProvider.removeListeners(this),
            this.removeImageOverlay()
        }
    })
}),
nm_module("nm/dataproviders/elevation/locations", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/async", "callWhenIdle")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/types", "isArray")
      , i = b("nm/console", "cmd")
      , j = b("js-libs/google", "maps")
      , k = {
        OK: j.ElevationStatus.OK,
        INVALID_REQUEST: j.ElevationStatus.INVALID_REQUEST,
        OVER_QUERY_LIMIT: j.ElevationStatus.OVER_QUERY_LIMIT,
        REQUEST_DENIED: j.ElevationStatus.REQUEST_DENIED,
        UNKNOWN_ERROR: j.ElevationStatus.UNKNOWN_ERROR
    }
      , l = a.LocationsElevationProvider = c(e, {
        constructor: function() {
            l.base.call(this),
            this.enabled = !1,
            this.source = "Google",
            this.date = "unknown",
            this._coords = null ,
            this._elevations = null ,
            this._elevator = new j.ElevationService,
            this.changeHandler = f(g(this, this.update), 500)
        },
        update: function() {
            if (h(this._coords) && !(this._coords.length < 1)) {
                var a = {
                    locations: this._coords
                };
                this._elevator.getElevationForLocations(a, g(this, this.processResponse))
            }
        },
        setCoordinates: function(a) {
            a && h(a) && (this._coords = a,
            this.enabled && this.update(),
            this.changed())
        },
        getCoordinates: function() {
            return this._coords || []
        },
        getData: function() {
            return this._elevations || []
        },
        setEnabled: function(a) {
            this.enabled !== a && (this.enabled = a,
            a && this.update(),
            this.changed())
        },
        processResponse: function(a, b) {
            this.elevations = [],
            b === k.OK ? this._elevations = a : i("error", "LocationsElevationProvider returned " + b + " for:", this._coords),
            this.changed()
        }
    })
}),
nm_module("nm/dataproviders/progress/progressprovider", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = a.ProgressProvider = c(e, {
        constructor: function() {
            f.base.call(this),
            this.resetProgress()
        },
        resetProgress: function() {
            this._progress = null ,
            this._steps = null 
        },
        setProgress: function(a) {
            this._progress = a
        },
        getProgress: function() {
            return this._progress
        }
    })
}),
nm_module("nm/dataproviders/measurement/excavationvolume", function(a, b, c, d) {
    function e(a) {
        return i(h(a, function(a) {
            return new q.LatLng(a.getLat(),a.getLon())
        }))
    }
    function f(a) {
        var b, c = a.length;
        if (c > 0) {
            b = a[0].elevation;
            for (var d = 1; c > d; d++)
                b > a[d].elevation && (b = a[d].elevation)
        }
        return b
    }
    var g = b("jscore/functools", "bind")
      , h = b("jscore/itertools", "map")
      , i = b("jscore/itertools", "array")
      , j = b("jscore/dateutils", "format")
      , k = b("jscore/types", "isUndefinedOrNull")
      , l = b("nm/const", "HOST_URL")
      , m = b("js-libs/jquery", "jQuery")
      , n = b("jscore/events", "Change")
      , o = b("nm/dataproviders/elevation/locations", "LocationsElevationProvider")
      , p = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , q = b("js-libs/google", "maps")
      , r = l + "maps/api/demtools/v1/excavationvolume"
      , s = a.ExcavationVolumeProvider = c(p, {
        constructor: function(a) {
            s.base.call(this),
            this.locationsElevationProvider = new o,
            this.locationsElevationProvider.setEnabled(!0),
            this.auth = a,
            this.points = [],
            this._ajaxRequestObject = null ,
            this.resetProgress(),
            this.errorMessage = null ,
            this.clearResults(),
            this._setupListeners()
        },
        _setupListeners: function() {
            this.locationsElevationProvider.addListener(n, g(this, this._handleElevationData))
        },
        setParams: function(a, b, c) {
            this.points = a,
            this.date = b,
            k(c) || (this.depth = c),
            this.fetchData()
        },
        canRequestElevation: function() {
            return k(this.points) || k(this.date) || 0 === this.points.length ? (this.lowestElevation = null ,
            this.volume = null ,
            !1) : !0
        },
        canRequestExcavationVolume: function() {
            return !this.canRequestElevation() || k(this.depth) ? (this.volume = null ,
            !1) : !0
        },
        fetchData: function() {
            if (this.resetProgress(),
            this.setProgress(0),
            this.changed(),
            !this.canRequestElevation())
                return this.setProgress(1),
                void this.changed();
            var a = this.points;
            this.setProgress(.3),
            this.changed();
            var b = this.locationsElevationProvider;
            b.setCoordinates(a)
        },
        _postExcavationVolumeRequest: function(a) {
            var b = this.points
              , c = this.date;
            c = c ? j(c, "yyyymmdd", !0) : "";
            var d = r
              , f = e(b)
              , h = q.geometry.encoding.encodePath(f)
              , i = m.ajax({
                type: "GET",
                url: d,
                dataType: "json",
                data: {
                    nmx: h,
                    nmd: c,
                    offsetdepth: a
                },
                contentType: "application/json"
            }).done(g(this, function(a) {
                this._handleExcavationVolumeData(a)
            })).fail(g(this, function(a) {
                this.clearResults(),
                this.errorMessage = a.responseText,
                this.setProgress(1),
                this.changed()
            }));
            return i
        },
        clearResults: function() {
            this.volume = null ,
            this.minHeight = null ,
            this.maxHeight = null ,
            this.missingData = null ,
            this.accuracy = null ,
            this.accuracyInPct = null 
        },
        _handleElevationData: function() {
            k(this._ajaxRequestObject) || this._ajaxRequestObject.abort();
            var a = this.locationsElevationProvider
              , b = a.getData()
              , c = f(b);
            if (this.lowestElevation = c,
            this.setProgress(.5),
            this.changed(),
            this.canRequestExcavationVolume()) {
                var d = this.depth;
                this.setProgress(.7),
                this.changed();
                var e = this._postExcavationVolumeRequest(d);
                this._ajaxRequestObject = e
            } else
                this.setProgress(1),
                this.changed()
        },
        getMissingData: function() {
            return this.missingData
        },
        getAccuracy: function() {
            return this.accuracy
        },
        getAccuracyInPct: function() {
            return this.accuracyInPct
        },
        _handleExcavationVolumeData: function(a) {
            this.volume = a.volume,
            this.minHeight = a.minHeight,
            this.maxHeight = a.maxHeight,
            this.missingData = a.missingData,
            this.accuracy = Math.abs(a.accuracy),
            this.accuracyInPct = 100 * this.accuracy / a.volume,
            this.errorMessage = null ,
            this.setProgress(1),
            this.changed()
        },
        getVolume: function() {
            return this.volume
        },
        getPoints: function() {
            return this.points
        },
        getDate: function() {
            return this.date
        },
        getDepth: function() {
            return this.depth
        },
        getErrorMessage: function() {
            return this.errorMessage
        },
        getLowestElevation: function() {
            return this.lowestElevation
        }
    })
}),
nm_module("nm/dataproviders/measurement/volume", function(a, b, c, d) {
    function e(a) {
        return h(g(a, function(a) {
            return new o.LatLng(a.getLat(),a.getLon())
        }))
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/itertools", "map")
      , h = b("jscore/itertools", "array")
      , i = b("jscore/dateutils", "format")
      , j = b("jscore/types", "isUndefinedOrNull")
      , k = b("nm/const", "HOST_URL")
      , l = b("js-libs/jquery", "jQuery")
      , m = b("nm/geom", "getArea")
      , n = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , o = b("js-libs/google", "maps")
      , p = k + "maps/api/demtools/v1/volume"
      , q = a.VolumeProvider = c(n, {
        constructor: function(a) {
            q.base.call(this),
            this.auth = a,
            this.points = [],
            this.resetProgress(),
            this.clearResults()
        },
        setParams: function(a, b) {
            this.points = a,
            this.date = b,
            this.fetchData()
        },
        canRequestVolume: function() {
            return !j(this.points) && !j(this.date) && 0 !== this.points.length
        },
        fetchData: function() {
            if (this.resetProgress(),
            this.setProgress(0),
            this.changed(),
            !this.canRequestVolume())
                return this.setProgress(1),
                this.clearResults(),
                void this.changed();
            var a = this.points
              , b = this.date;
            this.setProgress(.5),
            this.changed(),
            this._postVolumeRequest(a, b)
        },
        clearResults: function() {
            this.volumeTotal = null ,
            this.volumeBelow = null ,
            this.volumeAbove = null ,
            this.minHeight = null ,
            this.maxHeight = null ,
            this.accuracy = null ,
            this.accuracyInPct = null ,
            this.lowestElevation = null ,
            this.errorMessage = null 
        },
        _postVolumeRequest: function(a, b) {
            var c;
            b = b ? i(b, "yyyymmdd", !0) : "";
            var d = e(a)
              , g = o.geometry.encoding.encodePath(d);
            c = p,
            l.ajax(c, {
                type: "GET",
                url: c,
                dataType: "json",
                data: {
                    nmx: g,
                    nmd: b
                },
                contentType: "application/json"
            }).done(f(this, function(a) {
                this._handleVolumeData(a)
            })).fail(f(this, function(a) {
                this.clearResults(),
                this.errorMessage = a.responseText,
                this.setProgress(1),
                this.changed()
            }))
        },
        _handleVolumeData: function(a) {
            this.volumeAbove = a.volumeAbove,
            this.volumeBelow = a.volumeBelow,
            this.volumeTotal = a.volumeTotal,
            this.minHeight = a.minHeight,
            this.maxHeight = a.maxHeight,
            this.missingData = a.missingData,
            this.accuracy = Math.abs(a.accuracy),
            this.accuracyInPct = 100 * this.accuracy / a.volumeTotal,
            this.errorMessage = null ,
            this.setProgress(1),
            this.changed()
        },
        getMissingData: function() {
            return this.missingData
        },
        getAccuracy: function() {
            return this.accuracy
        },
        getVolumeBelow: function() {
            return this.volumeBelow
        },
        getVolumeAbove: function() {
            return this.volumeAbove
        },
        getAccuracyInPct: function() {
            return this.accuracyInPct
        },
        getArea: function() {
            var a = m(this.points);
            return 0 === a ? null  : a
        },
        getErrorMessage: function() {
            return this.errorMessage
        },
        getVolume: function() {
            return this.volumeTotal
        },
        getMinHeight: function() {
            return this.minHeight
        },
        getMaxHeight: function() {
            return this.maxHeight
        },
        getPoints: function() {
            return this.points
        },
        getDate: function() {
            return this.date
        }
    })
}),
nm_module("nm/tools/volume", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("nm/geom", "getPolygonPoints")
      , g = b("jscore/events", "Change")
      , h = b("nm/tools", "Tool")
      , i = b("nm/tools/volume/pitui", "PitTab")
      , j = b("nm/tools/volume/moundui", "MoundTab")
      , k = b("nm/tools/volume/excavationui", "ExcavationTab")
      , l = b("nm/layers/feature", "FeatureLayer")
      , m = b("nm/features/polygonimage", "PolygonImage")
      , n = b("nm/dataproviders/measurement/excavationvolume", "ExcavationVolumeProvider")
      , o = b("nm/dataproviders/measurement/volume", "VolumeProvider")
      , p = b("jscore/types", "isUndefinedOrNull")
      , q = b("jscore/async", "setTimeout")
      , r = b("jscore/async", "clearTimeout")
      , s = b("nm/const/tools", "VOLUME_TOOL_KEY")
      , t = b("js-libs/jquery", "jQuery")
      , u = b("nm/const", "HOST_URL")
      , v = b("jscore/strings", "format")
      , w = b("jscore/dateutils", "format")
      , x = "pit"
      , y = "mound"
      , z = "excav"
      , A = u + "maps/api/demtools/v1/volumeimage?nmf=png&imgtype={type}&nmd={date}"
      , B = a.VolumeTool = c(h, {
        constructor: function(a, b, c) {
            B.base.call(this),
            this.auth = a,
            this.map = b,
            this.layersCtrl = b.getLayersCtrl(),
            this.tmpGoogleMapViewController = b.tmpGoogleMapViewController,
            this.surveysController = c,
            this.name = "Volume Estimation",
            this.accessKey = s,
            this.currentTab = null ,
            this.layer = null ,
            this.polygon = null ,
            this._currentShowingTab = null ,
            this._loadProviders(),
            this._buildUI(),
            this._setupListeners()
        },
        _loadProviders: function() {
            this.excavationVolumeProvider = new n(this.auth),
            this.volumeProvider = new o(this.auth)
        },
        _buildUI: function() {
            var a = t('<div class="volume-tool">    <div class="volume-tabs">       <ul>           <li>               <button class="btn-pit" data-tab="' + x + '">                   Pit</button>           </li>           <li>               <button class="btn-mound"            data-tab="' + y + '">                   Mound</button>           </li>           <li>               <button class="btn-excavation" data-tab="' + z + '">                   Excavation               </button>           </li>       </ul>    </div>    <div class="volume-content">       Click the "Define Area"- button to create a volume        measuring area.        Select any of the tabs above to get a volume       estimation for the selected area.    </div>    <div class="buttons right">       <button class="btn-add button">Define Area</button>       <button class="btn-clear button">Clear</button>    </div>    <div class="data-unavailable">    </div></div>');
            this.$btnAdd = a.find(".btn-add"),
            this.$btnClear = a.find(".btn-clear"),
            this.$btnVolumeOverlay = a.find(".btn-volume"),
            this.$dataUnavailable = a.find(".data-unavailable"),
            this.popup = a
        },
        _handleVolumeClick: function() {
            var a = this.excavationVolumeProvider
              , b = a.getPoints()
              , c = a.getDate();
            a.setParams(b, c)
        },
        _setPolygonImageSource: function() {
            if (!p(this.polygon)) {
                var a = this.getImageSourceUrlDependingOnSelectedTab();
                this.polygon.setImageSource(a)
            }
        },
        _setupListeners: function() {
            var a = this.popup
              , b = this
              , c = a.find(".volume-tabs").find("button");
            c.click(function(a) {
                c.removeClass("selected");
                var d = t(a.target);
                d.addClass("selected"),
                b.showTab(d.data("tab"))
            }),
            this.$btnAdd.click(e(this, this.handleAddClick)),
            this.$btnClear.click(e(this, this.handleClearClick)),
            this.$btnVolumeOverlay.click(e(this, this._handleVolumeClick)),
            this.surveysController.addListener(g, e(this, this._surveysControllerUpdate))
        },
        _surveysControllerUpdate: function() {
            this.handlePolygonChange(),
            this._setPolygonImageSource()
        },
        getImageSourceUrlDependingOnSelectedTab: function() {
            var a = this._currentShowingTab
              , b = null 
              , c = this.surveysController.getDisplayDate();
            c = c ? w(c, "yyyymmdd", !0) : "";
            var d = "pit"
              , e = "mound";
            switch (a) {
            case x:
                b = v(A, {
                    type: d,
                    date: c
                });
                break;
            case y:
                b = v(A, {
                    type: e,
                    date: c
                });
                break;
            case z:
                b = null 
            }
            return b
        },
        showTab: function(a) {
            var b = this.popup.find(".volume-content");
            b.empty();
            var c = this.excavationVolumeProvider
              , d = this.volumeProvider
              , e = this.$dataUnavailable
              , f = this.currentTab;
            switch (null  !== f && f.destroy(),
            f = null ,
            this._currentShowingTab = a,
            a) {
            case x:
                f = new i(d,e),
                this.handlePolygonChange(),
                this._setPolygonImageSource();
                break;
            case y:
                f = new j(d,e),
                this.handlePolygonChange(),
                this._setPolygonImageSource();
                break;
            case z:
                f = new k(c,this.map,e),
                this.handlePolygonChange()
            }
            this.currentTab = f,
            null  !== f && b.append(f.$content)
        },
        handleAddClick: function() {
            this.handleClearClick();
            var a = f(this.map)
              , b = new m(a);
            this.polygon = b,
            this.layer.addNewFeature(b),
            b.addListener(g, e(this, this.handlePolygonChange)),
            this.handlePolygonChange(),
            this._currentShowingTab === z && this.currentTab.setPolygon(b),
            this.polygon.enableImage(!0),
            this._setPolygonImageSource()
        },
        handleClearClick: function() {
            this.excavationVolumeProvider.clearResults(),
            this.volumeProvider.clearResults();
            var a = this.polygon;
            p(a) || (a.removeListeners(this),
            this.layer.deleteFeature(a),
            this.polygon = null ,
            this.handlePolygonChange()),
            this._currentShowingTab === z && this.currentTab.removeImageOverlay()
        },
        handlePolygonChange: function() {
            r(this._timeout),
            this._timeout = q(e(this, this._onHandlePolygonChange), 400)
        },
        _onHandlePolygonChange: function() {
            var a = this.polygon
              , b = [];
            p(a) || (b = this.polygon.getPoints());
            var c = this.surveysController.getDisplayDate()
              , d = null ;
            this._currentShowingTab === z && (this.currentTab.setPolygon(a),
            d = this.currentTab.getDepth()),
            this.excavationVolumeProvider.setParams(b, c, d),
            this.volumeProvider.setParams(b, c)
        },
        hasAccess: function() {
            return this.auth.can(s)
        },
        start: function() {
            if (null  === this.layer) {
                var a = new l("Volume Tool Layer",!0,null ,!1);
                this.layer = a,
                this.layersCtrl.addLayer(a)
            }
        },
        stop: function() {
            this.layersCtrl.removeLayer(this.layer),
            this.layer = null ,
            this._currentShowingTab === z && this.currentTab.removeImageOverlay()
        }
    })
}),
nm_module("nm/views/LayersListItemView", function(a, b, c, d) {
    a.html = '<li class="layer-item">\n	<header>\n		<span class="layer-name"></span>\n		<span class="layer-status"></span>\n		<input type="checkbox" class="layer-checkbox" />\n	</header>\n</li>'
}),
nm_module("nm/views/LayersListItemViewCtrl", function(a, b, c, d) {
    var e = b("jscore/events", "Change")
      , f = b("js-libs/jquery", "jQuery")
      , g = b("nm/views/LayersListItemView", "html")
      , h = b("nm/const/messages", "PARTIAL_FEATURES_LOADED");
    a.LayerListItemViewCtrl = c(Object, {
        constructor: function(a, b, c) {
            this.layer = a,
            this.layersCtrl = b,
            this.selectionCtrl = b.getSelectionCtrl(),
            this.mountNode = c,
            this.setupDOM(),
            this.linkDOM()
        },
        setupDOM: function() {
            var a = f(g).prependTo(this.mountNode);
            this.layerElement = a,
            this.$status = a.find(".layer-status")
        },
        linkDOM: function() {
            var a = this.layer
              , b = this.selectionCtrl
              , c = this.layerElement
              , d = c.find(".layer-name");
            d.text(a.getName()),
            a.addListener(e, function() {
                return d.text(a.getName())
            }
            .bind(this));
            var f = c.find(".layer-checkbox");
            f.prop("checked", a.getVisible()),
            a.addListener(e, function() {
                return f.prop("checked", a.getVisible())
            }
            .bind(this)),
            f.click(function() {
                return a.setVisible(f.prop("checked"))
            }
            .bind(this)),
            c.toggleClass("selected", b.isSelected(a)),
            this.selectionCtrl.addListener(e, function() {
                c.toggleClass("selected", b.isSelected(a))
            }
            .bind(this)),
            c.click(function() {
                return b.select(a)
            }
            .bind(this)),
            c.dblclick(function() {
                return this.editLayerName()
            }
            .bind(this)),
            f.on("click dblclick", function(a) {
                return a.stopPropagation()
            }
            .bind(this)),
            a.addListener(e, function() {
                var b = a.getPartialFeatures();
                this.setPartialFeatures(b)
            }
            .bind(this))
        },
        setPartialFeatures: function(a) {
            a ? this.setStatus(h) : this.clearStatus()
        },
        editLayerName: function() {
            var a = this.layer
              , b = prompt("Enter layer name...", a.getName());
            b && b.length > 0 && a.setName(b)
        },
        setStatus: function(a) {
            var b = this.layer
              , c = b.getVisible();
            if (c) {
                var d = this.$status;
                d.text(a)
            } else
                this.clearStatus()
        },
        clearStatus: function() {
            var a = this.$status;
            a.text("")
        },
        destroy: function() {
            this.layerElement.remove()
        }
    })
}),
nm_module("nm/views/LayersListViewCtrl", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/objtools", "Dictionary")
      , i = b("nm/views/LayersListItemViewCtrl", "LayerListItemViewCtrl")
      , j = b("nm/layers/LayersController", "isItemSupported")
      , k = b("js-libs/jquery", "jQuery")
      , l = a.LayersListViewCtrl = c(e, {
        constructor: function(a, b) {
            l.base.call(this),
            this.layersCtrl = a,
            this.mountNode = b,
            this.layers = a.getLayers(),
            this.selectionCtrl = a.getSelectionCtrl(),
            this.layerItemViewCtrls = new h,
            this.setupListeners(),
            this.setupDOM(),
            this.update()
        },
        setupListeners: function() {
            var a = this.layersCtrl
              , b = this.selectionCtrl;
            a.addListener(f, g(this, this.layersChanged)),
            b.addListener(f, g(this, this.update)),
            this.updateLayerListeners()
        },
        layersChanged: function() {
            this.updateLayerListeners(),
            this.update()
        },
        updateLayerListeners: function() {
            for (var a, b = this.layers[d.iterator](); !(a = b.next()).done; ) {
                var c = a.value;
                c.removeListeners(this),
                c.addListener(f, g(this, this.update))
            }
            this.selectionCtrl.addListener(f, g(this, this.update))
        },
        setupDOM: function() {
            var a = k("<ul>");
            this.layerItemsContainer = a,
            a.css({
                height: "400px",
                overflow: "scroll",
                "padding-top": "0",
                "padding-left": "0",
                color: "black",
                background: "white"
            }),
            this.mountNode.append(a)
        },
        update: function() {
            for (var a, b = this.layersCtrl, c = b.getLayers(), e = this.layerItemViewCtrls, f = this.layerItemsContainer, g = this.layers[d.iterator](); !(a = g.next()).done; ) {
                var h = a.value;
                if (j(h)) {
                    var k = e.get(h);
                    k || (k = new i(h,b,f),
                    e.set(h, k))
                }
            }
            for (var l, m = e.keys()[d.iterator](); !(l = m.next()).done; ) {
                var n = l.value;
                if (-1 === c.indexOf(n)) {
                    var o = e.pop(n);
                    o.destroy(),
                    e.pop(n)
                }
            }
        }
    })
}),
nm_module("nm/views/LayersManagerView", function(a, b, c, d) {
    a.html = '<div class="layers-manager-view-container">\n	<!-- Support Link -->\n	<a href="{supportURL}" target="_blank">\n		Learn more about Layers Manager...\n	</a>\n	\n	<!-- Progress & Status -->\n	<div class="progressbar-container"/>\n	<div class="status-container"><span class="status"></span></div>\n\n	<!-- LayersListViewCtrl renders itself in here -->\n	<div class="layers-list-view-container"></div>\n	\n	<!-- Buttons Footer -->\n	<div class="buttons right">\n		<div class="button" id="add-layer">Add Layer</div>\n		<div class="button" id="import-kml">Import KML</div>\n		<div class="button delete-btn" id="delete"></div>\n	</div>\n\n</div>'
}),
nm_module("nm/views/LayersManagerViewController", function(a, b, c, d) {
    var e = b("nm/views/LayersListViewCtrl", "LayersListViewCtrl")
      , f = b("nm/const/urls", "LAYERS_MANAGER_SUPPORT_URL")
      , g = b("nm/const/tools", "IMPORT_GEOMETRY")
      , h = b("js-libs/jquery", "jQuery")
      , i = b("jscore/strings", "format")
      , j = b("nm/views/components/progressbar", "ProgressBar")
      , k = b("nm/views/LayersManagerView", "html")
      , l = a.LayersManagerViewController = c(Object, {
        constructor: function(a, b, c, d, e) {
            l.base.call(this),
            this.auth = a,
            this.map = b,
            this.selection = c,
            this.layersManagerTool = d,
            this.mountNode = e;
            var f = b.getLayersCtrl();
            this.layersCtrl = f,
            this.fileElement = null ,
            this.setupDOM()
        },
        setupDOM: function() {
            var a = h(i(k, {
                supportURL: f
            })).appendTo(this.mountNode)
              , b = this.layersCtrl;
            this.layersListViewCtrl = new e(b,a.find(".layers-list-view-container")),
            this.statusElement = a.find(".status"),
            a.find("#add-layer").click(function() {
                return b.newFeatureLayer()
            }
            .bind(this)),
            a.find("#delete").click(function() {
                return b.deleteSelectedLayers()
            }
            .bind(this)),
            this.auth.can(g) ? (a.find("#import-kml").click(function() {
                return this.promptForKML()
            }
            .bind(this)),
            this.fileElement = h('<input type="file"/>').css("display", "none").change(function(a) {
                this.layersManagerTool.importKML(a.target.files[0])
            }
            .bind(this)).appendTo(a)) : a.find("#import-kml").hide();
            var c = a.find(".progressbar-container");
            this.progressBar = new j(c,this.layersManagerTool.getProgressProvider())
        },
        promptForKML: function() {
            var a = this.fileElement;
            a.val(""),
            a.trigger("click")
        },
        setStatus: function(a) {
            "string" == typeof a ? this.statusElement.text(a).fadeIn(1e3) : this.statusElement.text("").hide()
        }
    })
}),
nm_module("nm/filereader", function(a, b, c, d) {
    var e = b("nm/console", "log");
    a.readFileToDataURL = function(a, b, c) {
        if (!FileReader)
            return e("Error: HTML5 File API not supported in this browser."),
            void c();
        var d = new FileReader;
        d.onload = function(a) {
            var d = a.target.result;
            d ? b(d) : (e("Error: No `dataURL` after trying to load file."),
            c())
        }
        ,
        d.readAsDataURL(a)
    }
}),
nm_module("nm/tools/layersmanager", function(a, b, c, d) {
    var e = b("nm/const/tools", "LAYERS_MANAGER_KEY")
      , f = b("nm/views/LayersManagerViewController", "LayersManagerViewController")
      , g = b("nm/filereader", "readFileToDataURL")
      , h = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , i = b("jscore/async", "setTimeout")
      , j = b("jscore/async", "clearTimeout")
      , k = b("js-libs/jquery", "jQuery")
      , l = "KML imported successfully."
      , m = "Couldn't import KML"
      , n = "error parsing file."
      , o = "file too large (must be less than {0} MB)."
      , p = "no supported layers found in file."
      , q = (a.LAYERS_MANAGER_TITLE = "Layers Manager",
    .2)
      , r = (1 - q) / 600
      , s = a.LayersManagerTool = c(Object, {
        constructor: function(a, b, c, d) {
            s.base.call(this),
            this.name = "Layers Manager",
            this.auth = a,
            this.accessKey = e,
            this.persistenceMgr = d,
            this.popup = k("<div>"),
            this.progressprovider = new h,
            this.progressTimeout = null ,
            this._layersManagerViewController = new f(a,b,c,this,this.popup)
        },
        getProgressProvider: function() {
            return this.progressprovider
        },
        importKML: function(a) {
            var b = this._layersManagerViewController;
            b.setStatus("Importing KML..."),
            g(a, function(a) {
                this.persistenceMgr.importGeometry(a, function(a) {
                    this.handleKMLUploadDone(a),
                    this.stopAutoProgress()
                }
                .bind(this))
            }
            .bind(this), function() {
                this.handleKMLUploadDone(),
                this.stopAutoProgress()
            }
            .bind(this)),
            this.autoProgress(q)
        },
        handleKMLUploadDone: function(a) {
            if (a && "ok" === a.status)
                alert(l);
            else {
                var b = m;
                if ("BadImportRequest" === a.status)
                    b += " — " + n;
                else if ("ImportFileExceedsMaxSize" === a.status) {
                    var c = a.properties || {}
                      , d = c.maxSizeBytes || 10485760;
                    d = Math.round(d / 1024 / 1024);
                    var e = o.replace("{0}", d);
                    b += " — " + e
                } else
                    "empty" === a.status && (b += " — " + p);
                alert(b)
            }
            this._layersManagerViewController.setStatus(null )
        },
        autoProgress: function(a) {
            a > 1 || (this.progressprovider.setProgress(a),
            this.progressprovider.changed(),
            j(this.progressTimeout),
            this.progressTimeout = i(function() {
                return this.autoProgress(a + r)
            }
            .bind(this), 500))
        },
        stopAutoProgress: function() {
            j(this.progressTimeout),
            this.progressprovider.setProgress(100),
            this.progressprovider.changed(),
            this.progressTimeout = i(function() {
                this.progressprovider.setProgress(0),
                this.progressprovider.changed()
            }
            .bind(this), 300)
        },
        hasAccess: function() {
            try {
                return this.auth.can(this.accessKey)
            } catch (a) {
                return !1
            }
        },
        start: function() {
            this.active = !0
        },
        stop: function() {
            this.active = !1
        }
    })
}),
nm_module("nm/tools/timestamp", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("nm/dataproviders/timestamp", "TimestampProvider")
      , g = b("jscore/events", "Change")
      , h = b("nm/tools", "Tool")
      , i = b("nm/const/tools", "VIEW_TIMESTAMP")
      , j = b("js-libs/jquery", "jQuery")
      , k = "N/A"
      , l = a.TimestampTool = c(h, {
        constructor: function(a, b, c) {
            l.base.call(this),
            this.auth = a,
            this.map = b,
            this.visible = !1,
            this.node = null ,
            this.timestamp = null ,
            this.provider = new f(b,null ,c),
            this.createHTML(),
            this.setupListeners(),
            this.enable()
        },
        createHTML: function() {
            this.node = j('<span class="timestamp">N/A</span>')[0]
        },
        setupListeners: function() {
            this.auth.addListener(g, e(this, this.enable)),
            this.provider.addListener(g, e(this, this.update))
        },
        update: function() {
            var a = this.provider.getFormatted() || k;
            this.timestamp = a,
            this.node.innerHTML = a
        },
        setCoordinates: function(a) {
            this.provider.setCoordinates(a)
        },
        enable: function() {
            var a = this.auth.can(i);
            this.setEnabled(a),
            this.provider.setEnabled(a && this.visible)
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.changed())
        },
        changed: function() {
            this.provider.setEnabled(this.visible && this.enabled),
            l.base.prototype.changed.call(this)
        }
    })
}),
nm_module("nm/dataproviders/geocode/google", function(a, b, c, d) {
    function e(a, b, c) {
        c = c || "long_name";
        for (var d = 0; d < b.length; d += 1) {
            var e = b[d];
            if (e.types.indexOf(a) > -1)
                return e[c]
        }
        return null 
    }
    function f(a) {
        var b = a.address_components
          , c = {
            lat: a.geometry.location.lat(),
            lon: a.geometry.location.lng(),
            streetNumber1: e("street_number", b),
            streetNumber2: null ,
            streetName: e("route", b),
            streetType: null ,
            streetSuffix: null ,
            locality: e("locality", b),
            stateTerritory: e("administrative_area_level_1", b),
            postCode: e("postal_code", b),
            country: e("country", b)
        };
        return c
    }
    var g = b("nm/const/tools", "REVERSE_GEOCODE_KEY")
      , h = b("js-libs/google", "maps");
    a.Geocoder = c(Object, {
        constructor: function(a) {
            this.auth = a
        },
        lookup: function(a, b) {
            if (!this.auth.can(g))
                return void b(null , new Error("not authorized"));
            var c = new h.Geocoder
              , d = new h.LatLng(a.lat,a.lng);
            c.geocode({
                location: d
            }, function(a, c) {
                var d = null ;
                if (c === h.GeocoderStatus.OK && a.length) {
                    var e = a[0];
                    d = {
                        formatted: e.formatted_address,
                        components: f(e)
                    }
                }
                b(d)
            })
        }
    })
}),
nm_module("nm/ui/FileDropzoneOverlay", function(a, b, c, d) {
    function e(a) {
        if (a.dataTransfer.types)
            for (var b = 0; b < a.dataTransfer.types.length; b++)
                if ("Files" === a.dataTransfer.types[b])
                    return !0;
        return !1
    }
    var f = b("jscore/events", "ObservableObject")
      , g = b("js-libs/jquery", "jQuery")
      , h = a.FileDropzoneOverlay = c(f, {
        constructor: function(a, b) {
            h.base.call(this),
            this.container = a,
            this.text = b,
            this.setupDOM()
        },
        setupDOM: function() {
            var a = this.container
              , b = g('<div class="file-dropzone-overlay">').hide().prependTo(a);
            g('<span class="overlay-text">').text(this.text).appendTo(b),
            g('<div class="overlay-outline">').appendTo(b),
            a.on("dragover dragenter dragleave drop", function(a) {
                e(a) && (a.preventDefault(),
                a.stopPropagation())
            }
            .bind(this)),
            a.on("dragover", function(a) {
                e(a) && b.fadeIn(100)
            }
            .bind(this)),
            a.on("drop", function(a) {
                if (e(a)) {
                    b.fadeOut(100);
                    var c = a.originalEvent.dataTransfer.files;
                    this.changed({
                        file: c[0],
                        originalEvent: a
                    })
                }
            }
            .bind(this))
        }
    })
}),
nm_module("nm/tools/elevation/location", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("nm/dataproviders/elevation/locations", "LocationsElevationProvider")
      , g = b("jscore/events", "Change")
      , h = b("nm/tools", "Tool")
      , i = b("nm/const/tools", "VIEW_ELEVATION_PROFILE")
      , j = b("js-libs/jquery", "jQuery")
      , k = "N/A"
      , l = a.ElevationLocationTool = c(h, {
        constructor: function(a) {
            l.base.call(this),
            this.auth = a,
            this.visible = !1,
            this.node = null ,
            this.elevation = null ,
            this.provider = new f,
            this.createHTML(),
            this.setupListeners(),
            this.enable()
        },
        createHTML: function() {
            this.node = j('<span class="elevation">N/A</span>')[0]
        },
        setupListeners: function() {
            this.auth.addListener(g, e(this, this.enable)),
            this.provider.addListener(g, e(this, this.update))
        },
        update: function() {
            var a = this.provider.getData()
              , b = k;
            a.length > 0 && a[0].hasOwnProperty("elevation") && (b = a[0].elevation.toFixed(1) + "m"),
            this.elevation = b,
            this.node.innerHTML = this.elevation
        },
        setCoordinates: function(a) {
            this.provider.setCoordinates(a)
        },
        enable: function() {
            var a = this.auth.can(i);
            this.setEnabled(a),
            this.provider.setEnabled(a && this.visible)
        },
        setVisible: function(a) {
            this.visible !== a && (this.visible = a,
            this.changed())
        },
        changed: function() {
            this.provider.setEnabled(this.visible && this.enabled),
            l.base.prototype.changed.call(this)
        }
    })
}),
nm_module("nm/tools/watermark", function(a, b, c, d) {
    var e = b("nm/dom", "createElement")
      , f = b("jscore/functools", "bind");
    a.Watermark = c(Object, {
        constructor: function(a) {
            this.mapViewController = a;
            var b = e("div");
            b.className = "nm-watermark",
            this.elm = b,
            a.gMap.getDiv().appendChild(b),
            a.gMap.getStreetView().addListener("visible_changed", f(this, this.onStreeViewChange))
        },
        onStreeViewChange: function() {
            var a = this.mapViewController.gMap;
            a.streetView.getVisible() ? this.elm.style.right = "65px" : this.elm.style.right = "5px"
        }
    })
}),
nm_module("nm/views/displaydate", function(a, b, c, d) {
    var e = b("nm/dom", "createElement")
      , f = b("jscore/functools", "bind")
      , g = b("jscore/events", "Change")
      , h = b("jscore/dateutils", "format")
      , i = b("nm/const/imagery", "ROAD")
      , j = b("nm/intl", "getText");
    a.DisplayDate = c(Object, {
        constructor: function(a, b) {
            this.surveysCtl = a,
            this.mapViewController = b,
            this.gMap = b.gMap,
            this.container = null ,
            this.label = null ,
            this.createUI(),
            this.surveysCtl.addListener(g, f(this, this.update)),
            b.gMap.getStreetView().addListener("visible_changed", f(this, this.onStreeViewChange))
        },
        createUI: function() {
            var a = e("div")
              , b = e("div");
            a.className = "nm-nodeLatestImageryControl",
            b.className = "nm-labelLatestImageryControl",
            this.container = a,
            this.label = b,
            a.appendChild(b),
            this.gMap.getDiv().appendChild(a)
        },
        onStreeViewChange: function() {
            var a = this.mapViewController.gMap;
            a.streetView.getVisible() ? this.container.style.display = "none" : this.container.style.display = "block"
        },
        update: function() {
            var a = this.surveysCtl;
            if (a.hasAnyCoverage() && a.getMapType() !== i) {
                var b = this.surveysCtl.getDisplayDate()
                  , c = j("formats.day-date")
                  , d = h(b, c, !0);
                this.label.innerHTML = "Showing: " + d
            } else
                this.label.innerHTML = ""
        }
    })
}),
nm_module("nm/const/output", function(a, b, c, d) {
    a.MapOutput = {
        FEATURELESS: 0,
        NORMAL: 1
    },
    a.OUTPUT_KEY = "output"
}),
nm_module("gooscr/closestreetview", function(a, b) {
    "use strict";
    var c = b("nm/dom")
      , d = a;
    a.visible = !1,
    a.elm = null ,
    a.init = function(a) {
        a.streetView.addListener("visible_changed", function() {
            d.refresh(a)
        }),
        d.refresh(a),
        d.elm = c.createElement("div"),
        d.elm.innerHTML = "Close",
        d.elm.className = "nm-streetview-close",
        d.elm.onclick = function() {
            a.streetView.setVisible(!1)
        }
        ,
        a.streetView.setEnableCloseButton(!1)
    }
    ,
    a.refresh = function(a) {
        var b = a.streetView.getVisible();
        d.visible !== b && (d.visible = b,
        b ? d.show(a) : d.hide(a))
    }
    ,
    a.show = function(a) {
        a.getDiv().appendChild(d.elm)
    }
    ,
    a.hide = function(a) {
        a.getDiv().removeChild(d.elm)
    }
}),
nm_module("gooscr/tooltip", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("nm/client")
      , e = a;
    a.tooltip = e,
    a.current = "",
    a.active = !1,
    a.$elm = null ,
    a.texts = [],
    a.init = function() {
        e.$elm = c("<div>", {
            "class": "nm-tooltip"
        }).appendTo("body"),
        d.isTouchDevice() ? c(document).on("click", e.reposition) : c(document).on("mousemove", e.reposition)
    }
    ,
    a.set = function(a) {
        e.texts.push(a),
        e.checkContents()
    }
    ,
    a.unset = function(a) {
        if (a)
            for (var b = 0; b < e.texts.length; b++)
                e.texts[b] === a && e.texts.splice(b, 1);
        else
            e.texts = [];
        e.checkContents()
    }
    ,
    a.checkContents = function() {
        e.texts.length ? (e.active = !0,
        e.$elm.addClass("active"),
        e.$elm.text(e.texts[e.texts.length - 1])) : (e.active = !1,
        e.$elm.removeClass("active"))
    }
    ,
    a.reposition = function(a) {
        var b = c(a.target)
          , d = 0 === b.closest("#map").length || b.closest(".gmnoprint, [class^=nm-]").length > 0
          , f = e.$elm.hasClass("hidden");
        !d && f ? e.$elm.removeClass("hidden") : d && !f && e.$elm.addClass("hidden"),
        d || e.$elm.css({
            left: a.clientX,
            top: a.clientY
        })
    }
}),
nm_module("gooscr/print", function(a, b) {
    "use strict";
    var c = b("gooscr/notify")
      , d = b("nm/const/tools")
      , e = b("nm/metrics")
      , f = b("nm/console")
      , g = b("jscore/dateutils").format
      , h = a;
    a.name = "Print",
    a.printUrl = "./print",
    a.hasAccess = function() {
        try {
            return h.auth.can(d.PRINT)
        } catch (a) {
            return !1
        }
    }
    ,
    a.init = function() {
        e.setEvent({
            category: e.CATEGORIES.Error,
            action: h.name,
            event: h.name + ".error",
            showInfo: !0
        })
    }
    ,
    a.setAuth = function(a) {
        h.auth = a
    }
    ,
    a.notifyAndGo = function(a) {
        c.fire("Print screen in new window or tab.", {
            closable: !0,
            duration: 5e3,
            type: "warning"
        }),
        h.go(a)
    }
    ,
    a.go = function(a, b, c) {
        if (!h.hasAccess())
            return c._displayDisallowedPopup(this);
        var d = a.getBounds();
        if (d) {
            var i = b.getDisplayDate();
            i = g(i, "yyyymmdd", !0);
            var j = h.printUrl + "?north=" + d.getNorthEast().lat() + "&east=" + d.getNorthEast().lng() + "&south=" + d.getSouthWest().lat() + "&west=" + d.getSouthWest().lng() + "&zoom=" + a.getZoom() + "&date=" + i;
            e.trigger("toolbar.print", {
                label: "Print URL",
                description: j
            }),
            window.open(j, "Print")
        } else
            f.cmd("error", "Print error: bounds undefined", d),
            e.trigger(h.name + ".error", {
                label: "Bounds",
                description: d
            })
    }
    ,
    a.start = function() {}
    ,
    a.stop = function() {}
}),
nm_module("gooscr/popup", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = a;
    a.popupMgr = d,
    a.$element = null ,
    a.markerOffset = 28,
    a.defaults = {
        tip: null ,
        links: null ,
        html: null ,
        position: ["right", "top"]
    },
    a.isOpen = !1,
    a.init = function() {
        c(window).bind("resize", d.refreshPosition),
        c(document).bind("mousedown", d._onMouseDown),
        d._initTooltips()
    }
    ,
    a._initTooltips = function() {
        c(document).on("mouseover click", ".popup-help", function() {
            var a = c(this);
            d.open(a, {
                tip: a.attr("data-tip"),
                position: a.attr("data-position").split(" ")
            })
        }).on("mouseout", ".popup-help", function() {
            d.close()
        })
    }
    ,
    a.open = function(a, b) {
        d.close();
        var e, f = c(a), g = c.extend({}, d.defaults);
        c.isPlainObject(b) ? g = c.extend(g, b) : g.html = b,
        g.$source = f,
        f.length && ("string" == typeof g.position && (g.position = [g.position, d.defaults.position[1]]),
        e = d.$element = d._generateElement(g),
        e.appendTo("body"),
        d.refreshPosition(),
        d.isOpen = !0)
    }
    ,
    a.close = function() {
        d.$element && d.$element.remove(),
        d.$element = null ,
        d.isOpen = !1
    }
    ,
    a.refreshPosition = function(a) {
        if (a && a.jquery && a.length || (a = d.$element),
        a && a.jquery && a.length) {
            var b, c, e = a.data("nm-popup"), f = e.position, g = e.$source, h = g.offset();
            "left" === f[0] || "right" === f[0] ? (b = "left" === f[0] ? h.left - a.outerWidth() - d.markerOffset : h.left + g.outerWidth() + d.markerOffset,
            c = "top" === f[1] ? h.top : h.top + g.outerHeight() - a.outerHeight()) : (c = "top" === f[0] ? h.top - a.outerHeight() - d.markerOffset : h.top + g.outerHeight() + d.markerOffset,
            b = "left" === f[1] ? h.left : h.left + g.outerWidth() - a.outerWidth()),
            a.css({
                left: b,
                top: c
            })
        }
    }
    ,
    a._onMouseDown = function(a) {
        var b = d.$element
          , e = c(a.target);
        b && b.jquery && b.length && (e.is(b) || e.closest(b).length || d.close())
    }
    ,
    a._generateInner = function(a) {
        if (a.html)
            return c("<div>", {
                "class": "html"
            }).append(a.html);
        if (a.tip)
            return c("<div>", {
                "class": "tip"
            }).append(a.tip);
        if (a.links) {
            var b = c("<ul>", {
                "class": "links"
            });
            return c.each(a.links, function(a, e) {
                var f = e.link || e.onClick
                  , g = c("<li>");
                c(f ? "<a>" : "<div>", {
                    "class": e["class"] + " link" || "link",
                    href: e.link,
                    text: e.text,
                    title: e.title,
                    target: e.target,
                    click: function(a) {
                        d.close(),
                        e.link || a.preventDefault(),
                        "function" == typeof e.onClick && e.onClick(a)
                    }
                }).appendTo(g),
                g.appendTo(b)
            }),
            b
        }
    }
    ,
    a._generateContainer = function(a) {
        return c("<div>", {
            "class": "nm-popup"
        }).append(a)
    }
    ,
    a._generateElement = function(a) {
        var b, e, f;
        return (b = d._generateInner(a)) ? (e = d._generateContainer(b),
        f = "top" === a.position[0] ? "bottom" : "right" === a.position[0] ? "left" : "bottom" === a.position[0] ? "top" : "right",
        c("<div>", {
            "class": "marker " + f + "-" + a.position[1]
        }).appendTo(e),
        e.data("nm-popup", a),
        e) : !1
    }
}),
nm_module("gooscr/tour", function(a, b) {
    "use strict";
    function c() {
        e.setValue("tour-complete", "1"),
        e.save()
    }
    var d = b("nm/ui/wizzard").startWizzard
      , e = b("nm/cookie").MapState;
    a.tour = a;
    var f = [{
        title: "Welcome to nearmap",
        content: "<p>Get ready to experience spectacular, high resolution imagery. </p><p>This tour will introduce you to the various tools and features of the MapBrowser interface.</p><p>On the left is the navigation bar. Along the top of the browser are your timeline and account settings. In the top-right are your display modes and overlays.</p><p>The next few screens will give you an overview of each element.</p>"
    }, {
        title: "Toolbar",
        content: '<img src="./static/maps/api-assets/img/tour/toolbar.png" style="float:left;margin-right:1em;"><p>The tools available include:</p><ul style="margin-left: 4em;"><li>Search</li><li>Measurement tools</li><li>Image saving</li><li>Location information</li><li>Demographic layers &amp; other information overlays</li></ul><p>You can also access print and help.</p><p>Right-click on a tool to hide it.</p>'
    }, {
        title: "The Map",
        content: "<p>The default view mode for MapBrowser is Photomaps&trade;. These are the spectacular high resolution images captured regularly for our coverage areas. </p><p>Multiview displays different capture angles where available. A Terrain view and Street Map mode are also available. </p><p>You can toggle street and property boundary overlays on most of the view modes.</p><p>Street View is accessible by right-clicking or dragging Pegman onto a specific location.</p><p>Along the bottom of the window you’ll see the capture date and current scale.</p>"
    }, {
        title: "Timeline",
        content: '<p><img src="./static/maps/api-assets/img/tour/timeline.png" style="max-width: 100%;"></p><p>The timeline allows you to select from all the available PhotoMaps updates for the current area. </p><p>You can use the dropdown to see all the available dates or select a point on the timeline.  Hover over the timeline and use your scroll-wheel to navigate between dates.</p><p>The icon in the far right corner allows you to access your account settings. </p>'
    }, {
        title: "Get Started",
        content: "<p>If you would like to play this tour again, you can access it from the help menu at the bottom left of the screen.</p>"
    }];
    a.init = function() {
        e.getValue("tour-complete") || d(f, c)
    }
    ,
    a.startTour = function() {
        d(f, c)
    }
}),
nm_module("gooscr/toolbar", function(a, b) {
    "use strict";
    function c() {
        return !1
    }
    var d = b("nm/localstorage").isLocalStorageEnabled
      , e = b("gooscr/print")
      , f = b("nm/const/tools").PRINT
      , g = b("nm/const/tools").DISABLE_TOUR
      , h = b("nm/const/tools").USE_DISCOVERY_SETTINGS
      , i = b("gooscr/popup")
      , j = b("gooscr/notify")
      , k = b("gooscr/tour")
      , l = b("nm/metrics")
      , m = b("nm/const/urls")
      , n = b("nm/const/messages")
      , o = b("jscore/types").isUndefinedOrNull
      , p = b("nm/tools").Tool
      , q = b("nm/intl")
      , r = b("js-libs/jquery").jQuery
      , s = b("jscore/functools").bind
      , t = a;
    a.toolbar = t,
    a.tools = {},
    a.appendTool = function(a, b, c, d, e) {
        var f = null ;
        return "search" === a ? (f = c(),
        t.toolbar.tools.search = f,
        f) : (d.can(["hide_", e].join("")) || (d.can(e) ? f = c() : (f = new p,
        f.start = function() {}
        ,
        f.stop = function() {}
        ,
        f.hasAccess = function() {
            return !1
        }
        ,
        f.name = b),
        t.toolbar.tools[a] = f),
        f)
    }
    ;
    var u = 0;
    a.appendDivider = function() {
        t.toolbar.tools["divider" + u] = "divider",
        u++
    }
    ,
    a.authorization = null ;
    var v = function() {
        var b = {
            _popups: [],
            $container: null ,
            init: function() {
                b.$container = r("<div>", {
                    "class": "tool-popup-container"
                }).appendTo(".panel-content")
            },
            add: function(c) {
                var d = a.getTool(c);
                return b._popups.push({
                    title: d.name,
                    toolKey: c,
                    $content: d.popup,
                    $popupElm: null ,
                    open: !1
                }) - 1
            },
            open: function(a) {
                var c = b._popups[a];
                return c ? (c.$popupElm = b.buildPopup(c),
                void c.$popupElm.appendTo(b.$container)) : !1
            },
            buildPopup: function(b) {
                var c = r('<div class="popup-close"></div>').on("click.toolPopup", a.startDefault)
                  , d = r('<div class="tool-popup-body">').append(b.$content);
                return r("<div>", {
                    html: '<h1 class="heading"><div class="icon"></div>' + b.title + "</h1>",
                    "class": "tool-popup",
                    "data-tool": b.toolKey
                }).append(c).append(d)
            },
            minMax: function() {
                var a = r(this);
                a.hasClass("max") ? (a.addClass("min").removeClass("max"),
                r(".tool-popup-body").slideDown()) : (a.addClass("max").removeClass("min"),
                r(".tool-popup-body").slideUp())
            },
            close: function(a) {
                var c = b._popups[a];
                return c ? void r(c.$popupElm).detach() : !1
            }
        };
        return b
    }()
      , w = {}
      , x = null 
      , y = ["name", "start", "stop"]
      , z = function() {
        function b() {
            var a = {};
            return function(b) {
                var c, d = b && a[b];
                return d || (c = r.Callbacks(),
                d = {
                    publish: c.fire,
                    subscribe: c.add,
                    unsubscribe: c.remove
                },
                b && (a[b] = d)),
                d
            }
        }
        function c(b, c, d) {
            var f = e[b];
            if (!o(f)) {
                var g, h = a.getActive();
                if (c.indexOf("click") >= 0) {
                    var i = !1
                      , j = !1
                      , k = !1;
                    if (a.forEachTool(function(a) {
                        var b = e[a];
                        if (!j && !o(b))
                            return b.options.stealClicks && a === h ? (j = !0,
                            void b(c).publish(d)) : b.options.clicksAware && a === h ? void (k = !0) : void ((b.options.stealClicks || b.options.clicksAware) && b === f && (i = !0))
                    }),
                    j)
                        return;
                    if (k) {
                        if (g = e[h],
                        o(g))
                            return;
                        g(c).publish(d)
                    } else
                        i && f(c).publish(d)
                } else
                    g = e[h],
                    o(g) || g(c).publish(d)
            }
        }
        function d(a, d) {
            if (e[a])
                return e[a];
            var f = b(a);
            return f.options = d || {},
            e[a] = f,
            function(b) {
                var d = f(b);
                return {
                    subscribe: d.subscribe,
                    unsubscribe: d.unsubscribe,
                    publish: function(d) {
                        c(a, b, d)
                    }
                }
            }
        }
        var e = {};
        return {
            makeChannel: d
        }
    }();
    a.events = z,
    a.$elm = null ,
    a.metrixInitialised = !1,
    a.toolsSubjectToStateChange = ["measureLine", "measurePath", "measureArea", "measureCircle", "savePhotomaps", "propertyInfo", "solarPanels", "dataLayers", "overlays"],
    a.init = function(b, c) {
        t.gMapObj = b,
        v.init();
        var d, j = a.authorization, n = j.getUserName();
        for (d in a.tools)
            a.tools.hasOwnProperty(d) && (w[d] = a.tools[d]);
        t.$elm = r(".toolbar"),
        t._buildButtons(),
        t.startDefault(),
        j.can(g) || k.init(),
        r(document).on("keydown.toolbar", function(a) {
            27 === a.which && t.startDefault()
        }),
        "backgroundSize" in document.documentElement.style && (r(window).on("resize.toolbar", t._recalculateSize),
        t._recalculateSize());
        var o = r(".toolbarBottom .tool[data-tool=print]");
        j.can("hide_" + f) ? o.remove() : (e.init(),
        e.setAuth(j),
        o.click(function() {
            e.go(b, c, t)
        }),
        o.toggleClass("disallowed", !j.can(f))),
        r(".toolbarBottom .tool[data-tool=help]").click(function() {
            var a = [{
                text: "Show Hidden Tools",
                onClick: function() {
                    t._showHidden()
                }
            }, {
                text: "Support",
                link: m.SUPPORT,
                target: "_blank"
            }];
            t.authorization.can(g) || a.push({
                text: "Tour",
                onClick: function() {
                    k.startTour()
                }
            }),
            a.push({
                text: "Legal",
                link: m.LEGAL,
                target: "_blank"
            }),
            a.push({
                text: "Feedback",
                link: m.FEEDBACK,
                target: "_blank"
            }),
            i.open(this, {
                links: a,
                position: ["right", "bottom"]
            }),
            l.trigger("toolbar.help")
        }),
        r(".profile").click(function() {
            t.authorization.can(h) ? i.open(this, {
                links: [{
                    text: "Log In",
                    link: m.LOGIN
                }, {
                    text: "Sign Up",
                    link: m.SIGN_UP,
                    target: "_blank"
                }, {
                    text: "Home",
                    link: m.US_HOME,
                    target: "_blank"
                }, {
                    text: "Support",
                    link: m.SUPPORT,
                    target: "_blank"
                }, {
                    text: "Contact",
                    link: m.CONTACT,
                    target: "_blank"
                }],
                position: ["bottom", "right"]
            }) : i.open(this, {
                links: [{
                    text: n,
                    "class": "username",
                    title: n
                }, {
                    text: "Account",
                    link: m.ACCOUNT,
                    target: "_blank"
                }, {
                    text: "Usage",
                    link: m.USAGE,
                    target: "_blank"
                }, {
                    text: "Package",
                    link: m.PACKAGE,
                    target: "_blank"
                }, {
                    text: "Support",
                    link: m.SUPPORT,
                    target: "_blank"
                }, {
                    text: "Log Out",
                    link: m.LOGOUT
                }],
                position: ["bottom", "right"]
            })
        }),
        t._restoreHidden(),
        t._cleanupToolbar(),
        t._saveHidden(),
        b.getStreetView().addListener("visible_changed", s(t, t._onStreeViewChange))
    }
    ,
    a.setAuth = function(b) {
        a.authorization = b
    }
    ,
    a._buildButtons = function() {
        if (t._clearButtons(),
        t.forEachTool(function(a, b) {
            if (b = t.getTool(a),
            "divider" === b)
                return t._addDivider();
            for (var c = y.length - 1; c >= 0; c--) {
                var d = y[c];
                if (!(b && d in b))
                    return console.error("Could not initialise tool: missing field " + d + " in tool " + a)
            }
            return "hasAccess" in b && !b.hasAccess() ? void t._addButton(a, !0) : (b.hidden || t._addButton(a),
            t.metrixInitialised || l.setEvent({
                category: l.CATEGORIES.ProductUse,
                action: "Toolbar - " + b.name,
                event: "toolbar." + a,
                showInfo: !0
            }),
            "function" != typeof b.init || b.initialised || (b.init(),
            b.initialised = !0),
            void (b.popup && !b.popupId && (b.popupId = v.add(a))))
        }),
        !t.metrixInitialised)
            for (var a, b = [{
                name: "Print",
                key: "print"
            }, {
                name: "Help",
                key: "help"
            }], c = 0; c < b.length; c++)
                a = b[c],
                l.setEvent({
                    category: l.CATEGORIES.ProductUse,
                    action: "Toolbar - " + a.name,
                    event: "toolbar." + a.key,
                    showInfo: !0
                });
        t.metrixInitialised = !0
    }
    ,
    a._recalculateSize = function(a, b) {
        a && Number(a) || (a = 50),
        b && Number(b) || (b = 25);
        var c = a;
        r(".toolbar, .toolbarBottom").css({
            width: c
        }).find(".tool").css({
            width: c - 10
        }),
        r(".panel-content").css({
            left: c
        });
        var d = r(".toolbarBottom").css({
            height: "auto"
        }).outerHeight();
        if (r(".toolbar").css({
            bottom: d
        }),
        r(".toolbarBottom").css({
            height: d
        }),
        r(".toolbar").height() < r(".toolbar>:last-child").offset().top) {
            var e = a - 5;
            e > b && t._recalculateSize(a - 5)
        }
    }
    ,
    a.addDividerToTools = function() {
        for (var a; !a || "divider-" + a in w; )
            a = 1e17 * Math.random();
        w["divider-" + a] = "divider"
    }
    ,
    a._addDivider = function() {
        var a = r("<div>", {
            "class": "divider"
        });
        t.$elm.append(a)
    }
    ,
    a._addButton = function(a, b) {
        function c() {
            "hasAccess" in d && !d.hasAccess() ? d.$button.hasClass("disallowed") || d.$button.addClass("disallowed") : d.$button.removeClass("disallowed"),
            t.start(a),
            l.trigger("toolbar." + a)
        }
        var d = t.getTool(a);
        d.$button = r("<div>", {
            "class": "tool" + (a === x ? " active" : ""),
            "data-tool": a,
            title: d.name
        }),
        b ? d.$button.addClass("disallowed").on("click.toolbar", c) : d.$button.on("click.toolbar", c),
        d.$button.on("contextmenu.toolbar", function(b) {
            b.preventDefault(),
            i.open(this, {
                links: [{
                    text: "Hide This Tool",
                    onClick: function() {
                        t._hideTool(a)
                    }
                }, {
                    text: "Show Hidden Tools",
                    onClick: function() {
                        t._showHidden()
                    }
                }]
            })
        }),
        t.$elm.append(d.$button)
    }
    ,
    a._clearButtons = function() {
        t.$elm.empty()
    }
    ,
    a._hideTool = function(a) {
        var b = t.getTool(a);
        b && (r(b.$button).remove(),
        b.hidden = !0,
        x === a && t.startDefault(),
        t._cleanupToolbar(),
        t._saveHidden())
    }
    ,
    a._cleanupToolbar = function() {
        var a = !0;
        r(".toolbar>*").each(function() {
            var b = r(this);
            b.is(".divider") ? ((a || b.is(":last-child")) && b.remove(),
            a = !0) : a = !1
        }),
        t._recalculateSize()
    }
    ,
    a._showHidden = function() {
        t.forEachTool(function(a, b) {
            "string" != typeof b && (b.hidden = !!b.hiddenPermanently)
        }),
        t._buildButtons(),
        t._saveHidden()
    }
    ,
    a._saveHidden = function() {
        if (d()) {
            var a = [];
            t.forEachTool(function(b, c) {
                c.hidden && a.push(b)
            });
            try {
                localStorage["toolbar-hidden"] = a.join(",")
            } catch (b) {}
        }
    }
    ,
    a._restoreHidden = function() {
        if (d() && "toolbar-hidden" in localStorage)
            for (var a = localStorage["toolbar-hidden"] || "", b = a.split(","), c = 0; c < b.length; c++) {
                var e = b[c];
                t._hideTool(e)
            }
    }
    ,
    a._displayDisallowedPopup = function(a) {
        var b = a ? a.name : "This feature"
          , c = m.SIGN_UP
          , d = q.getText("upsell-message", {
            toolName: b,
            signupUrl: c
        });
        j.fire(d, {
            modal: !0,
            duration: !1,
            type: "warning"
        })
    }
    ,
    a.start = function(a) {
        var b = "foo"
          , d = t.getTool(a)
          , e = t.getTool(x);
        if (a !== x) {
            if (d.hasAccess && !d.hasAccess())
                return t._displayDisallowedPopup(d);
            if (c(b) && -1 !== t.toolsSubjectToStateChange.indexOf(a))
                return j.fire(n.TEXTS.ToolUnavailableMapType, {
                    modal: !1,
                    duration: 2e3,
                    type: "warning"
                });
            if (e) {
                try {
                    e.stop()
                } catch (f) {}
                try {
                    "popup" in e && "popupId" in e && v.close(e.popupId)
                } catch (f) {}
                e.$button.removeClass("active")
            }
            if (d.start(),
            "popup" in d && "popupId" in d)
                try {
                    v.open(d.popupId)
                } catch (f) {}
            d.$button.addClass("active"),
            x = a
        }
    }
    ,
    a.stop = function(a) {
        return a && a !== x ? !1 : void t.startDefault()
    }
    ,
    a.getActive = function() {
        return x
    }
    ,
    a.getDefault = function() {
        var a = null 
          , b = null ;
        return t.forEachTool(function(c, d) {
            a || d.hidden || (a = c),
            b || !d.isDefault || d.hidden || (b = c)
        }),
        b ? b : a
    }
    ,
    a.startDefault = function() {
        t.start(t.getDefault())
    }
    ,
    a.forEachTool = function(a) {
        if ("function" != typeof a)
            return !1;
        for (var b in w)
            if (w.hasOwnProperty(b)) {
                var c = w[b];
                a.call(c, b, c)
            }
    }
    ,
    a.getToolKey = function(a) {
        for (var b in w)
            if (w.hasOwnProperty(b) && w[b] === a)
                return b;
        return null 
    }
    ,
    a.getTool = function(a) {
        return w[a]
    }
    ,
    a._onStreeViewChange = function() {
        var a = t.gMapObj;
        a.streetView.getVisible() ? (t.$elm.hide(),
        r(".toolbarBottom").hide()) : (t.$elm.show(),
        r(".toolbarBottom").show())
    }
    ,
    a.remove = function() {
        t.forEachTool(t.stop),
        t._clearButtons(),
        r(".toolbarBottom").empty()
    }
}),
nm_module("nm/tools/datalayers/hotzones", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Change")
      , g = b("jscore/functools", "bind")
      , h = b("jscore/functools", "partial")
      , i = b("jscore/itertools", "map")
      , j = b("jscore/itertools", "array")
      , k = b("jscore/strings", "format")
      , l = b("jscore/async", "callWhenIdle")
      , m = b("jscore/itertools", "find")
      , n = b("nm/const", "HOST_URL")
      , o = b("js-libs/geojson", "GeoJSON")
      , p = b("js-libs/jquery", "jQuery")
      , q = b("gooscr/notify", "fire")
      , r = (a.isHotSpottable = function(a) {
        if ("choropleth" !== a.LayerType)
            return !1;
        var b = a.Fields || []
          , c = m(b, !1, function(a) {
            return "num" === a.DataType
        });
        return Boolean(c)
    }
    ,
    a.HotzonesManager = c(e, {
        constructor: function(a) {
            r.base.call(this),
            this.auth = a,
            this.filters = []
        },
        addFilter: function(a) {
            this.filters.push(a),
            this.changed()
        },
        clear: function() {
            this.filters = [],
            this.changed()
        },
        getConditions: function() {
            var a = i(this.filters, function(a) {
                var b = {}
                  , c = a.relations || [];
                return c.forEach(function(a) {
                    b[a.key] = a.value
                }),
                {
                    op: a.op,
                    values: a.values,
                    name: a.name,
                    relationKeys: b,
                    field: a.field,
                    zoom: a.zoom
                }
            });
            return j(a)
        },
        getFilters: function() {
            return this.filters
        },
        removeFilter: function(a) {
            var b = this.filters
              , c = b.indexOf(a);
            c >= 0 && (b.splice(c, 1),
            this.changed())
        }
    }));
    a.HotzonesLayer = c(Object, {
        constructor: function(a, b, c) {
            this.auth = a,
            this.hotzonesManager = b,
            this.gMap = c,
            this.polygons = [],
            this.currentRequestId = 0,
            this.updateWhenIdle = l(g(this, this.update), 200),
            b.addListener(f, g(this, this.update))
        },
        clear: function() {
            for (var a = this.polygons; a.length; ) {
                var b = a.pop();
                b.setMap(null )
            }
        },
        update: function() {
            this.currentRequestId = null ;
            var a = this.hotzonesManager.getConditions();
            if (a.length < 1)
                return void this.clear();
            var b = this.gMap
              , c = b.getBounds()
              , d = b.getZoom()
              , e = n + "maps?nml=overlay&nmprovider=geojson&cmd=conditions&z=" + d + "&bbox=" + c.getSouthWest().lng() + "," + c.getSouthWest().lat() + "," + c.getNorthEast().lng() + "," + c.getNorthEast().lat()
              , f = {
                conditions: a
            };
            f = JSON.stringify(f),
            this.currentRequestId += 1;
            var i = h(g(this, this.handleData), this.currentRequestId);
            p.ajax({
                url: e,
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: f,
                success: i,
                error: function(a) {
                    var b = a.responseJSON || {};
                    "ConditionOutsideZoomThreshold" === b.code && q(b.message, {
                        type: "error"
                    })
                }
            })
        },
        handleData: function(a, b) {
            if (this.currentRequestId === a) {
                this.clear();
                var c = this.gMap;
                this.mapListenersRegistered || (this.mapListenersRegistered = !0,
                c.addListener("zoom_changed", this.updateWhenIdle),
                c.addListener("center_changed", this.updateWhenIdle));
                for (var d = {
                    strokeColor: "#FF7800",
                    strokeOpacity: 1,
                    strokeWeight: 2,
                    fillColor: "#46461F",
                    fillOpacity: .5
                }, e = this.polygons, f = new o(b,d), g = 0, h = f.length; h > g; g++)
                    for (var i = f[g], j = 0, k = i.length; k > j; j++) {
                        var l = i[j];
                        e.push(l),
                        l.setOptions({
                            clickable: !1
                        }),
                        l.setMap(c)
                    }
            }
        }
    }),
    a.HotzonesView = c(Object, {
        constructor: function(a, b) {
            this.hotzonesManager = a,
            this.container = b;
            var c = '<div>   <div class="help-text">       Your HotSpot filters are empty.<br/>       Go to the Layers tab, select a layer and add a HotSpot       filter.<br/>       Once added they will be listed here.<br/>       <br/>   </div>   <ul  class="hotzone-filters"></ul></div><div style="text-align:right">   <button class="btn-clear-hotzone button">       Clear HotSpot Filters   </button></div>';
            b.append(p(c)),
            b.find(".btn-clear-hotzone").click(function() {
                a.clear()
            }),
            a.addListener(f, g(this, this.update))
        },
        update: function() {
            var a = this.container
              , b = a.find(".help-text")
              , c = a.find(".hotzone-filters")
              , d = this.hotzonesManager
              , e = d.getFilters();
            e.length ? (b.hide(),
            c.show()) : (c.hide(),
            b.show()),
            c.empty();
            var f = {
                lt: "&lt;",
                gt: "&gt;",
                range: "-"
            };
            e.forEach(function(a) {
                var b = f[a.op]
                  , e = a.values[0]
                  , g = a.values[1];
                "range" !== a.op && (g = e,
                e = "");
                var h = k("{} ({}) {} {} {}", a.label, a.fieldDescription, e, b, g)
                  , l = j(i(a.relations, function(a) {
                    return a.label + ": " + a.value
                }));
                l = l.length ? "(" + l.join(", ") + ")" : "";
                var m = p('<li class="hotzone-filter">   <div class="del-hotzone-filter" title=       "Remove this filter" />   <div class="hotzone-label">' + h + '</div>   <div class="hotzone-modifiers">' + l + "</div></li>");
                m.find(".del-hotzone-filter").click(function() {
                    d.removeFilter(a)
                }),
                c.append(m)
            })
        }
    })
}),
nm_module("nm/tools/flooding/disclaimer", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/events", "ObservableObject")
      , g = b("nm/ui/wizzard", "startWizzard")
      , h = [{
        title: "Flooding Disclaimer",
        content: "<p>We strongly recommend reading the help file for this tool before use. nearmap provides this flood information as a general reference source only – it is not intended as a flood risk assessment and should not be relied upon as such. The flood information provided has not been prepared by taking into account your specific circumstances and/or purpose and may depend on statistical models and assumptions which may be incomplete or wrong, negatively impacting the accuracy of the flood information.  Before relying on any flood information, you should independently verify its accuracy, currency, completeness and relevance, and obtain any appropriate professional advice relevant to your particular circumstances and purpose.<br><br>The flood information provided is current as at the publication date only and, as a Product under the nearmap Agreement, is subject to the limitations of liability and other terms set out in the nearmap Agreement.</p>"
    }]
      , i = a.Disclaimer = c(f, {
        constructor: function() {
            i.base.call(this)
        },
        show: function() {
            g(h, e(this, function() {
                this.handleClose()
            }))
        },
        handleClose: function() {
            this.changed()
        }
    })
}),
nm_module("nm/tools/flooding/floodtmp", function(a, b, c, d) {
    a.html = '<div class="flooding-tab">\n	<ul><li>\n		<div class="prop-row">\n			<label>\n				Water <span>(above sea level)</span>\n			</label>\n			<div class="threshold" />\n		</div>\n		<div class="prop-row">\n			<label class="water-level">Color</label>\n			<label class="lbl-gradient">\n			<input type="checkbox" class="gradient" checked />\n				depth shading\n			</label>\n			<span>\n				<span class="cbox blue grad selected" data-color="b"/>\n				<span class="cbox green grad" data-color="g"/>\n				<span class="cbox red grad" data-color="r"/>\n				<span class="cbox yellow grad" data-color="y"/>\n				<span class="cbox earth grad" data-color="e"/>\n			</span>\n		</div>\n		<div class="prop-row">\n			<label>Transparency</label>\n			<span class="noUiSlider trans-slider" />\n		</div>\n		<div class="prop-row">\n			<label class="visibility-ctrl">\n				<input type="checkbox" class="visibility-toggle" />\n					Show Flooding\n			</label>\n			<a class="disclaimer">Disclaimer</a>\n		</div>\n		<div class="date-unavailable">\n			Data unavailable, please select another date.\n		</div>\n	</li></ul>\n</div>'
}),
nm_module("nm/tools/flooding/floodpanel", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/itertools", "find")
      , g = b("jscore/itertools", "some")
      , h = b("jscore/async", "callWhenIdle")
      , i = b("jscore/events", "Change")
      , j = b("nm/metrics", "trigger")
      , k = b("nm/layers/floodlayer", "FloodLayer")
      , l = b("nm/const/imagery", "DSM")
      , m = b("jscore/dateutils", "isEqualDateTime")
      , n = b("nm/tools/flooding/disclaimer", "Disclaimer")
      , o = b("nm/client", "hasSupportForTypedArrays")
      , p = b("nm/tools/volume/unitsinputview", "UnitsInputView")
      , q = b("js-libs/jquery", "jQuery")
      , r = b("nm/tools/flooding/floodtmp", "html")
      , s = {
        r: [255, 0, 0],
        g: [0, 255, 0],
        b: [0, 0, 255],
        y: [255, 255, 0],
        e: [163, 129, 110]
    }
      , t = {
        m: 1,
        ft: 3.2808399,
        yd: 1.0936133
    }
      , u = '<div class="flooding-tab">  Your browser is not supported. Please use another browser.<br></div>'
      , v = {
        range: [0, 100],
        start: 70,
        step: 1,
        handles: 1
    }
      , w = a.FloodPanel = c(Object, {
        constructor: function(a, b, c, d, e) {
            w.base.call(this),
            this.auth = a,
            this.layersCtrl = d.getLayersCtrl(),
            this.surveysController = b,
            this.surveyInfo = c,
            this.map = d,
            this.gMap = d.tmpGoogleMapViewController.gMap,
            this.container = e,
            this.buildUI(),
            this.registerListeners()
        },
        buildUI: function() {
            var a, b = this.container;
            return o() ? (a = q(r),
            this.$popup = a,
            this.$visibilityCtrl = a.find(".visibility-ctrl"),
            this.$visibilityCtrl.hide(),
            this.$visibilityToggle = a.find(".visibility-toggle"),
            this.$transSlider = a.find(".trans-slider").noUiSlider(v),
            this.thresholdInput = new p(t,a.find(".threshold"),null ),
            this.$grad = a.find("input.gradient"),
            this.$colorBoxes = a.find(".cbox"),
            this.$dateUnavailable = a.find(".date-unavailable"),
            this.$disclaimer = a.find(".disclaimer"),
            void b.append(a)) : (a = q(u),
            b.append(a),
            void (this.$popup = null ))
        },
        registerListeners: function() {
            var a = this.$popup;
            if (null  !== a) {
                var b = e(this, this.update)
                  , c = h(b, 100);
                this.$transSlider.change(function() {
                    b()
                }),
                this.thresholdInput.addListener(i, function() {
                    c()
                }),
                this.$visibilityToggle.change(e(this, this.onVisibilityToggle));
                var d = this.$colorBoxes;
                d.click(function(c) {
                    var d = c.target;
                    a.find(".cbox").removeClass("selected"),
                    q(d).addClass("selected"),
                    b()
                });
                var f = this.$grad;
                f.click(function() {
                    f.prop("checked") ? d.addClass("grad") : d.removeClass("grad"),
                    b()
                }),
                this.$disclaimer.click(e(this, this.showDisclaimer)),
                this.surveysController.addListener(i, e(this, c)),
                this.layersCtrl.addListener(i, e(this, this.onLayerCtrlChange))
            }
        },
        showDisclaimer: function() {
            var a = new n;
            a.show()
        },
        update: function() {
            var a = this.surveyInfo
              , b = a.getDates(l)
              , c = this.surveysController.getDesiredDate()
              , d = b.length > 0;
            if (c && d) {
                var g = f(b, null , function(a) {
                    return c > a || m(a, c, !0)
                });
                d = null  !== g
            }
            var h = this.$dateUnavailable;
            d ? h.hide() : h.show();
            var n = 2.56 * this.$transSlider.val()
              , o = this.thresholdInput.getValue()
              , p = this.$popup.find(".cbox.selected");
            p = p.data("color"),
            p = s[p];
            var q = this.$grad.prop("checked")
              , r = {
                thres: o,
                transp: n,
                color: p,
                grad: q
            };
            if (o) {
                var t = this.layer;
                t || (t = new k("Flooding"),
                t.addListener(i, e(this, this.onLayerChange)),
                this.layersCtrl.addLayer(t),
                this.$visibilityCtrl.show(),
                this.layer = t),
                t.update(r);
                var u = this.map
                  , v = u.getCenter()
                  , w = u.getZoom();
                j("flooding.layer.params_changed", {
                    label: "parameters",
                    description: "flooding layer parameters",
                    value: JSON.stringify({
                        threshold: o,
                        date: c,
                        transparency: n,
                        color: p,
                        gradient: q,
                        center: v,
                        zoom: w
                    })
                })
            }
        },
        reset: function() {
            this.thresholdInput.setValue(""),
            this.$transSlider.val(v.start),
            this.$grad.prop("checked", !0);
            var a = this.$colorBoxes;
            a.removeClass("selected"),
            a[0].classList.add("selected"),
            this.$visibilityCtrl.hide()
        },
        onVisibilityToggle: function() {
            var a = this.layer
              , b = !a.getVisible();
            a.setVisible(b)
        },
        onLayerChange: function() {
            var a = this.layer
              , b = a.getVisible();
            this.$visibilityToggle.prop("checked", b)
        },
        onLayerCtrlChange: function(a) {
            var b = this.layer
              , c = this.surveysController
              , d = a.properties.deleted;
            if (d) {
                var e = g(d, function(a) {
                    return a === b
                }
                .bind(this));
                e && (this.reset(),
                c.removeListeners(this),
                b.removeListeners(this),
                this.layer = null )
            }
        }
    })
}),
nm_module("nm/tools/shadowing/shadowtmp", function(a, b, c, d) {
    a.html = '<ul>\n	<li>\n		<div class="prop-row">\n			<label>Date</label>\n			<input type="text" maxlength="2" size="1" class="input-value shadow-day" placeholder="dd" /> / \n			<input type="text" maxlength="2" size="1" class="input-value shadow-month" placeholder="mm" /> / \n			<input type="text" maxlength="4" size="2" class="input-value shadow-year" placeholder="yyyy" />\n		</div>\n		<div class="prop-row">\n			<label>Time</label>\n			<input type="text" maxlength="2" size="1" class="input-value shadow-hours" placeholder="hh" /> :\n			<input type="text" maxlength="2" size="1" class="input-value shadow-minutes" placeholder="mm" />\n		</div>\n		<div class="prop-row">\n			<label class="water-level">Color</label>\n		   <span>\n				<span class="cbox dark selected" data-color="d"/>\n				<span class="cbox blue" data-color="b"/>\n				<span class="cbox green" data-color="g"/>\n				<span class="cbox red" data-color="r"/>\n				<span class="cbox yellow" data-color="y"/>\n		   </span>\n		</div>\n	   <div class="prop-row">\n			<div class="set-btn button">Set</div>\n		</div>\n		<div class="prop-row">\n			<label class="visibility-ctrl">\n				<input type="checkbox" class="visibility-toggle" />\n					Show Shadowing\n			</label>\n		</div>\n		<div class="status-box"></div>\n	</li>\n</ul>'
}),
nm_module("nm/tools/shadowing/shadowpanel", function(a, b, c, d) {
    function e(a) {
        return a >= 10 ? a : "0" + a
    }
    var f = b("nm/client", "hasSupportForTypedArrays")
      , g = b("nm/layers/shadowlayer", "ShadowLayer")
      , h = b("nm/tools/shadowing/shadowtmp", "html")
      , i = b("jscore/functools", "bind")
      , j = b("jscore/itertools", "some")
      , k = b("nm/geom", "LatLng")
      , l = b("jscore/dateutils", "isEqualDateTime")
      , m = b("jscore/events", "Change")
      , n = b("jscore/async", "callWhenIdle")
      , o = b("nm/dataproviders/timestamp", "TimestampProvider")
      , p = b("nm/metrics", "trigger")
      , q = b("js-libs/jquery", "jQuery")
      , r = b("nm/const/tools", "VIEW_SHADOWING_OBJECTS")
      , s = "<div>Your browser is not supported. Please use another browser.<br></div>"
      , t = {
        d: [0, 0, 0],
        r: [255, 0, 0],
        g: [0, 255, 0],
        b: [0, 0, 255],
        y: [255, 255, 0]
    }
      , u = a.ShadowPanel = c(Object, {
        constructor: function(a, b, c, d) {
            u.base.call(this),
            this.map = c,
            this.layersCtrl = c.getLayersCtrl(),
            this.auth = a,
            this.surveysController = b,
            this.container = d,
            this.tsProvider = new o(c,null ,b),
            this.buildUI(),
            this.registerListeners()
        },
        buildUI: function() {
            var a, b = this.container;
            return f() ? (a = q(h),
            this.$popup = a,
            this.$visibilityCtrl = a.find(".visibility-ctrl"),
            this.$visibilityCtrl.hide(),
            this.$visibilityToggle = a.find(".visibility-toggle"),
            this.$setBtn = a.find(".set-btn"),
            this.$inputValues = a.find(".input-value"),
            this.$statusBox = a.find(".status-box"),
            this.$year = a.find(".shadow-year"),
            this.$month = a.find(".shadow-month"),
            this.$day = a.find(".shadow-day"),
            this.$hours = a.find(".shadow-hours"),
            this.$minutes = a.find(".shadow-minutes"),
            this.setTodayDate(),
            void b.append(a)) : (a = q(s),
            b.append(a),
            void (this.$popup = null ))
        },
        registerListeners: function() {
            var a = this.$popup;
            if (null  !== a) {
                this.$setBtn.click(i(this, this.update)),
                this.$visibilityToggle.change(i(this, this.onVisibilityToggle)),
                this.$inputValues.focus(function(a) {
                    var b = q(a.target);
                    b.select()
                }
                .bind(this)).mouseup(function(a) {
                    a.preventDefault()
                }
                .bind(this)).keydown(function(a) {
                    13 === a.keyCode && this.update()
                }
                .bind(this));
                var b = a.find(".cbox");
                b.click(function(b) {
                    var c = b.target;
                    a.find(".cbox").removeClass("selected"),
                    q(c).addClass("selected"),
                    this.update()
                }
                .bind(this)),
                this.$colorBoxes = b,
                this.layersCtrl.addListener(m, i(this, this.onLayerCtrlChange))
            }
        },
        registerMapListeners: function() {
            var a = i(this, this.requestTimestamp)
              , b = n(a, 1e3);
            this.surveysController.addListener(m, b),
            this.tsProvider.addListener(m, i(this, this.onTimestampChange)),
            this.tsProvider.setEnabled(!0)
        },
        unregisterMapListeners: function() {
            this.surveysController.removeListeners(this),
            this.tsProvider.destroy(),
            this.tsProvider.removeListeners(this)
        },
        update: function() {
            this.tzOffset ? this.updateLayer() : (this.registerMapListeners(),
            this.requestTimestamp())
        },
        updateLayer: function() {
            var a = this.surveysController
              , b = this.getPanelDate()
              , c = Date.UTC(b.year, b.month, b.day, b.hours, b.minutes)
              , d = new Date(c)
              , e = d - this.tzOffset
              , f = a.getDisplayDate();
            if (e && f) {
                var h = this.layer;
                if (!h) {
                    var j = this.auth
                      , k = j.can(r);
                    h = new g("Shadowing",!0,k),
                    h.addListener(m, i(this, this.onLayerChange)),
                    this.layersCtrl.addLayer(h),
                    this.$visibilityCtrl.show(),
                    this.layer = h
                }
                var l = this.$popup.find(".cbox.selected");
                l = l.data("color"),
                l = t[l];
                var n = {
                    simDate: e,
                    surveyDate: f,
                    color: l
                };
                h.update(n);
                var o = this.map
                  , q = o.getCenter()
                  , s = o.getZoom();
                p("shadowing.layer.params_changed", {
                    label: "parameters",
                    description: "shadowing layer parameters",
                    value: JSON.stringify({
                        date: d,
                        center: q,
                        zoom: s
                    })
                })
            }
        },
        requestTimestamp: function() {
            var a = this.map
              , b = a.getCenter()
              , c = new k(b.lat,b.lng);
            this.tsProvider.setCoordinates(c)
        },
        setTodayDate: function() {
            var a = new Date
              , b = a.getFullYear()
              , c = a.getMonth()
              , d = a.getDate()
              , e = a.getHours()
              , f = a.getMinutes();
            this.setPanelDate(b, c, d, e, f)
        },
        getPanelDate: function() {
            return {
                year: this.$year.val(),
                month: this.$month.val() - 1,
                day: this.$day.val(),
                hours: this.$hours.val(),
                minutes: this.$minutes.val()
            }
        },
        setPanelDate: function(a, b, c, d, f) {
            this.$year.val(a),
            this.$month.val(e(b + 1)),
            this.$day.val(e(c)),
            this.$hours.val(e(d)),
            this.$minutes.val(e(f))
        },
        reset: function() {
            this.setTodayDate();
            var a = this.$colorBoxes;
            a.removeClass("selected"),
            a[0].classList.add("selected"),
            this.$visibilityCtrl.hide()
        },
        onTimestampChange: function() {
            var a = this.tsProvider
              , b = a.getTimeZoneOffset() || null 
              , c = a.getValue() || null ;
            if (c && b) {
                var d = this.surveysController.getDisplayDate();
                this.tzOffset = b;
                var e = !l(d, this.lastSurveyDate);
                if (this.lastSurveyDate && e) {
                    var f = new Date(c.getTime() + b)
                      , g = f.getUTCFullYear()
                      , h = f.getUTCMonth()
                      , i = f.getUTCDate()
                      , j = f.getUTCHours()
                      , k = f.getUTCMinutes();
                    this.setPanelDate(g, h, i, j, k)
                }
                this.updateLayer(),
                this.lastSurveyDate = d
            }
        },
        onVisibilityToggle: function() {
            var a = this.layer
              , b = !a.getVisible();
            b ? this.registerMapListeners() : this.unregisterMapListeners(),
            a.setVisible(b)
        },
        onLayerChange: function() {
            var a = this.layer
              , b = a.getVisible();
            this.$visibilityToggle.prop("checked", b)
        },
        onLayerCtrlChange: function(a) {
            var b = this.layer
              , c = a.properties.deleted;
            if (c) {
                var d = j(c, function(a) {
                    return a === b
                }
                .bind(this));
                d && (this.reset(),
                this.unregisterMapListeners(),
                b.removeListeners(this),
                this.layer = null )
            }
        }
    })
}),
nm_module("gooscr/overlays/layerState", function(a, b) {
    "use strict";
    function c(a) {
        m[a.Name] || (delete o[a.Name],
        n[a.Name] = a)
    }
    function d(a, b) {
        delete n[a.Name],
        delete o[a.Name],
        m[a.Name] = a,
        b && (p[a.Name] = b)
    }
    function e(a) {
        delete o[a.Name],
        delete n[a.Name],
        delete m[a.Name],
        delete p[a.Name]
    }
    function f() {
        return l.isEmptyObject(m)
    }
    function g() {
        return l.extend({}, m)
    }
    function h() {
        return l.extend({}, n)
    }
    function i(a) {
        return !!m[a.Name]
    }
    function j(a) {
        return !!n[a.Name]
    }
    function k(a) {
        return p[a.Name]
    }
    var l = b("js-libs/jquery").jQuery
      , m = {}
      , n = {}
      , o = {}
      , p = {};
    a.isEmpty = f,
    a.getCurrent = g,
    a.isCurrent = i,
    a.isAdded = j,
    a.addNow = d,
    a.addLater = c,
    a.removeNow = e,
    a.getAdded = h,
    a.getCurrentGeoJson = k
}),
nm_module("gooscr/overlays/styles", function(a, b) {
    "use strict";
    function c(a) {
        return {
            strokeColor: a.DefaultStrokeColor,
            strokeOpacity: 1,
            strokeWeight: 1,
            fillColor: a.DefaultFillColor,
            fillOpacity: .75
        }
    }
    function d(a, b, c) {
        if (b && c.properties && c.properties.styleSets) {
            var d = c.properties.styleSets[b.Name];
            if (d && c.properties.styleSetDetails)
                return c.properties.styleSetDetails[d];
            if (d && a.StyleSets)
                return a.StyleSets[d]
        }
        return null 
    }
    function e(a, b, c, d) {
        if (!a || !a.geojsonProperties || !b)
            return null ;
        switch (b) {
        case "hide":
            return {
                visible: !1
            };
        case "highlight":
            return {
                strokeColor: "#111111",
                zIndex: c.Zindex + 1,
                strokeWeight: 2,
                visible: !0
            };
        case "orange":
            return {
                strokeColor: "#FF7800",
                zIndex: c.Zindex + 2,
                strokeWeight: 2,
                visible: !0
            };
        default:
            var e = g(c, d, a.geojsonProperties);
            return {
                strokeColor: e ? e : c.DefaultStrokeColor,
                zIndex: c.Zindex,
                strokeWeight: 1,
                visible: !0
            }
        }
    }
    function f(a, b) {
        return a && b.fields ? b.fields[a.Name] : null 
    }
    function g(a, b, c) {
        var d = f(b, c);
        if (d) {
            if (d.colors) {
                var e = a.ActiveColorIndex || 0;
                return d.colors[e]
            }
            return d.color
        }
        return null 
    }
    function h(a, b) {
        var c = f(a, b);
        return c ? c.style : null 
    }
    function i(a, b) {
        var c = f(a, b);
        return c ? c.val : null 
    }
    function j(a, b, c) {
        if (s(a.Opacity))
            return null ;
        if (!b || "choropleth" !== a.LayerType)
            return a.Opacity / 100;
        var d = g(a, b, c);
        return d ? a.Opacity / 100 : null 
    }
    function k(a) {
        return a.Description && "" !== a.Description ? a.Description : a.Name
    }
    function l(a) {
        var b = null ;
        return a.ActiveField ? b = a.ActiveField : a.Fields && a.Fields.length > 0 && (b = a.Fields[0]),
        b
    }
    function m(a, b) {
        if (a && a.Fields)
            for (var c = 0; c < a.Fields.length; c++)
                if (a.Fields[c].Name === b)
                    return a.ActiveField = a.Fields[c],
                    a.Fields[c];
        return null 
    }
    function n(a) {
        return a.ActiveGeomType
    }
    function o(a) {
        a.CompareQueryPart = ""
    }
    function p(a, b, c) {
        var d = "";
        if (b && c)
            for (var e = 0; e < b.length; e++)
                d += r.format("&cmp-rel{0}={1}&cmp-key{2}={3}", e, encodeURIComponent(b[e]), e, encodeURIComponent(c[e]));
        a.CompareQueryPart = d
    }
    function q(a) {
        return a && a.CompareQueryPart ? a.CompareQueryPart : ""
    }
    var r = b("jscore/strings")
      , s = b("jscore/types").isUndefinedOrNull;
    a.getCurrentStyleSet = d,
    a.getDefaultStyle = c,
    a.getOptions = e,
    a.getFieldColor = g,
    a.getFieldStyleName = h,
    a.getFieldValue = i,
    a.getFeatureOpacity = j,
    a.getTitle = k,
    a.getActiveField = l,
    a.setActiveField = m,
    a.getActiveGeomType = n,
    a.clearComparisonKeys = o,
    a.setComparisonKeys = p,
    a.getComparisonQueryPart = q
}),
nm_module("gooscr/overlays/layerFeatures", function(a, b) {
    "use strict";
    function c(a) {
        return a.geojsonProperties && a.geojsonProperties.id ? a.geojsonProperties.id.toString() : k
    }
    function d(a) {
        for (var b in a)
            if (a.hasOwnProperty(b))
                return !1;
        return !0
    }
    function e() {
        this.dict = {}
    }
    function f() {
        this.type = "Success",
        this.message = "",
        this.mapObjs = null ,
        this.labelObjs = null ,
        this.markerObjs = null 
    }
    function g(a) {
        if (a)
            for (var b in a)
                a.hasOwnProperty(b) && (this[b] = a[b])
    }
    var h = b("gooscr/overlays/styles")
      , i = b("js-libs/jquery").jQuery
      , j = b("jscore/types").isUndefinedOrNull
      , k = "_other"
      , l = "_default_field_name_key";
    e.prototype = {
        _getLayerName: function(a) {
            return "string" == typeof a ? a : a.Name
        },
        _getFieldName: function(a) {
            return j(a) ? l : "string" == typeof a ? a : a.Name
        },
        getFeaturesByLayerFields: function(a) {
            var b = this._getLayerName(a);
            return b && this.dict[b] ? this.dict[b] : {}
        },
        getLayerFeatures: function(a, b) {
            var c = this._getFieldName(b)
              , d = this.getFeaturesByLayerFields(a)
              , e = d[c];
            return e ? e : null 
        },
        hasLayerFeatures: function(a, b) {
            return b ? null  !== this.getLayerFeatures(a, b) : this.getAllLayerFeaturesForLayer(a).length > 0
        },
        addLayerFeatures: function(a, b, c) {
            var d = this._getLayerName(a)
              , e = this._getFieldName(b);
            this.dict[d] || (this.dict[d] = {}),
            this.dict[d][e] = c
        },
        getAllLayerFeaturesForLayer: function(a) {
            var b = []
              , c = this.getFeaturesByLayerFields(a);
            for (var d in c)
                c.hasOwnProperty(d) && b.push(c[d]);
            return b
        },
        removeLayerFeatures: function(a, b) {
            var c = this._getFieldName(b)
              , d = this.getFeaturesByLayerFields(a);
            d && delete d[c]
        },
        removeAllFeaturesForLayer: function(a) {
            var b = this._getLayerName(a);
            b && delete this.dict[b]
        }
    },
    f.prototype = {
        hasFeatureObjs: function() {
            return this.hasMapObjs() || this.hasLabelObjs() || this.hasMarkerObjs()
        },
        hasMapObjs: function() {
            return this.mapObjs && !d(this.mapObjs)
        },
        hasLabelObjs: function() {
            return this.labelObjs && !d(this.labelObjs)
        },
        hasMarkerObjs: function() {
            return this.markerObjs && !d(this.markerObjs)
        },
        addMapObj: function(a) {
            a && (this.mapObjs || (this.mapObjs = new g),
            this.mapObjs.add(a))
        },
        addLabelObj: function(a) {
            this.labelObjs || (this.labelObjs = new g),
            this.labelObjs.add(a)
        },
        addMarkerObj: function(a) {
            this.markerObjs || (this.markerObjs = new g),
            this.markerObjs.add(a)
        },
        difference: function(a) {
            if (!a)
                return this;
            var b = new f;
            return b.mapObjs = this.mapObjs && a.mapObjs ? this.mapObjs.difference(a.mapObjs) : this.mapObjs,
            b.labelObjs = this.labelObjs && a.labelObjs ? this.labelObjs.difference(a.labelObjs) : this.labelObjs,
            b.markerObjs = this.markerObjs && a.markerObjs ? this.markerObjs.difference(a.markerObjs) : this.markerObjs,
            b
        },
        concat: function(a) {
            var b = new f;
            return a ? (b.mapObjs = this.mapObjs ? this.mapObjs.concat(a.mapObjs) : a.mapObjs ? a.mapObjs.concat() : null ,
            b.labelObjs = this.labelObjs ? this.labelObjs.concat(a.labelObjs) : a.labelObjs ? a.labelObjs.concat() : null ,
            b.markerObjs = this.markerObjs ? this.markerObjs.concat(a.markerObjs) : a.markerObjs ? a.markerObjs.concat() : null ,
            b) : (b.mapObjs = this.mapObjs ? this.mapObjs.concat() : null ,
            b.labelObjs = this.labelObjs ? this.labelObjs.concat() : null ,
            b.markerObjs = this.markerObjs ? this.markerObjs.concat() : null ,
            b)
        },
        getBuckets: function(a) {
            var b = {};
            return a && this.mapObjs ? (this.mapObjs.each(function(c) {
                var d = h.getFieldStyleName(a, c.geojsonProperties);
                d && (b[d] || (b[d] = []),
                b[d].push(c))
            }),
            b) : b
        },
        setOpacity: function(a) {
            this.mapObjs && this.mapObjs.each(function(b) {
                b.disableOpacity || b.setOptions({
                    fillOpacity: a
                })
            })
        },
        setMouseInteraction: function(a) {
            this.mapObjs && this.mapObjs.each(function(b) {
                b.setOptions({
                    clickable: a
                })
            })
        },
        debugStr: function() {
            return "mapObjs: " + (this.mapObjs ? this.mapObjs.debugStr() : "null") + ", labelObjs: " + (this.labelObjs ? this.labelObjs.debugStr() : "null") + ", markerObjs: " + (this.markerObjs ? this.markerObjs.debugStr() : "null")
        }
    },
    g.prototype = {
        each: function(a) {
            for (var b in this)
                if (this.hasOwnProperty(b)) {
                    var c = this[b];
                    if (i.isArray(c))
                        for (var d = 0; d < c.length; d++)
                            a(c[d]);
                    else
                        a(c)
                }
        },
        toArray: function() {
            var a = [];
            for (var b in this)
                this.hasOwnProperty(b) && a.push(this[b]);
            return a
        },
        add: function(a) {
            if (i.isArray(a))
                for (var b = 0; b < a.length; b++)
                    this.add(a[b]);
            else {
                var d = c(a);
                if (this.hasOwnProperty(d)) {
                    var e = this[d];
                    i.isArray(e) ? e.push(a) : this[d] = [e, a]
                } else
                    this[d] = a
            }
        },
        difference: function(a) {
            if (!a)
                return new g(this);
            var b = new g;
            for (var c in this)
                this.hasOwnProperty(c) && !a.hasOwnProperty(c) && (b[c] = this[c]);
            return b
        },
        concat: function(a) {
            var b = new g(this);
            if (!a)
                return b;
            for (var c in a)
                if (a.hasOwnProperty(c))
                    if (b.hasOwnProperty(c)) {
                        var d = b[c]
                          , e = a[c];
                        i.isArray(d) || (d = [d]),
                        b[c] = d.concat(e)
                    } else
                        b[c] = a[c];
            return b
        },
        debugStr: function() {
            var a = ""
              , b = "";
            for (var c in this)
                if (this.hasOwnProperty(c)) {
                    var d = this[c];
                    a += b + this.debugFeatureStr(d),
                    b = ","
                }
            return a
        },
        debugFeatureStr: function(a) {
            var b = "";
            if (i.isArray(a)) {
                b += "[";
                for (var c = "", d = 0; d < a.length; d++)
                    b += c + this.debugFeatureStr(a[d]),
                    c = ",";
                b += "]"
            } else
                b = "(" + a.geojsonProperties.id + ":" + a.geojsonProperties.name + ")";
            return b
        }
    },
    a.LayerFeaturesDict = e,
    a.LayerFeatures = f
}),
nm_module("js-libs/markerclusterer", function(a, b, c, d) {
    function e(a, b) {
        a.getMarkerClusterer().extend(e, h.OverlayView),
        this.cluster_ = a,
        this.className_ = a.getMarkerClusterer().getClusterClass(),
        this.styles_ = b,
        this.center_ = null ,
        this.div_ = null ,
        this.sums_ = null ,
        this.visible_ = !1,
        this.setMap(a.getMap())
    }
    function f(a) {
        this.markerClusterer_ = a,
        this.map_ = a.getMap(),
        this.gridSize_ = a.getGridSize(),
        this.minClusterSize_ = a.getMinimumClusterSize(),
        this.averageCenter_ = a.getAverageCenter(),
        this.markers_ = [],
        this.center_ = null ,
        this.bounds_ = null ,
        this.clusterIcon_ = new e(this,a.getStyles())
    }
    function g(a, b, c) {
        this.extend(g, h.OverlayView),
        b = b || [],
        c = c || {},
        this.markers_ = [],
        this.clusters_ = [],
        this.listeners_ = [],
        this.activeMap_ = null ,
        this.ready_ = !1,
        this.gridSize_ = c.gridSize || 60,
        this.minClusterSize_ = c.minimumClusterSize || 2,
        this.maxZoom_ = c.maxZoom || null ,
        this.styles_ = c.styles || [],
        this.title_ = c.title || "",
        this.zoomOnClick_ = !0,
        void 0 !== c.zoomOnClick && (this.zoomOnClick_ = c.zoomOnClick),
        this.averageCenter_ = !1,
        void 0 !== c.averageCenter && (this.averageCenter_ = c.averageCenter),
        this.ignoreHidden_ = !1,
        void 0 !== c.ignoreHidden && (this.ignoreHidden_ = c.ignoreHidden),
        this.enableRetinaIcons_ = !1,
        void 0 !== c.enableRetinaIcons && (this.enableRetinaIcons_ = c.enableRetinaIcons),
        this.imagePath_ = c.imagePath || g.IMAGE_PATH,
        this.imageExtension_ = c.imageExtension || g.IMAGE_EXTENSION,
        this.imageSizes_ = c.imageSizes || g.IMAGE_SIZES,
        this.calculator_ = c.calculator || g.CALCULATOR,
        this.batchSize_ = c.batchSize || g.BATCH_SIZE,
        this.batchSizeIE_ = c.batchSizeIE || g.BATCH_SIZE_IE,
        this.clusterClass_ = c.clusterClass || "cluster",
        -1 !== navigator.userAgent.toLowerCase().indexOf("msie") && (this.batchSize_ = this.batchSizeIE_),
        this.setupStyles_(),
        this.addMarkers(b, !0),
        this.setMap(a)
    }
    var h = b("./google", "maps");
    e.prototype.onAdd = function() {
        var a, b, c = this;
        this.div_ = document.createElement("div"),
        this.div_.className = this.className_,
        this.visible_ && this.show(),
        this.getPanes().overlayMouseTarget.appendChild(this.div_),
        this.boundsChangedListener_ = h.event.addListener(this.getMap(), "bounds_changed", function() {
            b = a
        }),
        h.event.addDomListener(this.div_, "mousedown", function() {
            a = !0,
            b = !1
        }),
        h.event.addDomListener(this.div_, "click", function(d) {
            if (a = !1,
            !b) {
                var e, f, g = c.cluster_.getMarkerClusterer();
                h.event.trigger(g, "click", c.cluster_),
                h.event.trigger(g, "clusterclick", c.cluster_),
                g.getZoomOnClick() && (f = g.getMaxZoom(),
                e = c.cluster_.getBounds(),
                g.getMap().fitBounds(e),
                setTimeout(function() {
                    g.getMap().fitBounds(e),
                    null  !== f && g.getMap().getZoom() > f && g.getMap().setZoom(f + 1)
                }, 100)),
                d.cancelBubble = !0,
                d.stopPropagation && d.stopPropagation()
            }
        }),
        h.event.addDomListener(this.div_, "mouseover", function() {
            var a = c.cluster_.getMarkerClusterer();
            h.event.trigger(a, "mouseover", c.cluster_)
        }),
        h.event.addDomListener(this.div_, "mouseout", function() {
            var a = c.cluster_.getMarkerClusterer();
            h.event.trigger(a, "mouseout", c.cluster_)
        })
    }
    ,
    e.prototype.onRemove = function() {
        this.div_ && this.div_.parentNode && (this.hide(),
        h.event.removeListener(this.boundsChangedListener_),
        h.event.clearInstanceListeners(this.div_),
        this.div_.parentNode.removeChild(this.div_),
        this.div_ = null )
    }
    ,
    e.prototype.draw = function() {
        if (this.visible_) {
            var a = this.getPosFromLatLng_(this.center_);
            this.div_.style.top = a.y + "px",
            this.div_.style.left = a.x + "px"
        }
    }
    ,
    e.prototype.hide = function() {
        this.div_ && (this.div_.style.display = "none"),
        this.visible_ = !1
    }
    ,
    e.prototype.show = function() {
        if (this.div_) {
            var a = ""
              , b = this.backgroundPosition_.split(" ")
              , c = parseInt(b[0].replace(/^\s+|\s+$/g, ""), 10)
              , d = parseInt(b[1].replace(/^\s+|\s+$/g, ""), 10)
              , e = this.getPosFromLatLng_(this.center_);
            this.div_.style.cssText = this.createCss(e),
            a = "<img src='" + this.url_ + "' style='position: absolute; top: " + d + "px; left: " + c + "px; ",
            this.cluster_.getMarkerClusterer().enableRetinaIcons_ || (a += "clip: rect(" + -1 * d + "px, " + (-1 * c + this.width_) + "px, " + (-1 * d + this.height_) + "px, " + -1 * c + "px);"),
            a += "'>",
            this.div_.innerHTML = a + "<div style='position: absolute;top: " + this.anchorText_[0] + "px;left: " + this.anchorText_[1] + "px;color: " + this.textColor_ + ";font-size: " + this.textSize_ + "px;font-family: " + this.fontFamily_ + ";font-weight: " + this.fontWeight_ + ";font-style: " + this.fontStyle_ + ";text-decoration: " + this.textDecoration_ + ";text-align: center;width: " + this.width_ + "px;line-height:" + this.height_ + "px;'>" + this.sums_.text + "</div>",
            "undefined" == typeof this.sums_.title || "" === this.sums_.title ? this.div_.title = this.cluster_.getMarkerClusterer().getTitle() : this.div_.title = this.sums_.title,
            this.div_.style.display = ""
        }
        this.visible_ = !0
    }
    ,
    e.prototype.useStyle = function(a) {
        this.sums_ = a;
        var b = Math.max(0, a.index - 1);
        b = Math.min(this.styles_.length - 1, b);
        var c = this.styles_[b];
        this.url_ = c.url,
        this.height_ = c.height,
        this.width_ = c.width,
        this.anchorText_ = c.anchorText || [0, 0],
        this.anchorIcon_ = c.anchorIcon || [parseInt(this.height_ / 2, 10), parseInt(this.width_ / 2, 10)],
        this.textColor_ = c.textColor || "black",
        this.textSize_ = c.textSize || 11,
        this.textDecoration_ = c.textDecoration || "none",
        this.fontWeight_ = c.fontWeight || "bold",
        this.fontStyle_ = c.fontStyle || "normal",
        this.fontFamily_ = c.fontFamily || "Arial,sans-serif",
        this.backgroundPosition_ = c.backgroundPosition || "0 0"
    }
    ,
    e.prototype.setCenter = function(a) {
        this.center_ = a
    }
    ,
    e.prototype.createCss = function(a) {
        var b = [];
        return b.push("cursor: pointer;"),
        b.push("position: absolute; top: " + a.y + "px; left: " + a.x + "px;"),
        b.push("width: " + this.width_ + "px; height: " + this.height_ + "px;"),
        b.join("")
    }
    ,
    e.prototype.getPosFromLatLng_ = function(a) {
        var b = this.getProjection().fromLatLngToDivPixel(a);
        return b.x -= this.anchorIcon_[1],
        b.y -= this.anchorIcon_[0],
        b.x = parseInt(b.x, 10),
        b.y = parseInt(b.y, 10),
        b
    }
    ,
    f.prototype.getSize = function() {
        return this.markers_.length
    }
    ,
    f.prototype.getMarkers = function() {
        return this.markers_
    }
    ,
    f.prototype.getCenter = function() {
        return this.center_
    }
    ,
    f.prototype.getMap = function() {
        return this.map_
    }
    ,
    f.prototype.getMarkerClusterer = function() {
        return this.markerClusterer_
    }
    ,
    f.prototype.getBounds = function() {
        var a, b = new h.LatLngBounds(this.center_,this.center_), c = this.getMarkers();
        for (a = 0; a < c.length; a++)
            b.extend(c[a].getPosition());
        return b
    }
    ,
    f.prototype.remove = function() {
        this.clusterIcon_.setMap(null ),
        this.markers_ = [],
        delete this.markers_
    }
    ,
    f.prototype.addMarker = function(a) {
        var b, c, d;
        if (this.isMarkerAlreadyAdded_(a))
            return !1;
        if (this.center_) {
            if (this.averageCenter_) {
                var e = this.markers_.length + 1
                  , f = (this.center_.lat() * (e - 1) + a.getPosition().lat()) / e
                  , g = (this.center_.lng() * (e - 1) + a.getPosition().lng()) / e;
                this.center_ = new h.LatLng(f,g),
                this.calculateBounds_()
            }
        } else
            this.center_ = a.getPosition(),
            this.calculateBounds_();
        if (a.isAdded = !0,
        this.markers_.push(a),
        c = this.markers_.length,
        d = this.markerClusterer_.getMaxZoom(),
        null  !== d && this.map_.getZoom() > d)
            a.getMap() !== this.map_ && a.setMap(this.map_);
        else if (c < this.minClusterSize_)
            a.getMap() !== this.map_ && a.setMap(this.map_);
        else if (c === this.minClusterSize_)
            for (b = 0; c > b; b++)
                this.markers_[b].setMap(null );
        else
            a.setMap(null );
        return this.updateIcon_(),
        !0
    }
    ,
    f.prototype.isMarkerInClusterBounds = function(a) {
        return this.bounds_.contains(a.getPosition())
    }
    ,
    f.prototype.calculateBounds_ = function() {
        var a = new h.LatLngBounds(this.center_,this.center_);
        this.bounds_ = this.markerClusterer_.getExtendedBounds(a)
    }
    ,
    f.prototype.updateIcon_ = function() {
        var a = this.markers_.length
          , b = this.markerClusterer_.getMaxZoom();
        if (null  !== b && this.map_.getZoom() > b)
            return void this.clusterIcon_.hide();
        if (a < this.minClusterSize_)
            return void this.clusterIcon_.hide();
        var c = this.markerClusterer_.getStyles().length
          , d = this.markerClusterer_.getCalculator()(this.markers_, c);
        this.clusterIcon_.setCenter(this.center_),
        this.clusterIcon_.useStyle(d),
        this.clusterIcon_.show()
    }
    ,
    f.prototype.isMarkerAlreadyAdded_ = function(a) {
        var b;
        if (this.markers_.indexOf)
            return -1 !== this.markers_.indexOf(a);
        for (b = 0; b < this.markers_.length; b++)
            if (a === this.markers_[b])
                return !0;
        return !1
    }
    ,
    g.prototype.onAdd = function() {
        var a = this;
        this.activeMap_ = this.getMap(),
        this.ready_ = !0,
        this.repaint(),
        this.listeners_ = [h.event.addListener(this.getMap(), "zoom_changed", function() {
            a.resetViewport_(!1),
            this.getZoom() !== (this.get("minZoom") || 0) && this.getZoom() !== this.get("maxZoom") || h.event.trigger(this, "idle")
        }), h.event.addListener(this.getMap(), "idle", function() {
            a.redraw_()
        })]
    }
    ,
    g.prototype.onRemove = function() {
        var a;
        for (a = 0; a < this.markers_.length; a++)
            this.markers_[a].getMap() !== this.activeMap_ && this.markers_[a].setMap(this.activeMap_);
        for (a = 0; a < this.clusters_.length; a++)
            this.clusters_[a].remove();
        for (this.clusters_ = [],
        a = 0; a < this.listeners_.length; a++)
            h.event.removeListener(this.listeners_[a]);
        this.listeners_ = [],
        this.activeMap_ = null ,
        this.ready_ = !1
    }
    ,
    g.prototype.draw = function() {}
    ,
    g.prototype.setupStyles_ = function() {
        var a, b;
        if (!(this.styles_.length > 0))
            for (a = 0; a < this.imageSizes_.length; a++)
                b = this.imageSizes_[a],
                this.styles_.push({
                    url: this.imagePath_ + (a + 1) + "." + this.imageExtension_,
                    height: b,
                    width: b
                })
    }
    ,
    g.prototype.fitMapToMarkers = function() {
        var a, b = this.getMarkers(), c = new h.LatLngBounds;
        for (a = 0; a < b.length; a++)
            c.extend(b[a].getPosition());
        this.getMap().fitBounds(c)
    }
    ,
    g.prototype.getGridSize = function() {
        return this.gridSize_
    }
    ,
    g.prototype.setGridSize = function(a) {
        this.gridSize_ = a
    }
    ,
    g.prototype.getMinimumClusterSize = function() {
        return this.minClusterSize_
    }
    ,
    g.prototype.setMinimumClusterSize = function(a) {
        this.minClusterSize_ = a
    }
    ,
    g.prototype.getMaxZoom = function() {
        return this.maxZoom_
    }
    ,
    g.prototype.setMaxZoom = function(a) {
        this.maxZoom_ = a
    }
    ,
    g.prototype.getStyles = function() {
        return this.styles_
    }
    ,
    g.prototype.setStyles = function(a) {
        this.styles_ = a
    }
    ,
    g.prototype.getTitle = function() {
        return this.title_
    }
    ,
    g.prototype.setTitle = function(a) {
        this.title_ = a
    }
    ,
    g.prototype.getZoomOnClick = function() {
        return this.zoomOnClick_
    }
    ,
    g.prototype.setZoomOnClick = function(a) {
        this.zoomOnClick_ = a
    }
    ,
    g.prototype.getAverageCenter = function() {
        return this.averageCenter_
    }
    ,
    g.prototype.setAverageCenter = function(a) {
        this.averageCenter_ = a
    }
    ,
    g.prototype.getIgnoreHidden = function() {
        return this.ignoreHidden_
    }
    ,
    g.prototype.setIgnoreHidden = function(a) {
        this.ignoreHidden_ = a
    }
    ,
    g.prototype.getEnableRetinaIcons = function() {
        return this.enableRetinaIcons_
    }
    ,
    g.prototype.setEnableRetinaIcons = function(a) {
        this.enableRetinaIcons_ = a
    }
    ,
    g.prototype.getImageExtension = function() {
        return this.imageExtension_
    }
    ,
    g.prototype.setImageExtension = function(a) {
        this.imageExtension_ = a
    }
    ,
    g.prototype.getImagePath = function() {
        return this.imagePath_
    }
    ,
    g.prototype.setImagePath = function(a) {
        this.imagePath_ = a
    }
    ,
    g.prototype.getImageSizes = function() {
        return this.imageSizes_
    }
    ,
    g.prototype.setImageSizes = function(a) {
        this.imageSizes_ = a
    }
    ,
    g.prototype.getCalculator = function() {
        return this.calculator_
    }
    ,
    g.prototype.setCalculator = function(a) {
        this.calculator_ = a
    }
    ,
    g.prototype.getBatchSizeIE = function() {
        return this.batchSizeIE_
    }
    ,
    g.prototype.setBatchSizeIE = function(a) {
        this.batchSizeIE_ = a
    }
    ,
    g.prototype.getClusterClass = function() {
        return this.clusterClass_
    }
    ,
    g.prototype.setClusterClass = function(a) {
        this.clusterClass_ = a
    }
    ,
    g.prototype.getMarkers = function() {
        return this.markers_
    }
    ,
    g.prototype.getTotalMarkers = function() {
        return this.markers_.length
    }
    ,
    g.prototype.getClusters = function() {
        return this.clusters_
    }
    ,
    g.prototype.getTotalClusters = function() {
        return this.clusters_.length
    }
    ,
    g.prototype.addMarker = function(a, b) {
        this.pushMarkerTo_(a),
        b || this.redraw_()
    }
    ,
    g.prototype.addMarkers = function(a, b) {
        var c;
        for (c in a)
            a.hasOwnProperty(c) && this.pushMarkerTo_(a[c]);
        b || this.redraw_()
    }
    ,
    g.prototype.pushMarkerTo_ = function(a) {
        if (a.getDraggable()) {
            var b = this;
            h.event.addListener(a, "dragend", function() {
                b.ready_ && (this.isAdded = !1,
                b.repaint())
            })
        }
        a.isAdded = !1,
        this.markers_.push(a)
    }
    ,
    g.prototype.removeMarker = function(a, b) {
        var c = this.removeMarker_(a);
        return !b && c && this.repaint(),
        c
    }
    ,
    g.prototype.removeMarkers = function(a, b) {
        var c, d, e = !1;
        for (c = 0; c < a.length; c++)
            d = this.removeMarker_(a[c]),
            e = e || d;
        return !b && e && this.repaint(),
        e
    }
    ,
    g.prototype.removeMarker_ = function(a) {
        var b, c = -1;
        if (this.markers_.indexOf)
            c = this.markers_.indexOf(a);
        else
            for (b = 0; b < this.markers_.length; b++)
                if (a === this.markers_[b]) {
                    c = b;
                    break
                }
        return -1 === c ? !1 : (a.setMap(null ),
        this.markers_.splice(c, 1),
        !0)
    }
    ,
    g.prototype.clearMarkers = function() {
        this.resetViewport_(!0),
        this.markers_ = []
    }
    ,
    g.prototype.repaint = function() {
        var a = this.clusters_.slice();
        this.clusters_ = [],
        this.resetViewport_(!1),
        this.redraw_(),
        setTimeout(function() {
            var b;
            for (b = 0; b < a.length; b++)
                a[b].remove()
        }, 0)
    }
    ,
    g.prototype.getExtendedBounds = function(a) {
        var b = this.getProjection()
          , c = new h.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng())
          , d = new h.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng())
          , e = b.fromLatLngToDivPixel(c);
        e.x += this.gridSize_,
        e.y -= this.gridSize_;
        var f = b.fromLatLngToDivPixel(d);
        f.x -= this.gridSize_,
        f.y += this.gridSize_;
        var g = b.fromDivPixelToLatLng(e)
          , i = b.fromDivPixelToLatLng(f);
        return a.extend(g),
        a.extend(i),
        a
    }
    ,
    g.prototype.redraw_ = function() {
        this.createClusters_(0)
    }
    ,
    g.prototype.resetViewport_ = function(a) {
        var b, c;
        for (b = 0; b < this.clusters_.length; b++)
            this.clusters_[b].remove();
        for (this.clusters_ = [],
        b = 0; b < this.markers_.length; b++)
            c = this.markers_[b],
            c.isAdded = !1,
            a && c.setMap(null )
    }
    ,
    g.prototype.distanceBetweenPoints_ = function(a, b) {
        var c = 6371
          , d = (b.lat() - a.lat()) * Math.PI / 180
          , e = (b.lng() - a.lng()) * Math.PI / 180
          , f = Math.sin(d / 2) * Math.sin(d / 2) + Math.cos(a.lat() * Math.PI / 180) * Math.cos(b.lat() * Math.PI / 180) * Math.sin(e / 2) * Math.sin(e / 2)
          , g = 2 * Math.atan2(Math.sqrt(f), Math.sqrt(1 - f))
          , h = c * g;
        return h
    }
    ,
    g.prototype.isMarkerInBounds_ = function(a, b) {
        return b.contains(a.getPosition())
    }
    ,
    g.prototype.addToClosestCluster_ = function(a) {
        var b, c, d, e, g = 4e4, h = null ;
        for (b = 0; b < this.clusters_.length; b++)
            d = this.clusters_[b],
            e = d.getCenter(),
            e && (c = this.distanceBetweenPoints_(e, a.getPosition()),
            g > c && (g = c,
            h = d));
        h && h.isMarkerInClusterBounds(a) ? h.addMarker(a) : (d = new f(this),
        d.addMarker(a),
        this.clusters_.push(d))
    }
    ,
    g.prototype.createClusters_ = function(a) {
        var b, c, d, e = this;
        if (this.ready_) {
            0 === a && (h.event.trigger(this, "clusteringbegin", this),
            "undefined" != typeof this.timerRefStatic && (clearTimeout(this.timerRefStatic),
            delete this.timerRefStatic)),
            d = this.getMap().getZoom() > 3 ? new h.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()) : new h.LatLngBounds(new h.LatLng(85.02070771743472,-178.48388434375),new h.LatLng(-85.08136444384544,178.00048865625));
            var f = this.getExtendedBounds(d)
              , g = Math.min(a + this.batchSize_, this.markers_.length);
            for (b = a; g > b; b++)
                c = this.markers_[b],
                !c.isAdded && this.isMarkerInBounds_(c, f) && (!this.ignoreHidden_ || this.ignoreHidden_ && c.getVisible()) && this.addToClosestCluster_(c);
            g < this.markers_.length ? this.timerRefStatic = setTimeout(function() {
                e.createClusters_(g)
            }, 0) : (delete this.timerRefStatic,
            h.event.trigger(this, "clusteringend", this))
        }
    }
    ,
    g.prototype.extend = function(a, b) {
        return function(a) {
            var b;
            for (b in a.prototype)
                this.prototype[b] = a.prototype[b];
            return this
        }
        .apply(a, [b])
    }
    ,
    g.CALCULATOR = function(a, b) {
        for (var c = 0, d = "", e = a.length.toString(), f = e; 0 !== f; )
            f = parseInt(f / 10, 10),
            c++;
        return c = Math.min(c, b),
        {
            text: e,
            index: c,
            title: d
        }
    }
    ,
    g.BATCH_SIZE = 2e3,
    g.BATCH_SIZE_IE = 500,
    g.IMAGE_PATH = "http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m",
    g.IMAGE_EXTENSION = "png",
    g.IMAGE_SIZES = [53, 56, 66, 78, 90],
    a.MarkerClusterer = g
}),
nm_module("gooscr/overlays/icons", function(a, b) {
    "use strict";
    function c() {}
    function d(a) {
        var b = f[a];
        return b ? {
            url: e + "img/overlays/" + b + ".png"
        } : null 
    }
    var e = b("nm/const").STATIC_ASSETS_URL
      , f = {
        toilets: "toilets",
        traffic_signals: "trafficlight",
        bicycle_parking: "parking_bicycle-2",
        bus_stop: "busstop",
        crossing: "junction",
        parking: "parkinggarage",
        cafe: "coffee",
        restaurant: "restaurant",
        pub: "bar",
        fast_food: "fastfood",
        post_box: "postal",
        post_office: "postal",
        fuel: "fillingstation",
        telephone: "telephone",
        school: "school",
        bank: "bank",
        viewpoint: "binoculars",
        pharmacy: "drugstore",
        information: "information",
        atm: "atm-2",
        drinking_water: "drinkingfountain",
        taxi: "taxi",
        station: "train"
    };
    a.init = c,
    a.getIcon = d
}),
nm_module("gooscr/overlays/marker", function(a, b) {
    "use strict";
    var c = b("js-libs/markerclusterer").MarkerClusterer
      , d = b("js-libs/jquery").jQuery
      , e = b("gooscr/overlays/icons")
      , f = b("nm/const")
      , g = b("js-libs/google").maps;
    a.NewMarker = function(a) {
        function b(a, b) {
            var e = 0
              , f = !0;
            if (d.each(a, function(a, b) {
                return b.geojsonProperties && b.geojsonProperties.count ? void (e += b.geojsonProperties.count) : void (f = !1)
            }),
            !f)
                return c.CALCULATOR(a, b);
            for (var g = 0, h = "", i = e; 0 !== i; )
                i = parseInt(i / 10, 10),
                g++;
            return g = Math.min(g, b),
            {
                text: e,
                index: g,
                title: h
            }
        }
        function h(a, b) {
            if (a && b && b.properties) {
                b.properties.type || (b.properties.type = "");
                var c, d = b.properties.type.replace("_", " ").replace(/(?:^|\s)\w/g, function(a) {
                    return a.toUpperCase()
                }), g = b.properties.name;
                if (g) {
                    var h = g.toLowerCase()
                      , i = d.toLowerCase();
                    c = "Cafe" === d && h.indexOf("café") || h.indexOf(i) >= 0 ? g : d + ": " + g
                } else
                    c = d;
                a.setTitle(c);
                var j = e.getIcon(b.properties.type);
                return j || (j = f.STATIC_ASSETS_URL + "img/blue-dot.png"),
                a.setIcon(j),
                a
            }
        }
        function i(a, b) {
            if (!a || !b || !b.properties)
                return null ;
            if (!b.properties.count || b.properties.count <= 1)
                return null ;
            var c = new g.Marker({
                position: a.getPosition()
            });
            return c.set("geojsonProperties", b.properties),
            c.geojsonProperties.id = -b.properties.id,
            c
        }
        function j(a, b) {
            return l.addMarkers(a, b)
        }
        function k(a, b) {
            var c = a.toArray();
            return l.removeMarkers(c, b)
        }
        var l = new c(a.mapObj);
        return l.setCalculator(b),
        {
            markerHelper: h,
            zeroMarkerHelper: i,
            markerClusterLabelCalculator: b,
            addMarkers: j,
            removeMarkers: k
        }
    }
}),
nm_module("gooscr/overlays/buckets", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("gooscr/overlays/styles");
    a.NewBuckets = function(a) {
        function b(b, c, e) {
            var f = a.getLayerFeatures(b, c);
            if (f)
                return f.highlightBuckets = f.highlightBuckets || {},
                f.highlightBuckets[e] = !0,
                i(f, e, function(a, e) {
                    e.setOptions(d.getOptions(e, "highlight", b, c))
                })
        }
        function e(b, c, e) {
            var f = a.getLayerFeatures(b, c);
            if (f)
                return f.highlightBuckets && delete f.highlightBuckets[e],
                i(f, e, function(a, e) {
                    e.setOptions(d.getOptions(e, "normal", b, c))
                })
        }
        function f(b, c, e) {
            var f = a.getLayerFeatures(b, c);
            if (f)
                return f.hiddenBuckets = f.hiddenBuckets || {},
                f.hiddenBuckets[e] = !0,
                i(f, e, function(a, e) {
                    e.setOptions(d.getOptions(e, "hide", b, c))
                })
        }
        function g(c, e, f) {
            var g = a.getLayerFeatures(c, e);
            if (g)
                return g.hiddenBuckets && delete g.hiddenBuckets[f],
                g.highlightBuckets && g.highlightBuckets[f] ? b(c, e, f) : i(g, f, function(a, b) {
                    b.setOptions(d.getOptions(b, "normal", c, e))
                })
        }
        function h(b, c, d) {
            var e = a.getLayerFeatures(b, c);
            if (e && e.hiddenBuckets)
                return e.hiddenBuckets[d]
        }
        function i(a, b, d) {
            a && a.buckets && b && a.buckets[b] && c.each(a.buckets[b], d)
        }
        return {
            highlightBucket: b,
            removeBucketHighlight: e,
            hideBucket: f,
            unhideBucket: g,
            isBucketHidden: h
        }
    }
}),
eval(function(a, b, c, d, e, f) {
    if (e = function(a) {
        return (b > a ? "" : e(parseInt(a / b))) + ((a %= b) > 35 ? String.fromCharCode(a + 29) : a.toString(36))
    }
    ,
    !"".replace(/^/, String)) {
        for (; c--; )
            f[e(c)] = d[c] || e(c);
        d = [function(a) {
            return f[a]
        }
        ],
        e = function() {
            return "\\w+"
        }
        ,
        c = 1
    }
    for (; c--; )
        d[c] && (a = a.replace(new RegExp("\\b" + e(c) + "\\b","g"), d[c]));
    return a
}('7 p(a){a=a||{};5.8.1N.2h(2,32);2.L=a.1u||"";2.1D=a.1q||H;2.P=a.1H||0;2.E=a.1B||1f 5.8.1U(0,0);2.B=a.W||1f 5.8.2t(0,0);2.S=a.11||q;2.1n=a.1l||"28";2.1k=a.D||{};2.1G=a.1E||"34";2.M=a.19||"2W://2Q.5.2L/2I/2G/2F/1v.2z";3(a.19===""){2.M=""}2.1i=a.1r||1f 5.8.1U(1,1);2.Y=a.1s||H;2.1a=a.1p||H;2.1K=a.2k||"2g";2.17=a.1m||H;2.4=q;2.w=q;2.X=q;2.16=q;2.15=q;2.13=q;2.12=q;2.O=q}p.r=1f 5.8.1N();p.r.22=7(){6 a;6 d=2;6 c=7(e){e.1Z=U;3(e.18){e.18()}};6 b=7(e){e.2S=H;3(e.1Y){e.1Y()}3(!d.17){c(e)}};3(!2.4){2.4=1g.2K("2J");2.1d();3(t 2.L.1w==="u"){2.4.J=2.F()+2.L}v{2.4.J=2.F();2.4.1b(2.L)}2.2y()[2.1K].1b(2.4);2.1F();3(2.4.9.A){2.O=U}v{3(2.P!==0&&2.4.Z>2.P){2.4.9.A=2.P;2.4.9.2u="2s";2.O=U}v{a=2.24();2.4.9.A=(2.4.Z-a.14-a.T)+"R";2.O=H}}2.1t(2.1D);3(!2.17){2.X=5.8.s.I(2.4,"2n",c);2.16=5.8.s.I(2.4,"1L",c);2.15=5.8.s.I(2.4,"2m",c);2.1o=5.8.s.I(2.4,"2l",7(e){2.9.1J="2j"})}2.12=5.8.s.I(2.4,"2i",b);5.8.s.Q(2,"2f")}};p.r.F=7(){6 a="";3(2.M!==""){a="<2e";a+=" 2d=\'"+2.M+"\'";a+=" 2c=T";a+=" 9=\'";a+=" W: 2b;";a+=" 1J: 2a;";a+=" 29: "+2.1G+";";a+="\'>"}N a};p.r.1F=7(){6 a;3(2.M!==""){a=2.4.27;2.w=5.8.s.I(a,\'1L\',2.1I())}v{2.w=q}};p.r.1I=7(){6 a=2;N 7(e){e.1Z=U;3(e.18){e.18()}a.1v();5.8.s.Q(a,"26")}};p.r.1t=7(d){6 m;6 n;6 e=0,G=0;3(!d){m=2.25();3(m 39 5.8.38){3(!m.23().37(2.B)){m.36(2.B)}n=m.23();6 a=m.35();6 h=a.Z;6 f=a.21;6 k=2.E.A;6 l=2.E.1j;6 g=2.4.Z;6 b=2.4.21;6 i=2.1i.A;6 j=2.1i.1j;6 o=2.20().31(2.B);3(o.x<(-k+i)){e=o.x+k-i}v 3((o.x+g+k+i)>h){e=o.x+g+k+i-h}3(2.1a){3(o.y<(-l+j+b)){G=o.y+l-j-b}v 3((o.y+l+j)>f){G=o.y+l+j-f}}v{3(o.y<(-l+j)){G=o.y+l-j}v 3((o.y+b+l+j)>f){G=o.y+b+l+j-f}}3(!(e===0&&G===0)){6 c=m.30();m.2Z(e,G)}}}};p.r.1d=7(){6 i,D;3(2.4){2.4.2Y=2.1n;2.4.9.2X="";D=2.1k;2V(i 2U D){3(D.2R(i)){2.4.9[i]=D[i]}}3(t 2.4.9.1h!=="u"&&2.4.9.1h!==""){2.4.9.2P="2O(1h="+(2.4.9.1h*2N)+")"}2.4.9.W="2M";2.4.9.V=\'1y\';3(2.S!==q){2.4.9.11=2.S}}};p.r.24=7(){6 c;6 a={1e:0,1c:0,14:0,T:0};6 b=2.4;3(1g.1x&&1g.1x.1V){c=b.2H.1x.1V(b,"");3(c){a.1e=C(c.1T,10)||0;a.1c=C(c.1S,10)||0;a.14=C(c.1R,10)||0;a.T=C(c.1W,10)||0}}v 3(1g.2E.K){3(b.K){a.1e=C(b.K.1T,10)||0;a.1c=C(b.K.1S,10)||0;a.14=C(b.K.1R,10)||0;a.T=C(b.K.1W,10)||0}}N a};p.r.2D=7(){3(2.4){2.4.2C.2B(2.4);2.4=q}};p.r.1A=7(){2.22();6 a=2.20().2A(2.B);2.4.9.14=(a.x+2.E.A)+"R";3(2.1a){2.4.9.1c=-(a.y+2.E.1j)+"R"}v{2.4.9.1e=(a.y+2.E.1j)+"R"}3(2.Y){2.4.9.V=\'1y\'}v{2.4.9.V="1X"}};p.r.2T=7(a){3(t a.1l!=="u"){2.1n=a.1l;2.1d()}3(t a.D!=="u"){2.1k=a.D;2.1d()}3(t a.1u!=="u"){2.1Q(a.1u)}3(t a.1q!=="u"){2.1D=a.1q}3(t a.1H!=="u"){2.P=a.1H}3(t a.1B!=="u"){2.E=a.1B}3(t a.1p!=="u"){2.1a=a.1p}3(t a.W!=="u"){2.1z(a.W)}3(t a.11!=="u"){2.1P(a.11)}3(t a.1E!=="u"){2.1G=a.1E}3(t a.19!=="u"){2.M=a.19}3(t a.1r!=="u"){2.1i=a.1r}3(t a.1s!=="u"){2.Y=a.1s}3(t a.1m!=="u"){2.17=a.1m}3(2.4){2.1A()}};p.r.1Q=7(a){2.L=a;3(2.4){3(2.w){5.8.s.z(2.w);2.w=q}3(!2.O){2.4.9.A=""}3(t a.1w==="u"){2.4.J=2.F()+a}v{2.4.J=2.F();2.4.1b(a)}3(!2.O){2.4.9.A=2.4.Z+"R";3(t a.1w==="u"){2.4.J=2.F()+a}v{2.4.J=2.F();2.4.1b(a)}}2.1F()}5.8.s.Q(2,"2x")};p.r.1z=7(a){2.B=a;3(2.4){2.1A()}5.8.s.Q(2,"1O")};p.r.1P=7(a){2.S=a;3(2.4){2.4.9.11=a}5.8.s.Q(2,"2w")};p.r.2v=7(){N 2.L};p.r.1C=7(){N 2.B};p.r.33=7(){N 2.S};p.r.2r=7(){2.Y=H;3(2.4){2.4.9.V="1X"}};p.r.2q=7(){2.Y=U;3(2.4){2.4.9.V="1y"}};p.r.2p=7(c,b){6 a=2;3(b){2.B=b.1C();2.13=5.8.s.2o(b,"1O",7(){a.1z(2.1C())})}2.1M(c);3(2.4){2.1t()}};p.r.1v=7(){3(2.w){5.8.s.z(2.w);2.w=q}3(2.X){5.8.s.z(2.X);5.8.s.z(2.16);5.8.s.z(2.15);5.8.s.z(2.1o);2.X=q;2.16=q;2.15=q;2.1o=q}3(2.13){5.8.s.z(2.13);2.13=q}3(2.12){5.8.s.z(2.12);2.12=q}2.1M(q)};', 62, 196, "||this|if|div_|google|var|function|maps|style||||||||||||||||InfoBox|null|prototype|event|typeof|undefined|else|closeListener_|||removeListener|width|position_|parseInt|boxStyle|pixelOffset_|getCloseBoxImg_|yOffset|false|addDomListener|innerHTML|currentStyle|content_|closeBoxURL_|return|fixedWidthSet_|maxWidth_|trigger|px|zIndex_|right|true|visibility|position|eventListener1_|isHidden_|offsetWidth||zIndex|contextListener_|moveListener_|left|eventListener3_|eventListener2_|enableEventPropagation_|stopPropagation|closeBoxURL|alignBottom_|appendChild|bottom|setBoxStyle_|top|new|document|opacity|infoBoxClearance_|height|boxStyle_|boxClass|enableEventPropagation|boxClass_|eventListener4_|alignBottom|disableAutoPan|infoBoxClearance|isHidden|panBox_|content|close|nodeType|defaultView|hidden|setPosition|draw|pixelOffset|getPosition|disableAutoPan_|closeBoxMargin|addClickHandler_|closeBoxMargin_|maxWidth|getCloseClickHandler_|cursor|pane_|click|setMap|OverlayView|position_changed|setZIndex|setContent|borderLeftWidth|borderBottomWidth|borderTopWidth|Size|getComputedStyle|borderRightWidth|visible|preventDefault|cancelBubble|getProjection|offsetHeight|createInfoBoxDiv_|getBounds|getBoxWidths_|getMap|closeclick|firstChild|infoBox|margin|pointer|relative|align|src|img|domready|floatPane|apply|contextmenu|default|pane|mouseover|dblclick|mousedown|addListener|open|hide|show|auto|LatLng|overflow|getContent|zindex_changed|content_changed|getPanes|gif|fromLatLngToDivPixel|removeChild|parentNode|onRemove|documentElement|mapfiles|en_us|ownerDocument|intl|div|createElement|com|absolute|100|alpha|filter|www|hasOwnProperty|returnValue|setOptions|in|for|http|cssText|className|panBy|getCenter|fromLatLngToContainerPixel|arguments|getZIndex|2px|getDiv|setCenter|contains|Map|instanceof".split("|"), 0, {})),
nm_module("gooscr/overlays/labels", function(a, b) {
    "use strict";
    b("js-libs/infobox.js");
    var c = b("gooscr/overlays/styles")
      , d = b("gooscr/toolbar");
    a.NewLabels = function(a) {
        function b(a, b, d, e) {
            if (b && d) {
                var f = e || b.name;
                if (!f || "" === f) {
                    var g = c.getActiveField(a);
                    f = c.getFieldValue(g, b)
                }
                if (f && "" !== f) {
                    var h = new InfoBox({
                        content: f,
                        boxClass: "nm-infobox",
                        disableAutoPan: !0,
                        position: d,
                        closeBoxURL: "",
                        isHidden: !1,
                        enableEventPropagation: !0
                    });
                    return h.set("geojsonProperties", b),
                    h
                }
            }
        }
        function e(a) {
            return a.ShowFeatureNameLabels
        }
        function f(b) {
            if (b.ShowFeatureNameLabels = !1,
            a.hasLayerFeatures(b))
                for (var c = a.getAllLayerFeaturesForLayer(b), d = 0; d < c.length; d++) {
                    var e = c[d];
                    e.hasLabelObjs() && h("setMap").publish({
                        elements: e.labelObjs,
                        hide: !0
                    })
                }
        }
        function g(b) {
            if (b.ShowFeatureNameLabels = !0,
            a.hasLayerFeatures(b)) {
                var c = a.getAllLayerFeaturesForLayer(b);
                if (c.length > 0) {
                    var d = c[0];
                    d.hasLabelObjs() ? h("setMap").publish({
                        elements: d.labelObjs,
                        show: !0
                    }) : h("refreshLayer").publish({
                        layer: b
                    })
                }
            }
        }
        var h = d.events.makeChannel("dataLayers");
        return {
            featureLabeller: b,
            isShowingLabels: e,
            hideLabels: f,
            showLabels: g
        }
    }
}),
nm_module("gooscr/overlays/overlaysGeoJson", function(a, b) {
    "use strict";
    var c = b("js-libs/google").maps
      , d = b("js-libs/geojson").GeoJSON
      , e = b("js-libs/jquery").jQuery
      , f = b("nm/console")
      , g = b("gooscr/toolbar")
      , h = b("gooscr/overlays/styles")
      , i = b("gooscr/overlays/layerFeatures")
      , j = b("gooscr/overlays/marker")
      , k = b("gooscr/overlays/buckets")
      , l = b("gooscr/overlays/labels")
      , m = b("jscore/types").isUndefinedOrNull;
    a.NewGeoJson = function(a) {
        function b(a) {
            D = new i.LayerFeaturesDict,
            E = a.mouseInteractionEnabled,
            C = a.mapObj,
            G = j.NewMarker({
                mapObj: C
            }),
            H = k.NewBuckets(D),
            I = l.NewLabels(D),
            F = g.events.makeChannel("dataLayers"),
            F("setMap").subscribe(function(a) {
                if (a && a.elements) {
                    var b = a.show && !a.hide ? C : null ;
                    B(a.elements, b)
                }
            })
        }
        function n(a, b, d, f, g, i) {
            if (e.isArray(a))
                return void e.each(a, function(a, c) {
                    n(c, b, d, f, g, i)
                });
            if (a instanceof c.Polygon) {
                a.setOptions({
                    clickable: J
                }),
                a.addListener("mouseover", function() {
                    D.hasLayerFeatures(f, g) && this.setOptions(h.getOptions(a, "orange", f, g))
                }),
                a.addListener("mouseout", function() {
                    var b = D.getLayerFeatures(f, g);
                    if (b) {
                        var c = h.getFieldStyleName(g, a.geojsonProperties)
                          , d = "normal";
                        b.hiddenBuckets[c] ? d = "hidden" : b.highlightBuckets[c] && (d = "highlight"),
                        this.setOptions(h.getOptions(a, d, f, g))
                    }
                });
                var j = ["mouseover", "mousemove", "mouseout", "click", "dblclick"];
                e.each(j, function(c, e) {
                    a.addListener(e, function(c) {
                        D.hasLayerFeatures(f, g) && F(e).publish({
                            layer: f,
                            field: g,
                            id: a.geojsonProperties.id,
                            style: a.geojsonProperties.style,
                            featureCollectionProperties: b,
                            featureProperties: d,
                            geomType: i,
                            e: c
                        })
                    })
                })
            }
        }
        function o(a, b, c, e, f) {
            e.error && (e.type = "Error"),
            f || (f = h.getDefaultStyle(a, b));
            var g = new i.LayerFeatures;
            switch (e.type) {
            case "FeatureCollection":
                var j = a.Fields || []
                  , k = null ;
                if (j.length > 0)
                    for (var l = 0; l < j.length; l++) {
                        var m = j[l];
                        if (m.hasOwnProperty("ShowLabels") && null  !== m.ShowLabels) {
                            k = m.Name;
                            break
                        }
                    }
                p(g, a, b, c, e, f, k);
                break;
            case "Error":
                g.type = "Error code " + e.error.code,
                g.message = e.error.message;
                break;
            default:
                g.type = "Unknown",
                g.message = "Untested path - no feature collection",
                g.addMapObj(new d(e,f))
            }
            return g
        }
        function p(a, b, f, g, i, j, k) {
            if (!i.features)
                return a.type = "Error",
                a.message = 'Invalid GeoJSON object: FeatureCollectionobject missing "features" member.',
                a;
            var l = h.getCurrentStyleSet(b, f, i);
            j.highlightColor = l ? l.HlColor : "#00FF00";
            for (var o = 0; o < i.features.length; o++) {
                var p = i.features[o]
                  , q = "label" === b.DataType
                  , r = e.extend({}, j)
                  , s = h.getFieldColor(b, f, p.properties);
                s && (r.fillColor = s,
                r.strokeColor = s);
                var t = h.getFeatureOpacity(b, f, p.properties);
                m(t) ? (r.fillOpacity = 0,
                r.disableOpacity = !0) : r.fillOpacity = t,
                r.zIndex = b.Zindex;
                var v = new d(p,r);
                if ("Error" === v.type) {
                    a.type = v.type,
                    a.message = v.message;
                    break
                }
                if (q || "label" === p.properties.type) {
                    var w = v.getPosition()
                      , x = I.featureLabeller(b, p.properties, w);
                    a.addMapObj(x)
                } else {
                    if (E && n(v, i.properties, p.properties, b, f, g),
                    v instanceof c.Marker) {
                        var y = G.zeroMarkerHelper(v, p);
                        y && a.addMarkerObj(y),
                        a.addMarkerObj(G.markerHelper(v, p))
                    } else
                        a.addMapObj(v);
                    if (b.ShowFeatureNameLabels || b.Fields > 0) {
                        var z = p.properties.centre;
                        if (z && 2 === z.length)
                            z = new c.LatLng(z[1],z[0]);
                        else {
                            var A = u(new c.LatLngBounds, v);
                            z = A.getCenter()
                        }
                        var B = null ;
                        if (k) {
                            var C = p.properties
                              , D = C.fields;
                            D.hasOwnProperty(k) && (B = D[k].val)
                        }
                        (null  === k || k && B) && a.addLabelObj(I.featureLabeller(b, p.properties, z, B))
                    }
                }
            }
            return a
        }
        function q(a, b) {
            var c = a.GeomTypes
              , d = b.properties;
            if (c && c.length > 0 && d)
                for (var e = 0; e < c.length; e++)
                    if (c[e].Name === d.geomType)
                        return a.GeomTypes[e];
            return null 
        }
        function r(a, b) {
            if (!m(b)) {
                var c = D.getFeaturesByLayerFields(a);
                for (var d in c)
                    !c.hasOwnProperty(d) || b && d === b.Name || (z(c[d]),
                    D.removeLayerFeatures(a, d))
            }
        }
        function s(a, b, c) {
            var d = q(a, b);
            a.ActiveGeomType = d;
            var e = h.getActiveField(a);
            r(a, e);
            var f = h.getCurrentStyleSet(a, e, b);
            a.ActiveStyleSet = f;
            var g = D.getLayerFeatures(a, e)
              , i = b.features && b.features.length < 200;
            F("labelsAllowedChanged").publish({
                labelsAllowed: i,
                layer: a
            });
            var j = o(a, e, d, b, c);
            F("layerGeomtriesProcessed").publish({
                layer: a
            });
            var k = !1
              , l = a.currGeomType
              , n = b.properties.geomType;
            a.currGeomType = n,
            m(l) || m(n) || l === n || (k = !0);
            var p = a.currGeomSimpleLevel
              , s = b.properties.simpleGeomLevel;
            a.currGeomSimpleLevel = s,
            m(p) || m(s) || p === s || (k = !0);
            var u = null ;
            k ? u = g : g && (u = g.difference(j)),
            z(u),
            j.hasFeatureObjs() || F("noGeometryData").publish({
                layer: a
            });
            var v = g ? g.difference(u) : null 
              , w = j.difference(v)
              , x = w.concat(v);
            D.addLayerFeatures(a, e, x),
            t(a, e, x, g),
            A(w, C)
        }
        function t(a, b, c, d) {
            c.buckets = c.getBuckets(b),
            c.highlightBuckets = d && d.highlightBuckets || {},
            c.hiddenBuckets = d && d.hiddenBuckets || {},
            e.each(c.highlightBuckets, function(c) {
                H.highlightBucket(a, b, c)
            }),
            e.each(c.hiddenBuckets, function(c) {
                H.hideBucket(a, b, c)
            })
        }
        function u(a, b) {
            return e.isArray(b) ? (e.each(b, function(b, c) {
                a = u(a, c)
            }),
            a) : b instanceof c.Polygon ? v(b, a) : a
        }
        function v(a, b) {
            b || (b = new c.LatLngBounds);
            for (var d, e = a.getPaths(), f = 0; f < e.getLength(); f++) {
                d = e.getAt(f);
                for (var g = 0; g < d.getLength(); g++)
                    b.extend(d.getAt(g))
            }
            return b
        }
        function w(a) {
            for (var b = D.getAllLayerFeaturesForLayer(a), c = 0; c < b.length; c++)
                b[c].setOpacity(a.Opacity / 100)
        }
        function x(a, b) {
            J = b;
            for (var c = D.getAllLayerFeaturesForLayer(a), d = 0; d < c.length; d++) {
                var e = c[d];
                e.setMouseInteraction(b)
            }
        }
        function y(a) {
            for (var b = D.getAllLayerFeaturesForLayer(a), c = 0; c < b.length; c++)
                z(b[c]);
            D.removeAllFeaturesForLayer(a)
        }
        function z(a) {
            a && (B(a.mapObjs, null ),
            B(a.labelObjs, null ),
            a.markerObjs && G.removeMarkers(a.markerObjs))
        }
        function A(a) {
            a && (B(a.mapObjs, C),
            B(a.labelObjs, C),
            a.markerObjs && G.addMarkers(a.markerObjs))
        }
        function B(a, b) {
            a && a.each(function(a) {
                a.message ? f.warn(a.message) : a.setMap(b)
            })
        }
        var C, D, E, F, G, H, I, J = E;
        return b(a),
        {
            processGeoJson: s,
            clear: y,
            changeOpacity: w,
            setMouseInteraction: x,
            isShowingLabels: I.isShowingLabels,
            hideLabels: I.hideLabels,
            showLabels: I.showLabels,
            buckets: H
        }
    }
});
var Mark = {
    includes: {},
    globals: {},
    delimiter: ">",
    compact: !1,
    _copy: function(a, b) {
        b = b || [];
        for (var c in a)
            b[c] = a[c];
        return b
    },
    _size: function(a) {
        return a instanceof Array ? a.length : a || 0
    },
    _iter: function(a, b) {
        this.idx = a,
        this.size = b,
        this.length = b,
        this.sign = "#",
        this.toString = function() {
            return this.idx + this.sign.length - 1
        }
    },
    _pipe: function(a, b) {
        var c, d, e, f;
        if (c = b.shift()) {
            d = c.split(this.delimiter),
            e = d.shift().trim();
            try {
                f = Mark.pipes[e].apply(null , [a].concat(d)),
                a = this._pipe(f, b)
            } catch (g) {}
        }
        return a
    },
    _eval: function(a, b, c) {
        var d, e, f = this._pipe(a, b), g = f, h = -1;
        if (f instanceof Array)
            for (f = "",
            d = g.length; ++h < d; )
                e = {
                    iter: new this._iter(h,d)
                },
                f += c ? Mark.up(c, g[h], e) : g[h];
        else
            f instanceof Object && (f = Mark.up(c, g));
        return f
    },
    _test: function(a, b, c, d) {
        var e = Mark.up(b, c, d).split(/\{\{\s*else\s*\}\}/);
        return (a === !1 ? e[1] : e[0]) || ""
    },
    _bridge: function(a, b) {
        var c, d, e = "{{\\s*" + b + "([^/}]+\\w*)?}}|{{/" + b + "\\s*}}", f = new RegExp(e,"g"), g = a.match(f) || [], h = 0, i = 0, j = -1, k = 0;
        for (d = 0; d < g.length && (c = d,
        j = a.indexOf(g[c], j + 1),
        g[c].indexOf("{{/") > -1 ? i++ : h++,
        h !== i); d++)
            ;
        return h = a.indexOf(g[0]),
        i = h + g[0].length,
        k = j + g[c].length,
        [a.substring(h, k), a.substring(i, j)]
    }
};
Mark.up = function(a, b, c) {
    b = b || {},
    c = c || {};
    var d, e, f, g, h, i, j, k, l, m, n = /\{\{(.+?)\}\}/g, o = a.match(n) || [], p = [], q = 0, r = 0;
    for (c.pipes && this._copy(c.pipes, this.pipes),
    c.includes && this._copy(c.includes, this.includes),
    c.globals && this._copy(c.globals, this.globals),
    c.delimiter && (this.delimiter = c.delimiter),
    void 0 !== c.compact && (this.compact = c.compact); d = o[q++]; )
        if (j = void 0,
        i = "",
        g = d.indexOf("/}}") > -1,
        e = d.substr(2, d.length - (g ? 5 : 4)),
        e = e.replace(/`(.+?)`/g, function(a, c) {
            return Mark.up("{{" + c + "}}", b)
        }),
        h = 0 === e.trim().indexOf("if "),
        p = e.split("|"),
        p.shift(),
        e = e.replace(/^\s*if/, "").split("|").shift().trim(),
        f = h ? "if" : e.split("|")[0],
        m = b[e],
        h && !p.length && (p = ["notempty"]),
        !g && a.indexOf("{{/" + f) > -1 && (j = this._bridge(a, f),
        d = j[0],
        i = j[1],
        q += d.match(n).length - 1),
        !/^\{\{\s*else\s*\}\}$/.test(d)) {
            if (void 0 !== (k = this.globals[e]))
                j = this._eval(k, p, i);
            else if (l = this.includes[e])
                l instanceof Function && (l = l()),
                j = this._pipe(Mark.up(l, b), p);
            else if (e.indexOf("#") > -1)
                c.iter.sign = e,
                j = this._pipe(c.iter, p);
            else if ("." === e)
                j = this._pipe(b, p);
            else if (e.indexOf(".") > -1) {
                for (e = e.split("."),
                m = Mark.globals[e[0]],
                m ? r = 1 : (r = 0,
                m = b); m && r < e.length; )
                    m = m[e[r++]];
                j = this._eval(m, p, i)
            } else
                h ? j = this._pipe(m, p) : m instanceof Array ? j = this._eval(m, p, i) : i ? j = m ? Mark.up(i, m) : void 0 : b.hasOwnProperty(e) && (j = this._pipe(m, p));
            j instanceof Array && (j = this._eval(j, p, i)),
            h && (j = this._test(j, i, b, c)),
            a = a.replace(d, void 0 === j ? "???" : j)
        }
    return this.compact ? a.replace(/>\s+</g, "><") : a
}
,
Mark.pipes = {
    empty: function(a) {
        return a && 0 !== (a + "").trim().length ? !1 : a
    },
    notempty: function(a) {
        return a && (a + "").trim().length ? a : !1
    },
    blank: function(a, b) {
        return a || 0 === a ? a : b
    },
    more: function(a, b) {
        return Mark._size(a) > b ? a : !1
    },
    less: function(a, b) {
        return Mark._size(a) < b ? a : !1
    },
    ormore: function(a, b) {
        return Mark._size(a) >= b ? a : !1
    },
    orless: function(a, b) {
        return Mark._size(a) <= b ? a : !1
    },
    between: function(a, b, c) {
        return a = Mark._size(a),
        a >= b && c >= a ? a : !1
    },
    equals: function(a, b) {
        return a == b ? a : !1
    },
    notequals: function(a, b) {
        return a != b ? a : !1
    },
    like: function(a, b) {
        return new RegExp(b,"i").test(a) ? a : !1
    },
    notlike: function(a, b) {
        return Mark.pipes.like(a, b) ? !1 : a
    },
    upcase: function(a) {
        return String(a).toUpperCase()
    },
    downcase: function(a) {
        return String(a).toLowerCase()
    },
    capcase: function(a) {
        return a.replace(/(?:^|\s)\S/g, function(a) {
            return a.toUpperCase()
        })
    },
    chop: function(a, b) {
        return a.length > b ? a.substr(0, b) + "..." : a
    },
    tease: function(a, b) {
        var c = a.split(/\s+/);
        return c.slice(0, b).join(" ") + (c.length > b ? "..." : "")
    },
    trim: function(a) {
        return a.trim()
    },
    pack: function(a) {
        return a.trim().replace(/\s{2,}/g, " ")
    },
    round: function(a) {
        return Math.round(+a)
    },
    clean: function(a) {
        return String(a).replace(/<\/?[^>]+>/gi, "")
    },
    size: function(a) {
        return a.length
    },
    length: function(a) {
        return a.length
    },
    reverse: function(a) {
        return [].concat(a).reverse()
    },
    join: function(a, b) {
        return a.join(b)
    },
    limit: function(a, b, c) {
        return a.slice(+c || 0, +b + (+c || 0))
    },
    split: function(a, b) {
        return a.split(b || ",")
    },
    choose: function(a, b, c) {
        return a ? b : c || ""
    },
    toggle: function(a, b, c, d) {
        return c.split(",")[b.match(/\w+/g).indexOf(a + "")] || d
    },
    sort: function(a, b) {
        var c = function(a, c) {
            return a[b] > c[b] ? 1 : -1
        }
        ;
        return [].concat(a).sort(b ? c : void 0)
    },
    fix: function(a, b) {
        return (+a).toFixed(b)
    },
    mod: function(a, b) {
        return +a % +b
    },
    divisible: function(a, b) {
        return a && +a % b === 0 ? a : !1
    },
    even: function(a) {
        return a && 0 === (1 & +a) ? a : !1
    },
    odd: function(a) {
        return a && 1 === (1 & +a) ? a : !1
    },
    number: function(a) {
        return parseFloat(a.replace(/[^\-\d\.]/g, ""))
    },
    url: function(a) {
        return encodeURI(a)
    },
    bool: function(a) {
        return !!a
    },
    falsy: function(a) {
        return !a
    },
    first: function(a) {
        return 0 === a.idx
    },
    last: function(a) {
        return a.idx === a.size - 1
    },
    call: function(a, b) {
        return a[b].apply(a, [].slice.call(arguments, 2))
    },
    set: function(a, b) {
        return Mark.globals[b] = a,
        ""
    },
    log: function(a) {
        return console.log(a),
        a
    }
},
"function" != typeof String.prototype.trim && (String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, "")
}
),
Mark.pipes.numberformat = function(a, b, c) {
    var d = (+a).toFixed(b).match(/\d+/g)
      , e = d[0].length % 3
      , f = d[1] ? "." + d[1] : ""
      , g = e ? [d[0].slice(0, e)] : []
      , h = c && a > 0 ? "+" : 0 > a ? "-" : "";
    return h + g.concat(d[0].slice(e).match(/\d{3}/g) || []).join() + f
}
,
Mark.pipes.dollars = function(a) {
    return accounting.formatMoney(+a)
}
,
Mark.pipes.euros = function(a) {
    return accounting.formatMoney(+a, "€", 2, ".", ",")
}
,
Mark.pipes.phone = function(a) {
    var b = a.replace(/[^\d]/g, "");
    return "(" + b.substr(0, 3) + ") " + b.substr(3, 3) + "-" + b.substr(6, 4)
}
,
Mark.pipes.ordinal = function(a) {
    return a > 10 && 20 > a ? a + "th" : a + ["th", "st", "nd", "rd", "th", "th", "th", "th", "th", "th"][a % 10]
}
,
Mark.pipes.percent = function(a, b) {
    return (1 > a ? 100 * a : a).toFixed(b || 0) + "%"
}
,
Mark.pipes.runtime = function(a, b) {
    var c = Math.floor(a / (60 * (b || 1)))
      , d = Math.floor(a / (b || 1) % 60);
    return c + ":" + ("00" + d).substr(-2)
}
,
Mark.pipes.plus = function(a, b) {
    return a + +b
}
,
Mark.pipes.minus = function(a, b) {
    return a - +b
}
,
Mark.pipes.times = function(a, b) {
    return a * +b
}
,
nm_module("js-libs/markup", function(a, b, c, d) {
    b("./markup/markup.js"),
    b("./markup/numbers.js");
    a.markup = Mark
}),
nm_module("js-libs/moment", function(a, b, c, d) {
    (function(b) {
        function c() {
            return {
                empty: !1,
                unusedTokens: [],
                unusedInput: [],
                overflow: -2,
                charsLeftOver: 0,
                nullInput: !1,
                invalidMonth: null ,
                invalidFormat: !1,
                userInvalidated: !1,
                iso: !1
            }
        }
        function d(a, b) {
            function c() {
                ia.suppressDeprecationWarnings === !1 && "undefined" != typeof console && console.warn && console.warn("Deprecation warning: " + a)
            }
            var d = !0;
            return j(function() {
                return d && (c(),
                d = !1),
                b.apply(this, arguments)
            }, b)
        }
        function e(a, b) {
            return function(c) {
                return m(a.call(this, c), b)
            }
        }
        function f(a, b) {
            return function(c) {
                return this.lang().ordinal(a.call(this, c), b)
            }
        }
        function g() {}
        function h(a) {
            z(a),
            j(this, a)
        }
        function i(a) {
            var b = s(a)
              , c = b.year || 0
              , d = b.quarter || 0
              , e = b.month || 0
              , f = b.week || 0
              , g = b.day || 0
              , h = b.hour || 0
              , i = b.minute || 0
              , j = b.second || 0
              , k = b.millisecond || 0;
            this._milliseconds = +k + 1e3 * j + 6e4 * i + 36e5 * h,
            this._days = +g + 7 * f,
            this._months = +e + 3 * d + 12 * c,
            this._data = {},
            this._bubble()
        }
        function j(a, b) {
            for (var c in b)
                b.hasOwnProperty(c) && (a[c] = b[c]);
            return b.hasOwnProperty("toString") && (a.toString = b.toString),
            b.hasOwnProperty("valueOf") && (a.valueOf = b.valueOf),
            a
        }
        function k(a) {
            var b, c = {};
            for (b in a)
                a.hasOwnProperty(b) && ua.hasOwnProperty(b) && (c[b] = a[b]);
            return c
        }
        function l(a) {
            return 0 > a ? Math.ceil(a) : Math.floor(a)
        }
        function m(a, b, c) {
            for (var d = "" + Math.abs(a), e = a >= 0; d.length < b; )
                d = "0" + d;
            return (e ? c ? "+" : "" : "-") + d
        }
        function n(a, b, c, d) {
            var e = b._milliseconds
              , f = b._days
              , g = b._months;
            d = null  == d ? !0 : d,
            e && a._d.setTime(+a._d + e * c),
            f && ea(a, "Date", da(a, "Date") + f * c),
            g && ca(a, da(a, "Month") + g * c),
            d && ia.updateOffset(a, f || g)
        }
        function o(a) {
            return "[object Array]" === Object.prototype.toString.call(a)
        }
        function p(a) {
            return "[object Date]" === Object.prototype.toString.call(a) || a instanceof Date
        }
        function q(a, b, c) {
            var d, e = Math.min(a.length, b.length), f = Math.abs(a.length - b.length), g = 0;
            for (d = 0; e > d; d++)
                (c && a[d] !== b[d] || !c && u(a[d]) !== u(b[d])) && g++;
            return g + f
        }
        function r(a) {
            if (a) {
                var b = a.toLowerCase().replace(/(.)s$/, "$1");
                a = Xa[a] || Ya[b] || b
            }
            return a
        }
        function s(a) {
            var b, c, d = {};
            for (c in a)
                a.hasOwnProperty(c) && (b = r(c),
                b && (d[b] = a[c]));
            return d
        }
        function t(a) {
            var c, d;
            if (0 === a.indexOf("week"))
                c = 7,
                d = "day";
            else {
                if (0 !== a.indexOf("month"))
                    return;
                c = 12,
                d = "month"
            }
            ia[a] = function(e, f) {
                var g, h, i = ia.fn._lang[a], j = [];
                if ("number" == typeof e && (f = e,
                e = b),
                h = function(a) {
                    var b = ia().utc().set(d, a);
                    return i.call(ia.fn._lang, b, e || "")
                }
                ,
                null  != f)
                    return h(f);
                for (g = 0; c > g; g++)
                    j.push(h(g));
                return j
            }
        }
        function u(a) {
            var b = +a
              , c = 0;
            return 0 !== b && isFinite(b) && (c = b >= 0 ? Math.floor(b) : Math.ceil(b)),
            c
        }
        function v(a, b) {
            return new Date(Date.UTC(a, b + 1, 0)).getUTCDate()
        }
        function w(a, b, c) {
            return _(ia([a, 11, 31 + b - c]), b, c).week
        }
        function x(a) {
            return y(a) ? 366 : 365
        }
        function y(a) {
            return a % 4 === 0 && a % 100 !== 0 || a % 400 === 0
        }
        function z(a) {
            var b;
            a._a && -2 === a._pf.overflow && (b = a._a[na] < 0 || a._a[na] > 11 ? na : a._a[oa] < 1 || a._a[oa] > v(a._a[ma], a._a[na]) ? oa : a._a[pa] < 0 || a._a[pa] > 23 ? pa : a._a[qa] < 0 || a._a[qa] > 59 ? qa : a._a[ra] < 0 || a._a[ra] > 59 ? ra : a._a[sa] < 0 || a._a[sa] > 999 ? sa : -1,
            a._pf._overflowDayOfYear && (ma > b || b > oa) && (b = oa),
            a._pf.overflow = b)
        }
        function A(a) {
            return null  == a._isValid && (a._isValid = !isNaN(a._d.getTime()) && a._pf.overflow < 0 && !a._pf.empty && !a._pf.invalidMonth && !a._pf.nullInput && !a._pf.invalidFormat && !a._pf.userInvalidated,
            a._strict && (a._isValid = a._isValid && 0 === a._pf.charsLeftOver && 0 === a._pf.unusedTokens.length)),
            a._isValid
        }
        function B(a) {
            return a ? a.toLowerCase().replace("_", "-") : a
        }
        function C(a, b) {
            return b._isUTC ? ia(a).zone(b._offset || 0) : ia(a).local()
        }
        function D(a, b) {
            return b.abbr = a,
            ta[a] || (ta[a] = new g),
            ta[a].set(b),
            ta[a]
        }
        function E(a) {
            delete ta[a]
        }
        function F(a) {
            var b, c, d, e, f = 0, g = function(a) {
                if (!ta[a] && va)
                    try {
                        require("./lang/" + a)
                    } catch (b) {}
                return ta[a]
            }
            ;
            if (!a)
                return ia.fn._lang;
            if (!o(a)) {
                if (c = g(a))
                    return c;
                a = [a]
            }
            for (; f < a.length; ) {
                for (e = B(a[f]).split("-"),
                b = e.length,
                d = B(a[f + 1]),
                d = d ? d.split("-") : null ; b > 0; ) {
                    if (c = g(e.slice(0, b).join("-")))
                        return c;
                    if (d && d.length >= b && q(e, d, !0) >= b - 1)
                        break;
                    b--
                }
                f++
            }
            return ia.fn._lang
        }
        function G(a) {
            return a.match(/\[[\s\S]/) ? a.replace(/^\[|\]$/g, "") : a.replace(/\\/g, "")
        }
        function H(a) {
            var b, c, d = a.match(za);
            for (b = 0,
            c = d.length; c > b; b++)
                ab[d[b]] ? d[b] = ab[d[b]] : d[b] = G(d[b]);
            return function(e) {
                var f = "";
                for (b = 0; c > b; b++)
                    f += d[b] instanceof Function ? d[b].call(e, a) : d[b];
                return f
            }
        }
        function I(a, b) {
            return a.isValid() ? (b = J(b, a.lang()),
            Za[b] || (Za[b] = H(b)),
            Za[b](a)) : a.lang().invalidDate()
        }
        function J(a, b) {
            function c(a) {
                return b.longDateFormat(a) || a
            }
            var d = 5;
            for (Aa.lastIndex = 0; d >= 0 && Aa.test(a); )
                a = a.replace(Aa, c),
                Aa.lastIndex = 0,
                d -= 1;
            return a
        }
        function K(a, b) {
            var c, d = b._strict;
            switch (a) {
            case "Q":
                return La;
            case "DDDD":
                return Na;
            case "YYYY":
            case "GGGG":
            case "gggg":
                return d ? Oa : Da;
            case "Y":
            case "G":
            case "g":
                return Qa;
            case "YYYYYY":
            case "YYYYY":
            case "GGGGG":
            case "ggggg":
                return d ? Pa : Ea;
            case "S":
                if (d)
                    return La;
            case "SS":
                if (d)
                    return Ma;
            case "SSS":
                if (d)
                    return Na;
            case "DDD":
                return Ca;
            case "MMM":
            case "MMMM":
            case "dd":
            case "ddd":
            case "dddd":
                return Ga;
            case "a":
            case "A":
                return F(b._l)._meridiemParse;
            case "X":
                return Ja;
            case "Z":
            case "ZZ":
                return Ha;
            case "T":
                return Ia;
            case "SSSS":
                return Fa;
            case "MM":
            case "DD":
            case "YY":
            case "GG":
            case "gg":
            case "HH":
            case "hh":
            case "mm":
            case "ss":
            case "ww":
            case "WW":
                return d ? Ma : Ba;
            case "M":
            case "D":
            case "d":
            case "H":
            case "h":
            case "m":
            case "s":
            case "w":
            case "W":
            case "e":
            case "E":
                return Ba;
            case "Do":
                return Ka;
            default:
                return c = new RegExp(S(R(a.replace("\\", "")), "i"))
            }
        }
        function L(a) {
            a = a || "";
            var b = a.match(Ha) || []
              , c = b[b.length - 1] || []
              , d = (c + "").match(Va) || ["-", 0, 0]
              , e = +(60 * d[1]) + u(d[2]);
            return "+" === d[0] ? -e : e
        }
        function M(a, b, c) {
            var d, e = c._a;
            switch (a) {
            case "Q":
                null  != b && (e[na] = 3 * (u(b) - 1));
                break;
            case "M":
            case "MM":
                null  != b && (e[na] = u(b) - 1);
                break;
            case "MMM":
            case "MMMM":
                d = F(c._l).monthsParse(b),
                null  != d ? e[na] = d : c._pf.invalidMonth = b;
                break;
            case "D":
            case "DD":
                null  != b && (e[oa] = u(b));
                break;
            case "Do":
                null  != b && (e[oa] = u(parseInt(b, 10)));
                break;
            case "DDD":
            case "DDDD":
                null  != b && (c._dayOfYear = u(b));
                break;
            case "YY":
                e[ma] = ia.parseTwoDigitYear(b);
                break;
            case "YYYY":
            case "YYYYY":
            case "YYYYYY":
                e[ma] = u(b);
                break;
            case "a":
            case "A":
                c._isPm = F(c._l).isPM(b);
                break;
            case "H":
            case "HH":
            case "h":
            case "hh":
                e[pa] = u(b);
                break;
            case "m":
            case "mm":
                e[qa] = u(b);
                break;
            case "s":
            case "ss":
                e[ra] = u(b);
                break;
            case "S":
            case "SS":
            case "SSS":
            case "SSSS":
                e[sa] = u(1e3 * ("0." + b));
                break;
            case "X":
                c._d = new Date(1e3 * parseFloat(b));
                break;
            case "Z":
            case "ZZ":
                c._useUTC = !0,
                c._tzm = L(b);
                break;
            case "w":
            case "ww":
            case "W":
            case "WW":
            case "d":
            case "dd":
            case "ddd":
            case "dddd":
            case "e":
            case "E":
                a = a.substr(0, 1);
            case "gg":
            case "gggg":
            case "GG":
            case "GGGG":
            case "GGGGG":
                a = a.substr(0, 2),
                b && (c._w = c._w || {},
                c._w[a] = b)
            }
        }
        function N(a) {
            var b, c, d, e, f, g, h, i, j, k, l = [];
            if (!a._d) {
                for (d = P(a),
                a._w && null  == a._a[oa] && null  == a._a[na] && (f = function(b) {
                    var c = parseInt(b, 10);
                    return b ? b.length < 3 ? c > 68 ? 1900 + c : 2e3 + c : c : null  == a._a[ma] ? ia().weekYear() : a._a[ma]
                }
                ,
                g = a._w,
                null  != g.GG || null  != g.W || null  != g.E ? h = aa(f(g.GG), g.W || 1, g.E, 4, 1) : (i = F(a._l),
                j = null  != g.d ? Y(g.d, i) : null  != g.e ? parseInt(g.e, 10) + i._week.dow : 0,
                k = parseInt(g.w, 10) || 1,
                null  != g.d && j < i._week.dow && k++,
                h = aa(f(g.gg), k, j, i._week.doy, i._week.dow)),
                a._a[ma] = h.year,
                a._dayOfYear = h.dayOfYear),
                a._dayOfYear && (e = null  == a._a[ma] ? d[ma] : a._a[ma],
                a._dayOfYear > x(e) && (a._pf._overflowDayOfYear = !0),
                c = X(e, 0, a._dayOfYear),
                a._a[na] = c.getUTCMonth(),
                a._a[oa] = c.getUTCDate()),
                b = 0; 3 > b && null  == a._a[b]; ++b)
                    a._a[b] = l[b] = d[b];
                for (; 7 > b; b++)
                    a._a[b] = l[b] = null  == a._a[b] ? 2 === b ? 1 : 0 : a._a[b];
                l[pa] += u((a._tzm || 0) / 60),
                l[qa] += u((a._tzm || 0) % 60),
                a._d = (a._useUTC ? X : W).apply(null , l)
            }
        }
        function O(a) {
            var b;
            a._d || (b = s(a._i),
            a._a = [b.year, b.month, b.day, b.hour, b.minute, b.second, b.millisecond],
            N(a))
        }
        function P(a) {
            var b = new Date;
            return a._useUTC ? [b.getUTCFullYear(), b.getUTCMonth(), b.getUTCDate()] : [b.getFullYear(), b.getMonth(), b.getDate()]
        }
        function Q(a) {
            a._a = [],
            a._pf.empty = !0;
            var b, c, d, e, f, g = F(a._l), h = "" + a._i, i = h.length, j = 0;
            for (d = J(a._f, g).match(za) || [],
            b = 0; b < d.length; b++)
                e = d[b],
                c = (h.match(K(e, a)) || [])[0],
                c && (f = h.substr(0, h.indexOf(c)),
                f.length > 0 && a._pf.unusedInput.push(f),
                h = h.slice(h.indexOf(c) + c.length),
                j += c.length),
                ab[e] ? (c ? a._pf.empty = !1 : a._pf.unusedTokens.push(e),
                M(e, c, a)) : a._strict && !c && a._pf.unusedTokens.push(e);
            a._pf.charsLeftOver = i - j,
            h.length > 0 && a._pf.unusedInput.push(h),
            a._isPm && a._a[pa] < 12 && (a._a[pa] += 12),
            a._isPm === !1 && 12 === a._a[pa] && (a._a[pa] = 0),
            N(a),
            z(a)
        }
        function R(a) {
            return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function(a, b, c, d, e) {
                return b || c || d || e
            })
        }
        function S(a) {
            return a.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")
        }
        function T(a) {
            var b, d, e, f, g;
            if (0 === a._f.length)
                return a._pf.invalidFormat = !0,
                void (a._d = new Date(NaN));
            for (f = 0; f < a._f.length; f++)
                g = 0,
                b = j({}, a),
                b._pf = c(),
                b._f = a._f[f],
                Q(b),
                A(b) && (g += b._pf.charsLeftOver,
                g += 10 * b._pf.unusedTokens.length,
                b._pf.score = g,
                (null  == e || e > g) && (e = g,
                d = b));
            j(a, d || b)
        }
        function U(a) {
            var b, c, d = a._i, e = Ra.exec(d);
            if (e) {
                for (a._pf.iso = !0,
                b = 0,
                c = Ta.length; c > b; b++)
                    if (Ta[b][1].exec(d)) {
                        a._f = Ta[b][0] + (e[6] || " ");
                        break
                    }
                for (b = 0,
                c = Ua.length; c > b; b++)
                    if (Ua[b][1].exec(d)) {
                        a._f += Ua[b][0];
                        break
                    }
                d.match(Ha) && (a._f += "Z"),
                Q(a)
            } else
                ia.createFromInputFallback(a)
        }
        function V(a) {
            var c = a._i
              , d = wa.exec(c);
            c === b ? a._d = new Date : d ? a._d = new Date(+d[1]) : "string" == typeof c ? U(a) : o(c) ? (a._a = c.slice(0),
            N(a)) : p(c) ? a._d = new Date(+c) : "object" == typeof c ? O(a) : "number" == typeof c ? a._d = new Date(c) : ia.createFromInputFallback(a)
        }
        function W(a, b, c, d, e, f, g) {
            var h = new Date(a,b,c,d,e,f,g);
            return 1970 > a && h.setFullYear(a),
            h
        }
        function X(a) {
            var b = new Date(Date.UTC.apply(null , arguments));
            return 1970 > a && b.setUTCFullYear(a),
            b
        }
        function Y(a, b) {
            if ("string" == typeof a)
                if (isNaN(a)) {
                    if (a = b.weekdaysParse(a),
                    "number" != typeof a)
                        return null 
                } else
                    a = parseInt(a, 10);
            return a
        }
        function Z(a, b, c, d, e) {
            return e.relativeTime(b || 1, !!c, a, d)
        }
        function $(a, b, c) {
            var d = la(Math.abs(a) / 1e3)
              , e = la(d / 60)
              , f = la(e / 60)
              , g = la(f / 24)
              , h = la(g / 365)
              , i = 45 > d && ["s", d] || 1 === e && ["m"] || 45 > e && ["mm", e] || 1 === f && ["h"] || 22 > f && ["hh", f] || 1 === g && ["d"] || 25 >= g && ["dd", g] || 45 >= g && ["M"] || 345 > g && ["MM", la(g / 30)] || 1 === h && ["y"] || ["yy", h];
            return i[2] = b,
            i[3] = a > 0,
            i[4] = c,
            Z.apply({}, i)
        }
        function _(a, b, c) {
            var d, e = c - b, f = c - a.day();
            return f > e && (f -= 7),
            e - 7 > f && (f += 7),
            d = ia(a).add("d", f),
            {
                week: Math.ceil(d.dayOfYear() / 7),
                year: d.year()
            }
        }
        function aa(a, b, c, d, e) {
            var f, g, h = X(a, 0, 1).getUTCDay();
            return c = null  != c ? c : e,
            f = e - h + (h > d ? 7 : 0) - (e > h ? 7 : 0),
            g = 7 * (b - 1) + (c - e) + f + 1,
            {
                year: g > 0 ? a : a - 1,
                dayOfYear: g > 0 ? g : x(a - 1) + g
            }
        }
        function ba(a) {
            var c = a._i
              , d = a._f;
            return null  === c || d === b && "" === c ? ia.invalid({
                nullInput: !0
            }) : ("string" == typeof c && (a._i = c = F().preparse(c)),
            ia.isMoment(c) ? (a = k(c),
            a._d = new Date(+c._d)) : d ? o(d) ? T(a) : Q(a) : V(a),
            new h(a))
        }
        function ca(a, b) {
            var c;
            return "string" == typeof b && (b = a.lang().monthsParse(b),
            "number" != typeof b) ? a : (c = Math.min(a.date(), v(a.year(), b)),
            a._d["set" + (a._isUTC ? "UTC" : "") + "Month"](b, c),
            a)
        }
        function da(a, b) {
            return a._d["get" + (a._isUTC ? "UTC" : "") + b]()
        }
        function ea(a, b, c) {
            return "Month" === b ? ca(a, c) : a._d["set" + (a._isUTC ? "UTC" : "") + b](c)
        }
        function fa(a, b) {
            return function(c) {
                return null  != c ? (ea(this, a, c),
                ia.updateOffset(this, b),
                this) : da(this, a)
            }
        }
        function ga(a) {
            ia.duration.fn[a] = function() {
                return this._data[a]
            }
        }
        function ha(a, b) {
            ia.duration.fn["as" + a] = function() {
                return +this / b
            }
        }
        for (var ia, ja, ka = "2.6.0", la = ("undefined" != typeof global ? global : this,
        Math.round), ma = 0, na = 1, oa = 2, pa = 3, qa = 4, ra = 5, sa = 6, ta = {}, ua = {
            _isAMomentObject: null ,
            _i: null ,
            _f: null ,
            _l: null ,
            _strict: null ,
            _isUTC: null ,
            _offset: null ,
            _pf: null ,
            _lang: null 
        }, va = "undefined" != typeof module && module.exports, wa = /^\/?Date\((\-?\d+)/i, xa = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/, ya = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/, za = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g, Aa = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g, Ba = /\d\d?/, Ca = /\d{1,3}/, Da = /\d{1,4}/, Ea = /[+\-]?\d{1,6}/, Fa = /\d+/, Ga = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, Ha = /Z|[\+\-]\d\d:?\d\d/gi, Ia = /T/i, Ja = /[\+\-]?\d+(\.\d{1,3})?/, Ka = /\d{1,2}/, La = /\d/, Ma = /\d\d/, Na = /\d{3}/, Oa = /\d{4}/, Pa = /[+-]?\d{6}/, Qa = /[+-]?\d+/, Ra = /^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/, Sa = "YYYY-MM-DDTHH:mm:ssZ", Ta = [["YYYYYY-MM-DD", /[+-]\d{6}-\d{2}-\d{2}/], ["YYYY-MM-DD", /\d{4}-\d{2}-\d{2}/], ["GGGG-[W]WW-E", /\d{4}-W\d{2}-\d/], ["GGGG-[W]WW", /\d{4}-W\d{2}/], ["YYYY-DDD", /\d{4}-\d{3}/]], Ua = [["HH:mm:ss.SSSS", /(T| )\d\d:\d\d:\d\d\.\d+/], ["HH:mm:ss", /(T| )\d\d:\d\d:\d\d/], ["HH:mm", /(T| )\d\d:\d\d/], ["HH", /(T| )\d\d/]], Va = /([\+\-]|\d\d)/gi, Wa = ("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),
        {
            Milliseconds: 1,
            Seconds: 1e3,
            Minutes: 6e4,
            Hours: 36e5,
            Days: 864e5,
            Months: 2592e6,
            Years: 31536e6
        }), Xa = {
            ms: "millisecond",
            s: "second",
            m: "minute",
            h: "hour",
            d: "day",
            D: "date",
            w: "week",
            W: "isoWeek",
            M: "month",
            Q: "quarter",
            y: "year",
            DDD: "dayOfYear",
            e: "weekday",
            E: "isoWeekday",
            gg: "weekYear",
            GG: "isoWeekYear"
        }, Ya = {
            dayofyear: "dayOfYear",
            isoweekday: "isoWeekday",
            isoweek: "isoWeek",
            weekyear: "weekYear",
            isoweekyear: "isoWeekYear"
        }, Za = {}, $a = "DDD w W M D d".split(" "), _a = "M D H h m s w W".split(" "), ab = {
            M: function() {
                return this.month() + 1
            },
            MMM: function(a) {
                return this.lang().monthsShort(this, a)
            },
            MMMM: function(a) {
                return this.lang().months(this, a)
            },
            D: function() {
                return this.date()
            },
            DDD: function() {
                return this.dayOfYear()
            },
            d: function() {
                return this.day()
            },
            dd: function(a) {
                return this.lang().weekdaysMin(this, a)
            },
            ddd: function(a) {
                return this.lang().weekdaysShort(this, a)
            },
            dddd: function(a) {
                return this.lang().weekdays(this, a)
            },
            w: function() {
                return this.week()
            },
            W: function() {
                return this.isoWeek()
            },
            YY: function() {
                return m(this.year() % 100, 2)
            },
            YYYY: function() {
                return m(this.year(), 4)
            },
            YYYYY: function() {
                return m(this.year(), 5)
            },
            YYYYYY: function() {
                var a = this.year()
                  , b = a >= 0 ? "+" : "-";
                return b + m(Math.abs(a), 6)
            },
            gg: function() {
                return m(this.weekYear() % 100, 2)
            },
            gggg: function() {
                return m(this.weekYear(), 4)
            },
            ggggg: function() {
                return m(this.weekYear(), 5)
            },
            GG: function() {
                return m(this.isoWeekYear() % 100, 2)
            },
            GGGG: function() {
                return m(this.isoWeekYear(), 4)
            },
            GGGGG: function() {
                return m(this.isoWeekYear(), 5)
            },
            e: function() {
                return this.weekday()
            },
            E: function() {
                return this.isoWeekday()
            },
            a: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !0)
            },
            A: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !1)
            },
            H: function() {
                return this.hours()
            },
            h: function() {
                return this.hours() % 12 || 12
            },
            m: function() {
                return this.minutes()
            },
            s: function() {
                return this.seconds()
            },
            S: function() {
                return u(this.milliseconds() / 100)
            },
            SS: function() {
                return m(u(this.milliseconds() / 10), 2)
            },
            SSS: function() {
                return m(this.milliseconds(), 3)
            },
            SSSS: function() {
                return m(this.milliseconds(), 3)
            },
            Z: function() {
                var a = -this.zone()
                  , b = "+";
                return 0 > a && (a = -a,
                b = "-"),
                b + m(u(a / 60), 2) + ":" + m(u(a) % 60, 2)
            },
            ZZ: function() {
                var a = -this.zone()
                  , b = "+";
                return 0 > a && (a = -a,
                b = "-"),
                b + m(u(a / 60), 2) + m(u(a) % 60, 2)
            },
            z: function() {
                return this.zoneAbbr()
            },
            zz: function() {
                return this.zoneName()
            },
            X: function() {
                return this.unix()
            },
            Q: function() {
                return this.quarter()
            }
        }, bb = ["months", "monthsShort", "weekdays", "weekdaysShort", "weekdaysMin"]; $a.length; )
            ja = $a.pop(),
            ab[ja + "o"] = f(ab[ja], ja);
        for (; _a.length; )
            ja = _a.pop(),
            ab[ja + ja] = e(ab[ja], 2);
        for (ab.DDDD = e(ab.DDD, 3),
        j(g.prototype, {
            set: function(a) {
                var b, c;
                for (c in a)
                    b = a[c],
                    "function" == typeof b ? this[c] = b : this["_" + c] = b
            },
            _months: "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
            months: function(a) {
                return this._months[a.month()]
            },
            _monthsShort: "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
            monthsShort: function(a) {
                return this._monthsShort[a.month()]
            },
            monthsParse: function(a) {
                var b, c, d;
                for (this._monthsParse || (this._monthsParse = []),
                b = 0; 12 > b; b++)
                    if (this._monthsParse[b] || (c = ia.utc([2e3, b]),
                    d = "^" + this.months(c, "") + "|^" + this.monthsShort(c, ""),
                    this._monthsParse[b] = new RegExp(d.replace(".", ""),"i")),
                    this._monthsParse[b].test(a))
                        return b
            },
            _weekdays: "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
            weekdays: function(a) {
                return this._weekdays[a.day()]
            },
            _weekdaysShort: "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
            weekdaysShort: function(a) {
                return this._weekdaysShort[a.day()]
            },
            _weekdaysMin: "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
            weekdaysMin: function(a) {
                return this._weekdaysMin[a.day()]
            },
            weekdaysParse: function(a) {
                var b, c, d;
                for (this._weekdaysParse || (this._weekdaysParse = []),
                b = 0; 7 > b; b++)
                    if (this._weekdaysParse[b] || (c = ia([2e3, 1]).day(b),
                    d = "^" + this.weekdays(c, "") + "|^" + this.weekdaysShort(c, "") + "|^" + this.weekdaysMin(c, ""),
                    this._weekdaysParse[b] = new RegExp(d.replace(".", ""),"i")),
                    this._weekdaysParse[b].test(a))
                        return b
            },
            _longDateFormat: {
                LT: "h:mm A",
                L: "MM/DD/YYYY",
                LL: "MMMM D YYYY",
                LLL: "MMMM D YYYY LT",
                LLLL: "dddd, MMMM D YYYY LT"
            },
            longDateFormat: function(a) {
                var b = this._longDateFormat[a];
                return !b && this._longDateFormat[a.toUpperCase()] && (b = this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function(a) {
                    return a.slice(1)
                }),
                this._longDateFormat[a] = b),
                b
            },
            isPM: function(a) {
                return "p" === (a + "").toLowerCase().charAt(0)
            },
            _meridiemParse: /[ap]\.?m?\.?/i,
            meridiem: function(a, b, c) {
                return a > 11 ? c ? "pm" : "PM" : c ? "am" : "AM"
            },
            _calendar: {
                sameDay: "[Today at] LT",
                nextDay: "[Tomorrow at] LT",
                nextWeek: "dddd [at] LT",
                lastDay: "[Yesterday at] LT",
                lastWeek: "[Last] dddd [at] LT",
                sameElse: "L"
            },
            calendar: function(a, b) {
                var c = this._calendar[a];
                return "function" == typeof c ? c.apply(b) : c
            },
            _relativeTime: {
                future: "in %s",
                past: "%s ago",
                s: "a few seconds",
                m: "a minute",
                mm: "%d minutes",
                h: "an hour",
                hh: "%d hours",
                d: "a day",
                dd: "%d days",
                M: "a month",
                MM: "%d months",
                y: "a year",
                yy: "%d years"
            },
            relativeTime: function(a, b, c, d) {
                var e = this._relativeTime[c];
                return "function" == typeof e ? e(a, b, c, d) : e.replace(/%d/i, a)
            },
            pastFuture: function(a, b) {
                var c = this._relativeTime[a > 0 ? "future" : "past"];
                return "function" == typeof c ? c(b) : c.replace(/%s/i, b)
            },
            ordinal: function(a) {
                return this._ordinal.replace("%d", a)
            },
            _ordinal: "%d",
            preparse: function(a) {
                return a
            },
            postformat: function(a) {
                return a
            },
            week: function(a) {
                return _(a, this._week.dow, this._week.doy).week
            },
            _week: {
                dow: 0,
                doy: 6
            },
            _invalidDate: "Invalid date",
            invalidDate: function() {
                return this._invalidDate
            }
        }),
        ia = function(a, d, e, f) {
            var g;
            return "boolean" == typeof e && (f = e,
            e = b),
            g = {},
            g._isAMomentObject = !0,
            g._i = a,
            g._f = d,
            g._l = e,
            g._strict = f,
            g._isUTC = !1,
            g._pf = c(),
            ba(g)
        }
        ,
        ia.suppressDeprecationWarnings = !1,
        ia.createFromInputFallback = d("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.", function(a) {
            a._d = new Date(a._i)
        }),
        ia.utc = function(a, d, e, f) {
            var g;
            return "boolean" == typeof e && (f = e,
            e = b),
            g = {},
            g._isAMomentObject = !0,
            g._useUTC = !0,
            g._isUTC = !0,
            g._l = e,
            g._i = a,
            g._f = d,
            g._strict = f,
            g._pf = c(),
            ba(g).utc()
        }
        ,
        ia.unix = function(a) {
            return ia(1e3 * a)
        }
        ,
        ia.duration = function(a, b) {
            var c, d, e, f = a, g = null ;
            return ia.isDuration(a) ? f = {
                ms: a._milliseconds,
                d: a._days,
                M: a._months
            } : "number" == typeof a ? (f = {},
            b ? f[b] = a : f.milliseconds = a) : (g = xa.exec(a)) ? (c = "-" === g[1] ? -1 : 1,
            f = {
                y: 0,
                d: u(g[oa]) * c,
                h: u(g[pa]) * c,
                m: u(g[qa]) * c,
                s: u(g[ra]) * c,
                ms: u(g[sa]) * c
            }) : (g = ya.exec(a)) && (c = "-" === g[1] ? -1 : 1,
            e = function(a) {
                var b = a && parseFloat(a.replace(",", "."));
                return (isNaN(b) ? 0 : b) * c
            }
            ,
            f = {
                y: e(g[2]),
                M: e(g[3]),
                d: e(g[4]),
                h: e(g[5]),
                m: e(g[6]),
                s: e(g[7]),
                w: e(g[8])
            }),
            d = new i(f),
            ia.isDuration(a) && a.hasOwnProperty("_lang") && (d._lang = a._lang),
            d
        }
        ,
        ia.version = ka,
        ia.defaultFormat = Sa,
        ia.momentProperties = ua,
        ia.updateOffset = function() {}
        ,
        ia.lang = function(a, b) {
            var c;
            return a ? (b ? D(B(a), b) : null  === b ? (E(a),
            a = "en") : ta[a] || F(a),
            c = ia.duration.fn._lang = ia.fn._lang = F(a),
            c._abbr) : ia.fn._lang._abbr
        }
        ,
        ia.langData = function(a) {
            return a && a._lang && a._lang._abbr && (a = a._lang._abbr),
            F(a)
        }
        ,
        ia.isMoment = function(a) {
            return a instanceof h || null  != a && a.hasOwnProperty("_isAMomentObject")
        }
        ,
        ia.isDuration = function(a) {
            return a instanceof i
        }
        ,
        ja = bb.length - 1; ja >= 0; --ja)
            t(bb[ja]);
        ia.normalizeUnits = function(a) {
            return r(a)
        }
        ,
        ia.invalid = function(a) {
            var b = ia.utc(NaN);
            return null  != a ? j(b._pf, a) : b._pf.userInvalidated = !0,
            b
        }
        ,
        ia.parseZone = function() {
            return ia.apply(null , arguments).parseZone()
        }
        ,
        ia.parseTwoDigitYear = function(a) {
            return u(a) + (u(a) > 68 ? 1900 : 2e3)
        }
        ,
        j(ia.fn = h.prototype, {
            clone: function() {
                return ia(this)
            },
            valueOf: function() {
                return +this._d + 6e4 * (this._offset || 0)
            },
            unix: function() {
                return Math.floor(+this / 1e3)
            },
            toString: function() {
                return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
            },
            toDate: function() {
                return this._offset ? new Date(+this) : this._d
            },
            toISOString: function() {
                var a = ia(this).utc();
                return 0 < a.year() && a.year() <= 9999 ? I(a, "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]") : I(a, "YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")
            },
            toArray: function() {
                var a = this;
                return [a.year(), a.month(), a.date(), a.hours(), a.minutes(), a.seconds(), a.milliseconds()]
            },
            isValid: function() {
                return A(this)
            },
            isDSTShifted: function() {
                return this._a ? this.isValid() && q(this._a, (this._isUTC ? ia.utc(this._a) : ia(this._a)).toArray()) > 0 : !1
            },
            parsingFlags: function() {
                return j({}, this._pf)
            },
            invalidAt: function() {
                return this._pf.overflow
            },
            utc: function() {
                return this.zone(0)
            },
            local: function() {
                return this.zone(0),
                this._isUTC = !1,
                this
            },
            format: function(a) {
                var b = I(this, a || ia.defaultFormat);
                return this.lang().postformat(b)
            },
            add: function(a, b) {
                var c;
                return c = "string" == typeof a ? ia.duration(+b, a) : ia.duration(a, b),
                n(this, c, 1),
                this
            },
            subtract: function(a, b) {
                var c;
                return c = "string" == typeof a ? ia.duration(+b, a) : ia.duration(a, b),
                n(this, c, -1),
                this
            },
            diff: function(a, b, c) {
                var d, e, f = C(a, this), g = 6e4 * (this.zone() - f.zone());
                return b = r(b),
                "year" === b || "month" === b ? (d = 432e5 * (this.daysInMonth() + f.daysInMonth()),
                e = 12 * (this.year() - f.year()) + (this.month() - f.month()),
                e += (this - ia(this).startOf("month") - (f - ia(f).startOf("month"))) / d,
                e -= 6e4 * (this.zone() - ia(this).startOf("month").zone() - (f.zone() - ia(f).startOf("month").zone())) / d,
                "year" === b && (e /= 12)) : (d = this - f,
                e = "second" === b ? d / 1e3 : "minute" === b ? d / 6e4 : "hour" === b ? d / 36e5 : "day" === b ? (d - g) / 864e5 : "week" === b ? (d - g) / 6048e5 : d),
                c ? e : l(e)
            },
            from: function(a, b) {
                return ia.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)
            },
            fromNow: function(a) {
                return this.from(ia(), a)
            },
            calendar: function() {
                var a = C(ia(), this).startOf("day")
                  , b = this.diff(a, "days", !0)
                  , c = -6 > b ? "sameElse" : -1 > b ? "lastWeek" : 0 > b ? "lastDay" : 1 > b ? "sameDay" : 2 > b ? "nextDay" : 7 > b ? "nextWeek" : "sameElse";
                return this.format(this.lang().calendar(c, this))
            },
            isLeapYear: function() {
                return y(this.year())
            },
            isDST: function() {
                return this.zone() < this.clone().month(0).zone() || this.zone() < this.clone().month(5).zone()
            },
            day: function(a) {
                var b = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
                return null  != a ? (a = Y(a, this.lang()),
                this.add({
                    d: a - b
                })) : b
            },
            month: fa("Month", !0),
            startOf: function(a) {
                switch (a = r(a)) {
                case "year":
                    this.month(0);
                case "quarter":
                case "month":
                    this.date(1);
                case "week":
                case "isoWeek":
                case "day":
                    this.hours(0);
                case "hour":
                    this.minutes(0);
                case "minute":
                    this.seconds(0);
                case "second":
                    this.milliseconds(0)
                }
                return "week" === a ? this.weekday(0) : "isoWeek" === a && this.isoWeekday(1),
                "quarter" === a && this.month(3 * Math.floor(this.month() / 3)),
                this
            },
            endOf: function(a) {
                return a = r(a),
                this.startOf(a).add("isoWeek" === a ? "week" : a, 1).subtract("ms", 1)
            },
            isAfter: function(a, b) {
                return b = "undefined" != typeof b ? b : "millisecond",
                +this.clone().startOf(b) > +ia(a).startOf(b)
            },
            isBefore: function(a, b) {
                return b = "undefined" != typeof b ? b : "millisecond",
                +this.clone().startOf(b) < +ia(a).startOf(b)
            },
            isSame: function(a, b) {
                return b = b || "ms",
                +this.clone().startOf(b) === +C(a, this).startOf(b)
            },
            min: function(a) {
                return a = ia.apply(null , arguments),
                this > a ? this : a
            },
            max: function(a) {
                return a = ia.apply(null , arguments),
                a > this ? this : a
            },
            zone: function(a, b) {
                var c = this._offset || 0;
                return null  == a ? this._isUTC ? c : this._d.getTimezoneOffset() : ("string" == typeof a && (a = L(a)),
                Math.abs(a) < 16 && (a = 60 * a),
                this._offset = a,
                this._isUTC = !0,
                c !== a && (!b || this._changeInProgress ? n(this, ia.duration(c - a, "m"), 1, !1) : this._changeInProgress || (this._changeInProgress = !0,
                ia.updateOffset(this, !0),
                this._changeInProgress = null )),
                this)
            },
            zoneAbbr: function() {
                return this._isUTC ? "UTC" : ""
            },
            zoneName: function() {
                return this._isUTC ? "Coordinated Universal Time" : ""
            },
            parseZone: function() {
                return this._tzm ? this.zone(this._tzm) : "string" == typeof this._i && this.zone(this._i),
                this
            },
            hasAlignedHourOffset: function(a) {
                return a = a ? ia(a).zone() : 0,
                (this.zone() - a) % 60 === 0
            },
            daysInMonth: function() {
                return v(this.year(), this.month())
            },
            dayOfYear: function(a) {
                var b = la((ia(this).startOf("day") - ia(this).startOf("year")) / 864e5) + 1;
                return null  == a ? b : this.add("d", a - b)
            },
            quarter: function(a) {
                return null  == a ? Math.ceil((this.month() + 1) / 3) : this.month(3 * (a - 1) + this.month() % 3)
            },
            weekYear: function(a) {
                var b = _(this, this.lang()._week.dow, this.lang()._week.doy).year;
                return null  == a ? b : this.add("y", a - b)
            },
            isoWeekYear: function(a) {
                var b = _(this, 1, 4).year;
                return null  == a ? b : this.add("y", a - b)
            },
            week: function(a) {
                var b = this.lang().week(this);
                return null  == a ? b : this.add("d", 7 * (a - b))
            },
            isoWeek: function(a) {
                var b = _(this, 1, 4).week;
                return null  == a ? b : this.add("d", 7 * (a - b))
            },
            weekday: function(a) {
                var b = (this.day() + 7 - this.lang()._week.dow) % 7;
                return null  == a ? b : this.add("d", a - b)
            },
            isoWeekday: function(a) {
                return null  == a ? this.day() || 7 : this.day(this.day() % 7 ? a : a - 7)
            },
            isoWeeksInYear: function() {
                return w(this.year(), 1, 4)
            },
            weeksInYear: function() {
                var a = this._lang._week;
                return w(this.year(), a.dow, a.doy)
            },
            get: function(a) {
                return a = r(a),
                this[a]()
            },
            set: function(a, b) {
                return a = r(a),
                "function" == typeof this[a] && this[a](b),
                this
            },
            lang: function(a) {
                return a === b ? this._lang : (this._lang = F(a),
                this)
            }
        }),
        ia.fn.millisecond = ia.fn.milliseconds = fa("Milliseconds", !1),
        ia.fn.second = ia.fn.seconds = fa("Seconds", !1),
        ia.fn.minute = ia.fn.minutes = fa("Minutes", !1),
        ia.fn.hour = ia.fn.hours = fa("Hours", !0),
        ia.fn.date = fa("Date", !0),
        ia.fn.dates = d("dates accessor is deprecated. Use date instead.", fa("Date", !0)),
        ia.fn.year = fa("FullYear", !0),
        ia.fn.years = d("years accessor is deprecated. Use year instead.", fa("FullYear", !0)),
        ia.fn.days = ia.fn.day,
        ia.fn.months = ia.fn.month,
        ia.fn.weeks = ia.fn.week,
        ia.fn.isoWeeks = ia.fn.isoWeek,
        ia.fn.quarters = ia.fn.quarter,
        ia.fn.toJSON = ia.fn.toISOString,
        j(ia.duration.fn = i.prototype, {
            _bubble: function() {
                var a, b, c, d, e = this._milliseconds, f = this._days, g = this._months, h = this._data;
                h.milliseconds = e % 1e3,
                a = l(e / 1e3),
                h.seconds = a % 60,
                b = l(a / 60),
                h.minutes = b % 60,
                c = l(b / 60),
                h.hours = c % 24,
                f += l(c / 24),
                h.days = f % 30,
                g += l(f / 30),
                h.months = g % 12,
                d = l(g / 12),
                h.years = d
            },
            weeks: function() {
                return l(this.days() / 7)
            },
            valueOf: function() {
                return this._milliseconds + 864e5 * this._days + this._months % 12 * 2592e6 + 31536e6 * u(this._months / 12)
            },
            humanize: function(a) {
                var b = +this
                  , c = $(b, !a, this.lang());
                return a && (c = this.lang().pastFuture(b, c)),
                this.lang().postformat(c)
            },
            add: function(a, b) {
                var c = ia.duration(a, b);
                return this._milliseconds += c._milliseconds,
                this._days += c._days,
                this._months += c._months,
                this._bubble(),
                this
            },
            subtract: function(a, b) {
                var c = ia.duration(a, b);
                return this._milliseconds -= c._milliseconds,
                this._days -= c._days,
                this._months -= c._months,
                this._bubble(),
                this
            },
            get: function(a) {
                return a = r(a),
                this[a.toLowerCase() + "s"]()
            },
            as: function(a) {
                return a = r(a),
                this["as" + a.charAt(0).toUpperCase() + a.slice(1) + "s"]()
            },
            lang: ia.fn.lang,
            toIsoString: function() {
                var a = Math.abs(this.years())
                  , b = Math.abs(this.months())
                  , c = Math.abs(this.days())
                  , d = Math.abs(this.hours())
                  , e = Math.abs(this.minutes())
                  , f = Math.abs(this.seconds() + this.milliseconds() / 1e3);
                return this.asSeconds() ? (this.asSeconds() < 0 ? "-" : "") + "P" + (a ? a + "Y" : "") + (b ? b + "M" : "") + (c ? c + "D" : "") + (d || e || f ? "T" : "") + (d ? d + "H" : "") + (e ? e + "M" : "") + (f ? f + "S" : "") : "P0D"
            }
        });
        for (ja in Wa)
            Wa.hasOwnProperty(ja) && (ha(ja, Wa[ja]),
            ga(ja.toLowerCase()));
        ha("Weeks", 6048e5),
        ia.duration.fn.asMonths = function() {
            return (+this - 31536e6 * this.years()) / 2592e6 + 12 * this.years()
        }
        ,
        ia.lang("en", {
            ordinal: function(a) {
                var b = a % 10
                  , c = 1 === u(a % 100 / 10) ? "th" : 1 === b ? "st" : 2 === b ? "nd" : 3 === b ? "rd" : "th";
                return a + c
            }
        }),
        a.moment = ia
    }
    ).call(this)
}),
nm_module("gooscr/overlays/markupCustomPipes", function(a, b) {
    "use strict";
    function c(a, b, c) {
        b || (b = 400),
        c || (c = 270);
        var d = "width: " + b + "px; height: " + c + "px;";
        return '<div id="' + a + '" style="' + d + '" />'
    }
    function d(a, b, c, d) {
        var e = a.layer.Url + "&cmd=relatedfeatures&relname=" + encodeURIComponent(b) + "&geomtype=" + encodeURIComponent(a.geomType.Name) + "&gid=" + encodeURIComponent(a.feature.id) + (c ? "&incfields=" + encodeURIComponent(c) : "");
        l(function() {
            f.ajax({
                url: e,
                dataType: "jsonp",
                success: function(a) {
                    var b = g.arrayToDataTable(a.data);
                    d(b, a.data)
                },
                error: function(a) {
                    k.log("ajax call error for markup chart", a)
                }
            })
        }, 1)
    }
    function e(a, b) {
        for (var c = ["blue", "red", "orange", "green", "purple", "yellow", "aqua", "gray", "lime", "maroon", "silver", "teal", "fuchsia", "olive"], d = {}, e = {}, f = 0; f < b[0].length; f++)
            d[f] = {
                targetAxisIndex: f
            },
            e[f] = {
                textPosition: 1 >= f ? "out" : "none",
                textStyle: {
                    color: c[f]
                }
            };
        return {
            title: a,
            series: d,
            vAxes: e,
            colors: c,
            legend: {
                position: "bottom"
            }
        }
    }
    var f = b("js-libs/jquery").jQuery
      , g = b("js-libs/google").visualization
      , h = b("js-libs/markup").markup
      , i = b("js-libs/moment").moment
      , j = b("jscore/uuid").uuid4
      , k = b("nm/console")
      , l = b("jscore/async").setTimeout;
    h.pipes.parseDate = function(a, b) {
        var c = i(a, b);
        return c.toDate()
    }
    ,
    h.pipes.formatDate = function(a, b) {
        return i(a).format(b)
    }
    ,
    h.pipes.dateAddMonths = function(a, b) {
        var c = parseInt(b, 10);
        return isNaN(c) ? a : new Date(new Date(a).setMonth(a.getMonth() + c))
    }
    ,
    h.pipes.quarterEnd = function(a, b, c) {
        b || (b = "MMM YYYY"),
        c || (c = "MMM YYYY");
        for (var d = i(a, b).toDate(), e = new Date(new Date(d).setMonth(d.getMonth() - 2)), f = "M", g = "", h = c.indexOf(f); h >= 0 && h < c.length && c.charAt(h) === f; h++)
            g += c.charAt(h);
        return "" === g && (g = c),
        i(e).format(g) + "-" + i(d).format(c)
    }
    ,
    h.pipes.geomName = function(a) {
        if (a) {
            if (0 === a.lastIndexOf("SSC", 0))
                return "suburb";
            if (0 === a.lastIndexOf("LGA", 0))
                return "LGA";
            if (0 === a.lastIndexOf("POA", 0))
                return "postal area";
            if (0 === a.lastIndexOf("STE", 0))
                return "state";
            if (0 === a.lastIndexOf("SA", 0))
                return "statistical area";
            if (0 === a.lastIndexOf("MB", 0))
                return "mesh block"
        }
        return "area"
    }
    ,
    h.pipes.columnChart = function(a, b, h, i, k, l) {
        var m = "chart-" + j();
        return d(a, b, i, function(a, b) {
            var c = f("#" + m);
            if (c.length) {
                var d = new g.ColumnChart(c[0]);
                d.draw(a, e(h, b))
            }
        }),
        c(m, k, l)
    }
    ,
    h.pipes.lineChart = function(a, b, h, i, k, l) {
        var m = "chart-" + j();
        return d(a, b, i, function(a, b) {
            var c = f("#" + m);
            if (c.length) {
                var d = new g.LineChart(c[0]);
                d.draw(a, e(h, b))
            }
        }),
        c(m, k, l)
    }
}),
nm_module("gooscr/overlays/singleInfoWindow", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("nm/console")
      , e = b("jscore/types")
      , f = b("jscore/async").callWhenIdle
      , g = b("gooscr/overlays/styles")
      , h = b("js-libs/google").maps
      , i = b("js-libs/markup").markup;
    b("gooscr/overlays/markupCustomPipes"),
    a.NewInfoWindow = function(a) {
        function b(a, b, d, e) {
            if (b && "geom" !== b.DataType) {
                var f = g.getFieldValue(b, d);
                b.Description && a.append(c("<span>", {
                    style: "font-style: italic;"
                }).append(b.Description + ": ")),
                f && "arr" === b.DataType && (f = f.join(", ")),
                a.append(c("<span>", {
                    style: "font-style: normal;"
                }).append(f || "")),
                e && a.append(e)
            }
        }
        function j(a, d, e, f) {
            if (f && b(a, f, d, c("<br>")),
            e.Fields)
                for (var g = 0; g < e.Fields.length; g++)
                    e.Fields[g] !== f && b(a, e.Fields[g], d, c("<br>"))
        }
        function k(a) {
            var b = {}
              , d = a.length;
            return 70 > d && (b.style = "white-space: nowrap"),
            c("<div>", b)
        }
        function l(a, b, d, e, f) {
            var g = b.name;
            if (g && "" !== g) {
                var h = "";
                f && f.Label && (h = f.Label + ": ");
                var i = k(h + g);
                i.append(c("<span>", {
                    style: "font-style: italic;"
                }).append(h)).append(c("<span>", {
                    style: "font-weight: bold;"
                }).append(g)).append(c("<br>")),
                a.append(i)
            }
            var l = d.Fields && d.Fields.length > 1;
            if (l && a.append(c("<hr/>")),
            j(a, b, d, e),
            l && a.append(c("<hr/>")),
            b.areaSqm) {
                var m = b.areaSqm + " m<sup>2</sup>";
                b.areaSqm >= 1e4 && (m = +(b.areaSqm / 1e6).toFixed(2) + " km<sup>2</sup>");
                var n = "Area: "
                  , o = k(n + m)
                  , p = c("<span>", {
                    style: "font-style: normal;"
                });
                p.append(m),
                o.append(c("<span>", {
                    style: "font-style: italic;"
                }).append(n), p),
                a.append(o)
            }
        }
        function m(a, b, e, f, g, h) {
            var k = c("<div>", {
                id: "contents",
                "class": "layers-iw-content"
            })
              , m = c("<span>");
            j(m, b, e, f, !0);
            var o = !0;
            if (g.ValueTemplate) {
                var q = {
                    featureCollection: a,
                    feature: b,
                    layer: e,
                    field: f,
                    geomType: g,
                    fieldsList: m.html()
                }
                  , r = i.up(g.ValueTemplate, q);
                r ? (k.append(r),
                o = !1) : d.log("Couldnt process template: " + g.ValueTemplate)
            }
            o && l(k, b, e, f, g),
            p(),
            n(k, h.latLng)
        }
        function n(a, b) {
            null  === s && (s = new h.InfoWindow({}),
            s.addListener("closeclick", function() {
                s.opened = !1
            })),
            s.setContent(a[0]),
            s.setPosition(b),
            s.setOptions({
                pixelOffset: new h.Size(0,-20),
                maxWidth: 400
            }),
            s.open(q),
            s.opened = !0
        }
        function o(a) {
            var b = q.getZoom();
            b === q.getZoom() && m(a.featureCollectionProperties, a.featureProperties, a.layer, a.field, a.geomType, a.e)
        }
        function p() {
            s && s.opened && (s.close(),
            s.opened = !1)
        }
        var q = a.mapObj
          , r = 300;
        a && a.debounceDelay && e.isNumeric(a.debounceDelay) && (r = a.debounceDelay);
        var s = null ;
        return h.InfoWindow.prototype.opened = !1,
        {
            showInfoWindow: f(o, r),
            closeInfoWindow: p
        }
    }
}),
nm_module("gooscr/overlays/overlays", function(a, b) {
    "use strict";
    function c(a) {
        return A.isCurrent(a) || A.isAdded(a)
    }
    function d() {
        return y.extend({}, A.getCurrent(), A.getAdded())
    }
    function e(a, b) {
        if (b) {
            a.IsMultiSelect = !0;
            var c = 0;
            y.each(d(), function(a, b) {
                b.IsMultiSelect && b.Zindex && (c = Math.max(c, b.Zindex))
            }),
            a.Zindex = c + 3
        } else
            a.IsMultiSelect = !1,
            a.Zindex = 0;
        A.addLater(a),
        i(a),
        s.closeInfoWindow()
    }
    function f() {
        if (!A.isEmpty()) {
            var a = u.getBounds()
              , b = u.getZoom();
            y.each(A.getCurrent(), function(c, d) {
                i(d, a, b)
            })
        }
    }
    function g(a) {
        return F[a] || (F[a] = 1),
        F[a]++,
        F[a]
    }
    function h(a) {
        return F[a]
    }
    function i(a, b, d) {
        return b || (b = u.getBounds(),
        d = u.getZoom()),
        a.GeomTypes ? void j(a, b, d) : (E("loadingLayerDescriptor").publish({
            layer: a
        }),
        void y.ajax({
            url: a.Url + "&cmd=layerdesc",
            dataType: "json",
            success: function(e) {
                return c(a) && d === u.getZoom() ? (y.extend(a, e),
                E("layerDescriptorAvailable").publish({
                    layer: a
                }),
                void j(a, b, d)) : void E("skippedLoadingLayer").publish({
                    layer: a
                })
            },
            error: function(b) {
                v.log("ajax call error", b),
                E("failedLoadingLayerDescriptor").publish({
                    layer: a
                })
            }
        }))
    }
    function j(a, b, d) {
        if (A.addNow(a),
        !b || !d)
            return v.log("missing bbox and zoom parameters"),
            void E("failedLoadingLayer").publish({
                layer: a
            });
        var e = a.MinimumZoom;
        if (e && e > d)
            return t.clear(a),
            void E("skippedLoadingLayer").publish({
                layer: a
            });
        E("loadingLayerData").publish({
            layer: a
        });
        var f = g("refreshLayer2");
        y.ajax({
            url: a.Url + B.getComparisonQueryPart(a) + "&cmd=geojson&z=" + d + "&bbox=" + b.getSouthWest().lng() + "," + b.getSouthWest().lat() + "," + b.getNorthEast().lng() + "," + b.getNorthEast().lat(),
            dataType: "json",
            success: function(b) {
                return c(a) && d === u.getZoom() ? void (f === h("refreshLayer2") && (E("layerGeomtriesReceived").publish({
                    layer: a
                }),
                k(a, b))) : void E("skippedLoadingLayer").publish({
                    layer: a
                })
            },
            error: function(b) {
                v.log("ajax call error", b),
                E("failedLoadingLayer").publish({
                    layer: a
                })
            }
        })
    }
    function k(a, b) {
        t.processGeoJson(a, b),
        A.addNow(a, b),
        E("layerDescriptorAvailable").publish({
            layer: a
        }),
        E("layerGeomtriesDisplayed").publish({
            layer: a
        })
    }
    function l(a) {
        var b = A.getCurrentGeoJson(a);
        b ? k(a, b) : f()
    }
    function m(a, b, c) {
        for (var d = 0; d < b.length; d++)
            if (a.Name === b[d])
                return c[d];
        return null 
    }
    function n(a, b, c, d, f, g) {
        if ("field" === b.Source) {
            B.setComparisonKeys(a, f, g);
            var h = m(b, c, d);
            return void (h ? (B.setActiveField(a, h),
            l(a)) : v.log("Couldn't find Activated field."))
        }
        var i = a.getUnmodified();
        i.Modifiers = i.Modifiers || {};
        var j = p(i.Modifiers, d)
          , k = !y.isEmptyObject(j);
        if (B.setComparisonKeys(j, f, g),
        k)
            return void e(j);
        for (var n = i.Url, o = 0; o < d.length; o++)
            n += w.format("&rel{0}={1}&key{2}={3}", o, encodeURIComponent(c[o]), o, encodeURIComponent(d[o]));
        y.extend(j, {
            Url: n,
            Unmodified: i
        }),
        E("loadingLayerDescriptor").publish({
            layer: j
        }),
        y.ajax({
            url: j.Url + "&cmd=layerdesc",
            dataType: "json",
            success: function(a) {
                y.extend(j, a, {
                    Opacity: i.Opacity
                }),
                E("layerDescriptorAvailable").publish({
                    layer: j
                }),
                e(j)
            },
            error: function(a) {
                v.log("ajax call error", a),
                E("failedLoadingLayerDescriptor").publish({
                    layer: j
                })
            }
        })
    }
    function o(a) {
        return a ? (t.clear(a),
        A.removeNow(a),
        s.closeInfoWindow(),
        void (a.Opacity && (a.getUnmodified().Opacity = a.Opacity))) : !1
    }
    function p(a, b, c) {
        for (var d = 3 === arguments.length ? b.pop() : !1, e = 0; e < b.length; e++)
            a = a[b[e]] = a[b[e]] || {};
        return d && (a = a[d] = c),
        a
    }
    function q(a) {
        t.showLabels(a),
        s.closeInfoWindow()
    }
    function r(a) {
        t.hideLabels(a),
        s.closeInfoWindow()
    }
    var s, t, u, v = b("nm/console"), w = b("jscore/strings"), x = b("jscore/async").callWhenIdle, y = b("js-libs/jquery").jQuery, z = b("gooscr/toolbar"), A = b("gooscr/overlays/layerState"), B = b("gooscr/overlays/styles"), C = b("gooscr/overlays/overlaysGeoJson"), D = b("gooscr/overlays/singleInfoWindow"), E = z.events.makeChannel("dataLayers"), F = {};
    a.init = function(b) {
        u = b,
        b.addListener("idle", x(f, 500, 500)),
        b.addListener("zoom_changed", function() {
            s.closeInfoWindow()
        }),
        E("refreshLayer").subscribe(function(a) {
            a && a.layer && c(a.layer) && i(a.layer)
        }),
        t = C.NewGeoJson({
            mapObj: b,
            mouseInteractionEnabled: !0
        }),
        a.isShowingLabels = t.isShowingLabels,
        a.changeOpacity = t.changeOpacity,
        a.setMouseInteraction = t.setMouseInteraction,
        s = D.NewInfoWindow({
            mapObj: b
        }),
        a.showInfoWindow = s.showInfoWindow,
        a.closeInfoWindow = s.closeInfoWindow,
        a.layerState = A,
        a.activate = e,
        a.deactivate = o,
        a.activateLayerWithModifier = n,
        a.isActive = c,
        a.getActiveLayers = d,
        a.showLabels = q,
        a.hideLabels = r,
        a.refresh = f,
        a.getActiveField = B.getActiveField,
        a.getTitle = B.getTitle,
        a.buckets = t.buckets
    }
}),
nm_module("gooscr/tools/datalayers/styleBuckets", function(a, b) {
    "use strict";
    var c = b("nm/tools/datalayers/hotzones").isHotSpottable
      , d = b("gooscr/toolbar")
      , e = b("js-libs/jquery").jQuery
      , f = d.events.makeChannel("dataLayers");
    a.NewStyleBuckets = function(a) {
        function b() {
            return v.Styles && v.Styles.length > 0
        }
        function d(a) {
            var b = a.is(".highlight-style-bucket-hidden");
            if (!b) {
                var c = a.is(".highlight-style-bucket-hover")
                  , d = a.is(".highlight-style-bucket-active");
                c || d ? r.highlightBucket(s, t, a.data("styleName")) : r.removeBucketHighlight(s, t, a.data("styleName"))
            }
        }
        function g(a) {
            var b = a.data.$inrLi;
            b.is(".highlight-style-bucket-hidden") || (b.is(".highlight-style-bucket-active") ? b.removeClass("highlight-style-bucket-active") : (e.each(b.parent().find("li.highlight-style-bucket-active"), function(a, b) {
                e(b).removeClass("highlight-style-bucket-active"),
                d(e(b))
            }),
            b.addClass("highlight-style-bucket-active")),
            d(b))
        }
        function h(a) {
            var b = a.data.$inrLi;
            b.addClass("highlight-style-bucket-hover"),
            b.find(".legend-style-checkbox").show(),
            b.find(".hotspot-btn").show(),
            d(b)
        }
        function i(a) {
            var b = a.data.$inrLi;
            b.removeClass("highlight-style-bucket-hover"),
            b.find(".legend-style-checkbox").hide(),
            b.find(".hotspot-btn").hide(),
            d(b)
        }
        function j(a) {
            var b = a.parent();
            a.is(".checked") ? (a.removeClass("checked").prop("title", "Show This Range").text("Show"),
            b.removeClass("highlight-style-bucket-active").removeAttr("title"),
            r.removeBucketHighlight(s, t, b.data("styleName")),
            b.addClass("highlight-style-bucket-hidden"),
            r.hideBucket(s, t, b.data("styleName"))) : (a.addClass("checked").prop("title", "Hide This Range").text("Hide"),
            r.unhideBucket(s, t, b.data("styleName")),
            b.removeClass("highlight-style-bucket-hidden").attr("title", b.data("title")))
        }
        function k() {
            return {
                style: "display: none;",
                "class": "legend-style-checkbox checked",
                text: "Hide",
                title: "Hide This Range"
            }
        }
        function l() {
            return {
                style: "display: none;",
                "class": "legend-style-checkbox",
                text: "Show",
                title: "Show This Range"
            }
        }
        function m(a) {
            var b = a.data.$checkBox;
            j(b),
            n(),
            a.stopPropagation()
        }
        function n() {
            var a = u.find(".legend-style-bucket-aggregate")
              , b = u.find(".legend-style-checkbox");
            b.filter(".checked").length === b.length ? a.hide("fast") : a.show("fast")
        }
        function o(a) {
            e.each(u.find(".legend-style-checkbox").not(".checked"), function(a, b) {
                j(e(b))
            });
            var b = a.data.$aggCheckBox;
            b.parent().hide("fast")
        }
        function p(a) {
            var d = e("<ul>", {
                "class": "bucket legend-style-buckets"
            });
            if (!b())
                return d;
            a = a || {};
            var j = !1;
            e.each(v.Styles, function(b, n) {
                var o = "" !== n.Value ? n.Value : n.From + " - " + n.To
                  , p = r.isBucketHidden(s, t, n.Name)
                  , q = a[b] && !p;
                q && r.hideBucket(s, t, n.Name);
                var u = a[b] || p;
                j |= u;
                var v = e("<li>", {
                    "class": "legend-style-bucket",
                    title: "Click to Highlight"
                }).data({
                    styleName: n.Name,
                    title: "Click to Highlight"
                })
                  , w = {
                    click: g,
                    mouseover: h,
                    mouseout: i
                };
                v.on(w, {
                    $inrLi: v
                }),
                u && v.addClass("highlight-style-bucket-hidden");
                var x = e("<label>", u ? l() : k());
                x.on("click", {
                    $checkBox: x
                }, m);
                var y;
                n.Colors && (y = n.Colors[s.ActiveColorIndex || 0]),
                y || (y = n.Color);
                var z = e("<span>", {
                    "class": "legend-style-color",
                    css: {
                        background: y
                    }
                })
                  , A = e("<label>", {
                    "class": "legend-style-bucket-label"
                }).append(o)
                  , B = "";
                c(s) && (B = e('<label        class="hotspot-btn"       title="Add range to HotSpot filter">   HS</label>'),
                B.hide(),
                B.click(function() {
                    return f("hotspots-add-filter").publish({
                        layer: s,
                        op: "range",
                        values: [parseFloat(n.From), parseFloat(n.To)]
                    }),
                    !1
                })),
                v.append(z).append(A).append(x).append(B).appendTo(d)
            });
            var n = e("<li>", {
                "class": "legend-style-bucket-aggregate"
            });
            j || n.css("display", "none");
            var p = e("<label>", {
                "class": "legend-style-checkbox-aggregate",
                text: "Show All",
                title: "Show All Ranges"
            });
            return p.on("click", {
                $aggCheckBox: p
            }, o),
            n.append(p).appendTo(d),
            d
        }
        function q() {
            if (b()) {
                var a = u.find(".legend-style-bucket");
                e.each(v.Styles, function(b, c) {
                    a.filter(function() {
                        return e(this).data("styleName") === c.Name
                    }).each(function() {
                        var a = "" !== c.Value ? c.Value : c.From + " - " + c.To;
                        e(this).find(".legend-style-bucket-label").text(a)
                    })
                })
            }
        }
        var r = a.overlayBuckets
          , s = a.layer
          , t = a.field
          , u = a.$layerInLegend
          , v = a.legendStyleSet;
        return {
            $build: p,
            $update: q
        }
    }
}),
nm_module("gooscr/tools/datalayers/legendBuilder", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("gooscr/overlays/styles")
      , e = b("gooscr/tools/datalayers/styleBuckets")
      , f = b("gooscr/toolbar")
      , g = b("gooscr/notify")
      , h = b("jscore/types").isUndefinedOrNull
      , i = b("nm/tools/datalayers/hotzones").isHotSpottable
      , j = f.events.makeChannel("dataLayers");
    a.NewLegendBuilder = function(a) {
        function b() {
            return w = c("<li>").data({
                id: t.getUnmodified().Name,
                zoom: v.Zoom,
                layer: t
            }),
            w.append(m()).append(n()).append(o()).append(r()).append(f()).append(k()).append(E.$build()).append(p()).append(q()),
            "Hometrack" === t.Source && w.append(c('<div class="hometrack-logo" />')),
            w
        }
        function f() {
            if (!i(t))
                return c('<span class="hotzone-selector" />');
            var a = c('<div class="hotzone-selector">Value    <select class="hotzone-operator">       <option value="gt">&gt;</option>       <option value="lt">&lt;</option>   </select>   <input type="number" class="hotzone-value" />   <div class="btn-add-to-hotzone">       Add to HotSpots   </div></div>')
              , b = a.find(".btn-add-to-hotzone");
            return b.click(function() {
                var b = a.find(".hotzone-operator").val()
                  , c = parseFloat(a.find(".hotzone-value").val());
                isNaN(c) ? g.alert("Please enter a number to add a HotSpot.", function() {
                    a.find(".hotzone-value").focus()
                }) : j("hotspots-add-filter").publish({
                    layer: t,
                    op: b,
                    values: [c]
                })
            }),
            a
        }
        function k() {
            if (!i(t))
                return c('<span class="style-selector-container" />');
            var a = c('<div class="style-selector-container">Theme:    <select class="style-selector">   </select></div>')
              , b = a.find(".style-selector")
              , d = 0
              , e = t.ColorSets;
            if ("undefined" != typeof e && (d = e.length),
            d > 0)
                for (var f = 0; d > f; f++)
                    b.append('<option value="' + f + '">' + e[f] + "</option>");
            else
                b.append('<option value="0">Default</option>');
            return b.change(function() {
                var a = parseInt(b.val(), 10);
                a = a || 0,
                t.ActiveColorIndex = a,
                j("layer-color-changed-hackidy-wack-wack").publish({
                    layer: t
                })
            }),
            b.val(t.ActiveColorIndex || 0),
            a
        }
        function l() {
            if (w.data("layer") === t && w.data("zoom"))
                return w.data("zoom") !== v.Zoom && (w.data("zoom", v.Zoom),
                E.$update()),
                void (t.MinimumZoom > 0 && w.find(".legend-title-id").replaceWith(m()));
            var a = {};
            w.find(".highlight-style-bucket-hidden").each(function() {
                a[c(this).index()] = !0
            }),
            w.data({
                id: t.getUnmodified().Name,
                zoom: v.Zoom,
                layer: t
            }),
            w.find(".legend-title-id").replaceWith(m()),
            w.find(".legend-style-buckets").replaceWith(E.$build(a)),
            w.find(".legend-transparency").replaceWith(p()),
            w.find(".legend-featureLabel").replaceWith(q()),
            w.find(".style-selector-container").replaceWith(k()),
            w.find(".hotzone-selector").replaceWith(f());
            var b = w.find(".layer-modifiers-container");
            null  !== b && b.data("empty") && b.replaceWith(r())
        }
        function m() {
            var a = d.getTitle(t)
              , b = t.MinimumZoom
              , e = C.getZoom();
            return b && b > e ? c("<span>", {
                "class": "legend-title-warning legend-title-id"
            }).append(a).append(c("<span>", {
                "class": "legend-warning"
            }).append("&nbsp;")).attr("title", "This layer is only available at higher zoom levels. Click to zoom in.").on("click", function() {
                var a = C.getZoom();
                !b || a >= b || C.setZoom(b)
            }) : c("<span>", {
                "class": "legend-title legend-title-id"
            }).append(a)
        }
        function n() {
            var a = c("<label>", {
                "class": "legend-close-btn",
                text: "Clear"
            }).attr("title", "Remove this " + A).on("click", function() {
                j("layerMgr.deactivateLayer").publish({
                    layer: t
                }),
                j("layerMgr.deactivateModifiedLayersOf").publish({
                    layer: t
                });
                var a = c(".layers-show-hide-button");
                a && !a.is(".layers-show-hide-button-checked") && D() && a.trigger("click")
            });
            return a
        }
        function o() {
            return c("<div>", {
                style: "clear: both;"
            })
        }
        function p() {
            var a = c("<div>", {
                "class": "trans-slider legend-transparency"
            });
            if (h(t.Opacity))
                return a;
            var b = c("<span>", {
                "class": "noUiSlider"
            }).noUiSlider({
                range: [0, 100],
                start: Math.min(Math.max(t.Opacity, 0), 100),
                step: 1,
                handles: 1
            });
            b.on("change", function() {
                t.Opacity = b.val(),
                y.changeOpacity(t)
            });
            var d = c("<label>").append("Transparency:&nbsp;").attr("title", "Click to reset transparency").on("click", function() {
                var a = t.DefaultOpacity;
                t.Opacity = a,
                b.val(a),
                y.changeOpacity(t)
            });
            return a.append(c("<label>", {
                "class": "trans-slider-label"
            })).append(d).append(b)
        }
        function q() {
            var a = c("<div>", {
                "class": "featureLabel legend-featureLabel"
            })
              , b = t.ShowFeatureNameLabels
              , e = !1;
            if ((!t.Fields || 0 === t.Fields.length) && h(b))
                return a;
            var f = t.Fields || []
              , g = "";
            if (f.length > 0)
                for (var i = 0; i < f.length; i++) {
                    var j = f[i];
                    if (j.hasOwnProperty("ShowLabels") && null  !== j.ShowLabels) {
                        g = j.Description,
                        e = !0;
                        break
                    }
                }
            if (!h(b) && !e) {
                var k = d.getActiveGeomType(t);
                g = k ? k.Label : "",
                e = !0
            }
            if (!e)
                return a;
            var l = "";
            g && (l = " Show " + g);
            var m = c("<input>", {
                "class": "featureLabel checkbox",
                type: "checkbox",
                checked: x.isShowingLabels(t)
            }).on("change", function() {
                c(this).is(":checked") ? x.showLabels(t) : x.hideLabels(t)
            });
            return a.append(c("<label>", {
                "class": "featureLabel-label"
            }).append(m, l))
        }
        function r() {
            var a = c("<div>", {
                "class": "layer-modifiers-container"
            }).data({
                layer: t
            });
            return t.Relations ? (c.each(t.Relations, function(b, d) {
                var e = "time" === d.Type
                  , f = c("<label>", {
                    "class": "layer-modifier-label"
                }).append(d.Desc + ": ")
                  , g = c("<select>", {
                    "class": "layer-modifier" + (e ? "-playable" : ""),
                    name: d.Name
                }).data({
                    index: b,
                    rel: d.Name,
                    relation: d
                }).on("change", s(a, d));
                c.each(d.Keys, function(a, b) {
                    var e = c("<option>", {
                        value: b
                    }).append(d.KeyDesc[a])
                      , f = "field" === d.Source && t.ActiveField ? b === t.ActiveField.Name : b === d.CurrKey;
                    f && e.attr("selected", ""),
                    e.appendTo(g)
                });
                var h = c("<div>").append(f).append(g);
                if (e) {
                    var i = c("<div>", {
                        "class": "layer-modifier-play-btn"
                    }).attr("title", "Autoplay");
                    i.on("click", function() {
                        z.startPlayRelation(d, a, i)
                    }),
                    i.data("relation", d),
                    h.append(i),
                    h.prependTo(a)
                } else
                    h.appendTo(a)
            }),
            a) : a.data("empty", !0)
        }
        function s(a, b) {
            return function() {
                var d = []
                  , e = [];
                c.each(a.find("select"), function(a, b) {
                    "DEFAULT" !== b.value && (d.push(c(b).data("rel")),
                    e.push(b.value))
                }),
                j("layerMgr.modifyLayer").publish({
                    layer: w.data("layer"),
                    relation: b,
                    modifierNames: d,
                    modifierKeys: e
                })
            }
        }
        var t = a.layer
          , u = a.field
          , v = a.legendStyleSet
          , w = a.$layerInLegend
          , x = a.labelMgr
          , y = a.opacityMgr
          , z = a.autoplay
          , A = a.singularName
          , B = a.overlayBuckets
          , C = a.gMap
          , D = a.isEmpty
          , E = e.NewStyleBuckets({
            overlayBuckets: B,
            layer: t,
            field: u,
            legendStyleSet: v,
            $layerInLegend: w
        });
        return {
            $buildLayerInLegend: b,
            update: l
        }
    }
}),
nm_module("gooscr/tools/datalayers/autoplay", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("jscore/types")
      , e = b("jscore/async").setTimeout
      , f = b("gooscr/toolbar");
    a.NewAutoPlay = function(a) {
        function b(a) {
            return function(b) {
                return b && b.layer ? a(b) : void 0
            }
        }
        function g(a, c) {
            r(a).subscribe(b(c))
        }
        function h() {
            if (null  !== p) {
                var a = new Date
                  , b = a.getTime() - q.getTime()
                  , c = s - b;
                c = Math.max(c, 0),
                e(function() {
                    p && (q = new Date,
                    p())
                }, c)
            }
        }
        function i(a) {
            p = a,
            e(h, 1)
        }
        function j(a) {
            p = null ,
            c.each(a, function(a, b) {
                o(c(b))
            })
        }
        function k(a, b, d) {
            var e = []
              , f = [];
            c.each(b.find("select"), function(b, d) {
                c(d).data("rel") === a.Name && (e.push(c(d).data("rel")),
                f.push(d.value))
            }),
            c.each(b.find("select"), function(b, d) {
                c(d).data("rel") !== a.Name && (e.push(c(d).data("rel")),
                f.push(d.value))
            });
            for (var g = [], h = [], j = 0; j < f.length; j++)
                g.push(e[j]),
                h.push(f[j]);
            o(d),
            i(function() {
                l(a, b, e, f, g, h, d)
            })
        }
        function l(a, b, c, d, e, f, g) {
            if (p) {
                var h = m(a, f[0]);
                if (!h)
                    return void j(g);
                f[0] = h,
                n(a, h, b),
                r("layerMgr.modifyLayer").publish({
                    layer: b.data("layer"),
                    relation: a,
                    modifierNames: e,
                    modifierKeys: f,
                    compModifierNames: c,
                    compModifierKeys: d
                })
            }
        }
        function m(a, b) {
            if (!a.Keys || a.Keys.length <= 1)
                return null ;
            for (var c = 0; c < a.Keys.length; c++)
                if (a.Keys[c] === b)
                    return c < a.Keys.length - 1 ? a.Keys[c + 1] : a.Keys[0];
            return null 
        }
        function n(a, b, d) {
            c.each(d.find("select"), function(d, e) {
                c(e).data("rel") === a.Name && c(e).val(b)
            })
        }
        function o(a) {
            if (!a.hasClass("layer-modifier-play-btn-checked"))
                return a.addClass("layer-modifier-play-btn-checked").attr("title", "Stop autoplay"),
                a.unbind("click"),
                void a.on("click", function() {
                    j(a)
                });
            var b = null 
              , d = a.parents(".layer-modifiers-container");
            d.length > 0 && (b = c(d[0])),
            a.removeClass("layer-modifier-play-btn-checked").attr("title", "Autoplay"),
            a.unbind("click"),
            a.on("click", function() {
                k(a.data("relation"), b, a)
            })
        }
        var p = null 
          , q = new Date
          , r = f.events.makeChannel("dataLayers")
          , s = 900;
        return a.playRelationFrameFrequency && d.isNumeric(a.playRelationFrameFrequency) && (s = a.playRelationFrameFrequency),
        g("layerGeomtriesDisplayed", h),
        g("failedLoadingLayerDescriptor", h),
        g("noGeometryData", h),
        g("failedLoadingLayer", h),
        g("skippedLoadingLayer", h),
        {
            stopPlayRelation: j,
            startPlayRelation: k
        }
    }
}),
nm_module("gooscr/tools/datalayers/legend", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("gooscr/tools/datalayers/legendBuilder")
      , e = b("gooscr/tools/datalayers/autoplay");
    a.NewLegend = function(a) {
        function b(a) {
            var b = u.find("li").filter(function() {
                return c(this).data("id") === a.getUnmodified().Name
            });
            return b && 0 === b.length ? null  : b
        }
        function f(a) {
            if (null  === a)
                return h(c(u.find("li")));
            var b = u.find("li").filter(function() {
                return c(this).data("id") !== a.getUnmodified().Name
            });
            return h(b)
        }
        function g() {
            return f(null )
        }
        function h(a) {
            return a && 0 === a.length ? null  : a
        }
        function i(a) {
            var c = b(a);
            c && c.remove(),
            m() && u.hide()
        }
        function j(a) {
            var b = {};
            return a.ActiveStyleSet && (b = c.extend(b, a.ActiveStyleSet)),
            b
        }
        function k(a) {
            if ("label" === a.DataType || !v.isActive(a))
                return void i(a);
            u.is(":visible") || u.show();
            var b = v.getActiveField(a)
              , c = j(a)
              , e = d.NewLegendBuilder({
                layer: a,
                gMap: A,
                field: b,
                legendStyleSet: c,
                labelMgr: w,
                opacityMgr: x,
                layerMgr: y,
                autoplay: C,
                isEmpty: m,
                singularName: B,
                overlayBuckets: z
            });
            u.append(e.$buildLayerInLegend)
        }
        function l(a) {
            var c = b(a);
            if (!c)
                return void k(a);
            var e = v.getActiveField(a)
              , f = j(a)
              , g = d.NewLegendBuilder({
                gMap: A,
                layer: a,
                field: e,
                legendStyleSet: f,
                labelMgr: w,
                opacityMgr: x,
                layerMgr: y,
                autoplay: C,
                isEmpty: m,
                singularName: B,
                overlayBuckets: z,
                $layerInLegend: c
            });
            g.update()
        }
        function m() {
            return 0 === u.find("li").length
        }
        function n(a) {
            if (a && a.style) {
                var d = b(a.layer)
                  , e = d.find(".legend-style-bucket").filter(function() {
                    return c(this).data("styleName") === a.style
                });
                c(e).addClass("highlight-style-bucket-orange")
            }
        }
        function o(a) {
            if (a && a.style) {
                var d = b(a.layer)
                  , e = d.find(".legend-style-bucket").filter(function() {
                    return c(this).data("styleName") === a.style
                });
                c(e).removeClass("highlight-style-bucket-orange")
            }
        }
        function p() {}
        function q() {}
        function r() {}
        function s() {
            for (var a = u.find(".layer-modifiers-container"), b = a.find("select"), d = 0; d < b.length; d++) {
                var e = b[d]
                  , f = c(e).data("relation");
                if (f && "field" === f.Source)
                    return e.value
            }
            return null 
        }
        function t() {
            C.stopPlayRelation(u.find(".layer-modifier-play-btn-checked"))
        }
        var u = a.$legend
          , v = a.overlays
          , w = a.labelMgr
          , x = a.opacityMgr
          , y = a.layerMgr
          , z = a.overlayBuckets
          , A = a.gMap
          , B = a.singularName
          , C = e.NewAutoPlay({});
        return {
            failedLoadingLayer: p,
            failedLoadingLayerDescriptor: q,
            noGeometryData: r,
            update: l,
            hide: i,
            $findLayer: b,
            $findLayersExcept: f,
            $findAllLayers: g,
            isEmpty: m,
            mouseoverGeomObj: n,
            mouseoutGeomObj: o,
            getActiveFieldNameFromModifiers: s,
            stopPlayRelation: t
        }
    }
}),
nm_module("gooscr/tools/datalayers/search", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("nm/metrics");
    a.NewSearch = function(a) {
        function b() {
            i.on("keyup change search", function() {
                e(i.val())
            }),
            d.setEvent({
                category: d.CATEGORIES.LayerUse,
                action: j + " - Search",
                event: "search." + j,
                showInfo: !0
            })
        }
        function e(a) {
            if (n !== a) {
                n = a;
                var b = l.find(".category.label").parent();
                if (!a)
                    return f(l.find(".layer.label")),
                    k.close(b);
                a = a.toLowerCase(),
                k.close(b),
                l.find(".layer.label").each(function() {
                    var b = c(this)
                      , d = b.text().toLowerCase().indexOf(a);
                    d > -1 ? g(b, d, a.length) : h(b)
                }),
                d.trigger("search." + j, {
                    label: "Query",
                    description: a
                })
            }
        }
        function f(a) {
            a.each(function(a, b) {
                var d = c(b);
                d.parent().show();
                var e = d.data("text");
                d.empty(),
                m && d.append(c("<input>", {
                    type: "checkbox"
                })).append(" "),
                d.append(e)
            })
        }
        function g(a, b, d) {
            a.each(function(a, e) {
                var f = c(e);
                f.parent().show();
                var g = f.data("text");
                for (f.empty(),
                m && f.append(c("<input>", {
                    type: "checkbox"
                })).append(" "),
                f.append(g.slice(0, b)).append(c("<span>", {
                    "class": "highlight-search-result"
                }).append(g.slice(b, b + d))).append(g.slice(b + d)); f && !f.is(l); )
                    k.open(f),
                    f = f.parent()
            })
        }
        function h(a) {
            a.each(function(a, b) {
                var d = c(b);
                d.parent().hide();
                var e = d.data("text");
                d.empty(),
                m && d.append(c("<input>", {
                    type: "checkbox"
                })).append(" "),
                d.append(e)
            })
        }
        var i = a.searchTextBox
          , j = a.name
          , k = a.tree
          , l = a.$tree
          , m = a.isMultiSelect
          , n = null ;
        return {
            init: b
        }
    }
}),
nm_module("gooscr/tools/datalayers/treeBuilder", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("jscore/async").setTimeout
      , e = b("jscore/async").clearTimeout
      , f = b("gooscr/overlays/styles")
      , g = b("gooscr/toolbar")
      , h = b("nm/metrics")
      , i = g.events.makeChannel("dataLayers");
    a.NewTreeBuilder = function(a) {
        function b() {
            var a = c(".tool-popup-container")
              , b = a.find(".popup-close")
              , d = a.find(".layers-show-hide-button");
            0 !== a.length && 0 !== b.length && 1 !== d.length && (d = c("<div>", {
                "class": "layers-show-hide-button"
            }),
            d.insertBefore(b))
        }
        function g() {
            m.empty(),
            t.length > 1 || t.length > 0 && t[0].Children.length > 0 ? c.each(t, function(a, b) {
                m.append(k(b))
            }) : t.length > 0 && c.each(t[0].Layers, function(a, b) {
                m.append(l(b))
            }),
            n.refresh();
            var a = j();
            return o.isEmpty() && a.showTree(),
            a
        }
        function j() {
            function a() {
                k.is(":visible") && (t = d(b, s))
            }
            function b(a) {
                e(t),
                k.is(":visible") && (a || !m && !l) && (i.removeClass("layers-show-hide-button-checked").attr("title", "Show " + q),
                r.attr("title", "Show " + q),
                k.hide("fast"))
            }
            function f() {
                e(t),
                k.is(":visible") || (i.addClass("layers-show-hide-button-checked").attr("title", "Hide " + q),
                r.attr("title", "Hide " + q),
                k.show("fast"))
            }
            function g() {
                i.is(".layers-show-hide-button-checked") ? b(!0) : f()
            }
            var h = c(".tool-popup-container").unbind("mouseenter mouseleave")
              , i = h.find(".layers-show-hide-button").unbind("click")
              , j = p.find(".layers-search").unbind("focus blur")
              , k = p.find(".layers-search-cont")
              , l = !1
              , m = !1;
            h.bind("mouseenter", function() {
                m = !0
            }),
            h.bind("mouseleave", function() {
                m = !1,
                l || o.isEmpty() || a()
            }),
            j.bind("focus", function() {
                l = !0
            }),
            j.bind("blur", function() {
                l = !1,
                m || o.isEmpty() || a()
            }),
            i.bind("click", function() {
                g(i)
            });
            var n = h.find(".tool-popup")
              , r = n.find(".heading");
            r.on("click", function() {
                g(i)
            }),
            r.css("cursor", "pointer"),
            k.is(":visible") ? (i.addClass("layers-show-hide-button-checked").attr("title", "Hide " + q),
            r.attr("title", "Hide " + q)) : (i.removeClass("layers-show-hide-button-checked").attr("title", "Show " + q),
            r.attr("title", "Show " + q));
            var s = 500
              , t = null ;
            return {
                hideTree: a,
                showTree: f,
                showHideTree: g
            }
        }
        function k(a) {
            var b = c("<div>", {
                "class": "category label"
            }).append(f.getTitle(a))
              , d = c("<li>", {}).append(b)
              , e = c("<ul>", {});
            return c.each(a.Children, function(a, b) {
                e.append(k(b))
            }),
            (a.Layers.length > 0 || 0 === a.Layers.length && 0 === a.Children.length) && d.addClass("layer-parent"),
            c.each(a.Layers, function(a, b) {
                e.append(l(b))
            }),
            d.append(e),
            d
        }
        function l(a) {
            var b = c("<label>", {
                "class": "layer label"
            }).data({
                id: a.Name,
                date: a.Date,
                url: a.Url,
                minimumZoom: a.MinimumZoom,
                text: f.getTitle(a)
            });
            if (r) {
                var d = c("<input>", {
                    type: "checkbox",
                    checked: s(a)
                });
                d.appendTo(b),
                b.on("click", function() {
                    c(this).find('input[type="checkbox"]').is(":checked") ? i("layerMgr.activateLayer").publish({
                        layer: a
                    }) : i("layerMgr.deactivateLayer").publish({
                        layer: a
                    })
                })
            } else
                b.on("click", function() {
                    c(this).is(".active") ? i("layerMgr.deactivateLayer").publish({
                        layer: a
                    }) : (i("layerMgr.deactivateAllLayersExcept").publish({
                        layer: a
                    }),
                    i("layerMgr.activateLayer").publish({
                        layer: a
                    }))
                });
            var e = c("<li>").append(b.append(" " + f.getTitle(a)));
            return h.setEvent({
                category: h.CATEGORIES.LayerUse,
                action: q + " - " + a.Description,
                event: "layer." + a.Name,
                showInfo: !0
            }),
            e
        }
        var m = a.$tree
          , n = a.tree
          , o = a.legend
          , p = a.popup
          , q = a.name
          , r = a.isMultiSelect
          , s = a.isLayerActive
          , t = a.categories;
        return {
            display: g,
            injectTreeShowButton: b
        }
    }
}),
nm_module("gooscr/tools/datalayers/layerMgr", function(a, b) {
    "use strict";
    var c, d = b("js-libs/jquery").jQuery, e = b("gooscr/popup"), f = b("nm/const/urls"), g = b("nm/const"), h = b("gooscr/overlays/styles"), i = b("nm/metrics"), j = b("jscore/types").isNumeric, k = b("jscore/types").isUndefinedOrNull, l = b("gooscr/tools/datalayers/treeBuilder");
    a.NewLayerMgr = function(a) {
        function b() {
            return g.HOST_URL
        }
        function m() {
            var c = J.length > 0;
            c && (d.each(J, function(a, b) {
                E(b)
            }),
            J = []);
            var e = b() + "maps?nmprovider=geojson&nml=overlay";
            d.ajax({
                url: e + "&cmd=categories&cattype=" + L,
                dataType: "json",
                success: function(b) {
                    a = b,
                    q(I, b, e),
                    s(),
                    t(),
                    Q.injectTreeShowButton(),
                    Q.display()
                }
            })
        }
        function n() {
            d(".hometrack-logo").remove()
        }
        function o(a) {
            n(),
            "Hometrack" === a.Source && d(".gm-style").append(d('<div class="hometrack-logo" />'))
        }
        function p(a) {
            d.each(M.getActiveLayers(), function(b) {
                M.setMouseInteraction(b, a)
            })
        }
        function q(a, b, c) {
            b && d.each(b, function(b, d) {
                u(a, b, d, c)
            })
        }
        function r(a, b, c) {
            k(a[b]) && (a[b] = c)
        }
        function s() {
            var a = d(".tool-popup-container");
            if (a) {
                var b = a.find(".popup-close");
                b.length > 0 && b.unbind("click.hide-layers").bind("click.hide-layers", function() {
                    w(!0)
                })
            }
        }
        function t() {
            var a = d(".tool-popup-container")
              , b = a.find(".popup-close")
              , c = a.find(".layers-help");
            0 !== a.length && 0 !== b.length && 1 !== c.length && (c = d("<div>", {
                "class": "layers-help"
            }),
            c.on("click", function() {
                var a = [{
                    text: "Learn about Map Layers",
                    link: f.MAP_LAYERS_INFO,
                    target: "maplayersinfo"
                }, {
                    text: "Give us feedback on our Layers feature!",
                    link: f.FEEDBACK,
                    target: "feedback"
                }];
                e.open(P, {
                    links: a,
                    position: ["right", "top"]
                })
            }),
            c.insertBefore(b))
        }
        function u(a, b, c, e) {
            r(a, b, {});
            var f = d.extend(a[b], c);
            r(f, "Children", []),
            r(f, "Layers", []),
            d.each(c.Layers, function(a, b) {
                r(f.Layers, a, {}),
                d.extend(f.Layers[a], b, {
                    Url: e + "&nmoverlay=" + b.Name
                }),
                v(f.Layers[a])
            }),
            a[b] = f,
            q(f.Children, c.Children, e)
        }
        function v(a) {
            "undefined" == typeof a.ActiveColorIndex ? a.ActiveColorIndex = c : c = a.ActiveColorIndex,
            o(a);
            var b = a.DefaultOpacity;
            j(b) && b >= 0 && r(a, "Opacity", b);
            var d = N.getActiveFieldNameFromModifiers();
            d && h.setActiveField(a, d);
            var e = "choropleth" === a.LayerType ? "#C9C0B8" : "#FF7800";
            r(a, "DefaultStrokeColor", e);
            var f = ("choropleth" === a.LayerType,
            "#46461F");
            r(a, "DefaultFillColor", f),
            r(a, "getUnmodified", function() {
                return a.Unmodified || a
            })
        }
        function w(a) {
            d.each(M.getActiveLayers(), function(b, c) {
                a && J.push(c),
                G(c)
            })
        }
        function x(a) {
            v(a.layer),
            M.isActive(a.layer) && N.update(a.layer)
        }
        function y() {}
        function z(a) {
            C(a.layer)
        }
        function A() {}
        function B(a) {
            var b = a.getUnmodified()
              , c = d.map(M.getActiveLayers(), function(c) {
                return c.Name !== a.Name && c.getUnmodified() === b ? c : null 
            });
            return c
        }
        function C(a) {
            var b = B(a);
            d.each(b, function(a, b) {
                M.deactivate(b)
            })
        }
        function D(a, b, c, d, e, f) {
            return 0 === c.length ? void M.activate(a, K) : void M.activateLayerWithModifier(a, b, c, d, e, f)
        }
        function E(a) {
            o(a);
            var b = O.find(".layer.label").filter(function() {
                return d(this).data("id") === a.Name
            });
            K ? b.find("input").prop("checked", !0) : (O.find(".layer.label").removeClass("active"),
            b.addClass("active")),
            h.clearComparisonKeys(a),
            M.activate(a, K),
            M.isActive(a) && N.update(a),
            i.trigger("layer." + a.Name)
        }
        function F(a) {
            var b = d.map(M.getActiveLayers(), function(b) {
                return b !== a ? b : null 
            });
            if (d.each(b, function(a, b) {
                G(b)
            }),
            !K) {
                var c = N.$findLayersExcept(a);
                c && c.remove()
            }
        }
        function G(a) {
            n(),
            N.stopPlayRelation(),
            N.hide(a);
            var b = O.find(".layer.label").filter(function() {
                return d(this).data("id") === a.Name
            });
            K ? b.find("input").prop("checked", !1) : b.removeClass("active"),
            M.deactivate(a)
        }
        function H(a) {
            if (!a.labelsAllowed) {
                var b = a.layer
                  , c = a.labelsAllowed
                  , d = N.$findLayer(b);
                if (d) {
                    var e = d.find(".featureLabel.checkbox");
                    e && c && e.prop("disabled") === !0 && (e.prop("disabled", !1).attr("title", null ),
                    e.is(":checked") && M.showLabels(b),
                    e.prop("disabled", !0).attr("title", "Labels are currently unavailable"),
                    M.hideLabels(b))
                }
            }
        }
        var I = []
          , J = []
          , K = a.isMultiSelect
          , L = a.categoryType
          , M = a.overlays
          , N = a.legend
          , O = a.$tree
          , P = a.popup
          , Q = l.NewTreeBuilder({
            tree: a.tree,
            name: a.name,
            $tree: O,
            categories: I,
            popup: P,
            legend: N,
            isMultiSelect: K,
            isLayerActive: M.isActive
        });
        return {
            layerDescriptorAvailable: x,
            layerGeomtriesReceived: y,
            layerGeomtriesProcessed: z,
            layerGeomtriesDisplayed: A,
            modifyLayer: D,
            activateLayer: E,
            deactivateLayer: G,
            deactivateAllLayersExcept: F,
            deactivateModifiedLayersOf: C,
            labelsAllowedChanged: H,
            hideAllLayers: w,
            refresh: m,
            setMouseInteraction: p
        }
    }
}),
nm_module("gooscr/tools/datalayers/tree", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery;
    a.NewTree = function(a) {
        function b() {
            var a = g.find(".category.label").on("click", function() {
                d(c(this).parent())
            });
            e(a.parent())
        }
        function d(a) {
            if (a.is(".closed")) {
                var b = g.children().filter(function() {
                    return c.inArray(this, a.parents()) < 0 && this !== a[0]
                });
                b.addClass("closed"),
                f(a)
            } else
                e(a)
        }
        function e(a) {
            a.addClass("closed")
        }
        function f(a) {
            a.removeClass("closed")
        }
        var g = a.$tree;
        return {
            refresh: b,
            toggle: d,
            close: e,
            open: f
        }
    }
}),
nm_module("nm/views/google/difflayer", function(a, b, c, d) {
    function e(a, b) {
        for (var c, d = [0, 0, 0], e = 0; 3 > e; e++)
            c = a[e],
            d[e] = Math.min(Math.max(0, c + c * b), 255);
        return d
    }
    function f(a, b, c) {
        b += 1,
        c += 1;
        var d = 3 * (129 * c + b)
          , e = a[d + 2] << 16 | a[d + 1] << 8 | a[d + 0];
        return e = e / 1280 - 1e3
    }
    function g(a, b, c, d, e) {
        var f = 4 * (128 * c + b);
        a[f] = d[0],
        a[f + 1] = d[1],
        a[f + 2] = d[2],
        a[f + 3] = e
    }
    function h(a, b) {
        var c = a - parseFloat(b) + 20
          , d = Math.pow(c, 3);
        d = .1533 * d;
        var e = Math.pow(c, 2);
        e = 1.5647 * e;
        var f = Math.pow(c, 1);
        f = 3.3395 * f;
        var g = .228
          , h = d - e + f + g;
        return h = Math.max(h, 0)
    }
    function i(a, b, c, d, i, j, k, l) {
        if (b && c) {
            var n = m("canvas");
            n.width = 128,
            n.height = 128;
            for (var o = n.getContext("2d"), r = o.createImageData(128, 128), s = r.data, t = 0; 128 > t; t++)
                for (var u = 0; 128 > u; u++) {
                    var v, w = i, x = [0, 0, 0], y = f(b, u, t), z = f(c, u, t), A = y - z;
                    if (l.indexOf(p) >= 0 && 0 >= A && (x = [255, 0, 0],
                    v = Math.abs(A),
                    w = h(v, d),
                    w = Math.min(w, 255)),
                    l.indexOf(q) >= 0 && A >= 0 && (x = [0, 0, 255],
                    v = Math.abs(A),
                    w = h(v, d),
                    w = Math.min(w, 255)),
                    l.indexOf(q) < 0 && l.indexOf(p) < 0 && (w = 0),
                    k) {
                        var B = -Math.min(Math.abs(A / 20), 1);
                        x = e(x, B)
                    }
                    g(s, u, t, x, w)
                }
            o.putImageData(r, 0, 0, 0, 0, 128, 128);
            var C = a.getContext("2d");
            C.clearRect(0, 0, a.width, a.height),
            C.drawImage(n, 0, 0, a.width, a.height)
        }
    }
    function j(a, b, c, d, e, f, g, h, j, k, m) {
        var n = ""
          , p = "";
        f && (n = "&nmd=" + l(f, "yyyymmdd", !0)),
        g && (p = "&nmd=" + l(g, "yyyymmdd", !0));
        var q, r, s = o + "maps/hl=en&x=" + b + "&y=" + c + "&z=" + d + "&nml=dsmc" + n + "&httpauth=false&version=2", t = o + "maps/hl=en&x=" + b + "&y=" + c + "&z=" + d + "&nml=dsmc" + p + "&httpauth=false&version=2", u = new XMLHttpRequest;
        u.open("GET", s),
        u.responseType = "arraybuffer",
        u.onload = function() {
            200 === u.status && (q = new Uint8Array(this.response),
            i(a, q || r, r || q, e, h, j, k, m))
        }
        ,
        u.send(),
        u = new XMLHttpRequest,
        u.open("GET", t),
        u.responseType = "arraybuffer",
        u.onload = function() {
            200 === u.status && (r = new Uint8Array(this.response),
            i(a, q || r, r || q, e, h, j, k, m))
        }
        ,
        u.send()
    }
    var k = b("js-libs/google", "maps")
      , l = b("jscore/dateutils", "format")
      , m = b("nm/dom", "createElement")
      , n = b("nm/geom", "getNormalizedCoord")
      , o = b("nm/const", "HOST_URL")
      , p = b("nm/const", "DEPTH")
      , q = b("nm/const", "HEIGHT")
      , r = a.DiffLayer = c(Object, {
        constructor: function(a, b, c, d, e, f, g) {
            r.base.call(this),
            this.tileSize = new k.Size(256,256),
            this.maxZoom = 24,
            this.name = "Flooding",
            this.alt = "Flooding simulation",
            this.threshold = a,
            this.date1 = b,
            this.date2 = c,
            this.transparency = d,
            this.color = e,
            this.gradient = f,
            this.tiles = [],
            this.selectedOption = g
        },
        getTile: function(a, b, c) {
            a = n(a, b);
            var d = c.createElement("canvas")
              , e = this.tileSize.width
              , f = this.tileSize.height;
            return d.width = e,
            d.height = f,
            d.style.width = e + "px",
            d.style.height = f + "px",
            null  === a ? d : (this.tiles.push(d),
            d.requestParams = {
                x: a.x,
                y: a.y,
                z: b - 1
            },
            this.threshold && j(d, a.x, a.y, b - 1, this.threshold, this.date1, this.date2, this.transparency, this.color, this.gradient, this.selectedOption),
            d)
        },
        releaseTile: function(a) {
            var b = this.tiles
              , c = b.indexOf(a);
            c >= 0 && b.splice(c, 1)
        },
        setParameters: function(a, b, c, d, e, f, g) {
            this.threshold = a,
            this.date1 = b,
            this.date2 = c,
            this.transparency = d,
            this.color = e,
            this.gradient = f,
            this.selectedOption = g,
            this.tiles.forEach(function(h) {
                var i = h.requestParams;
                j(h, i.x, i.y, i.z, a, b, c, d, e, f, g)
            })
        }
    })
}),
nm_module("nm/tools/compare/difftab", function(a, b, c, d) {
    a.html = '<div class="diff-tab">\n  <ul><li>\n    <div class="prop-row">\n        <label>Compare Date</label>\n        <select class="dates" />\n    </div>\n    <div class="prop-row">\n        <label>Threshold</label>\n        <div class="threshold" />\n    </div>\n    <div class="prop-row">\n       <label class="water-level">Color</label>\n       <label class="lbl-gradient">\n           <input type="checkbox" class="gradient" checked />\n           depth shading\n       </label>\n\n    </div>\n\n      <div class="prop-row">\n          <label class="water-level">Height</label>\n          <span>\n            <span class="cbox blue grad selected" data-color="b"/>\n          </span>\n      </div>\n\n      <div class="prop-row">\n          <label class="water-level">Depth</label>\n          <span>\n            <span class="cbox red grad" data-color="r"/>\n          </span>\n      </div>\n\n    <div class="prop-row">\n       <label>Transparency</label>\n\n       <span class="noUiSlider trans-slider noUi-target">\n       </span>\n\n    </div>\n    <div class="prop-row">\n       <label class="water-level">\n           <input type="checkbox" class="show-diff" />\n           Show Changes\n       </label>\n    </div>\n    <div class="date-unavailable">\n       Data unavailable, please select another date.\n    </div>\n  </li></ul>\n</div>'
}),
nm_module("nm/tools/compare/diffvis", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/itertools", "find")
      , g = b("jscore/async", "callWhenIdle")
      , h = b("jscore/events", "Change")
      , i = b("nm/metrics", "trigger")
      , j = b("nm/const/imagery", "DSM")
      , k = b("jscore/dateutils", "isEqualDateTime")
      , l = b("jscore/dateutils", "format")
      , m = b("nm/client", "hasSupportForTypedArrays")
      , n = b("nm/tools/volume/unitsinputview", "UnitsInputView")
      , o = b("nm/views/google/difflayer", "DiffLayer")
      , p = b("nm/tools/compare/difftab", "html")
      , q = b("js-libs/jquery", "jQuery")
      , r = b("nm/const", "DEPTH")
      , s = b("nm/const", "HEIGHT")
      , t = b("nm/intl", "getText")
      , u = {
        m: 1,
        ft: 3.2808399,
        yd: 1.0936133
    }
      , v = '<div class="diffing-tab">  Your browser is not supported. Please use another browser.<br></div>'
      , w = {
        range: [0, 100],
        start: 70,
        step: 1,
        handles: 1
    }
      , x = a.DiffPanel = c(Object, {
        constructor: function(a, b, c, d, e) {
            x.base.call(this),
            this.auth = a,
            this.surveysController = b,
            this.surveyInfo = c,
            this.map = d,
            this.gMap = d.tmpGoogleMapViewController.gMap,
            this.container = e,
            this._selectedOption = "height",
            this.buildUI(),
            this.registerListeners()
        },
        buildUI: function() {
            var a, b = this.container;
            return m() ? (a = q(p),
            this.$popup = a,
            this.$showDiff = a.find(".show-diff"),
            this.thresholdInput = new n(u,a.find(".threshold"),10),
            this.$grad = a.find("input.gradient"),
            this.$dateUnavailable = a.find(".date-unavailable"),
            this.$compDateList = a.find(".dates"),
            this.$transSlider = a.find(".trans-slider").noUiSlider(w),
            b.append(a),
            this.initCompareDate(),
            void this.updateDates()) : (a = q(v),
            b.append(a),
            void (this.$popup = null ))
        },
        initCompareDate: function() {
            var a = this.surveysController
              , b = a.getAvailableDates().reverse()
              , c = a.getDisplayDate()
              , d = b[0];
            d = f(b, d, function(a) {
                return c > a
            }),
            this.compareDate = d
        },
        updateDates: function() {
            var a = this.surveysController
              , b = a.getAvailableDates()
              , c = this.compareDate
              , e = this.$compDateList;
            e.empty();
            for (var f, g = t("formats.day-date"), h = b.reverse()[d.iterator](); !(f = h.next()).done; ) {
                var i = f.value
                  , j = l(i, g, !0)
                  , k = l(i, "yyyy-mm-dd", !0);
                e.append('<option value="' + k + '">' + j + "</option>")
            }
            e.val(l(c, "yyyy-mm-dd", !0))
        },
        dateChanged: function() {
            this.compareDate = new Date(this.$compDateList.val()),
            this.update()
        },
        registerListeners: function() {
            var a = this.$popup;
            if (null  !== a) {
                var b = e(this, this.update)
                  , c = g(b, 100)
                  , d = this.$showDiff;
                d.change(b),
                this.$transSlider.change(function() {
                    b()
                }),
                this.thresholdInput.addListener(h, function() {
                    d.prop("checked", !0),
                    c()
                });
                var f = a.find(".cbox");
                f.click(e(this, function(c) {
                    d.prop("checked", !0);
                    var e = c.target
                      , f = a.find(".cbox")
                      , g = q(f[0])
                      , h = q(f[1])
                      , i = "";
                    q(e).hasClass("red") && (h.hasClass("selected") ? h.removeClass("selected") : h.addClass("selected")),
                    q(e).hasClass("blue") && (g.hasClass("selected") ? g.removeClass("selected") : g.addClass("selected")),
                    g.hasClass("selected") && (i = s),
                    h.hasClass("selected") && (i += r),
                    this._selectedOption = i,
                    b()
                }));
                var i = this.$grad;
                i.click(function() {
                    d.prop("checked", !0),
                    i.prop("checked") ? f.addClass("grad") : f.removeClass("grad"),
                    b()
                }),
                this.$compDateList.change(function(a) {
                    a.target.blur(),
                    this.dateChanged()
                }
                .bind(this)),
                this.surveysController.addListener(h, c)
            }
        },
        update: function() {
            this.updateDates();
            var a = this.surveyInfo
              , b = a.getDates(j)
              , c = this.surveysController.getDesiredDate()
              , d = this.compareDate
              , e = this._selectedOption
              , g = b.length > 0;
            if (c && g) {
                var h = f(b, null , function(a) {
                    return c > a || k(a, c, !0)
                });
                g = null  !== h
            }
            var l = this.$dateUnavailable;
            g ? l.hide() : l.show();
            var m = this.$showDiff
              , n = m.prop("checked");
            if (!n || !g)
                return void this.clearLayer();
            var p = 2.56 * this.$transSlider.val()
              , q = this.thresholdInput.getValue()
              , r = this.$grad.prop("checked")
              , s = this.layer
              , t = this.map
              , u = [0, 0, 0];
            s ? s.setParameters(q, c, d, p, u, r, e) : (s = new o(q,c,d,p,u,r,e),
            this.layer = s,
            this.gMap.overlayMapTypes.push(s));
            var v = t.getCenter()
              , w = t.getZoom();
            i("compare.diff.layer.params_changed", {
                label: "parameters",
                description: "diff params",
                value: JSON.stringify({
                    threshold: q,
                    date1: c,
                    date2: d,
                    transparency: p,
                    color: u,
                    gradient: r,
                    center: v,
                    zoom: w
                })
            })
        },
        clearLayer: function() {
            var a = this.layer;
            if (a) {
                var b = this.gMap.overlayMapTypes
                  , c = b.indexOf(a);
                c >= 0 && (b.removeAt(c),
                this.layer = null )
            }
        }
    })
}),
function(a) {
    "use strict";
    if (a.zepto && !a.fn.removeData)
        throw new ReferenceError("Zepto is loaded without the data module.");
    a.fn.noUiSlider = function(b) {
        function c(a, b) {
            return 100 * b / (a[1] - a[0])
        }
        function d(a, b) {
            return c(a, a[0] < 0 ? b + Math.abs(a[0]) : b - a[0])
        }
        function e(a, b) {
            return b * (a[1] - a[0]) / 100 + a[0]
        }
        function f(b, c, d) {
            a.isArray(b) || (b = [b]),
            a.each(b, function() {
                "function" == typeof this && this.call(c, d)
            })
        }
        function g(b) {
            return b instanceof a || a.zepto && a.zepto.isZ(b)
        }
        function h(b) {
            b.preventDefault();
            var c, d, e = 0 === b.type.indexOf("touch"), f = 0 === b.type.indexOf("mouse"), g = 0 === b.type.indexOf("pointer"), h = b;
            return 0 === b.type.indexOf("MSPointer") && (g = !0),
            b.originalEvent && (b = b.originalEvent),
            e && (c = b.changedTouches[0].pageX,
            d = b.changedTouches[0].pageY),
            (f || g) && (g || void 0 !== window.pageXOffset || (window.pageXOffset = document.documentElement.scrollLeft,
            window.pageYOffset = document.documentElement.scrollTop),
            c = b.clientX + window.pageXOffset,
            d = b.clientY + window.pageYOffset),
            a.extend(h, {
                pointX: c,
                pointY: d,
                cursor: f
            })
        }
        function i(b, c, d, e, f) {
            return b = b.replace(/\s/g, D + " ") + D,
            f ? c.on(b, a.proxy(d, a.extend(c, e))) : (e.handler = d,
            c.on(b, a.proxy(function(a) {
                return this.target.hasClass("noUi-state-tap") || this.target.attr("disabled") ? !1 : void this.handler(h(a))
            }, e)))
        }
        function j(a) {
            return !isNaN(parseFloat(a)) && isFinite(a)
        }
        function k() {
            var b = parseFloat(this.style[a(this).data("style")]);
            return isNaN(b) ? -1 : b
        }
        function l(b) {
            var c = this.target;
            return void 0 === b ? this.element.data("value") : (b === !0 ? b = this.element.data("value") : this.element.data("value", b),
            void a.each(this.elements, function() {
                "function" == typeof this ? this.call(c, b) : this[0][this[1]](b)
            }))
        }
        function m() {
            var a = [null , null ];
            a[this.which] = this.val(),
            this.target.val(a, !0)
        }
        function n(b, d) {
            var e = {
                handles: {
                    r: !0,
                    t: function(a) {
                        return a = parseInt(a, 10),
                        1 === a || 2 === a
                    }
                },
                range: {
                    r: !0,
                    t: function(a, b, c) {
                        return 2 !== a.length ? !1 : (a = [parseFloat(a[0]), parseFloat(a[1])],
                        j(a[0]) && j(a[1]) ? "range" === c && a[0] === a[1] ? !1 : a[1] < a[0] ? !1 : (b[c] = a,
                        !0) : !1)
                    }
                },
                start: {
                    r: !0,
                    t: function(b, c, d) {
                        return 1 === c.handles ? (a.isArray(b) && (b = b[0]),
                        b = parseFloat(b),
                        c.start = [b],
                        j(b)) : e.range.t(b, c, d)
                    }
                },
                connect: {
                    t: function(a, b) {
                        return 1 === b.handles ? "lower" === a || "upper" === a : "boolean" == typeof a
                    }
                },
                orientation: {
                    t: function(a) {
                        return "horizontal" === a || "vertical" === a
                    }
                },
                margin: {
                    r: !0,
                    t: function(a, b, d) {
                        return a = parseFloat(a),
                        b[d] = c(b.range, a),
                        j(a)
                    }
                },
                direction: {
                    r: !0,
                    t: function(a, b, c) {
                        switch (a) {
                        case "ltr":
                            b[c] = 0;
                            break;
                        case "rtl":
                            b[c] = 1;
                            break;
                        default:
                            return !1
                        }
                        return !0
                    }
                },
                serialization: {
                    r: !0,
                    t: function(b, c, d) {
                        function e(a) {
                            return g(a) || "string" == typeof a || "function" == typeof a || a === !1 || g(a[0]) && "function" == typeof a[0][a[1]]
                        }
                        function f(b) {
                            var c = [[], []];
                            return e(b) ? c[0].push(b) : a.each(b, function(a, b) {
                                a > 1 || (e(b) ? c[a].push(b) : c[a] = c[a].concat(b))
                            }),
                            c
                        }
                        if (b.to) {
                            var h, i;
                            for (b.to = f(b.to, 0),
                            c.direction && b.to[1].length && b.to.reverse(),
                            h = 0; h < c.handles; h++)
                                for (i = 0; i < b.to[h].length; i++) {
                                    if (!e(b.to[h][i]))
                                        return !1;
                                    b.to[h][i] || b.to[h].splice(i, 1)
                                }
                            c[d].to = b.to
                        } else
                            c[d].to = [[], []];
                        if (b.resolution)
                            switch (b.resolution) {
                            case 1:
                            case .1:
                            case .01:
                            case .001:
                            case 1e-4:
                            case 1e-5:
                                break;
                            default:
                                return !1
                            }
                        else
                            c[d].resolution = .01;
                        if (b.mark) {
                            if ("." !== b.mark && "," !== b.mark)
                                return !1
                        } else
                            c[d].mark = ".";
                        return !0
                    }
                },
                slide: {
                    t: function(a) {
                        return "function" == typeof a
                    }
                },
                set: {
                    t: function(a, b) {
                        return e.slide.t(a, b)
                    }
                },
                block: {
                    t: function(a, b) {
                        return e.slide.t(a, b)
                    }
                },
                step: {
                    t: function(a, b, c) {
                        return a = parseFloat(a),
                        b[c] = a,
                        j(a)
                    }
                }
            };
            a.each(e, function(a, c) {
                var e = b[a]
                  , f = e || 0 === e;
                if (c.r && !f || f && !c.t(e, b, a))
                    throw console && console.log && console.group && (console.group("Invalid noUiSlider initialisation:"),
                    console.log("Option:	", a),
                    console.log("Value:	", e),
                    console.log("Slider(s):	", d),
                    console.groupEnd()),
                    new RangeError("noUiSlider")
            })
        }
        function o(a, b) {
            return Math.round(a / b) * b
        }
        function p(a, b) {
            return a = a.toFixed(b.decimals),
            a.replace(".", b.serialization.mark)
        }
        function q(a, b, c) {
            if (b)
                return !1;
            var d = a.data("target");
            return d.hasClass(F[14]) || (c || (d.addClass(F[15]),
            setTimeout(function() {
                d.removeClass(F[15])
            }, 600)),
            d.addClass(F[14]),
            f(a.data("options").block, d)),
            !1
        }
        function r(a, b, d) {
            var f, g = a.data("options"), h = a.data("base"), i = h.data("handles"), k = a[0].gPct();
            return b = 0 > b ? 0 : b > 100 ? 100 : b,
            j(b) && b !== k ? (g.step && (b = o(b, c(g.range, g.step))),
            b === k ? !1 : (i.length > 1 && (a[0] === i[1][0] ? (f = i[0][0].gPct() + g.margin,
            b = f > b ? f : b) : (f = i[1][0].gPct() - g.margin,
            b = b > f ? f : b)),
            b = 0 > b ? 0 : b > 100 ? 100 : b,
            b === k ? q(h, d, !g.margin) : (h.data("target").removeClass(F[14]),
            a.css(a.data("style"), b + "%"),
            a[0] === i[0][0] && a.children("." + F[2]).toggleClass(F[13], b > 50),
            g.direction && (b = 100 - b),
            a.data("store").val(p(e(g.range, b), g)),
            !0))) : !1
        }
        function s(b, c, d) {
            if (g(c)) {
                var e = [];
                return b.data("options").direction && (d = d ? 0 : 1),
                c.each(function() {
                    i("change", a(this), m, {
                        target: b.data("target"),
                        handle: b,
                        which: d
                    }, !0),
                    e.push([a(this), "val"])
                }),
                e
            }
            return "string" == typeof c && (c = [a('<input type="hidden" name="' + c + '">').appendTo(b).addClass(F[3]).change(function(a) {
                a.stopPropagation()
            }), "val"]),
            [c]
        }
        function t(b, c, d) {
            var e = [];
            return a.each(d.to[c], function(a) {
                e = e.concat(s(b, d.to[c][a], c))
            }),
            {
                element: b,
                elements: e,
                target: b.data("target"),
                val: l
            }
        }
        function u(a) {
            var b, c, d = this.base;
            "left" === this.handle.data("style") ? (b = a.pointX - this.startEvent.pointX,
            c = d.width()) : (b = a.pointY - this.startEvent.pointY,
            c = d.height()),
            b = this.position + 100 * b / c,
            r(this.handle, b) && f(d.data("options").slide, d.data("target"))
        }
        function v(a) {
            this.handle.children("." + F[2]).removeClass(F[4]),
            a.cursor && C.css("cursor", "").off(D),
            B.off(D),
            this.target.removeClass(F[14]).change(),
            f(this.handle.data("options").set, this.target)
        }
        function w(a) {
            this.handle.children("." + F[2]).addClass(F[4]),
            a.stopPropagation(),
            i(G.move, B, u, {
                startEvent: a,
                position: this.handle[0].gPct(),
                base: this.base,
                target: this.target,
                handle: this.handle
            }),
            i(G.end, B, v, {
                base: this.base,
                target: this.target,
                handle: this.handle
            }),
            a.cursor && (C.css("cursor", "default"),
            C.on("selectstart" + D, function() {
                return !1
            }))
        }
        function x(a) {
            if (!this.base.find("." + F[4]).length) {
                var b, c, d, e = this.base, g = e.data("handles"), h = g[0].data("style"), i = a["left" === h ? "pointX" : "pointY"], j = "left" === h ? e.width() : e.height(), k = {
                    handles: [],
                    base: e.offset()
                };
                for (b = 0; b < g.length; b++)
                    k.handles.push(g[b].offset());
                d = 1 === g.length ? 0 : (k.handles[0][h] + k.handles[1][h]) / 2,
                c = 1 === g.length || d > i ? g[0] : g[1],
                e.addClass(F[5]),
                setTimeout(function() {
                    e.removeClass(F[5])
                }, 300),
                r(c, 100 * (i - k.base[h]) / j),
                f([c.data("options").slide, c.data("options").set], e.data("target")),
                e.data("target").change()
            }
        }
        function y(b) {
            return b = a.extend({
                handles: 2,
                margin: 0,
                direction: "ltr",
                orientation: "horizontal"
            }, b) || {},
            b.serialization = b.serialization || {},
            n(b, this),
            this.each(function() {
                var c, d, e = a(this).addClass(F[6]), f = a("<div/>").appendTo(e), g = b.direction, h = {
                    base: [F[0]],
                    origin: [[F[1], F[1] + F[g ? 8 : 7]], [F[1], F[1] + F[g ? 7 : 8]]],
                    handle: [[F[2], F[2] + F[g ? 8 : 7]], [F[2], F[2] + F[g ? 7 : 8]]]
                };
                for (b.connect ? (g && ("lower" === b.connect ? b.connect = "upper" : "upper" === b.connect && (b.connect = "lower")),
                "lower" === b.connect ? (h.base.push(F[9], F[9] + F[7]),
                h.origin[0].push(F[12])) : (h.base.push(F[9] + F[8], F[12]),
                h.origin[0].push(F[9]))) : h.base.push(F[12]),
                b.decimals = function(a) {
                    return a = a.toString().split("."),
                    "1" === a[0] ? 0 : a[1].length
                }(b.serialization.resolution),
                "vertical" === b.orientation ? h.base.push(F[10]) : h.base.push(F[11]),
                f.addClass(h.base.join(" ")).data({
                    target: e,
                    options: b,
                    handles: []
                }),
                e.data("base", f),
                g && e.addClass(F[16]),
                c = 0; c < b.handles; c++)
                    d = a("<div><div/></div>").appendTo(f),
                    d.addClass(h.origin[c].join(" ")),
                    d.children().addClass(h.handle[c].join(" ")),
                    i(G.start, d.children(), w, {
                        base: f,
                        target: e,
                        handle: d
                    }),
                    d.data({
                        base: f,
                        target: e,
                        options: b,
                        style: "vertical" === b.orientation ? "top" : "left"
                    }),
                    d.data({
                        store: t(d, c, b.serialization)
                    }),
                    d[0].gPct = k,
                    f.data("handles").push(d);
                e.val(b.start),
                i(G.start, f, x, {
                    base: f,
                    target: e
                })
            })
        }
        function z() {
            var b = a(this).data("base")
              , c = [];
            return a.each(b.data("handles"), function() {
                c.push(a(this).data("store").val())
            }),
            1 === c.length ? c[0] : b.data("options").direction ? c.reverse() : c
        }
        function A(b, c) {
            return a.isArray(b) || (b = [b]),
            this.each(function() {
                var e, g, h = Array.prototype.slice.call(a(this).data("base").data("handles"), 0), i = h[0].data("options");
                for (h.length > 1 && (h[2] = h[0]),
                i.direction && b.reverse(),
                g = 0; g < h.length; g++)
                    e = b[g % 2],
                    null  !== e && void 0 !== e && ("string" === a.type(e) && (e = e.replace(",", ".")),
                    e = d(i.range, parseFloat(e)),
                    i.direction && (e = 100 - e),
                    r(h[g], e, !0) || h[g].data("store").val(!0),
                    c === !0 && f(i.set, a(this)))
            })
        }
        var B = a(document)
          , C = a("body")
          , D = ".nui"
          , E = a.fn.val
          , F = ["noUi-base", "noUi-origin", "noUi-handle", "noUi-input", "noUi-active", "noUi-state-tap", "noUi-target", "-lower", "-upper", "noUi-connect", "noUi-vertical", "noUi-horizontal", "noUi-background", "noUi-z-index", "noUi-block", "noUi-state-blocked", "noUi-rtl"]
          , G = window.navigator.pointerEnabled ? {
            start: "pointerdown",
            move: "pointermove",
            end: "pointerup"
        } : window.navigator.msPointerEnabled ? {
            start: "MSPointerDown",
            move: "MSPointerMove",
            end: "MSPointerUp"
        } : {
            start: "mousedown touchstart",
            move: "mousemove touchmove",
            end: "mouseup touchend"
        };
        return a.fn.val = function() {
            return this.hasClass(F[6]) ? arguments.length ? A.apply(this, arguments) : z.apply(this) : E.apply(this, arguments)
        }
        ,
        y.call(this, b)
    }
}(window.jQuery || window.Zepto),
nm_module("gooscr/tools/datalayers/datalayers", function(a, b) {
    "use strict";
    function c(a, b) {
        function c(a) {
            g(i),
            0 === a ? (d.hide(),
            h.hide()) : (100 === a && f(e(c, 0), 200),
            i = f(e(c, 0), 5e3),
            h.show(),
            d.show(),
            a = j.width() * a / 100,
            d.width(a + "px"))
        }
        var d = a.find(".loading-indicator")
          , h = a.find(".loading-label")
          , i = null 
          , j = d.parent();
        c(0),
        b("loadingLayerDescriptor", e(c, 10)),
        b("layerDescriptorAvailable", e(c, 50)),
        b("loadingLayerData", e(c, 60)),
        b("layerGeomtriesReceived", e(c, 70)),
        b("layerGeomtriesProcessed", e(c, 90)),
        b("layerGeomtriesDisplayed", e(c, 100)),
        b("failedLoadingLayerDescriptor", e(c, 100)),
        b("noGeometryData", e(c, 100)),
        b("failedLoadingLayer", e(c, 100)),
        b("skippedLoadingLayer", e(c, 100))
    }
    var d = b("nm/const/tools")
      , e = b("jscore/functools").partial
      , f = b("jscore/async").setTimeout
      , g = b("jscore/async").clearTimeout
      , h = b("nm/tools/datalayers/hotzones").HotzonesManager
      , i = b("nm/tools/datalayers/hotzones").HotzonesView
      , j = b("nm/tools/datalayers/hotzones").HotzonesLayer
      , k = b("nm/tools/flooding/floodpanel").FloodPanel
      , l = b("nm/tools/shadowing/shadowpanel").ShadowPanel
      , m = b("jscore/events").Change
      , n = b("jscore/itertools").filter
      , o = b("js-libs/jquery").jQuery
      , p = b("gooscr/overlays/overlays")
      , q = b("gooscr/overlays/layerState")
      , r = b("gooscr/toolbar")
      , s = b("gooscr/tools/datalayers/legend")
      , t = b("gooscr/tools/datalayers/search")
      , u = b("gooscr/tools/datalayers/layerMgr")
      , v = b("gooscr/tools/datalayers/tree")
      , w = b("nm/tools/compare/diffvis").DiffPanel
      , x = b("jscore/itertools").map
      , y = b("jscore/itertools").array;
    b("js-libs/jquery/nouislider.js");
    var z = '<div>   <div class="loading-label">loading...</div>   <div class="loading-indicator" />    <div class="ui-tabs">       <ul>           <li>               <button type="button" class="btn-layers">                   Data</button>           </li>           <li>               <button type="button" class="btn-hotzones">                   HotSpot</button>           </li>           <li>               <button type="button" class="btn-flooding">                   Flooding</button>           </li>           <li>               <button type="button" class="btn-shadowing">                   Shadowing</button>           </li>           <li>               <button type="button" class="btn-diff">                   &gt;</button>           </li>       </ul>    </div>    <div class="data-layers-tab">       <div class="layers-search-cont">           <div class="layers-search-wrapper">               <input class="layers-search" type="search"                    placeholder="Search for Layer" />           </div>           <div class="layers-cont">               <ul class="layers-tree"></ul>           </div>       </div>       <ul class="layers-active-legend" style="display:none;"></ul>   </div>   <div class="hotzones-tab"></div>   <div class="flooding-tab"></div>   <div class="shadowing-tab"></div>   <div class="diff-tab"></div>   <div class="projects-tab"></div></div>';
    a.DataLayersBase = function(a) {
        function b() {
            try {
                return aa.can(U)
            } catch (a) {
                return !1
            }
        }
        function e() {
            Q && (Q.refresh(),
            Q.setMouseInteraction(!0)),
            R && R.refresh()
        }
        function f() {
            O.stopPlayRelation(),
            Q.setMouseInteraction(!1)
        }
        function g() {}
        function A(a) {
            var b = null ;
            return a.ActiveField ? b = a.ActiveField : a.Fields && a.Fields.length > 0 && (b = a.Fields[0]),
            b
        }
        function B() {
            da.find(".btn-layers").removeClass("selected"),
            da.find(".btn-flooding").removeClass("selected"),
            da.find(".btn-shadowing").removeClass("selected"),
            da.find(".btn-diff").removeClass("selected"),
            da.find(".btn-hotzones").addClass("selected").blur(),
            da.find(".data-layers-tab").hide(),
            da.find(".flooding-tab").hide(),
            da.find(".shadowing-tab").hide(),
            da.find(".diff-tab").hide(),
            da.find(".projects-tab").hide(),
            da.find(".hotzones-tab").show()
        }
        function C() {
            da.find(".btn-hotzones").removeClass("selected"),
            da.find(".btn-flooding").removeClass("selected"),
            da.find(".btn-shadowing").removeClass("selected"),
            da.find(".btn-diff").removeClass("selected"),
            da.find(".btn-layers").addClass("selected").blur(),
            da.find(".hotzones-tab").hide(),
            da.find(".flooding-tab").hide(),
            da.find(".shadowing-tab").hide(),
            da.find(".diff-tab").hide(),
            da.find(".projects-tab").hide(),
            da.find(".data-layers-tab").show()
        }
        function D() {
            da.find(".btn-layers").removeClass("selected"),
            da.find(".btn-hotzones").removeClass("selected"),
            da.find(".btn-shadowing").removeClass("selected"),
            da.find(".btn-diff").removeClass("selected"),
            da.find(".btn-flooding").addClass("selected").blur(),
            da.find(".data-layers-tab").hide(),
            da.find(".hotzones-tab").hide(),
            da.find(".shadowing-tab").hide(),
            da.find(".diff-tab").hide(),
            da.find(".projects-tab").hide(),
            da.find(".flooding-tab").show()
        }
        function E() {
            da.find(".btn-layers").removeClass("selected"),
            da.find(".btn-hotzones").removeClass("selected"),
            da.find(".btn-diff").removeClass("selected"),
            da.find(".btn-flooding").removeClass("selected"),
            da.find(".btn-shadowing").addClass("selected").blur(),
            da.find(".data-layers-tab").hide(),
            da.find(".hotzones-tab").hide(),
            da.find(".diff-tab").hide(),
            da.find(".projects-tab").hide(),
            da.find(".flooding-tab").hide(),
            da.find(".shadowing-tab").show()
        }
        function F() {
            da.find(".btn-layers").removeClass("selected"),
            da.find(".btn-hotzones").removeClass("selected"),
            da.find(".btn-flooding").removeClass("selected"),
            da.find(".btn-shadowing").removeClass("selected"),
            da.find(".btn-diff").addClass("selected").blur(),
            da.find(".data-layers-tab").hide(),
            da.find(".hotzones-tab").hide(),
            da.find(".flooding-tab").hide(),
            da.find(".shadowing-tab").hide(),
            da.find(".projects-tab").hide(),
            da.find(".diff-tab").show()
        }
        function G(a) {
            return function(b) {
                return b && b.layer ? a(b) : void 0
            }
        }
        function H(a, b) {
            ca(a).subscribe(G(b))
        }
        function I() {
            p.init(ba);
            var a;
            da.find(".data-layers-tab").hide();
            var b = function() {}
            ;
            ca = r.events.makeChannel(_, {
                clicksAware: !0
            }),
            aa.can(d.VIEW_FLOODING) ? (new k(aa,X,Y,Z,da.find(".flooding-tab")),
            da.find(".btn-flooding").click(D),
            da.find(".btn-flooding").show(),
            b = D) : da.find(".btn-flooding").hide(),
            aa.can(d.VIEW_SHADOWING) ? (new l(aa,X,Z,da.find(".shadowing-tab")),
            da.find(".btn-shadowing").click(E),
            da.find(".btn-shadowing").show(),
            b = E) : da.find(".btn-shadowing").hide(),
            aa.can(d.VIEW_DIFF) ? (new w(aa,X,Y,Z,da.find(".diff-tab")),
            da.find(".btn-diff").click(F),
            da.find(".btn-diff").show(),
            b = F) : da.find(".btn-diff").hide(),
            aa.can(d.VIEW_HOTZONE) ? (a = new h(aa),
            new i(a,da.find(".hotzones-tab")),
            new j(aa,a,ba),
            a.addListener(m, function() {
                var b = a.getFilters()
                  , c = b.length
                  , d = "HotSpot";
                c > 0 && (d += " (" + c + ")"),
                da.find(".btn-hotzones").text(d)
            }),
            da.find(".btn-hotzones").click(B),
            da.find(".btn-hotzones").show(),
            b = B) : da.find(".btn-hotzones").hide(),
            aa.can(d.VIEW_DATA_LAYERS) ? (J(a),
            da.find(".btn-layers").click(C),
            da.find(".btn-layers").show(),
            b = C) : da.find(".btn-layers").hide(),
            c(da, H),
            b()
        }
        function J(a) {
            C(),
            M = p.buckets,
            N = da.find("ul.layers-active-legend"),
            O = s.NewLegend({
                gMap: ba,
                $legend: N,
                singularName: T,
                labelMgr: p,
                opacityMgr: p,
                overlays: p,
                layerMgr: Q,
                overlayBuckets: M
            }),
            K = da.find("ul.layers-tree"),
            V || K.addClass("single-select"),
            L = v.NewTree({
                $tree: K
            }),
            P = t.NewSearch({
                searchTextBox: da.find("input[type=search]"),
                name: S,
                tree: L,
                $tree: K,
                isMultiSelect: V
            }),
            Q = u.NewLayerMgr({
                name: S,
                categoryType: W,
                isSimpleMode: $,
                isMultiSelect: V,
                accessKey: U,
                overlays: p,
                legend: O,
                $tree: K,
                tree: L,
                popup: da
            }),
            Q.refresh(),
            g(),
            ba.addListener("zoom_changed", function() {
                o.each(p.getActiveLayers(), function(a, b) {
                    O.update(b)
                })
            }),
            ba.addListener("resize", g),
            P.init(),
            H("mouseover", O.mouseoverGeomObj),
            H("mouseout", O.mouseoutGeomObj),
            H("click", p.showInfoWindow),
            H("failedLoadingLayer", O.failedLoadingLayer),
            H("failedLoadingLayerDescriptor", O.failedLoadingLayerDescriptor),
            H("noGeometryData", O.noGeometryData),
            H("labelsAllowedChanged", Q.labelsAllowedChanged),
            H("layerDescriptorAvailable", Q.layerDescriptorAvailable),
            H("layerGeomtriesReceived", Q.layerGeomtriesReceived),
            H("layerGeomtriesProcessed", Q.layerGeomtriesProcessed),
            H("layerGeomtriesDisplayed", Q.layerGeomtriesDisplayed),
            H("layerMgr.activateLayer", function(a) {
                return Q.activateLayer(a.layer)
            }),
            H("layerMgr.deactivateLayer", function(a) {
                return Q.deactivateLayer(a.layer)
            }),
            H("layerMgr.deactivateAllLayersExcept", function(a) {
                return Q.deactivateAllLayersExcept(a.layer)
            }),
            ca("layerMgr.deactivateModifiedLayersOf").subscribe(function(a) {
                return Q.deactivateModifiedLayersOf(a.layer, a.exceptLayerName)
            }),
            ca("layerMgr.modifyLayer").subscribe(function(a) {
                return Q.modifyLayer(a.layer, a.relation, a.modifierNames, a.modifierKeys, a.compModifierNames, a.compModifierKeys)
            }),
            ca("layer-color-changed-hackidy-wack-wack").subscribe(function(a) {
                Q.deactivateLayer(a.layer),
                Q.activateLayer(a.layer)
            }),
            ca("hotspots-add-filter").subscribe(function(b) {
                var c, d = q.getCurrent();
                for (var e in d)
                    d.hasOwnProperty(e) && (c = d[e]);
                var f = b.op
                  , g = b.values
                  , h = ba.getZoom()
                  , i = A(c)
                  , j = n(c.Relations, function(a) {
                    return "field" !== a.Source
                });
                j = y(x(j, function(a) {
                    return {
                        key: a.Name,
                        value: a.CurrKey,
                        label: a.Desc
                    }
                })),
                a.addFilter({
                    op: f,
                    values: g,
                    name: c.Name,
                    relations: j,
                    field: i.Name,
                    fieldDescription: i.Description,
                    label: c.Description,
                    zoom: h
                }),
                ca("layerMgr.deactivateLayer").publish({
                    layer: c
                }),
                ca("layerMgr.deactivateModifiedLayersOf").publish({
                    layer: c
                }),
                Q.refresh()
            })
        }
        var K, L, M, N, O, P, Q, R, S = a.name, T = a.singularName, U = a.accessKey, V = a.isMultiSelect, W = a.categoryType, X = a.surveysController, Y = a.surveyInfo, Z = a.map, $ = !1, _ = a.key, aa = a.auth, ba = Z.tmpGoogleMapViewController.gMap, ca = null , da = o(z);
        return {
            init: I,
            accessKey: U,
            hasAccess: b,
            name: S,
            start: e,
            stop: f,
            popup: da
        }
    }
}),
nm_module("nm/layers/properties", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("jscore/functools", "partial")
      , g = b("jscore/async", "callWhenIdle")
      , h = b("nm/const", "HOST_URL")
      , i = b("js-libs/geojson", "GeoJSON")
      , j = b("js-libs/jquery", "jQuery");
    a.PropertiesLayer = c(Object, {
        constructor: function(a) {
            this.mapObj = a,
            this.polygons = [],
            this.currentRequestId = 0,
            this.active = !1,
            this.updateWhenIdle = g(e(this, this.update), 200)
        },
        setActive: function(a) {
            this.active = a,
            a ? this.updateWhenIdle() : this.clear()
        },
        clear: function() {
            for (var a = this.polygons; a.length; ) {
                var b = a.pop();
                b.setMap(null )
            }
        },
        update: function() {
            this.currentRequestId = null ;
            var a = this.mapObj;
            this.mapListenersRegistered || (this.mapListenersRegistered = !0,
            a.addListener("zoom_changed", this.updateWhenIdle),
            a.addListener("center_changed", this.updateWhenIdle));
            var b = a.getBounds()
              , c = a.getZoom();
            if (18 > c || this.active === !1)
                return void this.clear();
            var d = h + "maps?nmprovider=propintel&nml=overlay&cmd=propgeom&cads=true&bbox=" + b.getSouthWest().lng() + "," + b.getSouthWest().lat() + "," + b.getNorthEast().lng() + "," + b.getNorthEast().lat();
            this.currentRequestId += 1;
            var g = f(e(this, this.handleData), this.currentRequestId);
            j.ajax({
                url: d,
                dataType: "json",
                success: g,
                error: function(a) {
                    console.log(a)
                }
            })
        },
        handleData: function(a, b) {
            if (this.currentRequestId === a) {
                this.clear();
                for (var c = this.mapObj, d = {
                    strokeColor: "white",
                    strokeOpacity: 1,
                    strokeWeight: 2,
                    fillColor: null ,
                    fillOpacity: 0
                }, e = this.polygons, f = new i(b,d), g = 0, h = f.length; h > g; g++)
                    for (var j = f[g], k = 0, l = j.length; l > k; k++) {
                        var m = j[k];
                        e.push(m),
                        m.setOptions({
                            clickable: !1
                        }),
                        m.setMap(c)
                    }
                this.applyFilter()
            }
        },
        applyFilter: function() {
            var a = this._filter
              , b = this.mapObj
              , c = this.polygons;
            if (a)
                for (var d = 0, e = c.length; e > d; d++) {
                    var f = c[d];
                    a(f) ? f.setMap(b) : f.setMap(null )
                }
        },
        setFilter: function(a) {
            this._filter = a,
            this.applyFilter()
        }
    })
}),
nm_module("nm/tools/property/prospecting", function(a, b, c, d) {
    function e(a, b, c) {
        if (null  === a || null  === c)
            return !1;
        switch (b) {
        case "gt":
            return a > c;
        case "lt":
            return c > a;
        case "==":
            return a === c
        }
    }
    var f = b("jscore/functools", "bind")
      , g = b("jscore/functools", "partial")
      , h = b("nm/layers/properties", "PropertiesLayer")
      , i = b("js-libs/jquery", "jQuery")
      , j = '<div class="tab-prospect" style="display:none;">    <div>        <span class="label">Frontage</span>        <select class="ls-frontage-op">            <option value="gt">greater than</option>            <option value="lt">less than</option>            <option value="==">is</option>        </select>        <input class="txt-frontage-val" type="numbar" /> m    </div>    <div>        <span class="label">Area</span>        <select class="ls-area-op">            <option value="gt">greater than</option>            <option value="lt">smaller than</option>            <option value="==">is</option>        </select>        <input class="txt-area-val" type="numbar" /> m²    </div>    <div>        <span class="label">Strata Count</span>        <select class="ls-strata-op">            <option value="gt">greater than</option>            <option value="lt">less than</option>            <option value="==">is</option>        </select>        <input class="txt-strata-val" type="numbar" />    </div>    <div class="buttons right">        <div class="btn-filter button" title="Filter">Filter</div>        <div class="btn-clear button"             title="Clear Filter">Clear</div>    </div></div>'
      , k = {
        frontage: function(a, b, c) {
            var d = c.fields.frontageLength.val;
            return e(d, a, b)
        },
        area: function(a, b, c) {
            var d = c.areaSqm;
            return e(d, a, b)
        },
        strata: function(a, b, c) {
            var d = c.fields.strataCount;
            return d = d ? d.val || 0 : 0,
            e(d, a, b)
        }
    }
      , l = ".txt-frontage-val, .txt-strata-val, .txt-area-val"
      , m = ["frontage", "area", "strata"];
    a.ProspectView = c(Object, {
        constructor: function(a) {
            var b = i(j);
            this.$node = b;
            var c = new h(a);
            this.propertiesLayer = c,
            this.$btnFilter = b.find(".btn-filter"),
            this.$btnClear = b.find(".btn-clear"),
            this.setupListeners(),
            this.updateFilter()
        },
        getUINode: function() {
            return this.$node
        },
        setupListeners: function() {
            this.$btnFilter.click(f(this, this.updateFilter)),
            this.$btnClear.click(f(this, this.clearFilter)),
            this.$node.find(l).change(f(this, this.updateFilter))
        },
        clearFilter: function() {
            this.$node.find(l).val(""),
            this.updateFilter()
        },
        updateFilter: function() {
            var a = this.propertiesLayer
              , b = this.$node
              , c = [];
            m.forEach(function(a) {
                var d = b.find(".txt-" + a + "-val").val();
                if (d = parseFloat(d),
                !isNaN(d)) {
                    var e = b.find(".ls-" + a + "-op").val()
                      , f = k[a];
                    f = g(f, e, d),
                    c.push(f)
                }
            }),
            c.length ? (this.$btnClear.removeClass("disabled"),
            a.setActive(!0),
            a.setFilter(function(a) {
                for (var b = a.geojsonProperties, d = !0, e = 0, f = c.length; f > e && d; e++)
                    d = c[e](b);
                return d
            })) : (this.$btnClear.addClass("disabled"),
            a.setActive(!1))
        }
    })
}),
nm_module("gooscr/propertyIntel", function(a, b) {
    "use strict";
    var c = b("js-libs/jquery").jQuery
      , d = b("nm/const")
      , e = b("nm/console")
      , f = d.HOST_URL + "maps?nml=overlay&nmprovider=propintel";
    a.api = {
        search: function(a, b) {
            if ("function" == typeof b) {
                var d = f + "&cmd=prop";
                if (a.pdid)
                    d += "&pdid=" + encodeURIComponent(a.pdid);
                else if (a.gpid)
                    d += "&gpid=" + encodeURIComponent(a.gpid);
                else {
                    if (!a.addr)
                        return e.log("No property identifiers found to perform propertyIntel request."),
                        void b(null );
                    d += "&addr=" + encodeURIComponent(a.addr)
                }
                c.ajax({
                    url: d,
                    dataType: "json",
                    timeout: 1e4,
                    success: function(a) {
                        b(a)
                    },
                    error: function(a, c, d) {
                        e.log("Error during propertyintel request: " + c + ", " + d),
                        b(null )
                    }
                })
            }
        }
    },
    a.addr = {
        getNumAndStreet: function(a) {
            var b = "";
            return a.FlatNumber && (b += a.FlatNumber + "/"),
            a.BuildingNumber && (b += a.BuildingNumber + " "),
            a.Street && (b += this._toTitleCase(a.Street) + " "),
            "" !== b ? b.substr(0, b.length - 1) : b
        },
        getShortAddress: function(a) {
            var b = this.getNumAndStreet(a);
            return a.Suburb && (b += ", " + this._toTitleCase(a.Suburb)),
            b
        },
        getFullAddress: function(a) {
            var b = this.getNumAndStreet(a) + ", ";
            return a.Suburb && (b += this._toTitleCase(a.Suburb) + " "),
            a.State && (b += a.State + " "),
            a.Postcode && (b += a.Postcode + " "),
            (a.Suburb || a.State || a.Postcode) && (b = b.substr(0, b.length - 1)),
            b
        },
        _toTitleCase: function(a) {
            return a.replace(/\w\S*/g, function(a) {
                return a.charAt(0).toUpperCase() + a.substr(1).toLowerCase()
            })
        }
    }
}),
nm_module("gooscr/tools/partiPropertyInfo", function(a, b) {
    "use strict";
    function c(a, b) {
        var c = z;
        b && "house" === b.toLowerCase() && (c = y);
        var d = p(k, a, c);
        return d
    }
    var d = b("jscore/events").Change
      , e = b("jscore/functools").bind
      , f = b("nm/tools/property/prospecting").ProspectView
      , g = b("nm/console")
      , h = b("nm/const")
      , i = b("nm/const/tools").ART_DIRECT_LINK
      , j = b("nm/const/tools").PROPERTY_KEY
      , k = b("nm/const/tools").ART_DIRECT_LINK_URL_TEMPLATE
      , l = b("nm/intl")
      , m = b("nm/const/messages")
      , n = b("jscore/async").setTimeout
      , o = b("jscore/types").isUndefinedOrNull
      , p = b("jscore/strings").format
      , q = b("jscore/functools").partial
      , r = b("gooscr/tooltip")
      , s = b("gooscr/toolbar")
      , t = b("gooscr/propertyIntel")
      , u = b("js-libs/jquery").jQuery
      , v = b("js-libs/geojson").GeoJSON
      , w = b("js-libs/google").maps
      , x = w.LatLng
      , y = 3
      , z = 4
      , A = 16;
    a.getDirectArtUrlForPropId = c,
    a.buildTool = function(a, b, k, p) {
        var y = {
            name: "Property",
            accessKey: j,
            popup: u('<div id="propMode-info"></div>'),
            info: u('<div class="tab-info"><br/>You are now in property details mode. Click on a location to display available property information.<br/><br/></div>'),
            hot: u('<div class="tab-hot" style="display:none;"></div>'),
            active: !1,
            property: null ,
            coords: null ,
            geoms: [],
            hotGeoms: [],
            pins: [],
            hotPins: [],
            hotData: null ,
            geocoder: null ,
            channel: null ,
            elms: {
                $info: null ,
                $hot: null ,
                $tabs: null ,
                $addressDiv: null ,
                $propertyDetail: null ,
                $boundsSelector: null 
            },
            tooltips: {
                start: "Click anywhere to get property information"
            },
            polyStyle: {
                prop: {
                    strokeColor: "#FD4D39",
                    strokeWeight: 3,
                    fillOpacity: 0,
                    fillColor: "transparent"
                },
                cad: {
                    strokeColor: "blue",
                    strokeWeight: 2,
                    fillOpacity: 0,
                    fillColor: "transparent"
                },
                hot: {
                    strokeColor: "#FF9800",
                    strokeWeight: 2,
                    strokeOpacity: .7,
                    fillOpacity: 0,
                    fillColor: "transparent"
                }
            },
            hasAccess: function() {
                return a.can(y.accessKey)
            },
            _hasArtAccess: function() {
                return a.can(i)
            },
            init: function() {
                var a = new f(b);
                y.popup.append(y._createTabs(), y.info, y.hot, a.getUINode()),
                y.elms.$info = y.info,
                y.elms.$hot = y.hot,
                y.elms.$hot.append(y._createHotModifiersUI()),
                y.addHomeTrackLogo(),
                y.geocoder = new w.Geocoder,
                b.addListener("click", y._onMapClick);
                var c = s.getToolKey(y);
                y.channel = s.events.makeChannel(c, {
                    clicksAware: !0
                }),
                y.channel("click").subscribe(function(a) {
                    y._onMapClick(a.e)
                }),
                k.addListener(d, function() {
                    y._loadPropertyGeom()
                }),
                p.addListener(d, e(this, y._processHotResponse))
            },
            addHomeTrackLogo: function() {
                y.elms.$tabs.append(u('<div class="hometrack-logo pi-provider-logo" />'))
            },
            start: function() {
                y.active = !0,
                b.setOptions({
                    draggableCursor: "crosshair"
                }),
                y.property ? y._setPins(y.property) : r.set(y.tooltips.start),
                y._loadPropertyGeom();
                var a = y.hotData;
                a && (y._setHotPins(a.features),
                y.displayHotPropertyGeom(a))
            },
            stop: function() {
                y.active = !1,
                r.unset(y.tooltips.start),
                b.setOptions({
                    draggableCursor: null 
                }),
                y._setPins(),
                y._setHotPins(),
                y.clearPropertyGeom(),
                y.clearHotPropertyGeom()
            },
            _onMapClick: function(a) {
                y.active && (y._displayPropertyFromLatLong(a.latLng),
                y._loadPropertyGeom(a.latLng),
                y.coords = a.latLng)
            },
            _createTabs: function() {
                var a = u('<div class="ui-tabs">   <ul>       <li>           <a href="javascript:void(0);" data-tab="tab-info"                class="btn-info selected">Info</a>       </li>       <li>           <a href="javascript:void(0);"                   data-tab="tab-prospect"                   class="btn-prospect">               Site Finder           </a>       </li>   </ul></div>');
                return y.elms.$tabs = a,
                a.find("a").on("click", y._onTabClick),
                a
            },
            _onTabClick: function(a) {
                var b = u(a.target).data().tab;
                y._showTab(b)
            },
            _showTab: function(a) {
                var b = u('[data-tab="' + a + '"]');
                0 === b.length || b.hasClass("selected") || (u("." + y._getActiveTabName()).hide(),
                y.elms.$tabs.find("a").removeClass("selected"),
                b.addClass("selected"),
                u("." + a).show())
            },
            _getActiveTabName: function() {
                return y.elms.$tabs.find(".selected").data().tab
            },
            _createHotModifiersUI: function() {
                var a = u('<div class="ph-cont" />')
                  , b = u('<form class="ph-form" />')
                  , c = u('<label for="slc_type">Property Type:</label><select id="slc_type" class="slc-type" required>   <option value="">Choose</option>   <option value="house">House</option>   <option value="apartment">Apartment</option></select>')
                  , d = u('<label for="slc_beds">Bedrooms:</label><select id="slc_beds" class="slc-beds" required>   <option value="">Any</option>   <option value="0">Studio</option>   <option value="1">1</option>   <option value="2">2</option>   <option value="3">3</option>   <option value="4">4</option></select>')
                  , e = '  <option value="50000">50,000</option>   <option value="100000">100,000</option>   <option value="150000">150,000</option>   <option value="200000">200,000</option>   <option value="250000">250,000</option>   <option value="300000">300,000</option>   <option value="350000">350,000</option>   <option value="400000">400,000</option>   <option value="450000">450,000</option>   <option value="500000">500,000</option>   <option value="550000">550,000</option>   <option value="600000">600,000</option>   <option value="650000">650,000</option>   <option value="700000">700,000</option>   <option value="750000">750,000</option>   <option value="800000">800,000</option>   <option value="850000">850,000</option>   <option value="900000">900,000</option>   <option value="950000">950,000</option>   <option value="1000000">1,000,000</option>   <option value="1250000">1,250,000</option>   <option value="1500000">1,500,000</option>   <option value="1750000">1,750,000</option>   <option value="2000000">2,000,000</option>   <option value="2250000">2,250,000</option>   <option value="2500000">2,500,000</option>   <option value="2750000">2,750,000</option>   <option value="3000000">3,000,000</option>   <option value="4000000">4,000,000</option>   <option value="5000000">5,000,000</option>'
                  , f = u('<span class="lbl">Price Range:</span><select class="slc-price-min small" required>   <option value="">Min</option>   <option value="1">1</option>' + e + '</select><select class="slc-price-max small" required>   <option value="">Max</option>' + e + '   <option value=">5000000">5,000,000+</option></select><span class="ph-cur">' + l.getText("defaults.units.currency.symbol") + "</span>")
                  , g = u('<div class="ph-find">   <span class="ph-spinner" />   <input type="submit" value="Find" class="btn-find" /></div>')
                  , h = u('<div class="ph-results" />');
                return b.append(c, d, f, g),
                a.append(b, h),
                b.on("submit", y._submitHotProperties),
                b.find(".slc-price-min").on("change", y._validateOptions),
                a
            },
            _validateOptions: function(a) {
                var b = u(a.target)
                  , c = u(".slc-price-max")
                  , d = b.val()
                  , e = c.val();
                c.find("option").each(function(a, b) {
                    var c = u(b)
                      , e = parseInt(c.val(), 10);
                    d > e ? c.attr("disabled", !0) : c.removeAttr("disabled")
                }),
                (isNaN(e) || d > e) && c.val("")
            },
            _submitHotProperties: function(a) {
                a.preventDefault();
                var c = u(a.target)
                  , d = c.find(".slc-type")
                  , e = c.find(".slc-beds")
                  , f = c.find(".slc-price-min")
                  , g = c.find(".slc-price-max")
                  , h = d.val()
                  , i = parseInt(e.val(), 10)
                  , j = parseInt(f.val(), 10)
                  , k = parseInt(g.val(), 10)
                  , l = [];
                return b.getZoom() < A ? void u(".ph-results").html('<span class="ph-find-msg">Inappropriate zoom level, please zoom in.</span>') : (y._showHotSpinner(),
                l.push({
                    op: "eq",
                    field: "dwellingType",
                    values: [h]
                }),
                l.push({
                    op: "range",
                    field: "value",
                    values: [j, k]
                }),
                l.push({
                    op: "eq",
                    field: "bedrooms",
                    values: [i]
                }),
                void p.sendData(l, b.getBounds(), b.getZoom()))
            },
            _processHotResponse: function() {
                var a = p
                  , b = a.getData()
                  , c = a.getFailedXhr();
                if (y.clearHotPropertyGeom(),
                b && !c)
                    y._listHotProperties(b);
                else if (!b && c)
                    y._showHotErrorMessage(c);
                else if (!b && !c)
                    return;
                y._hideHotSpinner()
            },
            _listHotProperties: function(a) {
                var b, c, d, f, g, h = u(".ph-results"), i = u("<h2>Hot Properties:</h2>"), j = a.features || [];
                if (h.html(i),
                j.length > 0) {
                    f = u("<ul />", {
                        "class": "ph-ul"
                    });
                    for (var k = 0; k < j.length; k++)
                        b = j[k],
                        c = b.properties,
                        d = c.name,
                        d && (g = u('<li class="ph-marker">   <a href="javascript:void(0);">' + d + "</a></li>"),
                        f.append(g),
                        g.on("click", e(c, function() {
                            var a = this.centre
                              , b = new x(a[1],a[0]);
                            y._showHotPropertyInfo(b)
                        })),
                        g.find("a").on("mouseover", e(c, function() {
                            var a = this.centre
                              , b = new x(a[1],a[0]);
                            y._toggleHighlightHotPin(c, b, !0)
                        })),
                        g.find("a").on("mouseout", e(c, function() {
                            var a = this.centre
                              , b = new x(a[1],a[0]);
                            y._toggleHighlightHotPin(c, b, !1)
                        })));
                    h.append(f)
                } else
                    h.html("No results found.");
                y.displayHotPropertyGeom(a),
                a.hasOwnProperty("features") && y._setHotPins(a.features),
                y.hotData = a
            },
            _showHotSpinner: function() {
                y.elms.$hot.find(".ph-spinner").show({
                    display: "inline-block"
                }),
                y._disableFindButton()
            },
            _hideHotSpinner: function() {
                n(function() {
                    y.elms.$hot.find(".ph-spinner").hide(),
                    y._enableFindButton()
                }, 500)
            },
            _disableFindButton: function() {
                y.elms.$hot.find(".btn-find").attr("disabled", !0);
            },
            _enableFindButton: function() {
                y.elms.$hot.find(".btn-find").removeAttr("disabled")
            },
            _showHotErrorMessage: function(a) {
                var b = a.responseJSON
                  , c = a.statusText || "";
                b && b.hasOwnProperty("code") && b.hasOwnProperty("message") && (c += ", " + b.code + ": " + b.message),
                u(".ph-results").html('<div class="ph-err">   <p>' + m.GENERIC_ERROR + "</p>   <p>" + c + "</p></div>")
            },
            _loadPropertyGeom: function(a) {
                if (y.active) {
                    var b = a || y.coords;
                    k.setCoords(b, function(a) {
                        var c = k.getSelectedFeatures();
                        if (y.clearPropertyGeom(),
                        y.displayPropertyGeom(a, c),
                        !a) {
                            var d = u(k.getInfoElem())
                              , e = "Unable to display property boundaries. Please try again later.";
                            g.log(e + "for:", b),
                            d.replaceWith('<div class="pi-err">' + e + "</div>"),
                            d.show()
                        }
                    })
                }
            },
            _displayPropertyFromLatLong: function(a) {
                r.unset(y.tooltips.start),
                y._showLoadingProperty(),
                y.geocoder.geocode({
                    latLng: a
                }, function(a, b) {
                    if (b === w.GeocoderStatus.OK) {
                        var c = a[0].formatted_address || "";
                        y._displayPropertyFromAddress(c)
                    } else
                        g.log("Geocoder failed due to: " + b),
                        y.displayMessage("Unable to display property information. Please try again later.")
                })
            },
            _displayPropertyFromAddress: function(a) {
                t.api.search({
                    addr: a
                }, function(a) {
                    y.displayProperty(a)
                })
            },
            _showLoadingProperty: function() {
                o(y.elms.$addressDiv) || o(y.elms.$propertyDetail) ? (y.elms.$info.empty(),
                y.elms.$addressDiv = u("<div>", {
                    "class": "pi-sec"
                }).append("Loading property information...").appendTo(y.elms.$info),
                y.elms.$propertyDetail = u("<div>").appendTo(y.elms.$info)) : (y.elms.$addressDiv.fadeTo("slow", .3),
                y.elms.$propertyDetail.fadeTo("slow", .3))
            },
            displayMessage: function(a) {
                y.elms.$info.empty(),
                y.elms.$addressDiv = u("<div>", {
                    "class": "pi-sec"
                }).append(a).appendTo(y.elms.$info),
                y.elms.$propertyDetail = u("<div>").appendTo(y.elms.$info),
                y._setPins(),
                y.clearPropertyGeom()
            },
            displayProperty: function(a) {
                if (o(a) || o(a.Properties) || 0 === a.Properties.length)
                    return a && a.Status && "NotFound" === a.Status ? void y.displayMessage("No property information found at this location.") : void y.displayMessage("Unable to display property information. Please try again later.");
                var b = a.Properties[0];
                return y.displayAddress(b),
                y._addTransactionToAddress(b),
                y.displayPropertyDetails(b),
                y._setPins(b),
                y.property = b,
                y.displayBoundsSelector(),
                y._hasArtAccess() ? void y._retrieveAndDisplayLinkToART(b) : void 0
            },
            displayPropertyGeom: function(a, c) {
                if (a && y.active)
                    for (var d = null , e = null , f = {
                        strokeColor: "red"
                    }, g = 0; g < a.features.length; g++)
                        if (d = a.features[g],
                        d.hasOwnProperty("properties") && d.properties.hasOwnProperty("type") && (e = d.properties.type),
                        -1 !== c.indexOf(e)) {
                            f = y.polyStyle[e || "prop"];
                            for (var h = new v(d,f), i = 0; i < h.length; i++)
                                h[i].setMap(b);
                            y.geoms.push(h)
                        }
            },
            displayHotPropertyGeom: function(a) {
                if (a && y.active)
                    for (var c = null , d = null , e = 0; e < a.features.length; e++) {
                        c = a.features[e],
                        d = y.polyStyle.hot;
                        for (var f = new v(c,d), g = 0; g < f.length; g++)
                            f[g].setMap(b),
                            y.hotGeoms.push(f[g])
                    }
            },
            clearPropertyGeom: function() {
                for (var a = 0; a < y.geoms.length; a++)
                    for (var b = 0; b < y.geoms[a].length; b++)
                        y.geoms[a][b].setMap(null );
                y.geoms = []
            },
            clearHotPropertyGeom: function() {
                for (var a; y.hotGeoms.length; )
                    a = y.hotGeoms.pop(),
                    a.setMap(null )
            },
            displayAddress: function(a) {
                var c = u("<div>", {
                    "class": "pi-sec"
                })
                  , d = u('<input class="pi-addr" type="text">')
                  , e = u("<span>", {
                    "class": "addr-img"
                })
                  , f = t.addr.getFullAddress(a);
                d.val(f),
                c.append(d).append(e),
                y.elms.$addressDiv.replaceWith(c),
                y.elms.$addressDiv = c,
                d.change(function() {
                    var a = d.val();
                    y._displayPropertyFromAddress(a)
                }),
                e.click(function() {
                    b.setCenter(new x(a.Lat,a.Lon))
                })
            },
            displayBoundsSelector: function() {
                k && (k.destroy(),
                k.init(!0, !0),
                y.elms.$boundsSelector.append(u("<hr>"), u(k.getContainerElem())))
            },
            _addTransactionToAddress: function(a) {
                var b = null ;
                if (y.elms.$addressDiv && a.Transactions) {
                    for (var c = null , d = null , e = 0; e < a.Transactions.length; e++)
                        if (a.Transactions[e] && a.Transactions[e].Date && a.Transactions[e].Value) {
                            var f = new Date(a.Transactions[e].Date);
                            (o(d) || f > d) && (c = a.Transactions[e],
                            d = f)
                        }
                    o(c) || (b = u("<span>", {
                        "class": "pi-val"
                    }).append(u("<br>"), u("<span>", {
                        "class": "pi-trans-val"
                    }).append(y._formatCurrency(c.Value)), " at ", y._formatDate(c.Date)),
                    y.elms.$addressDiv.append(b))
                }
            },
            displayPropertyDetails: function(a) {
                var b = u("<div>", {
                    "class": "pi-sec",
                    id: "propInfoDiv"
                });
                b.append(u("<hr>"), y._getPropertyDetails(a)),
                b.append(u("<hr>"), u("<span>", {
                    "class": "pi-heading"
                }).append("Transactions:")),
                o(a.Transactions) || 0 === a.Transactions.length ? b.append(u("<span>", {
                    "class": "pi"
                }).append(" Not available")) : b.append(y._getPropertyTransactions(a.Transactions)),
                b.append(u("<hr>"), u("<span>", {
                    "class": "pi-heading"
                }).append("Sale Listings:")),
                o(a.ListingsSale) || 0 === a.ListingsSale.length ? b.append(u("<span>", {
                    "class": "pi"
                }).append(" Not available")) : b.append(y._getSalesListings(a.ListingsSale)),
                b.append(u("<hr>"), u("<span>", {
                    "class": "pi-heading"
                }).append("Rent Listings:")),
                o(a.ListingsRent) || 0 === a.ListingsRent.length ? b.append(u("<span>", {
                    "class": "pi"
                }).append(" Not available")) : b.append(y._getRentListings(a.ListingsRent)),
                y.elms.$boundsSelector = u("<div>", {
                    "class": "pi-sec pi-slc"
                }),
                b.append(y.elms.$boundsSelector),
                !o(a.Comparables) && a.Comparables.length > 0 && (b.append(u("<hr>"), u("<span>", {
                    "class": "pi-heading"
                }).append("Similar Properties:")),
                b.append(y._getComparables(a.Comparables))),
                y.elms.$propertyDetail.replaceWith(b),
                y.elms.$propertyDetail = b
            },
            _getPropertyDetails: function(a) {
                var b, c = u("<div>", {
                    "class": "pi"
                }), d = !o(a.Attributes) && a.Attributes.length > 0 ? a.Attributes[0] : null ;
                o(d) || (d.PropertyType && c.append(u("<span>", {
                    "class": "pi-lab"
                }).append(d.PropertyType + ":&nbsp;")),
                d.Bedrooms && (b = d.Bedrooms + " bedroom" + ("1" !== d.Bedrooms ? "s" : ""),
                c.append(u("<span>", {
                    "class": "pi-img-lab bedroom",
                    title: b
                }).append("&nbsp;"), u("<span>", {
                    "class": "pi-img-val",
                    title: b
                }).append(d.Bedrooms))),
                d.Bathrooms && (b = d.Bathrooms + " bathroom" + ("1" !== d.Bathrooms ? "s" : ""),
                c.append(u("<span>", {
                    "class": "pi-img-lab bathroom",
                    title: b
                }).append("&nbsp;"), u("<span>", {
                    "class": "pi-img-val",
                    title: b
                }).append(d.Bathrooms))),
                d.CarSpaces && (b = d.CarSpaces + " car space" + ("1" !== d.CarSpaces ? "s" : ""),
                c.append(u("<span>", {
                    "class": "pi-img-lab car",
                    title: b
                }).append("&nbsp;"), u("<span>", {
                    "class": "pi-img-val",
                    title: b
                }).append(d.CarSpaces))));
                var e = u("<table>", {
                    "class": "pi",
                    style: "margin-top: 5px;"
                }).appendTo(c);
                if (!o(d)) {
                    var f = d.YearBuilt || ""
                      , g = d.LandArea || ""
                      , h = d.LivingArea || "";
                    e.append(u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-lab"
                    }).append("Year Built:"), u("<td>", {
                        "class": "pi-val"
                    }).append(f)), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-lab"
                    }).append("Land Area:"), u("<td>", {
                        "class": "pi-val"
                    }).append(g + ("" !== g ? " m<sup>2</sup>" : ""))), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-lab"
                    }).append("Living Area:"), u("<td>", {
                        "class": "pi-val"
                    }).append(h + ("" !== h ? "m<sup>2</sup>" : ""))))
                }
                e.append(u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Lot Plan:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.LotPlan)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Title Ref:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.TitleRef)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Volume Folio:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.VolumeFolio)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Distance:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.Distance)));
                var i = y._capitalize(d.Improvements);
                return i.length <= 18 ? e.append(u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Improvements:"), u("<td>", {
                    "class": "pi-val"
                }).append(i))) : e.append(u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Improvements:")), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab",
                    colspan: "2",
                    style: "padding-left:10px;"
                }).append(i))),
                c
            },
            _getPropertyOtherDetails: function(a) {
                var b = u("<table>", {
                    "class": "pi"
                });
                return b.append(u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-heading"
                }).append("Lot Details:"))),
                b.append(u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Lot Plan:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.LotPlan)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Title Ref:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.TitleRef)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Volume Folio:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.VolumeFolio)), u("<tr>", {
                    "class": "pi"
                }).append(u("<td>", {
                    "class": "pi-lab"
                }).append("Distance:"), u("<td>", {
                    "class": "pi-val"
                }).append(a.Distance))),
                b
            },
            _getPropertyTransactions: function(a) {
                for (var b = u("<table>", {
                    "class": "pi"
                }), c = 0; c < a.length; c++) {
                    var d = a[c];
                    b.append(u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val"
                    }).append(y._formatDate(d.Date)), u("<td>", {
                        "class": "pi-val",
                        style: "text-align:right;"
                    }).append(y._formatCurrency(d.Value))))
                }
                return b
            },
            _getSalesListings: function(a) {
                for (var b = u("<table>", {
                    "class": "pi"
                }), c = 0; c < a.length; c++) {
                    var d = a[c]
                      , e = "";
                    d.StartDate && (e += y._formatDate(d.StartDate) + " - ",
                    d.EndDate && (e += y._formatDate(d.EndDate)));
                    var f = y._formatCurrency(d.Value)
                      , g = u("<tr>", {
                        "class": "pi-opener",
                        title: "Click to show or hide details"
                    }).append(u("<td>", {
                        "class": "pi-val"
                    }).append(e), u("<td>", {
                        "class": "pi-val",
                        style: "text-align:right;"
                    }).append(f), u("<td>", {
                        "class": "pi-val-img"
                    }).append(u("<span>", {
                        "class": "pi-img-sml show-detail"
                    }).append("&nbsp;"))).appendTo(b)
                      , h = u("<td>", {
                        "class": "pi",
                        colspan: "3",
                        style: "padding:0;"
                    }).appendTo(u("<tr>", {
                        "class": "pi sl-detail-" + c,
                        style: "display:none;"
                    }).appendTo(b));
                    h.append(u("<table>", {
                        "class": "pi",
                        style: "margin-bottom:5px; padding:5px 0px 0px 5px;"
                    }).append(u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Sale Date: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(y._formatDate(d.SaleDate))), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Status: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.Status)), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Days to sale: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.DaysToSale)), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Discount: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(y._numberWithCommas(d.DiscountAtSale))), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Agent: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.Agent)))),
                    g.click(q(y._showHideRowDetail, g, ".sl-detail-" + c))
                }
                return b
            },
            _getRentListings: function(a) {
                for (var b = u("<table>", {
                    "class": "pi"
                }), c = 0; c < a.length; c++) {
                    var d = a[c]
                      , e = "";
                    d.StartDate && (e += y._formatDate(d.StartDate) + " - ",
                    d.EndDate && (e += y._formatDate(d.EndDate)));
                    var f = y._formatCurrency(d.Value)
                      , g = u("<tr>", {
                        "class": "pi-opener",
                        title: "Click to show or hide details"
                    }).append(u("<td>", {
                        "class": "pi-val"
                    }).append(e), u("<td>", {
                        "class": "pi-val",
                        style: "text-align:right;"
                    }).append(f), u("<td>", {
                        "class": "pi-val-img"
                    }).append(u("<span>", {
                        "class": "pi-img-sml show-detail"
                    }).append("&nbsp;"))).appendTo(b)
                      , h = u("<td>", {
                        "class": "pi",
                        colspan: "3",
                        style: "padding:0;"
                    }).appendTo(u("<tr>", {
                        "class": "pi rl-detail-" + c,
                        style: "display:none;"
                    }).appendTo(b));
                    h.append(u("<table>", {
                        "class": "pi",
                        style: "margin-bottom:5px;"
                    }).append(u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Days on market: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.DaysOnMarket)), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Yield: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.Yield)), u("<tr>", {
                        "class": "pi"
                    }).append(u("<td>", {
                        "class": "pi-val-detail pi-lab"
                    }).append("Agent: "), u("<td>", {
                        "class": "pi-val-detail"
                    }).append(d.Agent)))),
                    g.click(q(y._showHideRowDetail, g, ".rl-detail-" + c))
                }
                return b
            },
            _showHideRowDetail: function(a, b) {
                var c = !a.hasClass("pi-selected")
                  , d = a.find(".show-detail");
                if (d)
                    for (var e = 0; e < d.length; e++) {
                        var f = u(d[e]);
                        c ? f.addClass("rotated") : f.removeClass("rotated")
                    }
                c ? (u(b).each(function(a, b) {
                    var c = u(b);
                    c.show()
                }),
                a.addClass("pi-selected")) : (u(b).each(function(a, b) {
                    var c = u(b);
                    c.hide()
                }),
                a.removeClass("pi-selected"))
            },
            _getComparables: function(a) {
                for (var b = u("<ul>", {
                    "class": "pi-prop"
                }), c = 0; c < a.length; c++) {
                    var d = a[c];
                    if (d.Lat && d.Lon) {
                        var e = t.addr.getShortAddress(d)
                          , f = q(y._goToProperty, d, !0)
                          , g = q(y._toggleHighlightPin, d, !0)
                          , h = q(this._toggleHighlightPin, d, !1);
                        b.append(u("<li>").append(u("<span>", {
                            "class": "pi-img-sml comparable-img",
                            title: "Click to go to this address",
                            href: "#",
                            click: f,
                            mouseover: g,
                            mouseout: h
                        }).append("&nbsp;"), u("<a>", {
                            text: e,
                            title: "Click to go to this address",
                            href: "#",
                            click: f,
                            mouseover: g,
                            mouseout: h
                        })))
                    }
                }
                return b
            },
            _createLinkToArt: function(a) {
                var b = u("<div>", {
                    "class": "pi",
                    id: "artLinksContainer"
                });
                b.append(u("<hr>"));
                var c = u("<ul>", {
                    "class": "pi-prop"
                }).appendTo(b);
                return a.directLink && c.append("Generate a custom report for this property with the ", u("<a>", {
                    "class": "art-direct-link",
                    href: a.directLink,
                    target: "_blank"
                }).append("Agent Reporting Tool (ART)"), "."),
                b
            },
            _retrieveAndDisplayLinkToART: function(a) {
                var b = u("#propInfoDiv");
                if (b) {
                    var d = !o(a.Attributes) && a.Attributes.length > 0 ? a.Attributes[0].PropertyType : null 
                      , e = {};
                    if (a.Gpid) {
                        e.directLink = c(a.Gpid, d);
                        var f = y._createLinkToArt(e)
                          , g = b.find("#artLinksContainer");
                        g && g.length > 0 ? u(g[0]).replaceWith(f) : b.append(f)
                    }
                }
            },
            _goToProperty: function(a, c) {
                var d = {};
                if (a.Pdid)
                    d.pdid = a.Pdid;
                else {
                    if (!a.Gpid)
                        return void g.log("No search attributes found to look up property");
                    d.gpid = a.gpid
                }
                y._showLoadingProperty(),
                t.api.search(d, function(b) {
                    y.displayProperty(b),
                    y.coords = new x(a.Lat,a.Lon),
                    y._loadPropertyGeom(y.coords)
                }),
                c && b.setCenter(new x(a.Lat,a.Lon))
            },
            _setPins: function(a) {
                var b, c = [];
                if (!o(a)) {
                    var d = y._newPin(a, !1);
                    if (d && c.push(d),
                    !o(a.Comparables))
                        for (b = 0; b < a.Comparables.length; b++) {
                            var e = y._newPin(a.Comparables[b], !0);
                            e && c.push(e)
                        }
                }
                var f = y.pins;
                for (b = 0; b < f.length; b++)
                    f[b].setMap(null );
                y.pins = c
            },
            _setHotPins: function(a) {
                var b, c, d, e = [];
                if (a)
                    for (d = 0; d < a.length; d++)
                        b = a[d],
                        b.properties && (c = y._newHotPin(b.properties),
                        c && e.push(c));
                var f = y.hotPins;
                for (d = 0; d < f.length; d++)
                    f[d].setMap(null );
                y.hotPins = e
            },
            _newPin: function(a, c) {
                var d = null ;
                if (a && a.Lat && a.Lon) {
                    var e = h.STATIC_ASSETS_URL + "img/" + (c ? "blue-dot" : "red-dot") + ".png"
                      , f = t.addr.getShortAddress(a);
                    d = new w.Marker({
                        position: new x(a.Lat,a.Lon),
                        map: b,
                        icon: e,
                        title: f,
                        zIndex: 1e8 - (c ? 1 : 0),
                        optimized: !1
                    }),
                    c && d.addListener("click", function() {
                        y._goToProperty(a, !1)
                    })
                }
                return d
            },
            _newHotPin: function(a) {
                var c = null 
                  , d = h.STATIC_ASSETS_URL + "img/orange-dot.png"
                  , e = null ;
                return a && a.centre && (e = a.centre,
                c = new w.Marker({
                    position: new x(e[1],e[0]),
                    map: b,
                    icon: d,
                    title: "Address not available yet!",
                    zIndex: 1e8,
                    optimized: !1
                }),
                c.addListener("click", y._onHotPinClick)),
                c
            },
            _toggleHighlightPin: function(a, b) {
                for (var c = y.pins, d = t.addr.getShortAddress(a), e = 0; e < c.length; e++)
                    d === c[e].title && (b ? c[e].setAnimation(w.Animation.BOUNCE) : c[e].setAnimation(null ))
            },
            _toggleHighlightHotPin: function(a, b, c) {
                for (var d, e = y.hotPins, f = 0; f < e.length; f++)
                    d = e[f],
                    b.equals(d.getPosition()) && (c ? d.setAnimation(w.Animation.BOUNCE) : d.setAnimation(null ))
            },
            _onHotPinClick: function(a) {
                y._showHotPropertyInfo(a.latLng)
            },
            _showHotPropertyInfo: function(a) {
                y._displayPropertyFromLatLong(a),
                y._loadPropertyGeom(a),
                y.coords = a,
                y._showTab("tab-info")
            },
            _formatDate: function(a) {
                if (a) {
                    var b = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
                      , c = new Date(a);
                    return c.getDate() + " " + b[c.getMonth()] + " " + c.getFullYear()
                }
                return ""
            },
            _formatCurrency: function(a) {
                return a ? "$" + y._numberWithCommas(a) : ""
            },
            _numberWithCommas: function(a) {
                if (a) {
                    var b = a.toString().split(".");
                    return b[0] = b[0].replace(/\B(?=(\d{3})+(?!\d))/g, ","),
                    b.join(".")
                }
                return ""
            },
            _capitalize: function(a) {
                return a && a.length > 0 ? a.charAt(0).toUpperCase() + a.substr(1).toLowerCase() : ""
            }
        };
        return y
    }
}),
nm_module("gooscr/contextmenu", function(a, b) {
    "use strict";
    function c(a, b) {
        this.width = a,
        this.height = b
    }
    function d(a, b, c, d) {
        var e = a.getZoom()
          , f = e + b;
        d && a.panTo(c),
        a.setZoom(f)
    }
    function e(a) {
        var b = o.parseBrowser()
          , c = o.parseOS();
        b.mozilla && c.mac && (a.addListener("rightclick", function() {
            a.set("disableDoubleClickZoom", !0)
        }),
        a.addListener("click", function() {
            a.set("disableDoubleClickZoom", !1)
        }))
    }
    function f(a, b, c) {
        this._enabled = !1,
        this._printable = Boolean(a),
        this._selectable = Boolean(b),
        this._auth = c,
        this._menuItems = [],
        this._listeners = {},
        this.holdTimer = null 
    }
    function g(a, b, c, d) {
        f.call(this, a, b, d),
        this._map = c,
        this._auth = d,
        this._listeners = {},
        this._formState = [],
        this._measurementControl = null ,
        this._saveImageControl = null ,
        this._communityLayerPlaceHolder = null ,
        this._addViewDefaultLabel = "Add To View",
        this._addViewCurrentLabel = this._addViewDefaultLabel,
        this._currentReverseGeocode = null ,
        this._currentStreetView = null ,
        this._infoWin = null ,
        this._auth.can(m.ART_DIRECT_LINK) && this.addItem(w.Art),
        this.addItem(w.Location, this._onLocationSelected),
        this.addItem(w.StreetView, this._onStreetView),
        this.addItem(w.ZoomIn, this._onZoomIn),
        this.addItem(w.ZoomOut, this._onZoomOut),
        this.addItem(w.ZoomHere, this._onZoomHere),
        this.addItem(w.CenterHere, this._onCenterMapHere)
    }
    var h = b("nm/dom")
      , i = b("jscore/async").setTimeout
      , j = b("jscore/async").clearTimeout
      , k = b("jscore/functools").bind
      , l = b("jscore/itertools").find
      , m = b("nm/const/tools")
      , n = b("nm/metrics")
      , o = b("nm/client")
      , p = b("nm/const")
      , q = b("nm/geom").LatLng
      , r = b("gooscr/tools/partiPropertyInfo").getDirectArtUrlForPropId
      , s = b("js-libs/google").maps
      , t = b("gooscr/toolbar")
      , u = b("gooscr/propertyIntel")
      , v = b("js-libs/jquery").jQuery;
    f._TOUCH_HOLD_DELAY = 500,
    f.prototype.resetHoldTimer = function(a) {
        this.clearHoldTimer(a),
        this.holdTimer = i(k(this, function() {
            this.handleHold(a)
        }), f._TOUCH_HOLD_DELAY)
    }
    ,
    f.prototype.clearHoldTimer = function() {
        j(this.holdTimer)
    }
    ,
    f.prototype._positionMenu = function(a) {
        var b, c, d = v(this._map.getDiv()).width, e = v(this._map.getDiv()).height;
        a.pixel && (b = a.pixel.x,
        c = a.pixel.y,
        this._latlng = a.latLng,
        b + this._menuSize.width > d && (b -= this._menuSize.width),
        c + this._menuSize.height > e && (c -= this._menuSize.height),
        this._node.style.left = parseInt(b, 10) + "px",
        this._node.style.top = parseInt(c, 10) + "px")
    }
    ,
    f.prototype.handleHold = function(a) {
        return this._auth.can(m.LITE) ? (this.disable(),
        h.discardElement(this._node),
        this._node = null ,
        void n.trigger("contextmenunotallowed")) : (this._positionMenu(a),
        void this.show())
    }
    ,
    f.prototype._onMapSingleRightClick = function(a) {
        return this._auth.can(m.LITE) ? (this.disable(),
        h.discardElement(this._node),
        this._node = null ,
        void n.trigger("contextmenunotallowed")) : (this._positionMenu(a),
        void this.show())
    }
    ,
    f.prototype._onMapMouseDown = function(a) {
        this.resetHoldTimer(a),
        this.isHidden() || this.hide()
    }
    ,
    f.prototype._onMapMouseMove = function(a) {
        this.clearHoldTimer(a)
    }
    ,
    f.prototype._onMenuClick = function(a) {
        var b, c = a.target;
        if ("li" === c.nodeName.toLowerCase()) {
            if (b = this.getItem(c.innerHTML),
            !b)
                return;
            return b.enabled && (this.hide(),
            "function" == typeof b.callback && b.callback.call(this, this._latlng)),
            v(a).stop()
        }
    }
    ,
    f.prototype._createMenuItem = function(a) {
        var b = h.createElement("li");
        return b.innerHTML = a.name,
        v(b).addClass("nm-listItemContextMenuControl"),
        b
    }
    ,
    f.prototype.getMenuItemNode = function(a) {
        for (var b, c = this._node.childNodes, d = c.length; d--; )
            if (b = c[d].innerHTML,
            8482 === b.charCodeAt(b.length - 1) && (b = b.substring(0, b.length - 1),
            b += "&#8482;"),
            a.name === b)
                return c[d]
    }
    ,
    f.prototype._styleMenuItem = function(a) {
        var b = this.getMenuItemNode(a);
        b && (a.enabled ? v(b).removeClass("nm-listItemDisabledContextMenuControl").addClass("nm-listItemEnabledContextMenuControl") : v(b).removeClass("nm-listItemEnabledContextMenuControl").addClass("nm-listItemDisabledContextMenuControl"))
    }
    ,
    f.prototype.initialize = function(a) {
        v(document).on("mousemove mouseup touchend", k(this, this.clearHoldTimer));
        var b = h.createDocumentFragment()
          , d = h.createElement("ul")
          , e = this._menuItems.length;
        this._map = a,
        this._node = d,
        v(d).addClass("nm-wrapContextMenuControl").css({
            zIndex: 1e3
        }),
        this.printable() || v(d).addClass(p.NO_PRINT),
        b.appendChild(d);
        for (var f = 0; e > f; f++)
            d.appendChild(this._createMenuItem(this._menuItems[f]));
        return a.getDiv().appendChild(b),
        this._menuSize = new c(d.offsetWidth,d.offsetHeight),
        this.hide(),
        this.enable(),
        d
    }
    ,
    f.prototype.selectable = function() {
        return this._selectable
    }
    ,
    f.prototype.printable = function() {
        return this._printable
    }
    ,
    f.prototype.addItem = function(a, b) {
        this._menuItems.push({
            name: a,
            callback: b,
            tooltip: null ,
            enabled: !0
        })
    }
    ,
    f.prototype.getItem = function(a) {
        var b = this._menuItems
          , c = l(b, null , function(b) {
            return a && 8482 === a.charCodeAt(a.length - 1) && (a = a.substring(0, a.length - 1),
            a += "&#8482;"),
            b.name === a
        });
        return c
    }
    ,
    f.prototype.changeItemName = function(a, b) {
        var c, d = this.getItem(a);
        d && (c = this.getMenuItemNode(d),
        c && (d.name = b,
        c.innerHTML = b))
    }
    ,
    f.prototype.toggleItem = function(a, b) {
        for (var c, d = this._menuItems, e = d.length; e--; )
            c = d[e],
            c.name === a && c.enabled !== b && (c.enabled = b,
            this._styleMenuItem(c))
    }
    ,
    f.prototype.hide = function() {
        var a = this._node
          , b = this._listeners;
        a && "none" !== a.style.display && (a.style.display = "none",
        b.onDocumentMouseDown && (s.event.removeListener(b.onDocumentMouseDown),
        delete b.onDocumentMouseDown),
        b.onMapZoomStart && (s.event.removeListener(b.onMapZoomStart),
        delete b.onMapZoomStart))
    }
    ,
    f.prototype.isHidden = function() {
        return !this._node || "none" === this._node.style.display
    }
    ,
    f.prototype.show = function() {
        var a = this._node
          , b = this._listeners;
        a && "none" === a.style.display && (a.style.display = "",
        b.onMenuMouseDown || (b.onMenuMouseDown = v(a).on("mousedown", function(a) {
            v(a).stop()
        })),
        b.onMenuClick || (b.onMenuClick = v(a).on("mousedown", k(this, this._onMenuClick))),
        b.onDocumentMouseDown || (b.onDocumentMouseDown = v(document).on("mousedown", k(this, this.hide))),
        b.onMapZoomStart || (b.onMapZoomStart = this._map.addListener("zoom_changed", k(this, this.hide))))
    }
    ,
    f.prototype.enable = function() {
        var a = this._listeners;
        this._enabled || (a.onMapSingleRightClick || (e(this._map),
        a.onMapSingleRightClick = this._map.addListener("rightclick", k(this, this._onMapSingleRightClick))),
        a.onTileContainerTouchStart || (a.onTileContainerTouchStart = this._map.addListener("mousedown", k(this, this._onMapMouseDown)),
        a.onMouseMove = this._map.addListener("mousemove", k(this, this._onMapMouseMove))),
        this._enabled = !0)
    }
    ,
    f.prototype.disable = function() {
        var a = this._listeners;
        this._enabled && (this.hide(),
        a.onMapSingleRightClick && (s.event.removeListener(a.onMapSingleRightClick),
        delete a.onMapSingleRightClick),
        a.onTileContainerTouchStart && (s.event.removeListener(a.onTileContainerTouchStart),
        delete a.onTileContainerTouchStart,
        s.event.removeListener(a.onMouseMove),
        delete a.onMouseMove),
        a.onDocumentTouchMove && (s.event.removeListener(a.onDocumentTouchMove),
        delete a.onDocumentTouchMove),
        a.onDocumentTouchEnd && (s.event.removeListener(a.onDocumentTouchEnd),
        delete a.onDocumentTouchEnd),
        this._enabled = !1)
    }
    ,
    f.prototype.getLatLng = function() {
        return this._latlng
    }
    ,
    f.prototype.getNode = function() {
        return this._node
    }
    ;
    var w = {
        ZoomIn: "Zoom in",
        ZoomOut: "Zoom out",
        ZoomHere: "Zoom all the way here",
        CenterHere: "Centre map here",
        LatLng: "Lat / Long",
        Measurement: "Measure",
        StreetView: "Street View",
        Location: "Address Lookup",
        Art: "Agent Reporting Tool (ART)"
    };
    g._STREET_VIEW_ZOOM_LEVEL = 18,
    g._FORM_IGNORE_CLASS = "nocheck",
    g.prototype = new f,
    g.prototype.constructor = g,
    g.prototype.initialize = function() {
        return f.prototype.initialize.call(this, this._map),
        this._node
    }
    ,
    g.prototype.show = function() {
        f.prototype.show.call(this),
        this._auth.can(m.ART_DIRECT_LINK) && this._enableArt()
    }
    ,
    g.prototype._onMenuItemSelected = function(a) {
        !this._saveImageControl || a.name !== w.LatLng && a.name !== w.Measurement && a.name !== w.Location || this._map.removeControl(this._saveImageControl)
    }
    ,
    g.prototype._disableArt = function() {
        this.toggleItem(w.Art, !1)
    }
    ,
    g.prototype._enableArt = function(a) {
        var b = new s.Geocoder
          , c = this;
        a = a || this.getLatLng(),
        c._disableArt(),
        b.geocode({
            location: a
        }, function(a, b) {
            var d = "";
            b === s.GeocoderStatus.OK && a.length ? (d = a[0].formatted_address,
            u.api.search({
                addr: d
            }, k(c, c._resolveArtUrl))) : c._disableArt()
        })
    }
    ,
    g.prototype._resolveArtUrl = function(a) {
        if (a && "Ok" === a.Status && a.Properties) {
            var b = a.Properties[0];
            if (!b.Gpid)
                return void this._disableArt();
            var c = b.Attributes && b.Attributes.length > 0 ? b.Attributes[0].PropertyType : null 
              , d = r(b.Gpid, c);
            this.toggleItem(w.Art, !0);
            var e = this.getItem(w.Art);
            e.callback = function() {
                window.open(d)
            }
        }
    }
    ,
    g.prototype._onZoomIn = function(a) {
        var b = this._map;
        d(b, 1, a, !0),
        n.trigger("zoomInContextMenu", {
            label: "Zoom to level",
            description: b.getZoom()
        })
    }
    ,
    g.prototype._onZoomOut = function(a) {
        var b = this._map;
        d(b, -1, a, !1),
        n.trigger("zoomOutContextMenu", {
            label: "Zoom to level",
            description: b.getZoom()
        })
    }
    ,
    g.prototype._onZoomHere = function(a) {
        var b = this._map
          , c = 21
          , d = function(c) {
            b.panTo(a),
            b.setZoom(c),
            n.trigger("zoomAllHereContextMenu")
        }
        ;
        d(c)
    }
    ,
    g.prototype._onCenterMapHere = function(a) {
        this._auth.can(m.CENTRE_MAP) ? (a = new q(a.lat(),a.lng()),
        this._map.setCenter(a),
        n.trigger("centerMapContextMenu")) : n.trigger("nm.restricted.centremap")
    }
    ,
    g.prototype._onLocationSelected = function(a) {
        var b = t.getTool("locationMarker");
        b.addMarker(a),
        t.start("locationMarker"),
        n.trigger("shareContextMenu")
    }
    ,
    g.prototype._onStreetView = function(a) {
        var b = this._map;
        b.getStreetView().setPosition(a),
        b.getStreetView().setVisible(!0),
        n.trigger("openStreetViewContextMenu", {
            label: "address",
            description: this._lastReverseGeocode
        })
    }
    ,
    a.MapContextMenuControl = g
});
var Proj4js = {
    defaultDatum: "WGS84",
    transform: function(a, b, c) {
        if (!a.readyToUse)
            return this.reportError("Proj4js initialization for:" + a.srsCode + " not yet complete"),
            c;
        if (!b.readyToUse)
            return this.reportError("Proj4js initialization for:" + b.srsCode + " not yet complete"),
            c;
        if (a.datum && b.datum && ((a.datum.datum_type == Proj4js.common.PJD_3PARAM || a.datum.datum_type == Proj4js.common.PJD_7PARAM) && "WGS84" != b.datumCode || (b.datum.datum_type == Proj4js.common.PJD_3PARAM || b.datum.datum_type == Proj4js.common.PJD_7PARAM) && "WGS84" != a.datumCode)) {
            var d = Proj4js.WGS84;
            this.transform(a, d, c),
            a = d
        }
        return "enu" != a.axis && this.adjust_axis(a, !1, c),
        "longlat" == a.projName ? (c.x *= Proj4js.common.D2R,
        c.y *= Proj4js.common.D2R) : (a.to_meter && (c.x *= a.to_meter,
        c.y *= a.to_meter),
        a.inverse(c)),
        a.from_greenwich && (c.x += a.from_greenwich),
        c = this.datum_transform(a.datum, b.datum, c),
        b.from_greenwich && (c.x -= b.from_greenwich),
        "longlat" == b.projName ? (c.x *= Proj4js.common.R2D,
        c.y *= Proj4js.common.R2D) : (b.forward(c),
        b.to_meter && (c.x /= b.to_meter,
        c.y /= b.to_meter)),
        "enu" != b.axis && this.adjust_axis(b, !0, c),
        c
    },
    datum_transform: function(a, b, c) {
        return a.compare_datums(b) || a.datum_type == Proj4js.common.PJD_NODATUM || b.datum_type == Proj4js.common.PJD_NODATUM ? c : (a.es == b.es && a.a == b.a && a.datum_type != Proj4js.common.PJD_3PARAM && a.datum_type != Proj4js.common.PJD_7PARAM && b.datum_type != Proj4js.common.PJD_3PARAM && b.datum_type != Proj4js.common.PJD_7PARAM || (a.geodetic_to_geocentric(c),
        (a.datum_type == Proj4js.common.PJD_3PARAM || a.datum_type == Proj4js.common.PJD_7PARAM) && a.geocentric_to_wgs84(c),
        (b.datum_type == Proj4js.common.PJD_3PARAM || b.datum_type == Proj4js.common.PJD_7PARAM) && b.geocentric_from_wgs84(c),
        b.geocentric_to_geodetic(c)),
        c)
    },
    adjust_axis: function(a, b, c) {
        for (var d, e, f = c.x, g = c.y, h = c.z || 0, i = 0; 3 > i; i++)
            if (!b || 2 != i || void 0 !== c.z)
                switch (0 == i ? (d = f,
                e = "x") : 1 == i ? (d = g,
                e = "y") : (d = h,
                e = "z"),
                a.axis[i]) {
                case "e":
                    c[e] = d;
                    break;
                case "w":
                    c[e] = -d;
                    break;
                case "n":
                    c[e] = d;
                    break;
                case "s":
                    c[e] = -d;
                    break;
                case "u":
                    void 0 !== c[e] && (c.z = d);
                    break;
                case "d":
                    void 0 !== c[e] && (c.z = -d);
                    break;
                default:
                    return alert("ERROR: unknow axis (" + a.axis[i] + ") - check definition of " + a.projName),
                    null 
                }
        return c
    },
    reportError: function() {},
    extend: function(a, b) {
        if (a = a || {},
        b)
            for (var c in b) {
                var d = b[c];
                void 0 !== d && (a[c] = d)
            }
        return a
    },
    Class: function() {
        for (var a, b = function() {
            this.initialize.apply(this, arguments)
        }
        , c = {}, d = 0; d < arguments.length; ++d)
            a = "function" == typeof arguments[d] ? arguments[d].prototype : arguments[d],
            Proj4js.extend(c, a);
        return b.prototype = c,
        b
    },
    bind: function(a, b) {
        var c = Array.prototype.slice.apply(arguments, [2]);
        return function() {
            var d = c.concat(Array.prototype.slice.apply(arguments, [0]));
            return a.apply(b, d)
        }
    },
    scriptName: "proj4js-compressed.js",
    defsLookupService: "http://spatialreference.org/ref",
    libPath: null ,
    getScriptLocation: function() {
        if (this.libPath)
            return this.libPath;
        for (var a = this.scriptName, b = a.length, c = document.getElementsByTagName("script"), d = 0; d < c.length; d++) {
            var e = c[d].getAttribute("src");
            if (e) {
                var f = e.lastIndexOf(a);
                if (f > -1 && f + b == e.length) {
                    this.libPath = e.slice(0, -b);
                    break
                }
            }
        }
        return this.libPath || ""
    },
    loadScript: function(a, b, c, d) {
        var e = document.createElement("script");
        e.defer = !1,
        e.type = "text/javascript",
        e.id = a,
        e.src = a,
        e.onload = b,
        e.onerror = c,
        e.loadCheck = d,
        /MSIE/.test(navigator.userAgent) && (e.onreadystatechange = this.checkReadyState),
        document.getElementsByTagName("head")[0].appendChild(e)
    },
    checkReadyState: function() {
        "loaded" == this.readyState && (this.loadCheck() ? this.onload() : this.onerror())
    }
};
Proj4js.Proj = Proj4js.Class({
    readyToUse: !1,
    title: null ,
    projName: null ,
    units: null ,
    datum: null ,
    x0: 0,
    y0: 0,
    localCS: !1,
    queue: null ,
    initialize: function(a, b) {
        if (this.srsCodeInput = a,
        this.queue = [],
        b && this.queue.push(b),
        0 <= a.indexOf("GEOGCS") || 0 <= a.indexOf("GEOCCS") || 0 <= a.indexOf("PROJCS") || 0 <= a.indexOf("LOCAL_CS"))
            this.parseWKT(a),
            this.deriveConstants(),
            this.loadProjCode(this.projName);
        else {
            if (0 == a.indexOf("urn:")) {
                var c = a.split(":");
                "ogc" != c[1] && "x-ogc" != c[1] || "def" != c[2] || "crs" != c[3] || (a = c[4] + ":" + c[c.length - 1])
            } else
                0 == a.indexOf("http://") && (c = a.split("#"),
                c[0].match(/epsg.org/) ? a = "EPSG:" + c[1] : c[0].match(/RIG.xml/) && (a = "IGNF:" + c[1]));
            this.srsCode = a.toUpperCase(),
            0 == this.srsCode.indexOf("EPSG") ? (this.srsCode = this.srsCode,
            this.srsAuth = "epsg",
            this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("IGNF") ? (this.srsCode = this.srsCode,
            this.srsAuth = "IGNF",
            this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("CRS") ? (this.srsCode = this.srsCode,
            this.srsAuth = "CRS",
            this.srsProjNumber = this.srsCode.substring(4)) : (this.srsAuth = "",
            this.srsProjNumber = this.srsCode),
            this.loadProjDefinition()
        }
    },
    loadProjDefinition: function() {
        if (Proj4js.defs[this.srsCode])
            this.defsLoaded();
        else {
            var a = Proj4js.getScriptLocation() + "defs/" + this.srsAuth.toUpperCase() + this.srsProjNumber + ".js";
            Proj4js.loadScript(a, Proj4js.bind(this.defsLoaded, this), Proj4js.bind(this.loadFromService, this), Proj4js.bind(this.checkDefsLoaded, this))
        }
    },
    loadFromService: function() {
        Proj4js.loadScript(Proj4js.defsLookupService + "/" + this.srsAuth + "/" + this.srsProjNumber + "/proj4js/", Proj4js.bind(this.defsLoaded, this), Proj4js.bind(this.defsFailed, this), Proj4js.bind(this.checkDefsLoaded, this))
    },
    defsLoaded: function() {
        this.parseDefs(),
        this.loadProjCode(this.projName)
    },
    checkDefsLoaded: function() {
        return !!Proj4js.defs[this.srsCode]
    },
    defsFailed: function() {
        Proj4js.reportError("failed to load projection definition for: " + this.srsCode),
        Proj4js.defs[this.srsCode] = Proj4js.defs.WGS84,
        this.defsLoaded()
    },
    loadProjCode: function(a) {
        if (Proj4js.Proj[a])
            this.initTransforms();
        else {
            var b = Proj4js.getScriptLocation() + "projCode/" + a + ".js";
            Proj4js.loadScript(b, Proj4js.bind(this.loadProjCodeSuccess, this, a), Proj4js.bind(this.loadProjCodeFailure, this, a), Proj4js.bind(this.checkCodeLoaded, this, a))
        }
    },
    loadProjCodeSuccess: function(a) {
        Proj4js.Proj[a].dependsOn ? this.loadProjCode(Proj4js.Proj[a].dependsOn) : this.initTransforms()
    },
    loadProjCodeFailure: function(a) {
        Proj4js.reportError("failed to find projection file for: " + a)
    },
    checkCodeLoaded: function(a) {
        return !!Proj4js.Proj[a]
    },
    initTransforms: function() {
        if (Proj4js.extend(this, Proj4js.Proj[this.projName]),
        this.init(),
        this.readyToUse = !0,
        this.queue)
            for (var a; a = this.queue.shift(); )
                a.call(this, this)
    },
    wktRE: /^(\w+)\[(.*)\]$/,
    parseWKT: function(a) {
        if (a = a.match(this.wktRE)) {
            var b, c = a[1], d = a[2].split(",");
            b = "TOWGS84" == c.toUpperCase() ? c : d.shift(),
            b = b.replace(/^\"/, ""),
            b = b.replace(/\"$/, "");
            for (var a = [], e = 0, f = "", g = 0; g < d.length; ++g) {
                for (var h = d[g], i = 0; i < h.length; ++i)
                    "[" == h.charAt(i) && ++e,
                    "]" == h.charAt(i) && --e;
                f += h,
                0 === e ? (a.push(f),
                f = "") : f += ","
            }
            switch (c) {
            case "LOCAL_CS":
                this.projName = "identity",
                this.localCS = !0,
                this.srsCode = b;
                break;
            case "GEOGCS":
                this.projName = "longlat",
                this.geocsCode = b,
                this.srsCode || (this.srsCode = b);
                break;
            case "PROJCS":
                this.srsCode = b;
                break;
            case "PROJECTION":
                this.projName = Proj4js.wktProjections[b];
                break;
            case "DATUM":
                this.datumName = b;
                break;
            case "LOCAL_DATUM":
                this.datumCode = "none";
                break;
            case "SPHEROID":
                this.ellps = b,
                this.a = parseFloat(a.shift()),
                this.rf = parseFloat(a.shift());
                break;
            case "PRIMEM":
                this.from_greenwich = parseFloat(a.shift());
                break;
            case "UNIT":
                this.units = b,
                this.unitsPerMeter = parseFloat(a.shift());
                break;
            case "PARAMETER":
                switch (c = b.toLowerCase(),
                d = parseFloat(a.shift()),
                c) {
                case "false_easting":
                    this.x0 = d;
                    break;
                case "false_northing":
                    this.y0 = d;
                    break;
                case "scale_factor":
                    this.k0 = d;
                    break;
                case "central_meridian":
                    this.long0 = d * Proj4js.common.D2R;
                    break;
                case "latitude_of_origin":
                    this.lat0 = d * Proj4js.common.D2R
                }
                break;
            case "TOWGS84":
                this.datum_params = a;
                break;
            case "AXIS":
                switch (c = b.toLowerCase(),
                d = a.shift()) {
                case "EAST":
                    d = "e";
                    break;
                case "WEST":
                    d = "w";
                    break;
                case "NORTH":
                    d = "n";
                    break;
                case "SOUTH":
                    d = "s";
                    break;
                case "UP":
                    d = "u";
                    break;
                case "DOWN":
                    d = "d";
                    break;
                default:
                    d = " "
                }
                switch (this.axis || (this.axis = "enu"),
                c) {
                case "x":
                    this.axis = d + this.axis.substr(1, 2);
                    break;
                case "y":
                    this.axis = this.axis.substr(0, 1) + d + this.axis.substr(2, 1);
                    break;
                case "z":
                    this.axis = this.axis.substr(0, 2) + d
                }
            }
            for (g = 0; g < a.length; ++g)
                this.parseWKT(a[g])
        }
    },
    parseDefs: function() {
        this.defData = Proj4js.defs[this.srsCode];
        var a, b;
        if (this.defData) {
            for (var c = this.defData.split("+"), d = 0; d < c.length; d++)
                switch (b = c[d].split("="),
                a = b[0].toLowerCase(),
                b = b[1],
                a.replace(/\s/gi, "")) {
                case "title":
                    this.title = b;
                    break;
                case "proj":
                    this.projName = b.replace(/\s/gi, "");
                    break;
                case "units":
                    this.units = b.replace(/\s/gi, "");
                    break;
                case "datum":
                    this.datumCode = b.replace(/\s/gi, "");
                    break;
                case "nadgrids":
                    this.nagrids = b.replace(/\s/gi, "");
                    break;
                case "ellps":
                    this.ellps = b.replace(/\s/gi, "");
                    break;
                case "a":
                    this.a = parseFloat(b);
                    break;
                case "b":
                    this.b = parseFloat(b);
                    break;
                case "rf":
                    this.rf = parseFloat(b);
                    break;
                case "lat_0":
                    this.lat0 = b * Proj4js.common.D2R;
                    break;
                case "lat_1":
                    this.lat1 = b * Proj4js.common.D2R;
                    break;
                case "lat_2":
                    this.lat2 = b * Proj4js.common.D2R;
                    break;
                case "lat_ts":
                    this.lat_ts = b * Proj4js.common.D2R;
                    break;
                case "lon_0":
                    this.long0 = b * Proj4js.common.D2R;
                    break;
                case "alpha":
                    this.alpha = parseFloat(b) * Proj4js.common.D2R;
                    break;
                case "lonc":
                    this.longc = b * Proj4js.common.D2R;
                    break;
                case "x_0":
                    this.x0 = parseFloat(b);
                    break;
                case "y_0":
                    this.y0 = parseFloat(b);
                    break;
                case "k_0":
                    this.k0 = parseFloat(b);
                    break;
                case "k":
                    this.k0 = parseFloat(b);
                    break;
                case "r_a":
                    this.R_A = !0;
                    break;
                case "zone":
                    this.zone = parseInt(b, 10);
                    break;
                case "south":
                    this.utmSouth = !0;
                    break;
                case "towgs84":
                    this.datum_params = b.split(",");
                    break;
                case "to_meter":
                    this.to_meter = parseFloat(b);
                    break;
                case "from_greenwich":
                    this.from_greenwich = b * Proj4js.common.D2R;
                    break;
                case "pm":
                    b = b.replace(/\s/gi, ""),
                    this.from_greenwich = Proj4js.PrimeMeridian[b] ? Proj4js.PrimeMeridian[b] : parseFloat(b),
                    this.from_greenwich *= Proj4js.common.D2R;
                    break;
                case "axis":
                    b = b.replace(/\s/gi, ""),
                    3 == b.length && -1 != "ewnsud".indexOf(b.substr(0, 1)) && -1 != "ewnsud".indexOf(b.substr(1, 1)) && -1 != "ewnsud".indexOf(b.substr(2, 1)) && (this.axis = b)
                }
            this.deriveConstants()
        }
    },
    deriveConstants: function() {
        if ("@null" == this.nagrids && (this.datumCode = "none"),
        this.datumCode && "none" != this.datumCode) {
            var a = Proj4js.Datum[this.datumCode];
            a && (this.datum_params = a.towgs84 ? a.towgs84.split(",") : null ,
            this.ellps = a.ellipse,
            this.datumName = a.datumName ? a.datumName : this.datumCode)
        }
        this.a || Proj4js.extend(this, Proj4js.Ellipsoid[this.ellps] ? Proj4js.Ellipsoid[this.ellps] : Proj4js.Ellipsoid.WGS84),
        this.rf && !this.b && (this.b = (1 - 1 / this.rf) * this.a),
        (0 === this.rf || Math.abs(this.a - this.b) < Proj4js.common.EPSLN) && (this.sphere = !0,
        this.b = this.a),
        this.a2 = this.a * this.a,
        this.b2 = this.b * this.b,
        this.es = (this.a2 - this.b2) / this.a2,
        this.e = Math.sqrt(this.es),
        this.R_A && (this.a *= 1 - this.es * (Proj4js.common.SIXTH + this.es * (Proj4js.common.RA4 + this.es * Proj4js.common.RA6)),
        this.a2 = this.a * this.a,
        this.b2 = this.b * this.b,
        this.es = 0),
        this.ep2 = (this.a2 - this.b2) / this.b2,
        this.k0 || (this.k0 = 1),
        this.axis || (this.axis = "enu"),
        this.datum = new Proj4js.datum(this)
    }
}),
Proj4js.Proj.longlat = {
    init: function() {},
    forward: function(a) {
        return a
    },
    inverse: function(a) {
        return a
    }
},
Proj4js.Proj.identity = Proj4js.Proj.longlat,
Proj4js.defs = {
    WGS84: "+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees",
    "EPSG:4326": "+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees",
    "EPSG:4269": "+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees",
    "EPSG:3875": "+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"
},
Proj4js.defs["EPSG:3785"] = Proj4js.defs["EPSG:3875"],
Proj4js.defs.GOOGLE = Proj4js.defs["EPSG:3875"],
Proj4js.defs["EPSG:900913"] = Proj4js.defs["EPSG:3875"],
Proj4js.defs["EPSG:102113"] = Proj4js.defs["EPSG:3875"],
Proj4js.common = {
    PI: 3.141592653589793,
    HALF_PI: 1.5707963267948966,
    TWO_PI: 6.283185307179586,
    FORTPI: .7853981633974483,
    R2D: 57.29577951308232,
    D2R: .017453292519943295,
    SEC_TO_RAD: 484813681109536e-20,
    EPSLN: 1e-10,
    MAX_ITER: 20,
    COS_67P5: .3826834323650898,
    AD_C: 1.0026,
    PJD_UNKNOWN: 0,
    PJD_3PARAM: 1,
    PJD_7PARAM: 2,
    PJD_GRIDSHIFT: 3,
    PJD_WGS84: 4,
    PJD_NODATUM: 5,
    SRS_WGS84_SEMIMAJOR: 6378137,
    SIXTH: .16666666666666666,
    RA4: .04722222222222222,
    RA6: .022156084656084655,
    RV4: .06944444444444445,
    RV6: .04243827160493827,
    msfnz: function(a, b, c) {
        return a *= b,
        c / Math.sqrt(1 - a * a)
    },
    tsfnz: function(a, b, c) {
        return c *= a,
        c = Math.pow((1 - c) / (1 + c), .5 * a),
        Math.tan(.5 * (this.HALF_PI - b)) / c
    },
    phi2z: function(a, b) {
        for (var c, d = .5 * a, e = this.HALF_PI - 2 * Math.atan(b), f = 0; 15 >= f; f++)
            if (c = a * Math.sin(e),
            c = this.HALF_PI - 2 * Math.atan(b * Math.pow((1 - c) / (1 + c), d)) - e,
            e += c,
            1e-10 >= Math.abs(c))
                return e;
        return alert("phi2z has NoConvergence"),
        -9999
    },
    qsfnz: function(a, b) {
        var c;
        return a > 1e-7 ? (c = a * b,
        (1 - a * a) * (b / (1 - c * c) - .5 / a * Math.log((1 - c) / (1 + c)))) : 2 * b
    },
    asinz: function(a) {
        return 1 < Math.abs(a) && (a = a > 1 ? 1 : -1),
        Math.asin(a)
    },
    e0fn: function(a) {
        return 1 - .25 * a * (1 + a / 16 * (3 + 1.25 * a))
    },
    e1fn: function(a) {
        return .375 * a * (1 + .25 * a * (1 + .46875 * a))
    },
    e2fn: function(a) {
        return .05859375 * a * a * (1 + .75 * a)
    },
    e3fn: function(a) {
        return a * a * a * (35 / 3072)
    },
    mlfn: function(a, b, c, d, e) {
        return a * e - b * Math.sin(2 * e) + c * Math.sin(4 * e) - d * Math.sin(6 * e)
    },
    srat: function(a, b) {
        return Math.pow((1 - a) / (1 + a), b)
    },
    sign: function(a) {
        return 0 > a ? -1 : 1
    },
    adjust_lon: function(a) {
        return a = Math.abs(a) < this.PI ? a : a - this.sign(a) * this.TWO_PI
    },
    adjust_lat: function(a) {
        return a = Math.abs(a) < this.HALF_PI ? a : a - this.sign(a) * this.PI
    },
    latiso: function(a, b, c) {
        return Math.abs(b) > this.HALF_PI ? +Number.NaN : b == this.HALF_PI ? Number.POSITIVE_INFINITY : b == -1 * this.HALF_PI ? -1 * Number.POSITIVE_INFINITY : (c *= a,
        Math.log(Math.tan((this.HALF_PI + b) / 2)) + a * Math.log((1 - c) / (1 + c)) / 2)
    },
    fL: function(a, b) {
        return 2 * Math.atan(a * Math.exp(b)) - this.HALF_PI
    },
    invlatiso: function(a, b) {
        var c = this.fL(1, b)
          , d = 0
          , e = 0;
        do
            d = c,
            e = a * Math.sin(d),
            c = this.fL(Math.exp(a * Math.log((1 + e) / (1 - e)) / 2), b);
        while (1e-12 < Math.abs(c - d));return c
    },
    sinh: function(a) {
        return a = Math.exp(a),
        (a - 1 / a) / 2
    },
    cosh: function(a) {
        return a = Math.exp(a),
        (a + 1 / a) / 2
    },
    tanh: function(a) {
        return a = Math.exp(a),
        (a - 1 / a) / (a + 1 / a)
    },
    asinh: function(a) {
        return (a >= 0 ? 1 : -1) * Math.log(Math.abs(a) + Math.sqrt(a * a + 1))
    },
    acosh: function(a) {
        return 2 * Math.log(Math.sqrt((a + 1) / 2) + Math.sqrt((a - 1) / 2))
    },
    atanh: function(a) {
        return Math.log((a - 1) / (a + 1)) / 2
    },
    gN: function(a, b, c) {
        return b *= c,
        a / Math.sqrt(1 - b * b)
    },
    pj_enfn: function(a) {
        var b = [];
        b[0] = this.C00 - a * (this.C02 + a * (this.C04 + a * (this.C06 + a * this.C08))),
        b[1] = a * (this.C22 - a * (this.C04 + a * (this.C06 + a * this.C08)));
        var c = a * a;
        return b[2] = c * (this.C44 - a * (this.C46 + a * this.C48)),
        c *= a,
        b[3] = c * (this.C66 - a * this.C68),
        b[4] = c * a * this.C88,
        b
    },
    pj_mlfn: function(a, b, c, d) {
        return c *= b,
        b *= b,
        d[0] * a - c * (d[1] + b * (d[2] + b * (d[3] + b * d[4])))
    },
    pj_inv_mlfn: function(a, b, c) {
        for (var d = 1 / (1 - b), e = a, f = Proj4js.common.MAX_ITER; f; --f) {
            var g = Math.sin(e)
              , h = 1 - b * g * g
              , h = (this.pj_mlfn(e, g, Math.cos(e), c) - a) * h * Math.sqrt(h) * d
              , e = e - h;
            if (Math.abs(h) < Proj4js.common.EPSLN)
                return e
        }
        return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),
        e
    },
    C00: 1,
    C02: .25,
    C04: .046875,
    C06: .01953125,
    C08: .01068115234375,
    C22: .75,
    C44: .46875,
    C46: .013020833333333334,
    C48: .007120768229166667,
    C66: .3645833333333333,
    C68: .005696614583333333,
    C88: .3076171875
},
Proj4js.datum = Proj4js.Class({
    initialize: function(a) {
        if (this.datum_type = Proj4js.common.PJD_WGS84,
        a.datumCode && "none" == a.datumCode && (this.datum_type = Proj4js.common.PJD_NODATUM),
        a && a.datum_params) {
            for (var b = 0; b < a.datum_params.length; b++)
                a.datum_params[b] = parseFloat(a.datum_params[b]);
            0 == a.datum_params[0] && 0 == a.datum_params[1] && 0 == a.datum_params[2] || (this.datum_type = Proj4js.common.PJD_3PARAM),
            3 < a.datum_params.length && (0 != a.datum_params[3] || 0 != a.datum_params[4] || 0 != a.datum_params[5] || 0 != a.datum_params[6]) && (this.datum_type = Proj4js.common.PJD_7PARAM,
            a.datum_params[3] *= Proj4js.common.SEC_TO_RAD,
            a.datum_params[4] *= Proj4js.common.SEC_TO_RAD,
            a.datum_params[5] *= Proj4js.common.SEC_TO_RAD,
            a.datum_params[6] = a.datum_params[6] / 1e6 + 1)
        }
        a && (this.a = a.a,
        this.b = a.b,
        this.es = a.es,
        this.ep2 = a.ep2,
        this.datum_params = a.datum_params)
    },
    compare_datums: function(a) {
        return this.datum_type != a.datum_type || this.a != a.a || 5e-11 < Math.abs(this.es - a.es) ? !1 : this.datum_type == Proj4js.common.PJD_3PARAM ? this.datum_params[0] == a.datum_params[0] && this.datum_params[1] == a.datum_params[1] && this.datum_params[2] == a.datum_params[2] : this.datum_type == Proj4js.common.PJD_7PARAM ? this.datum_params[0] == a.datum_params[0] && this.datum_params[1] == a.datum_params[1] && this.datum_params[2] == a.datum_params[2] && this.datum_params[3] == a.datum_params[3] && this.datum_params[4] == a.datum_params[4] && this.datum_params[5] == a.datum_params[5] && this.datum_params[6] == a.datum_params[6] : this.datum_type == Proj4js.common.PJD_GRIDSHIFT || a.datum_type == Proj4js.common.PJD_GRIDSHIFT ? (alert("ERROR: Grid shift transformations are not implemented."),
        !1) : !0
    },
    geodetic_to_geocentric: function(a) {
        var b, c, d, e = a.x, f = a.y, g = a.z ? a.z : 0;
        if (f < -Proj4js.common.HALF_PI && f > -1.001 * Proj4js.common.HALF_PI)
            f = -Proj4js.common.HALF_PI;
        else if (f > Proj4js.common.HALF_PI && f < 1.001 * Proj4js.common.HALF_PI)
            f = Proj4js.common.HALF_PI;
        else if (f < -Proj4js.common.HALF_PI || f > Proj4js.common.HALF_PI)
            return Proj4js.reportError("geocent:lat out of range:" + f),
            null ;
        return e > Proj4js.common.PI && (e -= 2 * Proj4js.common.PI),
        c = Math.sin(f),
        d = Math.cos(f),
        b = this.a / Math.sqrt(1 - this.es * c * c),
        f = (b + g) * d * Math.cos(e),
        e = (b + g) * d * Math.sin(e),
        g = (b * (1 - this.es) + g) * c,
        a.x = f,
        a.y = e,
        a.z = g,
        0
    },
    geocentric_to_geodetic: function(a) {
        var b, c, d, e, f, g, h, i, j, k, l = a.x;
        d = a.y;
        var m = a.z ? a.z : 0;
        if (b = Math.sqrt(l * l + d * d),
        c = Math.sqrt(l * l + d * d + m * m),
        1e-12 > b / this.a) {
            if (l = 0,
            1e-12 > c / this.a)
                return
        } else
            l = Math.atan2(d, l);
        d = m / c,
        e = b / c,
        f = 1 / Math.sqrt(1 - this.es * (2 - this.es) * e * e),
        h = e * (1 - this.es) * f,
        i = d * f,
        k = 0;
        do
            k++,
            g = this.a / Math.sqrt(1 - this.es * i * i),
            c = b * h + m * i - g * (1 - this.es * i * i),
            g = this.es * g / (g + c),
            f = 1 / Math.sqrt(1 - g * (2 - g) * e * e),
            g = e * (1 - g) * f,
            f *= d,
            j = f * h - g * i,
            h = g,
            i = f;
        while (j * j > 1e-24 && 30 > k);return b = Math.atan(f / Math.abs(g)),
        a.x = l,
        a.y = b,
        a.z = c,
        a
    },
    geocentric_to_geodetic_noniter: function(a) {
        var b, c, d, e, f, g = a.x, h = a.y, i = a.z ? a.z : 0, g = parseFloat(g), h = parseFloat(h), i = parseFloat(i);
        if (f = !1,
        0 != g)
            b = Math.atan2(h, g);
        else if (h > 0)
            b = Proj4js.common.HALF_PI;
        else if (0 > h)
            b = -Proj4js.common.HALF_PI;
        else if (f = !0,
        b = 0,
        i > 0)
            c = Proj4js.common.HALF_PI;
        else {
            if (!(0 > i))
                return;
            c = -Proj4js.common.HALF_PI
        }
        return d = g * g + h * h,
        g = Math.sqrt(d),
        h = i * Proj4js.common.AD_C,
        d = Math.sqrt(h * h + d),
        h /= d,
        d = g / d,
        h = i + this.b * this.ep2 * h * h * h,
        e = g - this.a * this.es * d * d * d,
        d = Math.sqrt(h * h + e * e),
        h /= d,
        d = e / d,
        e = this.a / Math.sqrt(1 - this.es * h * h),
        i = d >= Proj4js.common.COS_67P5 ? g / d - e : d <= -Proj4js.common.COS_67P5 ? g / -d - e : i / h + e * (this.es - 1),
        0 == f && (c = Math.atan(h / d)),
        a.x = b,
        a.y = c,
        a.z = i,
        a
    },
    geocentric_to_wgs84: function(a) {
        if (this.datum_type == Proj4js.common.PJD_3PARAM)
            a.x += this.datum_params[0],
            a.y += this.datum_params[1],
            a.z += this.datum_params[2];
        else if (this.datum_type == Proj4js.common.PJD_7PARAM) {
            var b = this.datum_params[3]
              , c = this.datum_params[4]
              , d = this.datum_params[5]
              , e = this.datum_params[6]
              , f = e * (d * a.x + a.y - b * a.z) + this.datum_params[1]
              , b = e * (-c * a.x + b * a.y + a.z) + this.datum_params[2];
            a.x = e * (a.x - d * a.y + c * a.z) + this.datum_params[0],
            a.y = f,
            a.z = b
        }
    },
    geocentric_from_wgs84: function(a) {
        if (this.datum_type == Proj4js.common.PJD_3PARAM)
            a.x -= this.datum_params[0],
            a.y -= this.datum_params[1],
            a.z -= this.datum_params[2];
        else if (this.datum_type == Proj4js.common.PJD_7PARAM) {
            var b = this.datum_params[3]
              , c = this.datum_params[4]
              , d = this.datum_params[5]
              , e = this.datum_params[6]
              , f = (a.x - this.datum_params[0]) / e
              , g = (a.y - this.datum_params[1]) / e
              , e = (a.z - this.datum_params[2]) / e;
            a.x = f + d * g - c * e,
            a.y = -d * f + g + b * e,
            a.z = c * f - b * g + e
        }
    }
}),
Proj4js.Point = Proj4js.Class({
    initialize: function(a, b, c) {
        "object" == typeof a ? (this.x = a[0],
        this.y = a[1],
        this.z = a[2] || 0) : "string" == typeof a && "undefined" == typeof b ? (a = a.split(","),
        this.x = parseFloat(a[0]),
        this.y = parseFloat(a[1]),
        this.z = parseFloat(a[2]) || 0) : (this.x = a,
        this.y = b,
        this.z = c || 0)
    },
    clone: function() {
        return new Proj4js.Point(this.x,this.y,this.z)
    },
    toString: function() {
        return "x=" + this.x + ",y=" + this.y
    },
    toShortString: function() {
        return this.x + ", " + this.y
    }
}),
Proj4js.PrimeMeridian = {
    greenwich: 0,
    lisbon: -9.131906111111,
    paris: 2.337229166667,
    bogota: -74.080916666667,
    madrid: -3.687938888889,
    rome: 12.452333333333,
    bern: 7.439583333333,
    jakarta: 106.807719444444,
    ferro: -17.666666666667,
    brussels: 4.367975,
    stockholm: 18.058277777778,
    athens: 23.7163375,
    oslo: 10.722916666667
},
Proj4js.Ellipsoid = {
    MERIT: {
        a: 6378137,
        rf: 298.257,
        ellipseName: "MERIT 1983"
    },
    SGS85: {
        a: 6378136,
        rf: 298.257,
        ellipseName: "Soviet Geodetic System 85"
    },
    GRS80: {
        a: 6378137,
        rf: 298.257222101,
        ellipseName: "GRS 1980(IUGG, 1980)"
    },
    IAU76: {
        a: 6378140,
        rf: 298.257,
        ellipseName: "IAU 1976"
    },
    airy: {
        a: 6377563.396,
        b: 6356256.91,
        ellipseName: "Airy 1830"
    },
    "APL4.": {
        a: 6378137,
        rf: 298.25,
        ellipseName: "Appl. Physics. 1965"
    },
    NWL9D: {
        a: 6378145,
        rf: 298.25,
        ellipseName: "Naval Weapons Lab., 1965"
    },
    mod_airy: {
        a: 6377340.189,
        b: 6356034.446,
        ellipseName: "Modified Airy"
    },
    andrae: {
        a: 6377104.43,
        rf: 300,
        ellipseName: "Andrae 1876 (Den., Iclnd.)"
    },
    aust_SA: {
        a: 6378160,
        rf: 298.25,
        ellipseName: "Australian Natl & S. Amer. 1969"
    },
    GRS67: {
        a: 6378160,
        rf: 298.247167427,
        ellipseName: "GRS 67(IUGG 1967)"
    },
    bessel: {
        a: 6377397.155,
        rf: 299.1528128,
        ellipseName: "Bessel 1841"
    },
    bess_nam: {
        a: 6377483.865,
        rf: 299.1528128,
        ellipseName: "Bessel 1841 (Namibia)"
    },
    clrk66: {
        a: 6378206.4,
        b: 6356583.8,
        ellipseName: "Clarke 1866"
    },
    clrk80: {
        a: 6378249.145,
        rf: 293.4663,
        ellipseName: "Clarke 1880 mod."
    },
    CPM: {
        a: 6375738.7,
        rf: 334.29,
        ellipseName: "Comm. des Poids et Mesures 1799"
    },
    delmbr: {
        a: 6376428,
        rf: 311.5,
        ellipseName: "Delambre 1810 (Belgium)"
    },
    engelis: {
        a: 6378136.05,
        rf: 298.2566,
        ellipseName: "Engelis 1985"
    },
    evrst30: {
        a: 6377276.345,
        rf: 300.8017,
        ellipseName: "Everest 1830"
    },
    evrst48: {
        a: 6377304.063,
        rf: 300.8017,
        ellipseName: "Everest 1948"
    },
    evrst56: {
        a: 6377301.243,
        rf: 300.8017,
        ellipseName: "Everest 1956"
    },
    evrst69: {
        a: 6377295.664,
        rf: 300.8017,
        ellipseName: "Everest 1969"
    },
    evrstSS: {
        a: 6377298.556,
        rf: 300.8017,
        ellipseName: "Everest (Sabah & Sarawak)"
    },
    fschr60: {
        a: 6378166,
        rf: 298.3,
        ellipseName: "Fischer (Mercury Datum) 1960"
    },
    fschr60m: {
        a: 6378155,
        rf: 298.3,
        ellipseName: "Fischer 1960"
    },
    fschr68: {
        a: 6378150,
        rf: 298.3,
        ellipseName: "Fischer 1968"
    },
    helmert: {
        a: 6378200,
        rf: 298.3,
        ellipseName: "Helmert 1906"
    },
    hough: {
        a: 6378270,
        rf: 297,
        ellipseName: "Hough"
    },
    intl: {
        a: 6378388,
        rf: 297,
        ellipseName: "International 1909 (Hayford)"
    },
    kaula: {
        a: 6378163,
        rf: 298.24,
        ellipseName: "Kaula 1961"
    },
    lerch: {
        a: 6378139,
        rf: 298.257,
        ellipseName: "Lerch 1979"
    },
    mprts: {
        a: 6397300,
        rf: 191,
        ellipseName: "Maupertius 1738"
    },
    new_intl: {
        a: 6378157.5,
        b: 6356772.2,
        ellipseName: "New International 1967"
    },
    plessis: {
        a: 6376523,
        rf: 6355863,
        ellipseName: "Plessis 1817 (France)"
    },
    krass: {
        a: 6378245,
        rf: 298.3,
        ellipseName: "Krassovsky, 1942"
    },
    SEasia: {
        a: 6378155,
        b: 6356773.3205,
        ellipseName: "Southeast Asia"
    },
    walbeck: {
        a: 6376896,
        b: 6355834.8467,
        ellipseName: "Walbeck"
    },
    WGS60: {
        a: 6378165,
        rf: 298.3,
        ellipseName: "WGS 60"
    },
    WGS66: {
        a: 6378145,
        rf: 298.25,
        ellipseName: "WGS 66"
    },
    WGS72: {
        a: 6378135,
        rf: 298.26,
        ellipseName: "WGS 72"
    },
    WGS84: {
        a: 6378137,
        rf: 298.257223563,
        ellipseName: "WGS 84"
    },
    sphere: {
        a: 6370997,
        b: 6370997,
        ellipseName: "Normal Sphere (r=6370997)"
    }
},
Proj4js.Datum = {
    WGS84: {
        towgs84: "0,0,0",
        ellipse: "WGS84",
        datumName: "WGS84"
    },
    GGRS87: {
        towgs84: "-199.87,74.79,246.62",
        ellipse: "GRS80",
        datumName: "Greek_Geodetic_Reference_System_1987"
    },
    NAD83: {
        towgs84: "0,0,0",
        ellipse: "GRS80",
        datumName: "North_American_Datum_1983"
    },
    NAD27: {
        nadgrids: "@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",
        ellipse: "clrk66",
        datumName: "North_American_Datum_1927"
    },
    potsdam: {
        towgs84: "606.0,23.0,413.0",
        ellipse: "bessel",
        datumName: "Potsdam Rauenberg 1950 DHDN"
    },
    carthage: {
        towgs84: "-263.0,6.0,431.0",
        ellipse: "clark80",
        datumName: "Carthage 1934 Tunisia"
    },
    hermannskogel: {
        towgs84: "653.0,-212.0,449.0",
        ellipse: "bessel",
        datumName: "Hermannskogel"
    },
    ire65: {
        towgs84: "482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",
        ellipse: "mod_airy",
        datumName: "Ireland 1965"
    },
    nzgd49: {
        towgs84: "59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",
        ellipse: "intl",
        datumName: "New Zealand Geodetic Datum 1949"
    },
    OSGB36: {
        towgs84: "446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",
        ellipse: "airy",
        datumName: "Airy 1830"
    }
},
Proj4js.WGS84 = new Proj4js.Proj("WGS84"),
Proj4js.Datum.OSB36 = Proj4js.Datum.OSGB36,
Proj4js.wktProjections = {
    "Lambert Tangential Conformal Conic Projection": "lcc",
    Mercator: "merc",
    "Popular Visualisation Pseudo Mercator": "merc",
    Mercator_1SP: "merc",
    Transverse_Mercator: "tmerc",
    "Transverse Mercator": "tmerc",
    "Lambert Azimuthal Equal Area": "laea",
    "Universal Transverse Mercator System": "utm"
},
Proj4js.Proj.aea = {
    init: function() {
        Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN ? Proj4js.reportError("aeaInitEqualLatitudes") : (this.temp = this.b / this.a,
        this.es = 1 - Math.pow(this.temp, 2),
        this.e3 = Math.sqrt(this.es),
        this.sin_po = Math.sin(this.lat1),
        this.cos_po = Math.cos(this.lat1),
        this.con = this.t1 = this.sin_po,
        this.ms1 = Proj4js.common.msfnz(this.e3, this.sin_po, this.cos_po),
        this.qs1 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.sin_po = Math.sin(this.lat2),
        this.cos_po = Math.cos(this.lat2),
        this.t2 = this.sin_po,
        this.ms2 = Proj4js.common.msfnz(this.e3, this.sin_po, this.cos_po),
        this.qs2 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.sin_po = Math.sin(this.lat0),
        this.cos_po = Math.cos(this.lat0),
        this.t3 = this.sin_po,
        this.qs0 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.ns0 = Math.abs(this.lat1 - this.lat2) > Proj4js.common.EPSLN ? (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1) : this.con,
        this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1,
        this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0)
    },
    forward: function(a) {
        var b = a.x
          , c = a.y;
        this.sin_phi = Math.sin(c),
        this.cos_phi = Math.cos(c);
        var c = Proj4js.common.qsfnz(this.e3, this.sin_phi, this.cos_phi)
          , c = this.a * Math.sqrt(this.c - this.ns0 * c) / this.ns0
          , d = this.ns0 * Proj4js.common.adjust_lon(b - this.long0)
          , b = c * Math.sin(d) + this.x0
          , c = this.rh - c * Math.cos(d) + this.y0;
        return a.x = b,
        a.y = c,
        a
    },
    inverse: function(a) {
        var b, c, d;
        return a.x -= this.x0,
        a.y = this.rh - a.y + this.y0,
        0 <= this.ns0 ? (b = Math.sqrt(a.x * a.x + a.y * a.y),
        c = 1) : (b = -Math.sqrt(a.x * a.x + a.y * a.y),
        c = -1),
        d = 0,
        0 != b && (d = Math.atan2(c * a.x, c * a.y)),
        c = b * this.ns0 / this.a,
        b = (this.c - c * c) / this.ns0,
        1e-10 <= this.e3 ? (c = 1 - .5 * (1 - this.es) * Math.log((1 - this.e3) / (1 + this.e3)) / this.e3,
        c = 1e-10 < Math.abs(Math.abs(c) - Math.abs(b)) ? this.phi1z(this.e3, b) : b >= 0 ? .5 * Proj4js.common.PI : -.5 * Proj4js.common.PI) : c = this.phi1z(this.e3, b),
        d = Proj4js.common.adjust_lon(d / this.ns0 + this.long0),
        a.x = d,
        a.y = c,
        a
    },
    phi1z: function(a, b) {
        var c, d, e, f, g = Proj4js.common.asinz(.5 * b);
        if (a < Proj4js.common.EPSLN)
            return g;
        for (var h = a * a, i = 1; 25 >= i; i++)
            if (c = Math.sin(g),
            d = Math.cos(g),
            e = a * c,
            f = 1 - e * e,
            c = .5 * f * f / d * (b / (1 - h) - c / f + .5 / a * Math.log((1 - e) / (1 + e))),
            g += c,
            1e-7 >= Math.abs(c))
                return g;
        return Proj4js.reportError("aea:phi1z:Convergence error"),
        null 
    }
},
Proj4js.Proj.sterea = {
    dependsOn: "gauss",
    init: function() {
        Proj4js.Proj.gauss.init.apply(this),
        this.rc ? (this.sinc0 = Math.sin(this.phic0),
        this.cosc0 = Math.cos(this.phic0),
        this.R2 = 2 * this.rc,
        this.title || (this.title = "Oblique Stereographic Alternative")) : Proj4js.reportError("sterea:init:E_ERROR_0")
    },
    forward: function(a) {
        var b, c, d, e;
        return a.x = Proj4js.common.adjust_lon(a.x - this.long0),
        Proj4js.Proj.gauss.forward.apply(this, [a]),
        b = Math.sin(a.y),
        c = Math.cos(a.y),
        d = Math.cos(a.x),
        e = this.k0 * this.R2 / (1 + this.sinc0 * b + this.cosc0 * c * d),
        a.x = e * c * Math.sin(a.x),
        a.y = e * (this.cosc0 * b - this.sinc0 * c * d),
        a.x = this.a * a.x + this.x0,
        a.y = this.a * a.y + this.y0,
        a
    },
    inverse: function(a) {
        var b, c, d, e;
        return a.x = (a.x - this.x0) / this.a,
        a.y = (a.y - this.y0) / this.a,
        a.x /= this.k0,
        a.y /= this.k0,
        (e = Math.sqrt(a.x * a.x + a.y * a.y)) ? (d = 2 * Math.atan2(e, this.R2),
        b = Math.sin(d),
        c = Math.cos(d),
        d = Math.asin(c * this.sinc0 + a.y * b * this.cosc0 / e),
        b = Math.atan2(a.x * b, e * this.cosc0 * c - a.y * this.sinc0 * b)) : (d = this.phic0,
        b = 0),
        a.x = b,
        a.y = d,
        Proj4js.Proj.gauss.inverse.apply(this, [a]),
        a.x = Proj4js.common.adjust_lon(a.x + this.long0),
        a
    }
},
Proj4js.Proj.poly = {
    init: function() {
        0 == this.lat0 && (this.lat0 = 90),
        this.temp = this.b / this.a,
        this.es = 1 - Math.pow(this.temp, 2),
        this.e = Math.sqrt(this.es),
        this.e0 = Proj4js.common.e0fn(this.es),
        this.e1 = Proj4js.common.e1fn(this.es),
        this.e2 = Proj4js.common.e2fn(this.es),
        this.e3 = Proj4js.common.e3fn(this.es),
        this.ml0 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
    },
    forward: function(a) {
        var b, c, d, e, f;
        return d = a.y,
        c = Proj4js.common.adjust_lon(a.x - this.long0),
        1e-7 >= Math.abs(d) ? (f = this.x0 + this.a * c,
        b = this.y0 - this.a * this.ml0) : (b = Math.sin(d),
        c = Math.cos(d),
        d = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, d),
        e = Proj4js.common.msfnz(this.e, b, c),
        c = b,
        f = this.x0 + this.a * e * Math.sin(c) / b,
        b = this.y0 + this.a * (d - this.ml0 + e * (1 - Math.cos(c)) / b)),
        a.x = f,
        a.y = b,
        a
    },
    inverse: function(a) {
        var b, c;
        if (a.x -= this.x0,
        a.y -= this.y0,
        b = this.ml0 + a.y / this.a,
        1e-7 >= Math.abs(b))
            b = a.x / this.a + this.long0,
            c = 0;
        else {
            if (b = b * b + a.x / this.a * (a.x / this.a),
            b = phi4z(this.es, this.e0, this.e1, this.e2, this.e3, this.al, b, void 0, c),
            1 != b)
                return b;
            b = Proj4js.common.adjust_lon(Proj4js.common.asinz(NaN * a.x / this.a) / Math.sin(c) + this.long0)
        }
        return a.x = b,
        a.y = c,
        a
    }
},
Proj4js.Proj.equi = {
    init: function() {
        this.x0 || (this.x0 = 0),
        this.y0 || (this.y0 = 0),
        this.lat0 || (this.lat0 = 0),
        this.long0 || (this.long0 = 0)
    },
    forward: function(a) {
        var b = a.y
          , c = this.x0 + this.a * Proj4js.common.adjust_lon(a.x - this.long0) * Math.cos(this.lat0)
          , b = this.y0 + this.a * b;
        return this.t1 = c,
        this.t2 = Math.cos(this.lat0),
        a.x = c,
        a.y = b,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b = a.y / this.a;
        Math.abs(b) > Proj4js.common.HALF_PI && Proj4js.reportError("equi:Inv:DataError");
        var c = Proj4js.common.adjust_lon(this.long0 + a.x / (this.a * Math.cos(this.lat0)));
        a.x = c,
        a.y = b
    }
},
Proj4js.Proj.merc = {
    init: function() {
        this.lat_ts && (this.k0 = this.sphere ? Math.cos(this.lat_ts) : Proj4js.common.msfnz(this.es, Math.sin(this.lat_ts), Math.cos(this.lat_ts)))
    },
    forward: function(a) {
        var b = a.x
          , c = a.y;
        if (90 < c * Proj4js.common.R2D && -90 > c * Proj4js.common.R2D && 180 < b * Proj4js.common.R2D && -180 > b * Proj4js.common.R2D)
            return Proj4js.reportError("merc:forward: llInputOutOfRange: " + b + " : " + c),
            null ;
        if (Math.abs(Math.abs(c) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN)
            return Proj4js.reportError("merc:forward: ll2mAtPoles"),
            null ;
        if (this.sphere)
            b = this.x0 + this.a * this.k0 * Proj4js.common.adjust_lon(b - this.long0),
            c = this.y0 + this.a * this.k0 * Math.log(Math.tan(Proj4js.common.FORTPI + .5 * c));
        else
            var d = Math.sin(c)
              , c = Proj4js.common.tsfnz(this.e, c, d)
              , b = this.x0 + this.a * this.k0 * Proj4js.common.adjust_lon(b - this.long0)
              , c = this.y0 - this.a * this.k0 * Math.log(c);
        return a.x = b,
        a.y = c,
        a
    },
    inverse: function(a) {
        var b = a.x - this.x0
          , c = a.y - this.y0;
        if (this.sphere)
            c = Proj4js.common.HALF_PI - 2 * Math.atan(Math.exp(-c / this.a * this.k0));
        else if (c = Math.exp(-c / (this.a * this.k0)),
        c = Proj4js.common.phi2z(this.e, c),
        -9999 == c)
            return Proj4js.reportError("merc:inverse: lat = -9999"),
            null ;
        return b = Proj4js.common.adjust_lon(this.long0 + b / (this.a * this.k0)),
        a.x = b,
        a.y = c,
        a
    }
},
Proj4js.Proj.utm = {
    dependsOn: "tmerc",
    init: function() {
        this.zone ? (this.lat0 = 0,
        this.long0 = (6 * Math.abs(this.zone) - 183) * Proj4js.common.D2R,
        this.x0 = 5e5,
        this.y0 = this.utmSouth ? 1e7 : 0,
        this.k0 = .9996,
        Proj4js.Proj.tmerc.init.apply(this),
        this.forward = Proj4js.Proj.tmerc.forward,
        this.inverse = Proj4js.Proj.tmerc.inverse) : Proj4js.reportError("utm:init: zone must be specified for UTM")
    }
},
Proj4js.Proj.eqdc = {
    init: function() {
        this.mode || (this.mode = 0),
        this.temp = this.b / this.a,
        this.es = 1 - Math.pow(this.temp, 2),
        this.e = Math.sqrt(this.es),
        this.e0 = Proj4js.common.e0fn(this.es),
        this.e1 = Proj4js.common.e1fn(this.es),
        this.e2 = Proj4js.common.e2fn(this.es),
        this.e3 = Proj4js.common.e3fn(this.es),
        this.sinphi = Math.sin(this.lat1),
        this.cosphi = Math.cos(this.lat1),
        this.ms1 = Proj4js.common.msfnz(this.e, this.sinphi, this.cosphi),
        this.ml1 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat1),
        0 != this.mode ? (Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN && Proj4js.reportError("eqdc:Init:EqualLatitudes"),
        this.sinphi = Math.sin(this.lat2),
        this.cosphi = Math.cos(this.lat2),
        this.ms2 = Proj4js.common.msfnz(this.e, this.sinphi, this.cosphi),
        this.ml2 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat2),
        this.ns = Math.abs(this.lat1 - this.lat2) >= Proj4js.common.EPSLN ? (this.ms1 - this.ms2) / (this.ml2 - this.ml1) : this.sinphi) : this.ns = this.sinphi,
        this.g = this.ml1 + this.ms1 / this.ns,
        this.ml0 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0),
        this.rh = this.a * (this.g - this.ml0)
    },
    forward: function(a) {
        var b = a.x
          , c = this.a * (this.g - Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, a.y))
          , d = this.ns * Proj4js.common.adjust_lon(b - this.long0)
          , b = this.x0 + c * Math.sin(d)
          , c = this.y0 + this.rh - c * Math.cos(d);
        return a.x = b,
        a.y = c,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y = this.rh - a.y + this.y0;
        var b, c;
        0 <= this.ns ? (c = Math.sqrt(a.x * a.x + a.y * a.y),
        b = 1) : (c = -Math.sqrt(a.x * a.x + a.y * a.y),
        b = -1);
        var d = 0;
        return 0 != c && (d = Math.atan2(b * a.x, b * a.y)),
        b = this.phi3z(this.g - c / this.a, this.e0, this.e1, this.e2, this.e3),
        d = Proj4js.common.adjust_lon(this.long0 + d / this.ns),
        a.x = d,
        a.y = b,
        a
    },
    phi3z: function(a, b, c, d, e) {
        var f, g;
        f = a;
        for (var h = 0; 15 > h; h++)
            if (g = (a + c * Math.sin(2 * f) - d * Math.sin(4 * f) + e * Math.sin(6 * f)) / b - f,
            f += g,
            1e-10 >= Math.abs(g))
                return f;
        return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
        null 
    }
},
Proj4js.Proj.tmerc = {
    init: function() {
        this.e0 = Proj4js.common.e0fn(this.es),
        this.e1 = Proj4js.common.e1fn(this.es),
        this.e2 = Proj4js.common.e2fn(this.es),
        this.e3 = Proj4js.common.e3fn(this.es),
        this.ml0 = this.a * Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
    },
    forward: function(a) {
        var b, c, d = a.y, e = Proj4js.common.adjust_lon(a.x - this.long0);
        b = Math.sin(d);
        var f = Math.cos(d);
        if (this.sphere) {
            var g = f * Math.sin(e);
            if (1e-10 > Math.abs(Math.abs(g) - 1))
                return Proj4js.reportError("tmerc:forward: Point projects into infinity"),
                93;
            c = .5 * this.a * this.k0 * Math.log((1 + g) / (1 - g)),
            b = Math.acos(f * Math.cos(e) / Math.sqrt(1 - g * g)),
            0 > d && (b = -b),
            d = this.a * this.k0 * (b - this.lat0)
        } else {
            c = f * e;
            var e = Math.pow(c, 2)
              , f = this.ep2 * Math.pow(f, 2)
              , g = Math.tan(d)
              , h = Math.pow(g, 2);
            b = 1 - this.es * Math.pow(b, 2),
            b = this.a / Math.sqrt(b),
            d = this.a * Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, d),
            c = this.k0 * b * c * (1 + e / 6 * (1 - h + f + e / 20 * (5 - 18 * h + Math.pow(h, 2) + 72 * f - 58 * this.ep2))) + this.x0,
            d = this.k0 * (d - this.ml0 + b * g * e * (.5 + e / 24 * (5 - h + 9 * f + 4 * Math.pow(f, 2) + e / 30 * (61 - 58 * h + Math.pow(h, 2) + 600 * f - 330 * this.ep2)))) + this.y0
        }
        return a.x = c,
        a.y = d,
        a
    },
    inverse: function(a) {
        var b, c, d, e;
        if (this.sphere) {
            c = Math.exp(a.x / (this.a * this.k0));
            var f = .5 * (c - 1 / c);
            d = this.lat0 + a.y / (this.a * this.k0),
            e = Math.cos(d),
            b = Math.sqrt((1 - e * e) / (1 + f * f)),
            c = Proj4js.common.asinz(b),
            0 > d && (c = -c),
            b = 0 == f && 0 == e ? this.long0 : Proj4js.common.adjust_lon(Math.atan2(f, e) + this.long0)
        } else {
            var f = a.x - this.x0
              , g = a.y - this.y0;
            for (c = b = (this.ml0 + g / this.k0) / this.a,
            e = 0; d = (b + this.e1 * Math.sin(2 * c) - this.e2 * Math.sin(4 * c) + this.e3 * Math.sin(6 * c)) / this.e0 - c,
            c += d,
            !(Math.abs(d) <= Proj4js.common.EPSLN); e++)
                if (e >= 6)
                    return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),
                    95;
            if (Math.abs(c) < Proj4js.common.HALF_PI) {
                b = Math.sin(c),
                d = Math.cos(c);
                var h = Math.tan(c);
                e = this.ep2 * Math.pow(d, 2);
                var g = Math.pow(e, 2)
                  , i = Math.pow(h, 2)
                  , j = Math.pow(i, 2);
                b = 1 - this.es * Math.pow(b, 2);
                var k = this.a / Math.sqrt(b);
                b = k * (1 - this.es) / b;
                var f = f / (k * this.k0)
                  , l = Math.pow(f, 2);
                c -= k * h * l / b * (.5 - l / 24 * (5 + 3 * i + 10 * e - 4 * g - 9 * this.ep2 - l / 30 * (61 + 90 * i + 298 * e + 45 * j - 252 * this.ep2 - 3 * g))),
                b = Proj4js.common.adjust_lon(this.long0 + f * (1 - l / 6 * (1 + 2 * i + e - l / 20 * (5 - 2 * e + 28 * i - 3 * g + 8 * this.ep2 + 24 * j))) / d)
            } else
                c = Proj4js.common.HALF_PI * Proj4js.common.sign(g),
                b = this.long0
        }
        return a.x = b,
        a.y = c,
        a
    }
},
Proj4js.defs.GOOGLE = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",
Proj4js.defs["EPSG:900913"] = Proj4js.defs.GOOGLE,
Proj4js.Proj.gstmerc = {
    init: function() {
        var a = this.b / this.a;
        this.e = Math.sqrt(1 - a * a),
        this.lc = this.long0,
        this.rs = Math.sqrt(1 + this.e * this.e * Math.pow(Math.cos(this.lat0), 4) / (1 - this.e * this.e));
        var a = Math.sin(this.lat0)
          , b = Math.asin(a / this.rs)
          , c = Math.sin(b);
        this.cp = Proj4js.common.latiso(0, b, c) - this.rs * Proj4js.common.latiso(this.e, this.lat0, a),
        this.n2 = this.k0 * this.a * Math.sqrt(1 - this.e * this.e) / (1 - this.e * this.e * a * a),
        this.xs = this.x0,
        this.ys = this.y0 - this.n2 * b,
        this.title || (this.title = "Gauss Schreiber transverse mercator")
    },
    forward: function(a) {
        var b = a.y
          , c = this.rs * (a.x - this.lc)
          , b = this.cp + this.rs * Proj4js.common.latiso(this.e, b, Math.sin(b))
          , d = Math.asin(Math.sin(c) / Proj4js.common.cosh(b))
          , d = Proj4js.common.latiso(0, d, Math.sin(d));
        return a.x = this.xs + this.n2 * d,
        a.y = this.ys + this.n2 * Math.atan(Proj4js.common.sinh(b) / Math.cos(c)),
        a
    },
    inverse: function(a) {
        var b = a.x
          , c = a.y
          , d = Math.atan(Proj4js.common.sinh((b - this.xs) / this.n2) / Math.cos((c - this.ys) / this.n2))
          , b = Math.asin(Math.sin((c - this.ys) / this.n2) / Proj4js.common.cosh((b - this.xs) / this.n2))
          , b = Proj4js.common.latiso(0, b, Math.sin(b));
        return a.x = this.lc + d / this.rs,
        a.y = Proj4js.common.invlatiso(this.e, (b - this.cp) / this.rs),
        a
    }
},
Proj4js.Proj.ortho = {
    init: function() {
        this.sin_p14 = Math.sin(this.lat0),
        this.cos_p14 = Math.cos(this.lat0)
    },
    forward: function(a) {
        var b, c, d, e, f;
        if (c = a.y,
        d = Proj4js.common.adjust_lon(a.x - this.long0),
        b = Math.sin(c),
        c = Math.cos(c),
        e = Math.cos(d),
        f = this.sin_p14 * b + this.cos_p14 * c * e,
        f > 0 || Math.abs(f) <= Proj4js.common.EPSLN)
            var g = 1 * this.a * c * Math.sin(d)
              , h = this.y0 + 1 * this.a * (this.cos_p14 * b - this.sin_p14 * c * e);
        else
            Proj4js.reportError("orthoFwdPointError");
        return a.x = g,
        a.y = h,
        a
    },
    inverse: function(a) {
        var b, c, d, e;
        return a.x -= this.x0,
        a.y -= this.y0,
        b = Math.sqrt(a.x * a.x + a.y * a.y),
        b > this.a + 1e-7 && Proj4js.reportError("orthoInvDataError"),
        c = Proj4js.common.asinz(b / this.a),
        d = Math.sin(c),
        e = Math.cos(c),
        c = this.long0,
        Math.abs(b),
        d = Proj4js.common.asinz(e * this.sin_p14 + a.y * d * this.cos_p14 / b),
        b = Math.abs(this.lat0) - Proj4js.common.HALF_PI,
        Math.abs(b) <= Proj4js.common.EPSLN && (c = 0 <= this.lat0 ? Proj4js.common.adjust_lon(this.long0 + Math.atan2(a.x, -a.y)) : Proj4js.common.adjust_lon(this.long0 - Math.atan2(-a.x, a.y))),
        Math.sin(d),
        a.x = c,
        a.y = d,
        a
    }
},
Proj4js.Proj.krovak = {
    init: function() {
        this.a = 6377397.155,
        this.es = .006674372230614,
        this.e = Math.sqrt(this.es),
        this.lat0 || (this.lat0 = .863937979737193),
        this.long0 || (this.long0 = .4334234309119251),
        this.k0 || (this.k0 = .9999),
        this.s45 = .785398163397448,
        this.s90 = 2 * this.s45,
        this.fi0 = this.lat0,
        this.e2 = this.es,
        this.e = Math.sqrt(this.e2),
        this.alfa = Math.sqrt(1 + this.e2 * Math.pow(Math.cos(this.fi0), 4) / (1 - this.e2)),
        this.uq = 1.04216856380474,
        this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa),
        this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2),
        this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g,
        this.k1 = this.k0,
        this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2)),
        this.s0 = 1.37008346281555,
        this.n = Math.sin(this.s0),
        this.ro0 = this.k1 * this.n0 / Math.tan(this.s0),
        this.ad = this.s90 - this.uq
    },
    forward: function(a) {
        var b, c, d;
        return c = a.y,
        d = Proj4js.common.adjust_lon(a.x - this.long0),
        b = Math.pow((1 + this.e * Math.sin(c)) / (1 - this.e * Math.sin(c)), this.alfa * this.e / 2),
        b = 2 * (Math.atan(this.k * Math.pow(Math.tan(c / 2 + this.s45), this.alfa) / b) - this.s45),
        c = -d * this.alfa,
        d = Math.asin(Math.cos(this.ad) * Math.sin(b) + Math.sin(this.ad) * Math.cos(b) * Math.cos(c)),
        b = this.n * Math.asin(Math.cos(b) * Math.sin(c) / Math.cos(d)),
        d = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(d / 2 + this.s45), this.n),
        a.y = d * Math.cos(b) / 1,
        a.x = d * Math.sin(b) / 1,
        this.czech && (a.y *= -1,
        a.x *= -1),
        a
    },
    inverse: function(a) {
        var b, c, d;
        b = a.x,
        a.x = a.y,
        a.y = b,
        this.czech && (a.y *= -1,
        a.x *= -1),
        b = Math.sqrt(a.x * a.x + a.y * a.y),
        c = Math.atan2(a.y, a.x) / Math.sin(this.s0),
        d = 2 * (Math.atan(Math.pow(this.ro0 / b, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45),
        b = Math.asin(Math.cos(this.ad) * Math.sin(d) - Math.sin(this.ad) * Math.cos(d) * Math.cos(c)),
        c = Math.asin(Math.cos(d) * Math.sin(c) / Math.cos(b)),
        a.x = this.long0 - c / this.alfa,
        c = b;
        var e = d = 0;
        do
            a.y = 2 * (Math.atan(Math.pow(this.k, -1 / this.alfa) * Math.pow(Math.tan(b / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(c)) / (1 - this.e * Math.sin(c)), this.e / 2)) - this.s45),
            1e-10 > Math.abs(c - a.y) && (d = 1),
            c = a.y,
            e += 1;
        while (0 == d && 15 > e);return e >= 15 ? (Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
        null ) : a
    }
},
Proj4js.Proj.somerc = {
    init: function() {
        var a = this.lat0;
        this.lambda0 = this.long0;
        var b = Math.sin(a)
          , c = this.a
          , d = 1 / this.rf
          , d = 2 * d - Math.pow(d, 2)
          , e = this.e = Math.sqrt(d);
        this.R = this.k0 * c * Math.sqrt(1 - d) / (1 - d * Math.pow(b, 2)),
        this.alpha = Math.sqrt(1 + d / (1 - d) * Math.pow(Math.cos(a), 4)),
        this.b0 = Math.asin(b / this.alpha),
        this.K = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2)) - this.alpha * Math.log(Math.tan(Math.PI / 4 + a / 2)) + this.alpha * e / 2 * Math.log((1 + e * b) / (1 - e * b))
    },
    forward: function(a) {
        var b = Math.log(Math.tan(Math.PI / 4 - a.y / 2))
          , c = this.e / 2 * Math.log((1 + this.e * Math.sin(a.y)) / (1 - this.e * Math.sin(a.y)))
          , c = 2 * (Math.atan(Math.exp(-this.alpha * (b + c) + this.K)) - Math.PI / 4)
          , d = this.alpha * (a.x - this.lambda0)
          , b = Math.atan(Math.sin(d) / (Math.sin(this.b0) * Math.tan(c) + Math.cos(this.b0) * Math.cos(d)))
          , c = Math.asin(Math.cos(this.b0) * Math.sin(c) - Math.sin(this.b0) * Math.cos(c) * Math.cos(d));
        return a.y = this.R / 2 * Math.log((1 + Math.sin(c)) / (1 - Math.sin(c))) + this.y0,
        a.x = this.R * b + this.x0,
        a
    },
    inverse: function(a) {
        for (var b = (a.x - this.x0) / this.R, c = 2 * (Math.atan(Math.exp((a.y - this.y0) / this.R)) - Math.PI / 4), d = Math.asin(Math.cos(this.b0) * Math.sin(c) + Math.sin(this.b0) * Math.cos(c) * Math.cos(b)), b = this.lambda0 + Math.atan(Math.sin(b) / (Math.cos(this.b0) * Math.cos(b) - Math.sin(this.b0) * Math.tan(c))) / this.alpha, c = 0, e = d, f = -1e3, g = 0; 1e-7 < Math.abs(e - f); ) {
            if (20 < ++g)
                return void Proj4js.reportError("omercFwdInfinity");
            c = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + d / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(e)) / 2)),
            f = e,
            e = 2 * Math.atan(Math.exp(c)) - Math.PI / 2
        }
        return a.x = b,
        a.y = e,
        a
    }
},
Proj4js.Proj.stere = {
    ssfn_: function(a, b, c) {
        return b *= c,
        Math.tan(.5 * (Proj4js.common.HALF_PI + a)) * Math.pow((1 - b) / (1 + b), .5 * c)
    },
    TOL: 1e-8,
    NITER: 8,
    CONV: 1e-10,
    S_POLE: 0,
    N_POLE: 1,
    OBLIQ: 2,
    EQUIT: 3,
    init: function() {
        this.phits = this.lat_ts ? this.lat_ts : Proj4js.common.HALF_PI;
        var a = Math.abs(this.lat0);
        if (this.mode = Math.abs(a) - Proj4js.common.HALF_PI < Proj4js.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : a > Proj4js.common.EPSLN ? this.OBLIQ : this.EQUIT,
        this.phits = Math.abs(this.phits),
        this.es) {
            var b;
            switch (this.mode) {
            case this.N_POLE:
            case this.S_POLE:
                Math.abs(this.phits - Proj4js.common.HALF_PI) < Proj4js.common.EPSLN ? this.akm1 = 2 * this.k0 / Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e)) : (a = Math.sin(this.phits),
                this.akm1 = Math.cos(this.phits) / Proj4js.common.tsfnz(this.e, this.phits, a),
                a *= this.e,
                this.akm1 /= Math.sqrt(1 - a * a));
                break;
            case this.EQUIT:
                this.akm1 = 2 * this.k0;
                break;
            case this.OBLIQ:
                a = Math.sin(this.lat0),
                b = 2 * Math.atan(this.ssfn_(this.lat0, a, this.e)) - Proj4js.common.HALF_PI,
                a *= this.e,
                this.akm1 = 2 * this.k0 * Math.cos(this.lat0) / Math.sqrt(1 - a * a),
                this.sinX1 = Math.sin(b),
                this.cosX1 = Math.cos(b)
            }
        } else
            switch (this.mode) {
            case this.OBLIQ:
                this.sinph0 = Math.sin(this.lat0),
                this.cosph0 = Math.cos(this.lat0);
            case this.EQUIT:
                this.akm1 = 2 * this.k0;
                break;
            case this.S_POLE:
            case this.N_POLE:
                this.akm1 = Math.abs(this.phits - Proj4js.common.HALF_PI) >= Proj4js.common.EPSLN ? Math.cos(this.phits) / Math.tan(Proj4js.common.FORTPI - .5 * this.phits) : 2 * this.k0
            }
    },
    forward: function(a) {
        var b, c, d = a.x, d = Proj4js.common.adjust_lon(d - this.long0), e = a.y;
        if (this.sphere) {
            var f, g, h;
            switch (f = Math.sin(e),
            g = Math.cos(e),
            h = Math.cos(d),
            d = Math.sin(d),
            this.mode) {
            case this.EQUIT:
                c = 1 + g * h,
                c <= Proj4js.common.EPSLN && Proj4js.reportError("stere:forward:Equit"),
                c = this.akm1 / c,
                b = c * g * d,
                c *= f;
                break;
            case this.OBLIQ:
                c = 1 + this.sinph0 * f + this.cosph0 * g * h,
                c <= Proj4js.common.EPSLN && Proj4js.reportError("stere:forward:Obliq"),
                c = this.akm1 / c,
                b = c * g * d,
                c *= this.cosph0 * f - this.sinph0 * g * h;
                break;
            case this.N_POLE:
                h = -h,
                e = -e;
            case this.S_POLE:
                Math.abs(e - Proj4js.common.HALF_PI) < this.TOL && Proj4js.reportError("stere:forward:S_POLE"),
                c = this.akm1 * Math.tan(Proj4js.common.FORTPI + .5 * e),
                b = d * c,
                c *= h
            }
        } else {
            h = Math.cos(d),
            d = Math.sin(d),
            f = Math.sin(e);
            var i;
            switch (this.mode != this.OBLIQ && this.mode != this.EQUIT || (i = 2 * Math.atan(this.ssfn_(e, f, this.e)),
            g = Math.sin(i - Proj4js.common.HALF_PI),
            i = Math.cos(i)),
            this.mode) {
            case this.OBLIQ:
                e = this.akm1 / (this.cosX1 * (1 + this.sinX1 * g + this.cosX1 * i * h)),
                c = e * (this.cosX1 * g - this.sinX1 * i * h),
                b = e * i;
                break;
            case this.EQUIT:
                e = 2 * this.akm1 / (1 + i * h),
                c = e * g,
                b = e * i;
                break;
            case this.S_POLE:
                e = -e,
                h = -h,
                f = -f;
            case this.N_POLE:
                b = this.akm1 * Proj4js.common.tsfnz(this.e, e, f),
                c = -b * h
            }
            b *= d
        }
        return a.x = b * this.a + this.x0,
        a.y = c * this.a + this.y0,
        a
    },
    inverse: function(a) {
        var b, c, d, e, f = (a.x - this.x0) / this.a, g = (a.y - this.y0) / this.a, h = b = 0, i = d = 0;
        if (this.sphere) {
            switch (h = Math.sqrt(f * f + g * g),
            i = 2 * Math.atan(h / this.akm1),
            d = Math.sin(i),
            i = Math.cos(i),
            b = 0,
            this.mode) {
            case this.EQUIT:
                c = Math.abs(h) <= Proj4js.common.EPSLN ? 0 : Math.asin(g * d / h),
                0 == i && 0 == f || (b = Math.atan2(f * d, i * h));
                break;
            case this.OBLIQ:
                c = Math.abs(h) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(i * this.sinph0 + g * d * this.cosph0 / h),
                i -= this.sinph0 * Math.sin(c),
                0 == i && 0 == f || (b = Math.atan2(f * d * this.cosph0, i * h));
                break;
            case this.N_POLE:
                g = -g;
            case this.S_POLE:
                c = Math.abs(h) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(this.mode == this.S_POLE ? -i : i),
                b = 0 == f && 0 == g ? 0 : Math.atan2(f, g)
            }
            a.x = Proj4js.common.adjust_lon(b + this.long0),
            a.y = c
        } else {
            switch (e = Math.sqrt(f * f + g * g),
            this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                b = 2 * Math.atan2(e * this.cosX1, this.akm1),
                d = Math.cos(b),
                c = Math.sin(b),
                h = 0 == e ? Math.asin(d * this.sinX1) : Math.asin(d * this.sinX1 + g * c * this.cosX1 / e),
                b = Math.tan(.5 * (Proj4js.common.HALF_PI + h)),
                f *= c,
                g = e * this.cosX1 * d - g * this.sinX1 * c,
                i = Proj4js.common.HALF_PI,
                d = .5 * this.e;
                break;
            case this.N_POLE:
                g = -g;
            case this.S_POLE:
                b = -e / this.akm1,
                h = Proj4js.common.HALF_PI - 2 * Math.atan(b),
                i = -Proj4js.common.HALF_PI,
                d = -.5 * this.e
            }
            for (e = this.NITER; e--; h = c)
                if (c = this.e * Math.sin(h),
                c = 2 * Math.atan(b * Math.pow((1 + c) / (1 - c), d)) - i,
                Math.abs(h - c) < this.CONV)
                    return this.mode == this.S_POLE && (c = -c),
                    b = 0 == f && 0 == g ? 0 : Math.atan2(f, g),
                    a.x = Proj4js.common.adjust_lon(b + this.long0),
                    a.y = c,
                    a
        }
    }
},
Proj4js.Proj.nzmg = {
    iterations: 1,
    init: function() {
        this.A = [],
        this.A[1] = .6399175073,
        this.A[2] = -.1358797613,
        this.A[3] = .063294409,
        this.A[4] = -.02526853,
        this.A[5] = .0117879,
        this.A[6] = -.0055161,
        this.A[7] = .0026906,
        this.A[8] = -.001333,
        this.A[9] = 67e-5,
        this.A[10] = -34e-5,
        this.B_re = [],
        this.B_im = [],
        this.B_re[1] = .7557853228,
        this.B_im[1] = 0,
        this.B_re[2] = .249204646,
        this.B_im[2] = .003371507,
        this.B_re[3] = -.001541739,
        this.B_im[3] = .04105856,
        this.B_re[4] = -.10162907,
        this.B_im[4] = .01727609,
        this.B_re[5] = -.26623489,
        this.B_im[5] = -.36249218,
        this.B_re[6] = -.6870983,
        this.B_im[6] = -1.1651967,
        this.C_re = [],
        this.C_im = [],
        this.C_re[1] = 1.3231270439,
        this.C_im[1] = 0,
        this.C_re[2] = -.577245789,
        this.C_im[2] = -.007809598,
        this.C_re[3] = .508307513,
        this.C_im[3] = -.112208952,
        this.C_re[4] = -.15094762,
        this.C_im[4] = .18200602,
        this.C_re[5] = 1.01418179,
        this.C_im[5] = 1.64497696,
        this.C_re[6] = 1.9660549,
        this.C_im[6] = 2.5127645,
        this.D = [],
        this.D[1] = 1.5627014243,
        this.D[2] = .5185406398,
        this.D[3] = -.03333098,
        this.D[4] = -.1052906,
        this.D[5] = -.0368594,
        this.D[6] = .007317,
        this.D[7] = .0122,
        this.D[8] = .00394,
        this.D[9] = -.0013
    },
    forward: function(a) {
        for (var b = 1e-5 * ((a.y - this.lat0) / Proj4js.common.SEC_TO_RAD), c = a.x - this.long0, d = 1, e = 0, f = 1; 10 >= f; f++)
            d *= b,
            e += this.A[f] * d;
        for (var b = e, d = 1, g = 0, h = 0, i = 0, f = 1; 6 >= f; f++)
            e = d * b - g * c,
            g = g * b + d * c,
            d = e,
            h = h + this.B_re[f] * d - this.B_im[f] * g,
            i = i + this.B_im[f] * d + this.B_re[f] * g;
        return a.x = i * this.a + this.x0,
        a.y = h * this.a + this.y0,
        a
    },
    inverse: function(a) {
        for (var b, c = (a.y - this.y0) / this.a, d = (a.x - this.x0) / this.a, e = 1, f = 0, g = 0, h = 0, i = 1; 6 >= i; i++)
            b = e * c - f * d,
            f = f * c + e * d,
            e = b,
            g = g + this.C_re[i] * e - this.C_im[i] * f,
            h = h + this.C_im[i] * e + this.C_re[i] * f;
        for (e = 0; e < this.iterations; e++) {
            var j, k = g, l = h;
            for (b = c,
            f = d,
            i = 2; 6 >= i; i++)
                j = k * g - l * h,
                l = l * g + k * h,
                k = j,
                b += (i - 1) * (this.B_re[i] * k - this.B_im[i] * l),
                f += (i - 1) * (this.B_im[i] * k + this.B_re[i] * l);
            for (var k = 1, l = 0, m = this.B_re[1], n = this.B_im[1], i = 2; 6 >= i; i++)
                j = k * g - l * h,
                l = l * g + k * h,
                k = j,
                m += i * (this.B_re[i] * k - this.B_im[i] * l),
                n += i * (this.B_im[i] * k + this.B_re[i] * l);
            h = m * m + n * n,
            g = (b * m + f * n) / h,
            h = (f * m - b * n) / h
        }
        for (c = g,
        d = 1,
        g = 0,
        i = 1; 9 >= i; i++)
            d *= c,
            g += this.D[i] * d;
        return i = this.lat0 + 1e5 * g * Proj4js.common.SEC_TO_RAD,
        a.x = this.long0 + h,
        a.y = i,
        a
    }
},
Proj4js.Proj.mill = {
    init: function() {},
    forward: function(a) {
        var b = a.y
          , c = this.x0 + this.a * Proj4js.common.adjust_lon(a.x - this.long0)
          , b = this.y0 + 1.25 * this.a * Math.log(Math.tan(Proj4js.common.PI / 4 + b / 2.5));
        return a.x = c,
        a.y = b,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b = Proj4js.common.adjust_lon(this.long0 + a.x / this.a)
          , c = 2.5 * (Math.atan(Math.exp(.8 * a.y / this.a)) - Proj4js.common.PI / 4);
        return a.x = b,
        a.y = c,
        a
    }
},
Proj4js.Proj.gnom = {
    init: function() {
        this.sin_p14 = Math.sin(this.lat0),
        this.cos_p14 = Math.cos(this.lat0),
        this.infinity_dist = 1e3 * this.a,
        this.rc = 1
    },
    forward: function(a) {
        var b, c, d, e, f;
        return c = a.y,
        d = Proj4js.common.adjust_lon(a.x - this.long0),
        b = Math.sin(c),
        c = Math.cos(c),
        e = Math.cos(d),
        f = this.sin_p14 * b + this.cos_p14 * c * e,
        f > 0 || Math.abs(f) <= Proj4js.common.EPSLN ? (d = this.x0 + 1 * this.a * c * Math.sin(d) / f,
        b = this.y0 + 1 * this.a * (this.cos_p14 * b - this.sin_p14 * c * e) / f) : (Proj4js.reportError("orthoFwdPointError"),
        d = this.x0 + this.infinity_dist * c * Math.sin(d),
        b = this.y0 + this.infinity_dist * (this.cos_p14 * b - this.sin_p14 * c * e)),
        a.x = d,
        a.y = b,
        a
    },
    inverse: function(a) {
        var b, c, d, e;
        return a.x = (a.x - this.x0) / this.a,
        a.y = (a.y - this.y0) / this.a,
        a.x /= this.k0,
        a.y /= this.k0,
        (b = Math.sqrt(a.x * a.x + a.y * a.y)) ? (e = Math.atan2(b, this.rc),
        c = Math.sin(e),
        d = Math.cos(e),
        e = Proj4js.common.asinz(d * this.sin_p14 + a.y * c * this.cos_p14 / b),
        b = Math.atan2(a.x * c, b * this.cos_p14 * d - a.y * this.sin_p14 * c),
        b = Proj4js.common.adjust_lon(this.long0 + b)) : (e = this.phic0,
        b = 0),
        a.x = b,
        a.y = e,
        a
    }
},
Proj4js.Proj.sinu = {
    init: function() {
        this.sphere ? (this.n = 1,
        this.es = this.m = 0,
        this.C_y = Math.sqrt((this.m + 1) / this.n),
        this.C_x = this.C_y / (this.m + 1)) : this.en = Proj4js.common.pj_enfn(this.es)
    },
    forward: function(a) {
        var b, c;
        if (b = a.x,
        c = a.y,
        b = Proj4js.common.adjust_lon(b - this.long0),
        this.sphere) {
            if (this.m)
                for (var d = this.n * Math.sin(c), e = Proj4js.common.MAX_ITER; e; --e) {
                    var f = (this.m * c + Math.sin(c) - d) / (this.m + Math.cos(c));
                    if (c -= f,
                    Math.abs(f) < Proj4js.common.EPSLN)
                        break
                }
            else
                c = 1 != this.n ? Math.asin(this.n * Math.sin(c)) : c;
            b = this.a * this.C_x * b * (this.m + Math.cos(c)),
            c *= this.a * this.C_y
        } else
            d = Math.sin(c),
            e = Math.cos(c),
            c = this.a * Proj4js.common.pj_mlfn(c, d, e, this.en),
            b = this.a * b * e / Math.sqrt(1 - this.es * d * d);
        return a.x = b,
        a.y = c,
        a
    },
    inverse: function(a) {
        var b, c;
        if (a.x -= this.x0,
        a.y -= this.y0,
        this.sphere)
            a.y /= this.C_y,
            b = this.m ? Math.asin((this.m * a.y + Math.sin(a.y)) / this.n) : 1 != this.n ? Math.asin(Math.sin(a.y) / this.n) : a.y,
            c = a.x / (this.C_x * (this.m + Math.cos(a.y)));
        else {
            b = Proj4js.common.pj_inv_mlfn(a.y / this.a, this.es, this.en);
            var d = Math.abs(b);
            d < Proj4js.common.HALF_PI ? (d = Math.sin(b),
            c = this.long0 + a.x * Math.sqrt(1 - this.es * d * d) / (this.a * Math.cos(b)),
            c = Proj4js.common.adjust_lon(c)) : d - Proj4js.common.EPSLN < Proj4js.common.HALF_PI && (c = this.long0)
        }
        return a.x = c,
        a.y = b,
        a
    }
},
Proj4js.Proj.vandg = {
    init: function() {
        this.R = 6370997
    },
    forward: function(a) {
        var b = a.y
          , c = Proj4js.common.adjust_lon(a.x - this.long0);
        Math.abs(b);
        var d = Proj4js.common.asinz(2 * Math.abs(b / Proj4js.common.PI));
        (Math.abs(c) <= Proj4js.common.EPSLN || Math.abs(Math.abs(b) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN) && Math.tan(.5 * d);
        var e = .5 * Math.abs(Proj4js.common.PI / c - c / Proj4js.common.PI)
          , f = e * e
          , g = Math.sin(d)
          , d = Math.cos(d)
          , d = d / (g + d - 1)
          , g = d * (2 / g - 1)
          , g = g * g
          , f = Proj4js.common.PI * this.R * (e * (d - g) + Math.sqrt(f * (d - g) * (d - g) - (g + f) * (d * d - g))) / (g + f);
        return 0 > c && (f = -f),
        c = this.x0 + f,
        f = Math.abs(f / (Proj4js.common.PI * this.R)),
        b = b >= 0 ? this.y0 + Proj4js.common.PI * this.R * Math.sqrt(1 - f * f - 2 * e * f) : this.y0 - Proj4js.common.PI * this.R * Math.sqrt(1 - f * f - 2 * e * f),
        a.x = c,
        a.y = b,
        a
    },
    inverse: function(a) {
        var b, c, d, e, f, g, h, i;
        return a.x -= this.x0,
        a.y -= this.y0,
        i = Proj4js.common.PI * this.R,
        b = a.x / i,
        d = a.y / i,
        e = b * b + d * d,
        f = -Math.abs(d) * (1 + e),
        c = f - 2 * d * d + b * b,
        g = -2 * f + 1 + 2 * d * d + e * e,
        i = d * d / g + (2 * c * c * c / g / g / g - 9 * f * c / g / g) / 27,
        h = (f - c * c / 3 / g) / g,
        f = 2 * Math.sqrt(-h / 3),
        i = 3 * i / h / f,
        1 < Math.abs(i) && (i = i >= 0 ? 1 : -1),
        i = Math.acos(i) / 3,
        c = 0 <= a.y ? (-f * Math.cos(i + Proj4js.common.PI / 3) - c / 3 / g) * Proj4js.common.PI : -(-f * Math.cos(i + Proj4js.common.PI / 3) - c / 3 / g) * Proj4js.common.PI,
        Math.abs(b),
        b = Proj4js.common.adjust_lon(this.long0 + Proj4js.common.PI * (e - 1 + Math.sqrt(1 + 2 * (b * b - d * d) + e * e)) / 2 / b),
        a.x = b,
        a.y = c,
        a
    }
},
Proj4js.Proj.cea = {
    init: function() {},
    forward: function(a) {
        var b = a.y
          , c = this.x0 + this.a * Proj4js.common.adjust_lon(a.x - this.long0) * Math.cos(this.lat_ts)
          , b = this.y0 + this.a * Math.sin(b) / Math.cos(this.lat_ts);
        return a.x = c,
        a.y = b,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b = Proj4js.common.adjust_lon(this.long0 + a.x / this.a / Math.cos(this.lat_ts))
          , c = Math.asin(a.y / this.a * Math.cos(this.lat_ts));
        return a.x = b,
        a.y = c,
        a
    }
},
Proj4js.Proj.eqc = {
    init: function() {
        this.x0 || (this.x0 = 0),
        this.y0 || (this.y0 = 0),
        this.lat0 || (this.lat0 = 0),
        this.long0 || (this.long0 = 0),
        this.lat_ts || (this.lat_ts = 0),
        this.title || (this.title = "Equidistant Cylindrical (Plate Carre)"),
        this.rc = Math.cos(this.lat_ts)
    },
    forward: function(a) {
        var b = a.y
          , c = Proj4js.common.adjust_lon(a.x - this.long0)
          , b = Proj4js.common.adjust_lat(b - this.lat0);
        return a.x = this.x0 + this.a * c * this.rc,
        a.y = this.y0 + this.a * b,
        a
    },
    inverse: function(a) {
        var b = a.y;
        return a.x = Proj4js.common.adjust_lon(this.long0 + (a.x - this.x0) / (this.a * this.rc)),
        a.y = Proj4js.common.adjust_lat(this.lat0 + (b - this.y0) / this.a),
        a
    }
},
Proj4js.Proj.cass = {
    init: function() {
        this.sphere || (this.en = Proj4js.common.pj_enfn(this.es),
        this.m0 = Proj4js.common.pj_mlfn(this.lat0, Math.sin(this.lat0), Math.cos(this.lat0), this.en))
    },
    C1: .16666666666666666,
    C2: .008333333333333333,
    C3: .041666666666666664,
    C4: .3333333333333333,
    C5: .06666666666666667,
    forward: function(a) {
        var b, c, d = a.x, e = a.y, d = Proj4js.common.adjust_lon(d - this.long0);
        return this.sphere ? (b = Math.asin(Math.cos(e) * Math.sin(d)),
        c = Math.atan2(Math.tan(e), Math.cos(d)) - this.phi0) : (this.n = Math.sin(e),
        this.c = Math.cos(e),
        c = Proj4js.common.pj_mlfn(e, this.n, this.c, this.en),
        this.n = 1 / Math.sqrt(1 - this.es * this.n * this.n),
        this.tn = Math.tan(e),
        this.t = this.tn * this.tn,
        this.a1 = d * this.c,
        this.c *= this.es * this.c / (1 - this.es),
        this.a2 = this.a1 * this.a1,
        b = this.n * this.a1 * (1 - this.a2 * this.t * (this.C1 - (8 - this.t + 8 * this.c) * this.a2 * this.C2)),
        c -= this.m0 - this.n * this.tn * this.a2 * (.5 + (5 - this.t + 6 * this.c) * this.a2 * this.C3)),
        a.x = this.a * b + this.x0,
        a.y = this.a * c + this.y0,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b = a.x / this.a
          , c = a.y / this.a;
        if (this.sphere)
            this.dd = c + this.lat0,
            c = Math.asin(Math.sin(this.dd) * Math.cos(b)),
            b = Math.atan2(Math.tan(b), Math.cos(this.dd));
        else {
            var d = Proj4js.common.pj_inv_mlfn(this.m0 + c, this.es, this.en);
            this.tn = Math.tan(d),
            this.t = this.tn * this.tn,
            this.n = Math.sin(d),
            this.r = 1 / (1 - this.es * this.n * this.n),
            this.n = Math.sqrt(this.r),
            this.r *= (1 - this.es) * this.n,
            this.dd = b / this.n,
            this.d2 = this.dd * this.dd,
            c = d - this.n * this.tn / this.r * this.d2 * (.5 - (1 + 3 * this.t) * this.d2 * this.C3),
            b = this.dd * (1 + this.t * this.d2 * (-this.C4 + (1 + 3 * this.t) * this.d2 * this.C5)) / Math.cos(d)
        }
        return a.x = Proj4js.common.adjust_lon(this.long0 + b),
        a.y = c,
        a
    }
},
Proj4js.Proj.gauss = {
    init: function() {
        var a = Math.sin(this.lat0)
          , b = Math.cos(this.lat0)
          , b = b * b;
        this.rc = Math.sqrt(1 - this.es) / (1 - this.es * a * a),
        this.C = Math.sqrt(1 + this.es * b * b / (1 - this.es)),
        this.phic0 = Math.asin(a / this.C),
        this.ratexp = .5 * this.C * this.e,
        this.K = Math.tan(.5 * this.phic0 + Proj4js.common.FORTPI) / (Math.pow(Math.tan(.5 * this.lat0 + Proj4js.common.FORTPI), this.C) * Proj4js.common.srat(this.e * a, this.ratexp))
    },
    forward: function(a) {
        var b = a.x
          , c = a.y;
        return a.y = 2 * Math.atan(this.K * Math.pow(Math.tan(.5 * c + Proj4js.common.FORTPI), this.C) * Proj4js.common.srat(this.e * Math.sin(c), this.ratexp)) - Proj4js.common.HALF_PI,
        a.x = this.C * b,
        a
    },
    inverse: function(a) {
        for (var b = a.x / this.C, c = a.y, d = Math.pow(Math.tan(.5 * c + Proj4js.common.FORTPI) / this.K, 1 / this.C), e = Proj4js.common.MAX_ITER; e > 0 && (c = 2 * Math.atan(d * Proj4js.common.srat(this.e * Math.sin(a.y), -.5 * this.e)) - Proj4js.common.HALF_PI,
        !(1e-14 > Math.abs(c - a.y))); --e)
            a.y = c;
        return e ? (a.x = b,
        a.y = c,
        a) : (Proj4js.reportError("gauss:inverse:convergence failed"),
        null )
    }
},
Proj4js.Proj.omerc = {
    init: function() {
        this.mode || (this.mode = 0),
        this.lon1 || (this.lon1 = 0,
        this.mode = 1),
        this.lon2 || (this.lon2 = 0),
        this.lat2 || (this.lat2 = 0);
        var a = 1 - Math.pow(this.b / this.a, 2);
        Math.sqrt(a),
        this.sin_p20 = Math.sin(this.lat0),
        this.cos_p20 = Math.cos(this.lat0),
        this.con = 1 - this.es * this.sin_p20 * this.sin_p20,
        this.com = Math.sqrt(1 - a),
        this.bl = Math.sqrt(1 + this.es * Math.pow(this.cos_p20, 4) / (1 - a)),
        this.al = this.a * this.bl * this.k0 * this.com / this.con,
        Math.abs(this.lat0) < Proj4js.common.EPSLN ? this.el = this.d = this.ts = 1 : (this.ts = Proj4js.common.tsfnz(this.e, this.lat0, this.sin_p20),
        this.con = Math.sqrt(this.con),
        this.d = this.bl * this.com / (this.cos_p20 * this.con),
        this.f = 0 < this.d * this.d - 1 ? 0 <= this.lat0 ? this.d + Math.sqrt(this.d * this.d - 1) : this.d - Math.sqrt(this.d * this.d - 1) : this.d,
        this.el = this.f * Math.pow(this.ts, this.bl)),
        0 != this.mode ? (this.g = .5 * (this.f - 1 / this.f),
        this.gama = Proj4js.common.asinz(Math.sin(this.alpha) / this.d),
        this.longc -= Proj4js.common.asinz(this.g * Math.tan(this.gama)) / this.bl,
        this.con = Math.abs(this.lat0),
        this.con > Proj4js.common.EPSLN && Math.abs(this.con - Proj4js.common.HALF_PI) > Proj4js.common.EPSLN ? (this.singam = Math.sin(this.gama),
        this.cosgam = Math.cos(this.gama),
        this.sinaz = Math.sin(this.alpha),
        this.cosaz = Math.cos(this.alpha),
        this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz)) : Proj4js.reportError("omerc:Init:DataError")) : (this.sinphi = Math.sin(this.at1),
        this.ts1 = Proj4js.common.tsfnz(this.e, this.lat1, this.sinphi),
        this.sinphi = Math.sin(this.lat2),
        this.ts2 = Proj4js.common.tsfnz(this.e, this.lat2, this.sinphi),
        this.h = Math.pow(this.ts1, this.bl),
        this.l = Math.pow(this.ts2, this.bl),
        this.f = this.el / this.h,
        this.g = .5 * (this.f - 1 / this.f),
        this.j = (this.el * this.el - this.l * this.h) / (this.el * this.el + this.l * this.h),
        this.p = (this.l - this.h) / (this.l + this.h),
        this.dlon = this.lon1 - this.lon2,
        this.dlon < -Proj4js.common.PI && (this.lon2 -= 2 * Proj4js.common.PI),
        this.dlon > Proj4js.common.PI && (this.lon2 += 2 * Proj4js.common.PI),
        this.dlon = this.lon1 - this.lon2,
        this.longc = .5 * (this.lon1 + this.lon2) - Math.atan(this.j * Math.tan(.5 * this.bl * this.dlon) / this.p) / this.bl,
        this.dlon = Proj4js.common.adjust_lon(this.lon1 - this.longc),
        this.gama = Math.atan(Math.sin(this.bl * this.dlon) / this.g),
        this.alpha = Proj4js.common.asinz(this.d * Math.sin(this.gama)),
        Math.abs(this.lat1 - this.lat2) <= Proj4js.common.EPSLN ? Proj4js.reportError("omercInitDataError") : this.con = Math.abs(this.lat1),
        this.con <= Proj4js.common.EPSLN || Math.abs(this.con - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN ? Proj4js.reportError("omercInitDataError") : Math.abs(Math.abs(this.lat0) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN && Proj4js.reportError("omercInitDataError"),
        this.singam = Math.sin(this.gam),
        this.cosgam = Math.cos(this.gam),
        this.sinaz = Math.sin(this.alpha),
        this.cosaz = Math.cos(this.alpha),
        this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz))
    },
    forward: function(a) {
        var b, c, d, e, f;
        return d = a.x,
        c = a.y,
        b = Math.sin(c),
        e = Proj4js.common.adjust_lon(d - this.longc),
        d = Math.sin(this.bl * e),
        Math.abs(Math.abs(c) - Proj4js.common.HALF_PI) > Proj4js.common.EPSLN ? (b = Proj4js.common.tsfnz(this.e, c, b),
        b = this.el / Math.pow(b, this.bl),
        f = .5 * (b - 1 / b),
        b = (f * this.singam - d * this.cosgam) / (.5 * (b + 1 / b)),
        c = Math.cos(this.bl * e),
        1e-7 > Math.abs(c) ? d = this.al * this.bl * e : (d = this.al * Math.atan((f * this.cosgam + d * this.singam) / c) / this.bl,
        0 > c && (d += Proj4js.common.PI * this.al / this.bl))) : (b = c >= 0 ? this.singam : -this.singam,
        d = this.al * c / this.bl),
        Math.abs(Math.abs(b) - 1) <= Proj4js.common.EPSLN && Proj4js.reportError("omercFwdInfinity"),
        e = .5 * this.al * Math.log((1 - b) / (1 + b)) / this.bl,
        d -= this.u,
        b = this.y0 + d * this.cosaz - e * this.sinaz,
        a.x = this.x0 + e * this.cosaz + d * this.sinaz,
        a.y = b,
        a
    },
    inverse: function(a) {
        var b, c, d, e;
        return a.x -= this.x0,
        a.y -= this.y0,
        b = a.x * this.cosaz - a.y * this.sinaz,
        d = a.y * this.cosaz + a.x * this.sinaz,
        d += this.u,
        c = Math.exp(-this.bl * b / this.al),
        b = .5 * (c - 1 / c),
        c = .5 * (c + 1 / c),
        d = Math.sin(this.bl * d / this.al),
        e = (d * this.cosgam + b * this.singam) / c,
        Math.abs(Math.abs(e) - 1) <= Proj4js.common.EPSLN ? (b = this.longc,
        e = e >= 0 ? Proj4js.common.HALF_PI : -Proj4js.common.HALF_PI) : (c = 1 / this.bl,
        e = Math.pow(this.el / Math.sqrt((1 + e) / (1 - e)), c),
        e = Proj4js.common.phi2z(this.e, e),
        b = this.longc - Math.atan2(b * this.cosgam - d * this.singam, c) / this.bl,
        b = Proj4js.common.adjust_lon(b)),
        a.x = b,
        a.y = e,
        a
    }
},
Proj4js.Proj.lcc = {
    init: function() {
        if (this.lat2 || (this.lat2 = this.lat0),
        this.k0 || (this.k0 = 1),
        Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN)
            Proj4js.reportError("lcc:init: Equal Latitudes");
        else {
            var a = this.b / this.a;
            this.e = Math.sqrt(1 - a * a);
            var a = Math.sin(this.lat1)
              , b = Math.cos(this.lat1)
              , b = Proj4js.common.msfnz(this.e, a, b)
              , c = Proj4js.common.tsfnz(this.e, this.lat1, a)
              , d = Math.sin(this.lat2)
              , e = Math.cos(this.lat2)
              , e = Proj4js.common.msfnz(this.e, d, e)
              , d = Proj4js.common.tsfnz(this.e, this.lat2, d)
              , f = Proj4js.common.tsfnz(this.e, this.lat0, Math.sin(this.lat0));
            this.ns = Math.abs(this.lat1 - this.lat2) > Proj4js.common.EPSLN ? Math.log(b / e) / Math.log(c / d) : a,
            this.f0 = b / (this.ns * Math.pow(c, this.ns)),
            this.rh = this.a * this.f0 * Math.pow(f, this.ns),
            this.title || (this.title = "Lambert Conformal Conic")
        }
    },
    forward: function(a) {
        var b = a.x
          , c = a.y;
        if (!(90 >= c && c >= -90 && 180 >= b && b >= -180))
            return Proj4js.reportError("lcc:forward: llInputOutOfRange: " + b + " : " + c),
            null ;
        var d = Math.abs(Math.abs(c) - Proj4js.common.HALF_PI);
        if (d > Proj4js.common.EPSLN)
            c = Proj4js.common.tsfnz(this.e, c, Math.sin(c)),
            c = this.a * this.f0 * Math.pow(c, this.ns);
        else {
            if (d = c * this.ns,
            0 >= d)
                return Proj4js.reportError("lcc:forward: No Projection"),
                null ;
            c = 0
        }
        return b = this.ns * Proj4js.common.adjust_lon(b - this.long0),
        a.x = this.k0 * c * Math.sin(b) + this.x0,
        a.y = this.k0 * (this.rh - c * Math.cos(b)) + this.y0,
        a
    },
    inverse: function(a) {
        var b, c, d, e = (a.x - this.x0) / this.k0, f = this.rh - (a.y - this.y0) / this.k0;
        if (0 < this.ns ? (b = Math.sqrt(e * e + f * f),
        c = 1) : (b = -Math.sqrt(e * e + f * f),
        c = -1),
        d = 0,
        0 != b && (d = Math.atan2(c * e, c * f)),
        0 != b || 0 < this.ns) {
            if (c = 1 / this.ns,
            b = Math.pow(b / (this.a * this.f0), c),
            b = Proj4js.common.phi2z(this.e, b),
            -9999 == b)
                return null 
        } else
            b = -Proj4js.common.HALF_PI;
        return d = Proj4js.common.adjust_lon(d / this.ns + this.long0),
        a.x = d,
        a.y = b,
        a
    }
},
Proj4js.Proj.laea = {
    S_POLE: 1,
    N_POLE: 2,
    EQUIT: 3,
    OBLIQ: 4,
    init: function() {
        var a = Math.abs(this.lat0);
        if (this.mode = Math.abs(a - Proj4js.common.HALF_PI) < Proj4js.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : Math.abs(a) < Proj4js.common.EPSLN ? this.EQUIT : this.OBLIQ,
        0 < this.es)
            switch (this.qp = Proj4js.common.qsfnz(this.e, 1),
            this.mmf = .5 / (1 - this.es),
            this.apa = this.authset(this.es),
            this.mode) {
            case this.N_POLE:
            case this.S_POLE:
                this.dd = 1;
                break;
            case this.EQUIT:
                this.rq = Math.sqrt(.5 * this.qp),
                this.dd = 1 / this.rq,
                this.xmf = 1,
                this.ymf = .5 * this.qp;
                break;
            case this.OBLIQ:
                this.rq = Math.sqrt(.5 * this.qp),
                a = Math.sin(this.lat0),
                this.sinb1 = Proj4js.common.qsfnz(this.e, a) / this.qp,
                this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1),
                this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * a * a) * this.rq * this.cosb1),
                this.ymf = (this.xmf = this.rq) / this.dd,
                this.xmf *= this.dd
            }
        else
            this.mode == this.OBLIQ && (this.sinph0 = Math.sin(this.lat0),
            this.cosph0 = Math.cos(this.lat0))
    },
    forward: function(a) {
        var b, c, d = a.x, e = a.y, d = Proj4js.common.adjust_lon(d - this.long0);
        if (this.sphere) {
            var f, g, h;
            switch (h = Math.sin(e),
            g = Math.cos(e),
            f = Math.cos(d),
            this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                if (c = this.mode == this.EQUIT ? 1 + g * f : 1 + this.sinph0 * h + this.cosph0 * g * f,
                c <= Proj4js.common.EPSLN)
                    return Proj4js.reportError("laea:fwd:y less than eps"),
                    null ;
                c = Math.sqrt(2 / c),
                b = c * g * Math.sin(d),
                c *= this.mode == this.EQUIT ? h : this.cosph0 * h - this.sinph0 * g * f;
                break;
            case this.N_POLE:
                f = -f;
            case this.S_POLE:
                if (Math.abs(e + this.phi0) < Proj4js.common.EPSLN)
                    return Proj4js.reportError("laea:fwd:phi < eps"),
                    null ;
                c = Proj4js.common.FORTPI - .5 * e,
                c = 2 * (this.mode == this.S_POLE ? Math.cos(c) : Math.sin(c)),
                b = c * Math.sin(d),
                c *= f
            }
        } else {
            var i = g = 0
              , j = 0;
            switch (f = Math.cos(d),
            d = Math.sin(d),
            h = Math.sin(e),
            h = Proj4js.common.qsfnz(this.e, h),
            this.mode != this.OBLIQ && this.mode != this.EQUIT || (g = h / this.qp,
            i = Math.sqrt(1 - g * g)),
            this.mode) {
            case this.OBLIQ:
                j = 1 + this.sinb1 * g + this.cosb1 * i * f;
                break;
            case this.EQUIT:
                j = 1 + i * f;
                break;
            case this.N_POLE:
                j = Proj4js.common.HALF_PI + e,
                h = this.qp - h;
                break;
            case this.S_POLE:
                j = e - Proj4js.common.HALF_PI,
                h = this.qp + h
            }
            if (Math.abs(j) < Proj4js.common.EPSLN)
                return Proj4js.reportError("laea:fwd:b < eps"),
                null ;
            switch (this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                j = Math.sqrt(2 / j),
                c = this.mode == this.OBLIQ ? this.ymf * j * (this.cosb1 * g - this.sinb1 * i * f) : (j = Math.sqrt(2 / (1 + i * f))) * g * this.ymf,
                b = this.xmf * j * i * d;
                break;
            case this.N_POLE:
            case this.S_POLE:
                h >= 0 ? (b = (j = Math.sqrt(h)) * d,
                c = f * (this.mode == this.S_POLE ? j : -j)) : b = c = 0
            }
        }
        return a.x = this.a * b + this.x0,
        a.y = this.a * c + this.y0,
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b, c = a.x / this.a, d = a.y / this.a;
        if (this.sphere) {
            var e, f = 0, g = 0;
            if (e = Math.sqrt(c * c + d * d),
            b = .5 * e,
            b > 1)
                return Proj4js.reportError("laea:Inv:DataError"),
                null ;
            switch (b = 2 * Math.asin(b),
            this.mode != this.OBLIQ && this.mode != this.EQUIT || (g = Math.sin(b),
            f = Math.cos(b)),
            this.mode) {
            case this.EQUIT:
                b = Math.abs(e) <= Proj4js.common.EPSLN ? 0 : Math.asin(d * g / e),
                c *= g,
                d = f * e;
                break;
            case this.OBLIQ:
                b = Math.abs(e) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(f * this.sinph0 + d * g * this.cosph0 / e),
                c *= g * this.cosph0,
                d = (f - Math.sin(b) * this.sinph0) * e;
                break;
            case this.N_POLE:
                d = -d,
                b = Proj4js.common.HALF_PI - b;
                break;
            case this.S_POLE:
                b -= Proj4js.common.HALF_PI
            }
            c = 0 != d || this.mode != this.EQUIT && this.mode != this.OBLIQ ? Math.atan2(c, d) : 0
        } else {
            switch (b = 0,
            this.mode) {
            case this.EQUIT:
            case this.OBLIQ:
                if (c /= this.dd,
                d *= this.dd,
                g = Math.sqrt(c * c + d * d),
                g < Proj4js.common.EPSLN)
                    return a.x = 0,
                    a.y = this.phi0,
                    a;
                e = 2 * Math.asin(.5 * g / this.rq),
                f = Math.cos(e),
                c *= e = Math.sin(e),
                this.mode == this.OBLIQ ? (b = f * this.sinb1 + d * e * this.cosb1 / g,
                d = g * this.cosb1 * f - d * this.sinb1 * e) : (b = d * e / g,
                d = g * f);
                break;
            case this.N_POLE:
                d = -d;
            case this.S_POLE:
                if (b = c * c + d * d,
                !b)
                    return a.x = 0,
                    a.y = this.phi0,
                    a;
                b = 1 - b / this.qp,
                this.mode == this.S_POLE && (b = -b)
            }
            c = Math.atan2(c, d),
            b = this.authlat(Math.asin(b), this.apa)
        }
        return a.x = Proj4js.common.adjust_lon(this.long0 + c),
        a.y = b,
        a
    },
    P00: .3333333333333333,
    P01: .17222222222222222,
    P02: .10257936507936508,
    P10: .06388888888888888,
    P11: .0664021164021164,
    P20: .016415012942191543,
    authset: function(a) {
        var b, c = [];
        return c[0] = a * this.P00,
        b = a * a,
        c[0] += b * this.P01,
        c[1] = b * this.P10,
        b *= a,
        c[0] += b * this.P02,
        c[1] += b * this.P11,
        c[2] = b * this.P20,
        c
    },
    authlat: function(a, b) {
        var c = a + a;
        return a + b[0] * Math.sin(c) + b[1] * Math.sin(c + c) + b[2] * Math.sin(c + c + c)
    }
},
Proj4js.Proj.aeqd = {
    init: function() {
        this.sin_p12 = Math.sin(this.lat0),
        this.cos_p12 = Math.cos(this.lat0)
    },
    forward: function(a) {
        var b, c = a.x, d = Math.sin(a.y), e = Math.cos(a.y), c = Proj4js.common.adjust_lon(c - this.long0), f = Math.cos(c), g = this.sin_p12 * d + this.cos_p12 * e * f;
        if (Math.abs(Math.abs(g) - 1) < Proj4js.common.EPSLN) {
            if (b = 1,
            0 > g)
                return void Proj4js.reportError("aeqd:Fwd:PointError")
        } else
            b = Math.acos(g),
            b /= Math.sin(b);
        return a.x = this.x0 + this.a * b * e * Math.sin(c),
        a.y = this.y0 + this.a * b * (this.cos_p12 * d - this.sin_p12 * e * f),
        a
    },
    inverse: function(a) {
        a.x -= this.x0,
        a.y -= this.y0;
        var b = Math.sqrt(a.x * a.x + a.y * a.y);
        if (!(b > 2 * Proj4js.common.HALF_PI * this.a)) {
            var c, d = b / this.a, e = Math.sin(d), d = Math.cos(d), f = this.long0;
            if (Math.abs(b) <= Proj4js.common.EPSLN)
                c = this.lat0;
            else {
                c = Proj4js.common.asinz(d * this.sin_p12 + a.y * e * this.cos_p12 / b);
                var g = Math.abs(this.lat0) - Proj4js.common.HALF_PI;
                Math.abs(g) <= Proj4js.common.EPSLN ? f = 0 <= this.lat0 ? Proj4js.common.adjust_lon(this.long0 + Math.atan2(a.x, -a.y)) : Proj4js.common.adjust_lon(this.long0 - Math.atan2(-a.x, a.y)) : (g = d - this.sin_p12 * Math.sin(c),
                Math.abs(g) < Proj4js.common.EPSLN && Math.abs(a.x) < Proj4js.common.EPSLN || (Math.atan2(a.x * e * this.cos_p12, g * b),
                f = Proj4js.common.adjust_lon(this.long0 + Math.atan2(a.x * e * this.cos_p12, g * b))))
            }
            return a.x = f,
            a.y = c,
            a
        }
        Proj4js.reportError("aeqdInvDataError")
    }
},
Proj4js.Proj.moll = {
    init: function() {},
    forward: function(a) {
        for (var b = a.y, c = Proj4js.common.adjust_lon(a.x - this.long0), d = b, e = Proj4js.common.PI * Math.sin(b), f = 0; ; f++) {
            var g = -(d + Math.sin(d) - e) / (1 + Math.cos(d))
              , d = d + g;
            if (Math.abs(g) < Proj4js.common.EPSLN)
                break;
            f >= 50 && Proj4js.reportError("moll:Fwd:IterationError")
        }
        return d /= 2,
        Proj4js.common.PI / 2 - Math.abs(b) < Proj4js.common.EPSLN && (c = 0),
        b = .900316316158 * this.a * c * Math.cos(d) + this.x0,
        d = 1.4142135623731 * this.a * Math.sin(d) + this.y0,
        a.x = b,
        a.y = d,
        a
    },
    inverse: function(a) {
        var b;
        a.x -= this.x0,
        b = a.y / (1.4142135623731 * this.a),
        .999999999999 < Math.abs(b) && (b = .999999999999),
        b = Math.asin(b);
        var c = Proj4js.common.adjust_lon(this.long0 + a.x / (.900316316158 * this.a * Math.cos(b)));
        return c < -Proj4js.common.PI && (c = -Proj4js.common.PI),
        c > Proj4js.common.PI && (c = Proj4js.common.PI),
        b = (2 * b + Math.sin(2 * b)) / Proj4js.common.PI,
        1 < Math.abs(b) && (b = 1),
        b = Math.asin(b),
        a.x = c,
        a.y = b,
        a
    }
},
nm_module("nm/views/google/convert/geometry", function(a, b, c, d) {
    var e = b("jscore/functools", "bind")
      , f = b("js-libs/google", "maps")
      , g = Math.PI / 180
      , h = a.LatLng = c(Object, {
        constructor: function(a, b, c) {
            this._lat = "number" == typeof a ? a : parseFloat(a),
            this._lng = "number" == typeof b ? b : parseFloat(b),
            c || (this._lat < -90 ? this._lat = (this._lat + 90) % 180 + 90 : a > 90 && (this._lat = (this._lat - 90) % 180 - 90),
            this._lng < -180 ? this._lng = (this._lng + 180) % 360 + 180 : this._lng > 180 && (this._lng = (this._lng - 180) % 360 - 180))
        },
        lat: function() {
            return this._lat
        },
        lng: function() {
            return this._lng
        },
        haversine: function(a) {
            var b = a.latRadians() - this.latRadians()
              , c = a.lngRadians() - this.lngRadians()
              , d = Math.sin(b / 2) * Math.sin(b / 2) + Math.cos(this.latRadians()) * Math.cos(a.latRadians()) * Math.sin(c / 2) * Math.sin(c / 2)
              , e = 2 * Math.atan2(Math.sqrt(d), Math.sqrt(1 - d));
            return e
        },
        simpleDistance: function(a) {
            return 6378137 * this.haversine(a)
        },
        getBearingTo: function(a) {
            var b = this.latRadians()
              , c = this.lngRadians()
              , d = a.latRadians()
              , e = a.lngRadians()
              , f = -Math.atan2(Math.sin(c - e) * Math.cos(d), Math.cos(b) * Math.sin(d) - Math.sin(b) * Math.cos(d) * Math.cos(c - e));
            return 0 > f && (f += 2 * Math.PI),
            f
        },
        getWaypoint: function(a, b) {
            var c, d = this.lngRadians(), e = this.latRadians(), f = b / 6378137, i = Math.sin(f) * Math.sin(a), j = Math.cos(e) * Math.cos(f) - Math.sin(e) * Math.sin(f) * Math.cos(a), k = Math.asin(Math.sin(e) * Math.cos(f) + Math.cos(e) * Math.sin(f) * Math.cos(a)) / g;
            return c = 0 === j ? d : (d + Math.atan(i / j)) / g,
            new h(k,c)
        },
        copy: function(a) {
            return new h(this.lat(),this.lng(),a)
        },
        latRadians: function() {
            return this.lat() * g
        },
        lngRadians: function() {
            return this.lng() * g
        },
        equals: function(a) {
            return Boolean(a && this.lat() === a.lat() && this.lng() === a.lng())
        }
    })
      , i = a.LatLngBounds = c(Object, {
        constructor: function(a, b) {
            this._sw = a ? a.copy(!0) : null ,
            this._ne = b ? b.copy(!0) : null 
        },
        copy: function() {
            return new i(this.getSouthWest(),this.getNorthEast())
        },
        getSouthWest: function() {
            return this._sw
        },
        getNorthEast: function() {
            return this._ne
        },
        extend: function(a) {
            var b, c;
            a && a instanceof h && (this._sw || this._ne ? (c = this._sw,
            b = this._ne,
            this._sw = new h(!c || c.lat() > a.lat() ? a.lat() : c.lat(),!c || c.lng() > a.lng() ? a.lng() : c.lng(),!0),
            this._ne = new h(!b || b.lat() < a.lat() ? a.lat() : b.lat(),!b || b.lng() < a.lng() ? a.lng() : b.lng(),!0)) : (this._sw = a.copy(!0),
            this._ne = a.copy(!0)))
        },
        equals: function(a) {
            var b, c, d, e, f = this.isEmpty(), g = a.isEmpty();
            return f && g ? !0 : f && !g || !f && g ? !1 : (b = this.getSouthWest(),
            c = this.getNorthEast(),
            d = a.getSouthWest(),
            e = a.getNorthEast(),
            b.lat() === d.lat() && b.lng === d.lat() && c.lat() === e.lat() && c.lng === e.lng())
        },
        containsLatLng: function(a) {
            function b(a, b, c) {
                return c >= a && b >= c
            }
            var c, d, e, f, g, h, i, j, k;
            return this.isEmpty() ? !1 : (c = this.isFullLat(),
            d = this.isFullLng(),
            c && d ? !0 : (e = this.getSouthWest(),
            f = this.getNorthEast(),
            g = a.lat(),
            h = a.lng(),
            i = !1,
            j = {
                sw: {
                    lat: e.lat(),
                    lng: e.lng()
                },
                ne: {
                    lat: f.lat(),
                    lng: f.lng()
                }
            },
            k = {
                sw: {
                    lat: e.lat(),
                    lng: e.lng()
                },
                ne: {
                    lat: f.lat(),
                    lng: f.lng()
                }
            },
            f.lng() < e.lng() && (k.sw.lng = -180,
            j.ne.lng = 180,
            i = !0),
            e.lat() > f.lat() && (k.sw.lat = -90,
            j.ne.lat = 90,
            i = !0),
            !(!(c || b(j.sw.lat, j.ne.lat, g) || i && b(k.sw.lat, k.ne.lat, g)) || !(d || b(j.sw.lng, j.ne.lng, h) || i && b(k.sw.lng, k.ne.lng, h)))))
        },
        intersects: function(a) {
            var b, c, d, e;
            return this.isEmpty() ? !1 : (b = this.getSouthWest(),
            c = this.getNorthEast(),
            d = a.getSouthWest(),
            e = a.getNorthEast(),
            (c.lat() >= e.lat() && b.lat() <= e.lat() || c.lat() >= d.lat() && b.lat() <= d.lat()) && (c.lng() >= e.lng() && b.lng() <= e.lng() || c.lng() >= d.lng() && b.lng() <= d.lng()))
        },
        containsBounds: function(a) {
            var b, c, d, e;
            return this.isEmpty() ? !1 : (b = this.getSouthWest(),
            c = this.getNorthEast(),
            d = a.getSouthWest(),
            e = a.getNorthEast(),
            this.containsLatLng(e) && this.containsLatLng(d))
        },
        toSpan: function() {
            var a, b;
            if (this.isEmpty())
                throw "LatLngBounds.toSpan() error: This instance of LatLngBounds has not been given an area yet. Use LatLngBounds.extend() first.";
            return a = this.getSouthWest(),
            b = this.getNorthEast(),
            new h(b.lat() - a.lat(),b.lng() - a.lng(),!0)
        },
        isFullLat: function() {
            var a, b;
            return this.isEmpty() ? !1 : (a = this.getSouthWest(),
            b = this.getNorthEast(),
            -90 === a.lat() && 90 === b.lat())
        },
        isFullLng: function() {
            var a, b;
            return this.isEmpty() ? !1 : (a = this.getSouthWest(),
            b = this.getNorthEast(),
            -180 === a.lng() && 180 === b.lng())
        },
        isEmpty: function() {
            return !this.getSouthWest() || !this.getNorthEast()
        },
        getCenter: function() {
            var a, b;
            return this.isEmpty() ? new h(0,180) : (a = this.toSpan(),
            b = this.getSouthWest(),
            new h(b.lat() + a.lat() / 2,b.lng() + a.lng() / 2))
        }
    })
      , j = a.Polyline = c(Object, {
        constructor: function() {
            this.points = [],
            this.bounds = new i
        },
        addLatLng: function(a) {
            this.points.push(a),
            this.bounds.extend(a)
        },
        addPoint: function(a, b) {
            var c = new h(a,b);
            this.points.push(c),
            this.bounds.extend(c)
        },
        getCount: function() {
            return this.points.length
        },
        getPoint: function(a) {
            return this.points[a]
        },
        getBounds: function() {
            return this.bounds
        },
        insertAt: function(a, b) {
            this.points.splice(a, 0, b),
            this.bounds.extend(b)
        },
        removeAt: function(a) {
            this.points.splice(a, 1)
        }
    })
      , k = a.mvcArrayToPolyline = function(a) {
        for (var b = a.getArray(), c = 0, d = new j; c < b.length; c++)
            d.addPoint(b[c].lat(), b[c].lng());
        return d
    }
    ;
    a.MVCArraySync = c(Object, {
        constructor: function(a) {
            this.mvcArray = a,
            this.polyline = k(this.mvcArray),
            this.mvcArray.addListener("insert_at", e(this, function(a) {
                this.polyline.insertAt(a, new h(this.mvcArray.getAt(a).lat(),this.mvcArray.getAt(a).lng()))
            })),
            this.mvcArray.addListener("remove_at", e(this, function(a) {
                this.polyline.removeAt(a)
            }))
        },
        stop: function() {},
        getPolyline: function() {
            return this.polyline
        }
    }),
    a.polylineToMVCArray = function(a) {
        for (var b = 0, c = new f.MVCArray; b < a.getCount(); b++)
            c.push(new f.LatLng(a.getPoint(b).lat(),a.getPoint(b).lng()));
        return c
    }
}),
nm_module("nm/tools/controls/autotrack", function(a, b, c, d) {
    var e = b("nm/geom", "LatLng")
      , f = b("nm/console", "log")
      , g = b("nm/metrics", "trigger")
      , h = b("jscore/functools", "bind")
      , i = b("jscore/functools", "partial")
      , j = b("jscore/async", "setInterval")
      , k = b("jscore/async", "clearInterval")
      , l = b("js-libs/jquery", "jQuery")
      , m = b("nm/views/google/convert/geometry", "Polyline")
      , n = {
        DEFAULT_INITIAL_ZOOM: 19,
        LOOP_INTERVAL_MS: 50
    }
      , o = 6378137;
    a.AutoTrack = c(Object, {
        constructor: function(a) {
            var b = l(a.parentElement);
            return 0 === b.length ? void (this.empty = !0) : (this.empty = !1,
            b.append('<a class="disclosure" style="cursor:pointer">    <span class="right-triangle-btn"></span>AutoTrack</a><div class="contents">    <div class="speed_section">        <div class="autotrack_section_title">Speed</div>        <div class="radio">            <input name="speed" type="radio" id="speed-fast"                 class="speed" checked="checked" value="fast"                 disabled="disabled"/>            <label for="speed-fast">Fast</label><br />            <input name="speed" type="radio" id="speed-slow"                 class="speed" value="slow" disabled="disabled"/>            <label for="speed-slow">Slow</label>        </div>    </div>    <div class="direction_section">        <div class="autotrack_section_title">Direction</div>        <div class="radio">            <label><input name="direction" type="radio"                 class="direction" checked="checked"                 value="forward" disabled="disabled" />Forward            </label><br />            <label><input name="direction" type="radio"                 class="direction" value="reverse"                 disabled="disabled" />Reverse</label>        </div>    </div>    <div class="buttons">        <div class="disabled play-btn play-pause-btn"             title="Start/pause the flight"></div>        <div class="disabled stop-btn"             title="Stop the flight"></div>    </div>    <div style="clear: both" /></div>'),
            this.map = a.map,
            this.getData = a.getData,
            this.hasData = a.hasData,
            this.toolType = a.toolType && a.toolType.length ? a.toolType : "standalone",
            this.popup = l(b),
            this.updateSpeedValue("fast"),
            this.directionChanged(),
            this.popup_elem(".speed").on("change", i(this.uiAction, this, function(a) {
                this.updateSpeedValue(l(a).val())
            })),
            this.popup_elem(".play-pause-btn").on("click", i(this.uiAction, this, this.startPause)),
            this.popup_elem(".stop-btn").on("click", h(this, this.stopPlayback)),
            this.popup_elem(".direction").on("change", i(this.uiAction, this, this.directionChanged)),
            this.popup_elem(".disclosure").on("click", h(this, this.disclosure)),
            void this.updateControls())
        },
        triggerPlayGAEvent: function() {
            g([this.toolType, ".autotrack.play"].join(""))
        },
        hasDataChanged: function() {
            this.hasData && this.hasData() ? this.controlsEnabled = !0 : this.controlsEnabled = !1,
            this.updateControls()
        },
        popup_elem: function(a) {
            return this.popup.find(a)
        },
        updateSpeedValue: function(a) {
            "fast" === a ? this.speedPxs = 100 : this.speedPxs = 50
        },
        getCurrentSpeed: function() {
            var a, b = this.map.getZoom(), c = 256 * (1 << b), d = 2 * o * Math.PI;
            return a = this.speedPxs * d / c
        },
        updateControls: function() {
            "undefined" != typeof this.popup && (this.controlsEnabled ? (this.popup_elem(".buttons div").removeClass("disabled"),
            this.popup_elem(":radio").removeAttr("disabled")) : (this.popup_elem(".buttons div").addClass("disabled"),
            this.popup_elem(":radio").attr("disabled", "disabled"),
            this.isPlaying && this.popup_elem(".stop-btn").removeClass("disabled")))
        },
        directionChanged: function() {
            this.isForward = "forward" === this.popup_elem(".direction:checked").val(),
            this.isPlaying && (this.isForward ? this.nextPathIndex += 1 : this.nextPathIndex -= 1)
        },
        disclosure: function() {
            var a = this.popup_elem(".contents")
              , b = !a.is(":visible")
              , c = this.popup_elem(".disclosure span")
              , d = b ? "down-triangle-btn" : "right-triangle-btn";
            c.removeClass("down-triangle-btn").removeClass("right-triangle-btn").addClass(d),
            a.slideToggle()
        },
        uiAction: function(a, b) {
            a.controlsEnabled && b.call(a, this)
        },
        loop: function() {
            var a, b, c = this.flightPath.getPoint(this.nextPathIndex), d = Date.now() - this.lastTick, f = d / 1e3 * this.getCurrentSpeed(), g = null , h = this.isForward ? 1 : -1;
            a = this.currentPoint.simpleDistance(c),
            f > a && (this.nextPathIndex += h,
            this.isForward && this.nextPathIndex < this.flightPath.getCount() || !this.isForward && this.nextPathIndex >= 0 ? c = this.flightPath.getPoint(this.nextPathIndex) : this.stopPlayback()),
            b = this.currentPoint.getBearingTo(c),
            g = this.currentPoint.getWaypoint(b, f),
            this.map.setCenter(new e(g.lat(),g.lng())),
            this.currentPoint = g,
            this.lastTick = Date.now(),
            this.numFrames++
        },
        startPause: function() {
            this.isPaused || !this.isPlaying ? this.startPlayback() : this.pausePlayback()
        },
        startPlayback: function() {
            var a, b = !0, c = this.map.getZoom();
            this.isPlaying ? this.lastTick = Date.now() : (this.triggerPlayGAEvent(),
            this.flightPath = this.getData(),
            this.flightPath && this.flightPath instanceof m || f("autotrack start - unexpected getData return"),
            this.isForward ? (this.nextPathIndex = 1,
            this.currentPoint = this.flightPath.getPoint(0)) : (a = this.flightPath.getCount(),
            this.nextPathIndex = a - 2,
            this.currentPoint = this.flightPath.getPoint(a - 1)),
            this.lastTick = Date.now(),
            this.isPlaying = !0,
            this.numFrames = 0,
            b && c < n.DEFAULT_INITIAL_ZOOM && this.map.setZoom(n.DEFAULT_INITIAL_ZOOM)),
            this.intervalId = j(h(this, this.loop), n.LOOP_INTERVAL_MS),
            this.popup_elem(".play-pause-btn").addClass("paused"),
            this.isPaused = !1
        },
        pausePlayback: function() {
            k(this.intervalId),
            "undefined" != typeof this.popup && (this.popup_elem(".play-pause-btn").removeClass("paused"),
            this.isPaused = !0)
        },
        stopPlayback: function() {
            this.pausePlayback(),
            this.isPlaying = !1,
            this.updateControls()
        }
    })
}),
nm_module("gooscr/units", function(a, b) {
    "use strict";
    var c = b("nm/intl").getText
      , d = b("jscore/functools").partial
      , e = b("js-libs/jquery").jQuery
      , f = a;
    a.list = [{
        name: d(c, "units.length.cm.plural_name"),
        shortName: d(c, "units.length.cm.symbol"),
        perMetre: 100
    }, {
        isDefault: !0,
        name: d(c, "units.length.m.plural_name"),
        shortName: d(c, "units.length.m.symbol"),
        perMetre: 1
    }, {
        name: d(c, "units.length.km.plural_name"),
        shortName: d(c, "units.length.km.symbol"),
        perMetre: .001
    }, {
        name: d(c, "units.length.in.plural_name"),
        shortName: d(c, "units.length.in.symbol"),
        perMetre: 39.3700787
    }, {
        name: d(c, "units.length.ft.plural_name"),
        shortName: d(c, "units.length.ft.symbol"),
        perMetre: 3.2808399
    }, {
        name: d(c, "units.length.yd.plural_name"),
        shortName: d(c, "units.length.yd.symbol"),
        perMetre: 1.0936133
    }, {
        name: d(c, "units.length.mi.plural_name"),
        shortName: d(c, "units.length.mi.symbol"),
        perMetre: .000621371192
    }, {
        name: d(c, "units.length.nmi.plural_name"),
        shortName: d(c, "units.length.nmi.symbol"),
        perMetre: .000539956803
    }],
    a.init = function(a) {
        var b = e(a);
        b.length || (b = e("body")),
        b.find(".unitSelector").each(function() {
            f.createUnitSelector(this)
        })
    }
    ,
    a.createUnitSelector = function(a) {
        var b = e(a)
          , c = e("<select>", {
            "class": "unitSelector"
        });
        if (!b.children().length) {
            var d = {
                area: b.is("[data-area]")
            };
            e.each(f.list, function(a, b) {
                e("<option>", {
                    text: b.shortName(),
                    value: b.shortName(),
                    title: b.name(),
                    selected: b.isDefault
                }).appendTo(c)
            }),
            c.data("unitSelectorSettings", d).appendTo(b),
            d.area && b.append('<sup class="squared">2</sup>')
        }
    }
    ,
    a.unitSelectorToValue = function(a, b) {
        var c = e(b).children("select")
          , d = c.val()
          , g = c.data("unitSelectorSettings");
        return f.fromMetres(a, d, g && g.area ? 2 : 1)
    }
    ,
    a.reverseUnitSelectorToValue = function(a, b) {
        var c = e(b).children("select")
          , d = c.val()
          , g = c.data("unitSelectorSettings");
        return f.toMetres(a, d, g && g.area ? 2 : 1)
    }
    ,
    a.toMetres = function(a, b, c) {
        var d = null ;
        return e.each(f.list, function(e, f) {
            f.shortName() !== b && f.name() !== b || (d = a / (c ? Math.pow(f.perMetre, c) : f.perMetre))
        }),
        d
    }
    ,
    a.fromMetres = function(a, b, c) {
        var d = null ;
        return e.each(f.list, function(e, f) {
            f.shortName() !== b && f.name() !== b || (d = a * (c ? Math.pow(f.perMetre, c) : f.perMetre))
        }),
        d
    }
    ,
    a.convert = function(a, b, c, d) {
        return f.fromMetres(f.toMetres(a, b, d), c, d)
    }
    ,
    a.convertMeasurementsByUnit = function(a, b) {
        var c = e.grep(f.list, function(a) {
            return a.shortName() === b
        })[0];
        return c && (a = f.formatNumberOfDecimalPlacesByUnit(a * c.perMetre, b)),
        Number(a)
    }
    ,
    a.formatNumberOfDecimalPlacesByUnit = function(a, b) {
        switch (b) {
        case "cm":
            a = Number(a).toFixed(0);
            break;
        case "km":
        case "mi":
        case "nmi":
            a = Number(a).toFixed(5);
            break;
        case "m":
            a = Number(a).toFixed(2);
            break;
        default:
            a = Number(a).toFixed(2)
        }
        return a
    }
}),
nm_module("gooscr/tools/uistate", function(a, b) {
    "use strict";
    function c() {
        this.localStorage = !1
    }
    var d = b("nm/const")
      , e = b("nm/cookie").MapState
      , f = {
        fill: function(a, b) {
            if (a) {
                for (var c in b)
                    "prototype" !== c && b.hasOwnProperty(c) && void 0 === a[c] && (a[c] = b[c]);
                return a
            }
            return b
        },
        copy: function(a, b) {
            if (!a || !b)
                throw new Error("You must provide an object to copy from and to");
            for (var c in a)
                a.hasOwnProperty(c) && (b[c] = a[c])
        }
    }
      , g = {};
    c.prototype.getStored = function() {
        var a;
        if (!this.localStorage) {
            var b = e.getValue(d.UI_KEY);
            b = b ? window.decodeURIComponent(b) : "{}",
            a = JSON.parse(b)
        }
        f.fill(g, a),
        f.copy(a, g)
    }
    ,
    c.prototype.getUi = function(a) {
        return g.hasOwnProperty(a) ? (this.getStored(),
        g[a]) : null 
    }
    ,
    c.prototype.setUi = function(a, b, c) {
        return a && 0 !== a.legth && b && "object" == typeof b ? (g.hasOwnProperty(a) ? (f.fill(g[a], b),
        f.copy(b, g[a])) : this.register(a, b),
        c || this.save(g),
        !0) : !1
    }
    ,
    c.prototype.register = function(a, b) {
        return a && 0 !== a.legth && b && "object" == typeof b ? (g[a] = b,
        !0) : !1
    }
    ,
    c.prototype.save = function(a) {
        if (!this.localStorage) {
            var b;
            b = "object" == typeof a ? JSON.stringify(a) : a,
            e.setValue(d.UI_KEY, window.encodeURIComponent(b)),
            e.save()
        }
    }
    ,
    a.UiState = new c
}),
nm_module("jscore/oo", function(a, b, c, d) {
    a.Class = function(a, b) {
        b = b || function() {
            a.apply(this, arguments)
        }
        ;
        var d = {
            constructor: b
        };
        return c(a || Object, d)
    }
    ,
    a.supr = function(a) {
        return a.base.prototype
    }
    ,
    a.abstractMethod = function() {
        function a() {
            throw new Error("not implemented")
        }
        return a.isAbstract = !0,
        a
    }
}),
nm_module("nm/features/simple", function(a, b, c, d) {
    var e = b("jscore/events", "Event")
      , f = b("jscore/events", "EventTarget")
      , g = (a.Change = c(e, {
        constructor: function() {}
    }),
    a.Line = c(f, {
        constructor: function(a) {
            g.base.call(this),
            this.coordinates = a
        }
    }))
}),
nm_module("gooscr/tools/measure", function(a, b) {
    "use strict";
    b("js-libs/proj4.js"),
    b("js-libs/infobox.js");
    var c = b("nm/const/tools").MEASUREMENT_KEY
      , d = b("nm/const/tools").PERSIST_MEASUREMENTS
      , e = b("nm/const/tools").AUTOTRACK_KEY
      , f = b("nm/tools/controls/autotrack")
      , g = b("nm/client")
      , h = b("nm/intl")
      , i = b("nm/views/google/convert/geometry")
      , j = b("nm/localstorage")
      , k = b("gooscr/toolbar")
      , l = b("gooscr/tooltip")
      , m = b("gooscr/units")
      , n = b("gooscr/tools/uistate").UiState
      , o = b("nm/views/google/convert/geometry").Polyline
      , p = b("jscore/events").Change
      , q = b("js-libs/jquery").jQuery
      , r = b("js-libs/google").maps
      , s = b("nm/tools").Tool
      , t = b("jscore/types").isUndefinedOrNull
      , u = b("jscore/oo")
      , v = b("nm/geom").LatLng
      , w = b("nm/features/simple").Line
      , x = b("jscore/itertools").map
      , y = b("jscore/itertools").array
      , z = u.Class(s, function() {
        z.base.call(this),
        this.selectedFeature = null 
    });
    z.prototype._pathChanged = function(a) {
        if (a) {
            var b = x(a.path.getArray(), function(a) {
                return new v(a.lat(),a.lng())
            })
              , c = new w(y(b));
            this.selectedFeature = c
        } else
            this.selectedFeature = null ;
        this.changed()
    }
    ,
    a.buildMeasureTool = function(a, b, s, u) {
        var v, w = null ;
        "line" === s && (v = "Line"),
        "path" === s && (v = "Path"),
        "area" === s && (v = "Area");
        var x = b.tmpGoogleMapViewController.gMap;
        n.register(v, {
            showInlineMeasurements: !1,
            unit: h.getText("defaults.units.length.symbol")
        });
        var y = n.getUi(v)
          , A = {
            foo: new z,
            name: v,
            accessKey: c,
            active: !1,
            objects: [null ],
            currentObject: null ,
            tempHoverObjectIndex: -1,
            activeObjectIndex: -1,
            lastActiveOjectIndex: -1,
            isMouseOnShape: !1,
            previewLine: null ,
            cursorLatLon: null ,
            allowFakePoly: !1,
            activeCoords: null ,
            hidden: "hidden" === s,
            hiddenPermanently: "hidden" === s,
            showInlineMeasurements: y && y.showInlineMeasurements ? y.showInlineMeasurements : !1,
            unit: y && y.unit ? y.unit : h.getText("defaults.units.length.symbol"),
            popup: q('<div><ul class="info">' + ("area" === s ? '   <li><div class="label">Area</div><div class="data"><span data-value="area">0</span> <span class="unitSelector" data-area></span></div>   </li>' : "") + '   <li><div class="label">' + ("area" === s ? "Perimeter" : "Length") + '</div><div class="data"><span data-value="length">0</span> <span class="unitSelector"></span></div>   </li>' + ("line" === s ? '   <li><div class="label">Bearing</div><div class="data"><span data-value="bearing">0</span>&deg;</div>   </li>' : "") + '</ul><div class="compact-buttons">   <div class="left" style="margin-top: 1em;">      <label><input type="checkbox"            data-value="inline-measurements">           Show inline measurements</label>      <label><input type="checkbox"            class="elevation-chk">           Show Elevation Profile</label>   </div>   <div class="buttons right">       <div class="delete-btn"            title="Delete selected shape"></div>       <div class="clear-btn"            title="Clear all shapes of this type">Clear       </div>   </div></div></div>'),
            popupId: null ,
            eventName: function() {
                return g.isTouchDevice() ? "Tap" : "Click"
            },
            tooltips: {
                start: "{0} anywhere to start drawing",
                drawing: "line" === s ? "{0} to finish line" : "Double {0}  to finish shape",
                mouseoverShapeActive: "{0} to select shape. Hit 'Delete' key or button to delete selection",
                mouseoverShapeInactive: "{0} to select shape",
                mouseoverVertex: "{0} and drag to modify this shape",
                getMouseOver: function() {
                    return A.active ? A.tooltips.mouseoverShapeActive : A.tooltips.mouseoverShapeInactive
                },
                get: function(a) {
                    return a.replace("{0}", A.eventName())
                }
            },
            shapeOptions: {
                active: {
                    strokeColor: "#0000ff",
                    editable: !0,
                    visible: !0
                },
                inactive: {
                    strokeColor: "#0000ff",
                    editable: !1,
                    visible: !0
                },
                autotrack: {
                    strokeColor: "#0000ff",
                    editable: !1,
                    visible: !1
                }
            },
            hasAccess: function() {
                try {
                    return a.can(A.accessKey)
                } catch (b) {
                    return !1
                }
            },
            init: function() {
                var c, d = k.getToolKey(A);
                w = k.events.makeChannel(d, {
                    stealClicks: !0
                }),
                A._bindActionsToMap(),
                q("head").append("<style>.previewLineActive *{cursor: crosshair !important;}</style>"),
                m.init(A.popup),
                A.popup.find(".unitSelector").val(A.unit),
                A.popup.find(".unitSelector").on("change", function(a) {
                    a.stopPropagation();
                    var b = this.value;
                    u && u.setUnit(b),
                    b && n.setUi(v, {
                        unit: b
                    }),
                    A.popup.find("select.unitSelector").each(function() {
                        q(this).val(b)
                    }),
                    A._updateTotalDistance()
                }),
                A.popup.find("[data-value=inline-measurements]").prop("checked", A.showInlineMeasurements).on("change", function() {
                    A.showInlineMeasurements = q(this).is(":checked"),
                    A._redrawAll(),
                    n.setUi(v, {
                        showInlineMeasurements: A.showInlineMeasurements
                    })
                });
                var g = A.popup.find(".elevation-chk");
                g.parent().hide(),
                u && (u.enabled && g.parent().show(),
                u.addListener(p, function() {
                    u.enabled ? g.parent().show() : g.parent().hide(),
                    g.prop("checked", u.visible)
                }),
                g.change(function() {
                    u.enabled && (u.setUnit(A.unit),
                    u.setVisible(q(this).is(":checked")))
                })),
                A.popup.find(".delete-btn").on("click", function() {
                    A.activeObjectIndex > -1 ? A.deleteObject(A.activeObjectIndex) : A.deleteLast()
                }),
                A.popup.find(".clear-btn").on("click", function() {
                    A.clear(),
                    A.active && A.newShape()
                }),
                a.can(e) && A.popup.append('<div class="autotrack"/>'),
                c = A.popup.find(".autotrack"),
                A.autoTrack = new f.AutoTrack({
                    map: b,
                    parentElement: c,
                    hasData: A.hasData,
                    getData: A.getData,
                    toolType: s
                })
            },
            hasData: function() {
                return A.activeObjectIndex >= 0
            },
            getData: function() {
                return A.activeObjectIndex < 0 ? null  : i.mvcArrayToPolyline(A.objects[A.activeObjectIndex].path)
            },
            addShape: function(a) {
                var b, c = A.newShape(), d = A.objects[c];
                b = i.polylineToMVCArray(a, b),
                d.path = b,
                d.poly.setPath(b),
                A._redraw(d),
                A.endShape()
            },
            _calculateAreaWithGoogle: function(a) {
                return r.geometry.spherical.computeArea(a)
            },
            _calculateDistanceWithGoogle: function(a, b) {
                return r.geometry.spherical.computeDistanceBetween(a, b)
            },
            _calculateDistanceWithProj4Js: function(a, b) {
                var c = function(a) {
                    var b = Math.floor((a + 180) / 6) + 1;
                    return b
                }
                  , d = new Proj4js.Proj("EPSG:4326")
                  , e = c(b.lng());
                "undefined" == typeof Proj4js.defs["EPSG:283" + e] && (Proj4js.defs["EPSG:283" + e] = "+proj=utm +zone=" + e + " +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");
                var f = new Proj4js.Proj("EPSG:283" + e)
                  , g = new Proj4js.Point(a.lng(),a.lat())
                  , h = new Proj4js.Point(b.lng(),b.lat());
                Proj4js.transform(d, f, g),
                Proj4js.transform(d, f, h);
                var i = g.x - h.x
                  , j = g.y - h.y
                  , k = Math.sqrt(i * i + j * j);
                return k
            },
            shapeChanged: function() {
                A.foo._pathChanged(A.objects[A.activeObjectIndex]),
                A.autoTrack.hasDataChanged(),
                A.savePaths()
            },
            _onAutoTrackStart: function() {
                A.activeObjectIndex >= 0 && A.objects[A.activeObjectIndex].poly.setOptions(A.shapeOptions.autotrack)
            },
            _onAutoTrackStop: function() {
                A.activeObjectIndex >= 0 && A.objects[A.activeObjectIndex].poly.setOptions(A.shapeOptions.active)
            },
            _onAutoTrackPause: function() {
                A.activeObjectIndex >= 0 && A.objects[A.activeObjectIndex].poly.setOptions(A.shapeOptions.active)
            },
            _onClick: function(a) {
                if (a) {
                    if (A.isMouseOnShape)
                        return A.activateShape(),
                        void A._redraw(A.objects[A.activeObjectIndex]);
                    if (null  !== A.currentObject) {
                        A._removePreviewLine();
                        var b = A.objects[A.currentObject].path
                          , c = A.objects[A.currentObject].poly;
                        if (A.activeObjectIndex = A.currentObject,
                        b.length) {
                            if (a.latLng.equals(b.getAt(0)))
                                return "path" === s ? b.insertAt(b.length, a.latLng) : A.closeShape(A.currentObject),
                                A.newShape(),
                                void c.setEditable(!0);
                            if (a.latLng.equals(b.getAt(b.length - 1)))
                                return A.endShape(A.currentObject),
                                void A.newShape();
                            if ("line" === s)
                                return A._removePreviewLine(),
                                b.insertAt(b.length, a.latLng),
                                A.endShape(A.currentObject),
                                void A.newShape()
                        }
                        0 === b.length && (g.isTouchDevice() || l.set(A.tooltips.get(A.tooltips.drawing))),
                        a && (b.insertAt(b.length, a.latLng),
                        A._startPreviewLine(a.latLng))
                    }
                }
            },
            _onDblClick: function() {
                if (null  !== A.currentObject) {
                    var a = A.objects[A.currentObject].path;
                    return a.length ? (A.endShape(A.currentObject),
                    void A.newShape()) : void 0
                }
            },
            _onMouseMove: function(a) {
                A.cursorLatLon = a && a.hasOwnProperty("latLng") ? a.latLng : null ,
                null  !== A.currentObject && A.previewLine && A._redrawPreviewLine(a.latLng)
            },
            _onKeyDown: function(a) {
                switch (a.which) {
                case 46:
                    A.active && A.activeObjectIndex > -1 && (A.endShape(A.activeObjectIndex),
                    A.deleteObject(A.activeObjectIndex),
                    A.newShape());
                    break;
                case 27:
                    A.currentObject && (A.endShape(A.currentObject),
                    A.deleteObject(A.currentObject))
                }
            },
            _onMouseOverShape: function(a, b) {
                q("#map").addClass("shapeHover"),
                A.previewLine || ("vertex" in a || "edge" in a ? l.set(A.tooltips.get(A.tooltips.mouseoverVertex)) : l.set(A.tooltips.get(A.tooltips.getMouseOver())),
                A.isMouseOnShape = !0,
                A.tempHoverObjectIndex = b)
            },
            _onMouseOutShape: function() {
                q("#map").removeClass("shapeHover"),
                A.previewLine || (l.unset(A.tooltips.get(A.tooltips.mouseoverVertex)),
                l.unset(A.tooltips.get(A.tooltips.getMouseOver()))),
                A.isMouseOnShape = !1,
                A.tempHoverObjectIndex = -1
            },
            _onDragStart: function() {
                null  !== A.currentObject && q("#map").addClass("dragging")
            },
            _onDragEnd: function() {
                null  !== A.currentObject && q("#map").removeClass("dragging")
            },
            _drawMeasurement: function(a, b, c, d, e) {
                if (!A.allowFakePoly) {
                    if (d || (d = "distance"),
                    !a || !A.showInlineMeasurements)
                        return void (e && e.setMap(null ));
                    var f = m.formatNumberOfDecimalPlacesByUnit(a, b);
                    if (f = A.formatNumber(f),
                    "distance" === d ? f += "&nbsp;" + b : "area" === d && (f += "&nbsp;" + b + "<sup>2</sup>"),
                    e)
                        return e.setPosition(c),
                        e.setContent(f),
                        e;
                    var g = {
                        content: f,
                        disableAutoPan: !0,
                        pixelOffset: new r.Size(-50,5),
                        position: c,
                        closeBoxURL: "",
                        isHidden: !1,
                        pane: "floatPane",
                        enableEventPropagation: !0
                    }
                      , h = {
                        distance: {
                            background: "black",
                            border: "1px solid #666",
                            borderRadius: "5px",
                            color: "white",
                            textAlign: "center",
                            fontSize: "11px",
                            width: "100px",
                            zIndex: 9
                        },
                        area: {
                            background: "green",
                            border: "1px solid black",
                            borderRadius: "5px",
                            color: "white",
                            textAlign: "center",
                            fontSize: "11px",
                            width: "100px",
                            zIndex: 10
                        }
                    }
                      , i = q.extend({}, g);
                    i.boxStyle = h[d];
                    var j = new InfoBox(i);
                    return j.open(x),
                    j
                }
            },
            _redrawAll: function() {
                for (var a = 0; a < A.objects.length; a++)
                    A._redraw(A.objects[a])
            },
            _redraw: function(a) {
                if (a && !(a.path.length < 2)) {
                    var b = a.path
                      , c = a.isArea ? b.getAt(b.length - 1) : null 
                      , d = new r.LatLngBounds
                      , e = 0
                      , f = A.popup.find("[data-value=length]").siblings(".unitSelector")
                      , g = A.popup.find("[data-value=area]").siblings(".unitSelector")
                      , h = f.find("select").val();
                    if (b.forEach(function(b, g) {
                        if (c) {
                            var i = m.unitSelectorToValue(A.calculateDistance(c, b), f)
                              , j = 100 > i ? new r.LatLng((c.lat() + b.lat()) / 2,(c.lng() + b.lng()) / 2) : r.geometry.spherical.interpolate(c, b, .5)
                              , k = a.isArea ? g : g - 1;
                            e += i,
                            a.labels[k] = A._drawMeasurement(i, h, j, "distance", a.labels[k])
                        }
                        d.extend(b),
                        c = b
                    }),
                    A._setTotalDistance(e, a),
                    "line" === s && e) {
                        for (var i = r.geometry.spherical.computeHeading(b.getAt(0), b.getAt(1)); 0 > i; )
                            i += 360;
                        A._setBearing(i)
                    }
                    if (a.isArea) {
                        var j = m.unitSelectorToValue(A.calculateArea(b), g);
                        a.areaLabel = A._drawMeasurement(j, h, d.getCenter(), "area", a.areaLabel),
                        A._setArea(j)
                    }
                }
            },
            _startPreviewLine: function(a) {
                var b = A.objects[A.currentObject].path;
                b.insertAt(b.length, a),
                A.previewLine = !0,
                q("#map").addClass("previewLineActive")
            },
            _endPreviewLine: function() {
                A.previewLine = !1,
                q("#map").removeClass("previewLineActive")
            },
            _removePreviewLine: function() {
                if (A.previewLine) {
                    A.previewLine = !1,
                    q("#map").removeClass("previewLineActive");
                    var a = A.objects[A.currentObject].path;
                    a && a.length && a.removeAt(a.length - 1)
                }
            },
            _redrawPreviewLine: function(a) {
                if (null  !== A.currentObject) {
                    var b = A.objects[A.currentObject].path;
                    b && b.length && b.setAt(b.length - 1, a)
                }
            },
            _setTotalDistance: function(a, b) {
                var c = A.popup.find("[data-value=length]")
                  , d = c.next("span.unitSelector").children("select.unitSelector").val();
                a = m.formatNumberOfDecimalPlacesByUnit(a, d),
                c.html(A.formatNumber(a)).data("measure-object", b)
            },
            _updateTotalDistance: function() {
                var a = A.popup.find("[data-value=length]")
                  , b = a.data("measure-object");
                b && A._redraw(b)
            },
            _setBearing: function(a) {
                var b = A.popup.find("[data-value=bearing]");
                a = m.formatNumberOfDecimalPlacesByUnit(a),
                b.html(A.formatNumber(a))
            },
            _setArea: function(a) {
                var b = A.popup.find("[data-value=area]")
                  , c = b.next("span.unitSelector").children("select.unitSelector").val();
                a = m.formatNumberOfDecimalPlacesByUnit(a, c),
                b.html(A.formatNumber(a))
            },
            _bindActionsToMap: function() {
                x.addListener("click", A._onClick),
                x.addListener("dblclick", A._onDblClick),
                x.addListener("mousemove", A._onMouseMove),
                x.addListener("dragstart", A._onDragStart),
                x.addListener("dragend", A._onDragEnd),
                q(document).on("keydown", A._onKeyDown)
            },
            _bindActionsToShape: function(a) {
                var b = A.objects[a].poly
                  , c = null ;
                b.addListener("click", function(a) {
                    A._onClick(a)
                }),
                b.addListener("dblclick", function(a) {
                    A._onDblClick(a)
                }),
                b.addListener("mousemove", function(a) {
                    A._onMouseMove(a)
                }),
                b.addListener("mousedown", function(a) {
                    if ("vertex" in a || "edge" in a) {
                        A.allowFakePoly = !0;
                        var d = x
                          , e = q(d.getDiv()).offset()
                          , f = new r.Polygon({})
                          , g = null ;
                        c = b.addListener("mousemove", function(a) {
                            if ("vertex" in a || "edge" in a) {
                                var c = a.hasOwnProperty("vertex") ? a.vertex : null 
                                  , h = a.hasOwnProperty("edge") ? a.edge : null ;
                                r.event.addDomListenerOnce(d.getDiv(), "mousemove", function(a) {
                                    if (A.allowFakePoly) {
                                        var i = (a.clientX || a.pageX) - e.left
                                          , j = (a.clientY || a.pageY) - e.top
                                          , k = null 
                                          , l = null ;
                                        k = new r.OverlayView,
                                        k.draw = function() {}
                                        ,
                                        k.setMap(d),
                                        l = new r.Point(i,j);
                                        var m = k.getProjection();
                                        if (!t(m)) {
                                            A.cursorLatLon = m.fromContainerPixelToLatLng(l),
                                            k.setMap(null );
                                            var n = b.getPath().getArray().slice(0);
                                            null  !== c ? n[c] = A.cursorLatLon : n.splice(h + 1, 0, A.cursorLatLon),
                                            f.setOptions({
                                                paths: n
                                            }),
                                            A.activeCoords = n,
                                            g = {
                                                path: f.getPath(),
                                                poly: f,
                                                labels: [],
                                                areaLabel: null ,
                                                isArea: A.objects[A.activeObjectIndex].isArea
                                            },
                                            A._redraw(g)
                                        }
                                    }
                                }, !0)
                            }
                        })
                    }
                }),
                b.addListener("mouseup", function(a) {
                    ("vertex" in a || "edge" in a) && (c && c.remove(),
                    c = null ,
                    A.cursorLatLon = null ,
                    A.allowFakePoly = !1)
                }),
                b.addListener("mouseover", function(b) {
                    A._onMouseOverShape(b, a)
                }),
                b.addListener("mouseout", function(b) {
                    A._onMouseOutShape(b, a)
                })
            },
            _bindActionsToPath: function(a) {
                function b(a) {
                    return A.allowFakePoly = !1,
                    A.activeCoords && (a.path = new r.MVCArray(A.activeCoords),
                    A.activeCoords = null ),
                    a
                }
                var c = A.objects[a]
                  , d = c.path;
                d.addListener("insert_at", function() {
                    c = b(c),
                    A._redraw(c),
                    A.foo._pathChanged(A.objects[A.activeObjectIndex])
                }),
                d.addListener("set_at", function() {
                    c = b(c),
                    A._redraw(c),
                    A.foo._pathChanged(A.objects[A.activeObjectIndex])
                })
            },
            calculateArea: function(a) {
                return A._calculateAreaWithGoogle(a)
            },
            calculateDistance: function(a, b) {
                var c = 1e4
                  , d = 100
                  , e = A._calculateDistanceWithGoogle(a, b);
                if (e > c)
                    return e;
                var f = A._calculateDistanceWithProj4Js(a, b);
                if (c - d > e)
                    return f;
                var g = (c - e) / d;
                return g * f + (1 - g) * e
            },
            roundNumber: function(a) {
                return Math.round(100 * a) / 100
            },
            formatNumber: function(a, b) {
                return h.formatNumber(a, b)
            },
            clear: function() {
                A.currentObject = null ;
                for (var a = A.objects.length - 1; a >= 0; a--)
                    A.deleteObject(a);
                A.objects = [null ]
            },
            deleteLast: function() {
                A._removePreviewLine();
                for (var a = A.objects.length - 1; a >= 0; a--) {
                    var b = !1;
                    if (A.objects[a] && A.objects[a].path.length && (b = !0),
                    A.deleteObject(a),
                    b)
                        break
                }
                A.newShape()
            },
            deleteObject: function(a) {
                A.currentObject === a && (A.currentObject = null );
                var b = A.objects[a];
                if (b) {
                    b.poly.setMap(null );
                    for (var c = b.labels.length - 1; c >= 0; c--)
                        b.labels[c] && b.labels[c].hide();
                    b.areaLabel && b.areaLabel.hide();
                    var d = A.popup.find("[data-value=length]");
                    d.data("measure-object", null ),
                    A.objects[a] = null ,
                    A.activeObjectIndex = -1,
                    A._setTotalDistance(0),
                    A._setArea(0),
                    A._setBearing(0),
                    l.unset(A.tooltips.getMouseOver()),
                    l.unset(A.tooltips.get(A.tooltips.mouseoverVertex)),
                    A.shapeChanged()
                }
            },
            getObjectByShape: function(a) {
                if (!a || !A.objects)
                    return null ;
                for (var b, c = A.objects, d = c.length - 1; d >= 0; d--)
                    if (null  !== c[d] && (b = c[d],
                    b.hasOwnProperty("poly") && b.poly === a))
                        return b;
                return null 
            },
            getObjectIndexFromShape: function(a) {
                var b = A.getObjectByShape(a);
                return b ? A.objects.indexOf(b) : -1
            },
            activateShape: function(a) {
                if (!A.active) {
                    var b = "measure" + s.charAt(0).toUpperCase() + s.slice(1);
                    k.start(b)
                }
                A.deactivateShape(),
                A.activeObjectIndex = isNaN(a) ? A.tempHoverObjectIndex : a,
                A.objects[A.activeObjectIndex] && A.objects[A.activeObjectIndex].poly && A.objects[A.activeObjectIndex].poly.setOptions(A.shapeOptions.active),
                A.lastActiveOjectIndex = A.activeObjectIndex,
                A.shapeChanged()
            },
            deactivateShape: function(a) {
                var b = isNaN(a) ? A.lastActiveOjectIndex : a;
                A.objects[b] && A.objects[b].poly && A.objects[b].poly.setOptions(A.shapeOptions.inactive)
            },
            newShape: function() {
                var a, b, c, d, e = "area" === s, f = e ? "Polygon" : "Polyline";
                return a = new r.MVCArray,
                b = new r[f]({
                    strokeColor: "#0000ff",
                    strokeOpacity: .6,
                    strokeWeight: 4,
                    fillColor: e ? "#5555FF" : null ,
                    editable: !!g.isTouchDevice(),
                    geodesic: !0,
                    zIndex: 100
                }),
                b.setMap(x),
                "Polygon" === f ? b.setPaths(new r.MVCArray([a])) : b.setPath(a),
                c = {
                    path: a,
                    poly: b,
                    labels: [],
                    areaLabel: null ,
                    isArea: e
                },
                d = A.currentObject = A.objects.push(c) - 1,
                A._bindActionsToPath(d),
                A._bindActionsToShape(d),
                x.set("disableDoubleClickZoom", !0),
                l.unset(A.tooltips.get(A.tooltips.drawing)),
                g.isTouchDevice() || l.set(A.tooltips.get(A.tooltips.start)),
                d
            },
            endShape: function(a) {
                if (a || (a = A.currentObject),
                A.activeObjectIndex = a,
                l.unset(A.tooltips.get(A.tooltips.start)),
                a && A.objects[a]) {
                    var b = A.objects[a].poly;
                    A._removePreviewLine(),
                    b.setEditable(!0),
                    A.activateShape(a),
                    A.savePaths()
                }
            },
            closeShape: function(a) {
                var b = A.objects[a];
                return !b || b.isArea ? !1 : (b.poly.setMap(null ),
                b.poly = new r.Polygon({
                    strokeWeight: 3,
                    fillColor: "#5555FF",
                    editable: !0,
                    geodesic: !0
                }),
                b.poly.setPaths(new r.MVCArray([b.path])),
                b.poly.setMap(x),
                b.isArea = !0,
                A._bindActionsToShape(a),
                void A._redraw(b))
            },
            loadPreviousPaths: function() {
                if ("Path" === v && a.can(d)) {
                    var b = j.getItem("measurement-paths");
                    if (b)
                        try {
                            b = JSON.parse(b),
                            b.forEach(function(a) {
                                var b = new o;
                                a.forEach(function(a) {
                                    b.addPoint(a[0], a[1])
                                }),
                                A.addShape(b)
                            })
                        } catch (c) {
                            return
                        }
                }
            },
            savePaths: function() {
                if ("Path" === v && a.can(d))
                    try {
                        var b = [];
                        A.objects.forEach(function(a) {
                            if (a && !a.isArea) {
                                var c = [];
                                a.path.forEach(function(a) {
                                    c.push([a.lat(), a.lng()])
                                }),
                                b.push(c)
                            }
                        });
                        var c = JSON.stringify(b);
                        j.setItem("measurement-paths", c)
                    } catch (e) {}
            },
            start: function() {
                A.active = !0,
                A.newShape(),
                A.loadPreviousPaths(),
                A.showInlineMeasurements = A.popup.find("[data-value=inline-measurements]").is(":checked"),
                A._redrawAll(),
                x.setOptions({
                    draggableCursor: "crosshair"
                })
            },
            stop: function() {
                A.active = !1,
                A.endShape(),
                A.deleteObject(A.currentObject),
                A.currentObject = null ,
                A.showInlineMeasurements = !1,
                A._redrawAll(),
                x.setOptions({
                    draggableCursor: null 
                }),
                x.set("disableDoubleClickZoom", !1),
                q.each(A.tooltips, function(a, b) {
                    "string" == typeof b && l.unset(A.tooltips.get(b))
                }),
                A.autoTrack.pausePlayback()
            }
        };
        return A
    }
}),
nm_module("gooscr/tools/measureCircle", function(a, b) {
    "use strict";
    var c = b("gooscr/units")
      , d = b("gooscr/toolbar")
      , e = b("gooscr/tooltip")
      , f = b("gooscr/tools/uistate").UiState
      , g = b("nm/client");
    b("js-libs/infobox.js");
    var h = "Measure Circle"
      , i = b("nm/intl")
      , j = b("nm/const/tools")
      , k = null 
      , l = b("js-libs/google").maps
      , m = b("js-libs/jquery").jQuery;
    a.buildMeasureTool = function(a, b, n) {
        f.register(h, {
            unit: i.getText("defaults.units.length.symbol")
        });
        var o = f.getUi(h)
          , p = {
            name: h,
            accessKey: j.CIRCLE,
            active: !1,
            isMouseOnShape: !1,
            unit: o && o.unit ? o.unit : i.getText("defaults.units.length.symbol"),
            shape: null ,
            intervalShapes: [],
            intervalCount: 1,
            label: null ,
            radiusRatio: 5,
            popup: m('<div><ul class="info">   <li>       <div class="label">Radius</div>       <div class="data"><input type="number"            data-value="radius" min="0"></input> <span class="unitSelector"></span></div>   </li>   <li>       <div class="label">Area</div>       <div class="data"><span data-value="area">0</span> <span class="unitSelector" data-area></span></div>   </li></ul><div class="buttons"><div class="delete-btn"    title="Delete shape"></div></div></div>'),
            elms: {
                $radiusInput: null ,
                $areaInput: null ,
                $intervalInput: null ,
                $intervalRadiusOutput: null 
            },
            tooltips: {
                start: "Click anywhere to draw a circle",
                mouseoverShapeActive: "Hit the delete key to delete this shape",
                mouseoverShapeInactive: "Click to select shape",
                mouseoverVertex: "Click and drag to modify this shape",
                getMouseOver: function() {
                    return p.active ? p.tooltips.mouseoverShapeActive : p.tooltips.mouseoverShapeInactive
                }
            },
            shapeOptions: {
                active: {
                    strokeColor: "#0000ff",
                    editable: !0
                },
                inactive: {
                    strokeColor: "#0000ff",
                    editable: !1
                }
            },
            hasAccess: function() {
                try {
                    return a.can(p.accessKey)
                } catch (b) {
                    return !1
                }
            },
            init: function() {
                var a = d.getToolKey(p);
                k = d.events.makeChannel(a, {
                    clicksAware: !0
                }),
                p.elms.$radiusInput = p.popup.find("[data-value=radius]"),
                p.elms.$areaInput = p.popup.find("[data-value=area]"),
                p.elms.$intervalInput = p.popup.find("[data-value=interval]"),
                p.elms.$intervalRadiusOutput = p.popup.find(".intervalRadius"),
                p.elms.$intervalInput.val(p.intervalCount),
                p.popup.find(".unitSelector").on("change", function(a) {
                    a.stopPropagation();
                    var b = m(this).find("select").val();
                    m(this).find("select").val() && f.setUi(p.name, {
                        unit: b
                    }),
                    p.popup.find("select.unitSelector").each(function() {
                        m(this).val(b)
                    }),
                    p.update()
                }),
                b.addListener("click", p._onMapClick),
                m(document).on("keydown", p._onKeyDown),
                p.popup.find(".delete-btn").on("click", p.remove),
                p.elms.$radiusInput.change(function() {
                    var a = m(this).siblings(".unitSelector")
                      , b = c.reverseUnitSelectorToValue(this.value, a);
                    p.setRadius(b)
                }),
                p.elms.$intervalInput.change(function() {
                    p.setIntervals(this.value)
                }),
                c.init(p.popup),
                p.popup.find(".unitSelector select").val(p.unit)
            },
            _onMapClick: function(a) {
                if (p.active && !p.shape) {
                    var d;
                    if ("" === p.elms.$radiusInput.val()) {
                        var f = b.getBounds();
                        d = Math.round(n.calculateDistance(f.getNorthEast(), f.getSouthWest()) / p.radiusRatio),
                        d >= 200 && (d -= d % 50),
                        d >= 100 && (d -= d % 25),
                        d >= 50 && (d -= d % 10),
                        50 > d && (d -= d % 1)
                    } else {
                        var g = p.elms.$radiusInput.next("span.unitSelector").find("select.unitSelector").val();
                        d = Number(p.elms.$radiusInput.val()),
                        d = c.toMetres(d, g)
                    }
                    e.unset(p.tooltips.start),
                    b.setOptions({
                        draggableCursor: null 
                    }),
                    p.add(a.latLng, d)
                }
            },
            _onKeyDown: function(a) {
                46 === a.which && p.active && p.remove()
            },
            add: function(a, c) {
                var f = {
                    strokeColor: "#0000ff",
                    strokeOpacity: .8,
                    strokeWeight: 2,
                    fillColor: "#0000ff",
                    fillOpacity: .01,
                    map: b,
                    center: a,
                    radius: c,
                    editable: !0,
                    zIndex: 100
                }
                  , g = p.shape = new l.Circle(f);
                g.addListener("radius_changed", p.update),
                g.addListener("center_changed", p.update),
                g.addListener("click", function(a) {
                    return p.click(a),
                    p.active ? void 0 : void d.start("measureCircle")
                }),
                g.addListener("mouseover", function() {
                    e.set(p.tooltips.getMouseOver()),
                    p.isMouseOnShape = !0
                }),
                g.addListener("mouseout", function() {
                    e.unset(p.tooltips.getMouseOver()),
                    p.isMouseOnShape = !1
                }),
                g.addListener("mousemove", function(a) {
                    k("mousemove").publish({
                        e: a
                    })
                }),
                p.update()
            },
            click: function() {
                p.activate()
            },
            activate: function() {
                p.isMouseOnShape && (p.active || d.start("measureCircle"),
                p.shape && p.shape.setOptions(p.shapeOptions.active))
            },
            deactivate: function() {
                p.shape && p.shape.setOptions(p.shapeOptions.inactive)
            },
            remove: function() {
                p.shape && (p.shape.setMap(null ),
                p.shape = null ),
                p.label && (p.label.hide(),
                p.label = null );
                for (var a = p.intervalShapes.length - 1; a >= 0; a--)
                    p.intervalShapes[a].setMap(null );
                p.intervalShapes = [],
                e.unset(p.tooltips.getMouseOver()),
                p.active && (b.setOptions({
                    draggableCursor: "crosshair"
                }),
                g.isTouchDevice() || e.set(p.tooltips.start))
            },
            update: function() {
                if (p.shape) {
                    p.activate();
                    for (var a = p.shape.getRadius(), d = p.shape.getCenter(), e = a / p.intervalCount, f = {
                        strokeColor: "#0000ff",
                        strokeOpacity: .8,
                        strokeWeight: 0,
                        fillColor: "#0000ff",
                        fillOpacity: .15,
                        map: b,
                        center: d,
                        zIndex: -1
                    }, g = Math.max(p.intervalCount, p.intervalShapes.length), h = 0; g > h; h++) {
                        var i = (h + 1) * e;
                        if (h in p.intervalShapes && h < p.intervalCount)
                            p.intervalShapes[h].setRadius(i),
                            p.intervalShapes[h].setCenter(d),
                            p.intervalShapes[h].setMap(b);
                        else if (h < p.intervalCount) {
                            var j = new l.Circle(m.extend(f, {
                                radius: i
                            }));
                            p.intervalShapes[h] = j
                        } else
                            p.intervalShapes[h].setMap(null )
                    }
                    var k = c.unitSelectorToValue(a, p.elms.$radiusInput.siblings(".unitSelector"))
                      , o = c.unitSelectorToValue(Math.PI * a * a, p.elms.$areaInput.siblings(".unitSelector"))
                      , q = p.popup.find("select.unitSelector").val();
                    return k = c.formatNumberOfDecimalPlacesByUnit(k, q),
                    o = c.formatNumberOfDecimalPlacesByUnit(o, q),
                    p.elms.$areaInput.html(n.formatNumber(o)),
                    p.elms.$radiusInput.val(k),
                    p.showLabel(a, e)
                }
            },
            showLabel: function(a, d) {
                var e = p.shape.getCenter()
                  , f = c.unitSelectorToValue(a, p.elms.$radiusInput.siblings(".unitSelector"))
                  , g = c.unitSelectorToValue(Math.PI * a * a, p.elms.$areaInput.siblings(".unitSelector"))
                  , h = p.popup.find("select.unitSelector").val();
                f = c.formatNumberOfDecimalPlacesByUnit(f, h),
                g = c.formatNumberOfDecimalPlacesByUnit(g, h);
                var i = "Radius: " + n.formatNumber(f) + "&nbsp;" + h;
                i += " <br />Area: " + n.formatNumber(g) + "&nbsp;" + h + "<sup>2</sup>",
                p.intervalCount > 1 && (i += " <br />Intervals: " + n.formatNumber(d) + "&nbsp;m");
                var j, k = {
                    content: i,
                    disableAutoPan: !0,
                    pixelOffset: new l.Size(-70,5),
                    position: e,
                    closeBoxURL: "",
                    isHidden: !1,
                    pane: "floatPane",
                    enableEventPropagation: !0,
                    boxStyle: {
                        background: "black",
                        border: "1px solid #666",
                        borderRadius: "5px",
                        color: "white",
                        textAlign: "center",
                        fontSize: "11px",
                        width: "140px"
                    }
                };
                return p.label ? (p.label.setPosition(e),
                p.label.setContent(i)) : (j = p.label = new InfoBox(k),
                j.open(b)),
                j
            },
            setRadius: function(a) {
                a = Number(a),
                p.shape && a && a !== p.shape.getRadius() && p.shape.setRadius(a)
            },
            setIntervals: function(a) {
                a = Number(a),
                p.intervalCount = a,
                p.update()
            },
            start: function() {
                p.active = !0,
                p.shape ? e.unset(p.tooltips.mouseoverShapeInacactive) : (b.setOptions({
                    draggableCursor: "crosshair"
                }),
                g.isTouchDevice() || e.set(p.tooltips.start))
            },
            stop: function() {
                p.active = !1,
                p.deactivate(),
                b.setOptions({
                    draggableCursor: null 
                }),
                e.unset(p.tooltips.start)
            }
        };
        return p
    }
}),
nm_module("nm/tools/rail", function(a, b, c, d) {
    function e(a) {
        return new n.LatLng(a.lat(),a.lng())
    }
    function f(a) {
        return new n.LatLngBounds(e(a.getSouthWest()),e(a.getNorthEast()))
    }
    var g = b("nm/const/tools", "RAIL_TOOL_KEY");
    Date.now || (Date.now = function() {
        return (new Date).getTime()
    }
    );
    var h = "Rail"
      , i = b("nm/urls", "encodeURIComponent")
      , j = b("nm/const/urls", "RAIL")
      , k = b("nm/const", "HOST_URL")
      , l = b("nm/views/google/convert/geometry", "Polyline")
      , m = b("js-libs/jquery", "jQuery")
      , n = b("js-libs/google", "maps");
    a.buildTool = function(a, b, c) {
        function d(a) {
            return o.popup.find(a)
        }
        function e() {
            return k + "maps?nmprovider=geojson&nml=overlay&cmd=categories&cattype=rail"
        }
        function n(a) {
            return k + "maps?nml=overlay&nmprovider=geojson&cmd=geojson&all-geom=true&z=22&nmoverlay=" + i(a)
        }
        var o = {
            name: h,
            controlsEnabled: !1,
            isPlaying: !1,
            accessKey: g,
            popup: m('<div>    <ul class="info">        <li class="first">            <div>Lines</div>            <div class="radio">                <select class="railways">                   <option value="">Select line</option>                </select>            </div>        </li>    </ul>    <div class="buttons">        <div class="convert button disabled"			title="Convert this shape to measurement">			Show path		</div>    </div></div>'),
            hasAccess: function() {
                try {
                    return a.can(o.accessKey)
                } catch (b) {}
                return !1
            },
            upgradeBlurb: function() {
                return '<p>Click <a href="' + j + '">here</a> to find out more about nearmap Rail.</p>'
            },
            ensureCategoryData: function(a) {
                var b, c, d, e = 0, f = 0;
                if (a && "object" == typeof a && a instanceof Array)
                    for (e = 0; e < a.length; e++)
                        if ("rail_api" === a[e].Name) {
                            if (c = a[e].Layers,
                            !c || "object" != typeof c || !c instanceof Array)
                                break;
                            for (b = [],
                            f = 0; f < c.length; f++)
                                d = c[f],
                                d && d.Name && d.Description && b.push({
                                    name: d.Name,
                                    description: d.Description
                                });
                            return b
                        }
                return null 
            },
            layersSuccess: function(a) {
                o.layers = o.ensureCategoryData(a);
                var b, c = d(".railways");
                if (null  !== o.layers)
                    for (b = 0; b < o.layers.length; b++)
                        c.append(m("<option></option>").val(o.layers[b].name).html(o.layers[b].description))
            },
            layersFailure: function() {
                o.layers = null 
            },
            layerSuccess: function(a) {
                var c, e, g, h = new l;
                if (a && a.features && a.features instanceof Array && (c = a.features[0],
                c && c.geometry && c.geometry.coordinates && c.geometry.coordinates instanceof Array && (e = c.geometry.coordinates[0])),
                e) {
                    for (g = 0; g < e.length; g++)
                        h.addPoint(e[g][1], e[g][0]);
                    b.fitBounds(f(h.getBounds())),
                    o.currentPolyline = h
                }
                d(".buttons div").removeClass("disabled")
            },
            layerFailure: function() {},
            layerChanged: function() {
                var a = m("option:selected", this)
                  , b = a.val();
                b && "" !== b && m.ajax({
                    type: "GET",
                    url: n(b),
                    dataType: "json",
                    success: o.layerSuccess,
                    error: o.layerFailure
                }),
                d(".buttons div").addClass("disabled")
            },
            init: function() {
                d(".railways").on("change", o.layerChanged),
                d(".convert").on("click", function() {
                    c.addShape(o.currentPolyline)
                }),
                m.ajax({
                    type: "GET",
                    url: e(),
                    dataType: "json",
                    success: o.layersSuccess,
                    error: o.layersFailure
                })
            },
            start: function() {},
            stop: function() {}
        };
        return o
    }
}),
nm_module("nm/tools/savephotomaps/savephotomapstmpl", function(a, b, c, d) {
    a.html = '<div class="save-image">\n    <div class="progressbar-container"/>\n    <label>\n        <input type="radio" name="type" value="screen" checked="" class="current-screen">\n        Current screen\n    </label>\n    <label>\n        <input type="radio" name="type" value="rectangle" class="define-area"> \n        Define area\n    </label>\n    <div class="advanced-options" />\n    <div class="demexport-wrapper">\n        <label>\n            <input type="radio" name="type" value="rectangle" class="demexport-radio"> \n            DEM export\n        </label>\n        <div class="demexport-options" />\n    </div>\n    <div class="prop-row file-size">\n        <label>File Size: </label>\n        <label class="fileSize"></label>\n    </div>\n    <div class="right">\n        <a href="#" target="_blank" class="button primary save-button">Save</a>\n    </div>\n    <div class="messaging"></div>\n</div>\n'
}),
nm_module("nm/tools/savephotomaps/imagesize", function(a, b, c, d) {
    var e = 4
      , f = 1024
      , g = 1024
      , h = .2;
    a.getImageSizePrediction = function(a, b) {
        var c, d = a * b, i = e * d, j = i * h, k = j / f, l = k / g, m = k, n = l;
        return 1e3 >= m && (c = Number(m.toFixed(0)),
        c += " KB"),
        m > 1e3 && (c = Number(n.toFixed(1)),
        c += " MB"),
        c
    }
}),
nm_module("nm/dataproviders/photomaps/photomapsprovider", function(a, b, c, d) {
    var e = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , f = b("nm/tools/savephotomaps/imagesize", "getImageSizePrediction")
      , g = b("nm/const", "DATE_FORMAT")
      , h = b("jscore/types", "isUndefined")
      , i = b("jscore/types", "isUndefinedOrNull")
      , j = b("jscore/strings", "format")
      , k = b("jscore/itertools", "find")
      , l = b("jscore/itertools", "map")
      , m = b("jscore/itertools", "max")
      , n = b("jscore/itertools", "filter")
      , o = b("jscore/itertools", "first")
      , p = b("jscore/itertools", "last")
      , q = b("jscore/itertools", "array")
      , r = b("jscore/dateutils", "format")
      , s = b("js-libs/jquery", "jQuery")
      , t = 64
      , u = 64
      , v = a.PhotomapsProvider = c(e, {
        constructor: function(a, b, c, d) {
            c = "undefined" == typeof arguments[2] ? !1 : c,
            d = "undefined" == typeof arguments[3] ? "" : d,
            v.base.call(this),
            this._urlPreFetchFormat = a,
            this._urlSaveFormat = b,
            this._urlImageFormatsAvailable = d,
            this._autoSelectWebMercZoom = c,
            this._date = "",
            this._southWest = null ,
            this._northEast = null ,
            this._geoFileIncluded = !1,
            this._selectedPixelSize = null ,
            this._selectedProjection = null ,
            this._selectedFormat = null ,
            this._hasCoverage = !1,
            this._clearResults(),
            this.resetProgress()
        },
        _clearResultsNotifyChange: function(a) {
            this._clearResults(),
            this._hasCoverage = a,
            this.setProgress(1),
            this.changed()
        },
        _clearResults: function() {
            this._canImageBeRequested = !1,
            this._nativeResolutionAvailable = !1,
            this._availableProjections = [],
            this._availableResolutions = [],
            this._defaultPixelSize = null ,
            this._defaultProjection = null ,
            this._storageSize = null ,
            this._imageWidth = null ,
            this._imageHeight = null ,
            this._imageUrl = "#"
        },
        getAvailableResolutions: function() {
            return this._availableResolutions
        },
        _setAvailableResolutions: function(a) {
            a = "undefined" == typeof arguments[0] ? [] : a,
            a.sort(function(a, b) {
                return a - b
            }
            .bind(this)),
            a = q(l(a, function(a) {
                return {
                    label: a.toFixed(3),
                    value: a
                }
            }
            .bind(this))),
            a.length > 1 && (o(a).label += " (Highest)",
            p(a).label += " (Lowest)"),
            this._availableResolutions = a
        },
        _selectPixelSizeByPrevious: function() {
            var a = this._availableResolutions;
            if (0 === a.length)
                return void (this._selectedPixelSize = null );
            var b = this._selectedPixelSize;
            if (this._selectedPixelSize = o(a).value,
            b) {
                var c = l(a, function(a) {
                    return a.value
                }
                .bind(this))
                  , d = m(n(c, function(a) {
                    return b >= a
                }
                .bind(this)));
                h(d) || (this._selectedPixelSize = d)
            }
        },
        getAvailableProjections: function() {
            return this._availableProjections
        },
        _setAvailableProjections: function(a) {
            a = "undefined" == typeof arguments[0] ? [] : a,
            this._availableProjections = q(l(a, function(a) {
                return {
                    label: a.SrsDesc,
                    value: a.Srs,
                    width: a.Width,
                    height: a.Height
                }
            }
            .bind(this)))
        },
        _selectProjectionByPrevious: function() {
            var a = this._availableProjections;
            if (0 === a.length)
                return void (this._selectedProjection = null );
            var b = this._selectedProjection;
            if (this._selectedProjection = o(a).value,
            b) {
                var c = k(a, o(a), function(a) {
                    return a.value === b
                }
                .bind(this));
                this._selectedProjection = c.value
            }
        },
        setGeoFileIncluded: function(a) {
            this._geoFileIncluded = a,
            this._updateImageUrl(),
            this.changed()
        },
        setSelectedPixelSize: function(a) {
            this._selectedPixelSize = a,
            this._updateImageDetails(),
            this.changed()
        },
        getSelectedPixelSize: function() {
            return this._selectedPixelSize
        },
        setSelectedProjection: function(a) {
            this._selectedProjection = a,
            this._updateImageDetails(),
            this.changed()
        },
        getSelectedProjection: function() {
            return this._selectedProjection
        },
        queryImageProfile: function(a, b, c, d) {
            d = "undefined" == typeof arguments[3] ? "" : d,
            i(this._profileImageAjaxRequest) || this._profileImageAjaxRequest.abort(),
            this._date = c,
            this._southWest = a,
            this._northEast = b,
            this._canImageBeRequested = !1,
            this.resetProgress(),
            this.setProgress(0),
            this.changed();
            var e = this._getUpdateFromServer(a, b, c, d);
            return this._profileImageAjaxRequest = e,
            0 === this.getProgress() && (this.setProgress(.5),
            this.changed()),
            e
        },
        _getUpdateFromServer: function(a, b, c, d) {
            c = c ? r(c, g, !0) : "";
            var e = a.getLon()
              , f = a.getLat()
              , h = b.getLon()
              , i = b.getLat()
              , k = j(this._urlPreFetchFormat, {
                bbox1: e,
                bbox2: f,
                bbox3: h,
                bbox4: i,
                date: c,
                webMercZoom: d
            })
              , l = s.getJSON(k).done(function(a) {
                return this._handleDataReceived(a)
            }
            .bind(this)).fail(function() {
                return this._clearResultsNotifyChange(!1)
            }
            .bind(this));
            return l
        },
        _handleDataReceived: function(a) {
            return 0 === a.Projections.length || 0 === a.PixelSizes.length ? void this._clearResultsNotifyChange(a.Coverage) : (this._canImageBeRequested = !0,
            this._setAvailableProjections(a.Projections),
            this._setAvailableResolutions(a.PixelSizes),
            this._autoSelectWebMercZoom ? (this._selectedProjection = a.SelectedSrs,
            this._selectedPixelSize = a.SelectedPixelSize) : (this._selectProjectionByPrevious(),
            this._selectPixelSizeByPrevious(),
            this._nativeResolutionAvailable = a.NativeResolutionAvailable),
            this._updateImageDetails(),
            this._hasCoverage = a.Coverage,
            this.setProgress(1),
            void this.changed())
        },
        _updateImageDetails: function() {
            this._updateImageDetailsHelper(),
            this._updateImageUrl()
        },
        _updateImageDetailsHelper: function() {
            var a = this._selectedPixelSize
              , b = this._selectedProjection;
            if (this._storageSize = null ,
            this._imageWidth = null ,
            this._imageHeight = null ,
            this._canImageBeRequested && null  !== b && null  !== a && 0 !== a) {
                var c = k(this._availableProjections, null , function(a) {
                    return a.value === b
                }
                .bind(this));
                if (null  === c)
                    return void (this._canImageBeRequested = !1);
                var d = c.width / a
                  , e = c.height / a;
                if (t > d || u > e)
                    return void (this._canImageBeRequested = !1);
                this._imageWidth = d,
                this._imageHeight = e,
                this._storageSize = f(d, e)
            }
        },
        _updateImageUrl: function() {
            if (!this._canImageBeRequested)
                return void (this._imageUrl = "#");
            var a = this._date;
            a = a ? r(a, g, !0) : "";
            var b = this._southWest
              , c = b.getLon()
              , d = b.getLat()
              , e = this._northEast
              , f = e.getLon()
              , h = e.getLat();
            this._imageUrl = j(this._urlSaveFormat, {
                bbox1: c,
                bbox2: d,
                bbox3: f,
                bbox4: h,
                date: a,
                geoFile: this._geoFileIncluded,
                pixelSize: this._selectedPixelSize,
                projection: encodeURIComponent(this._selectedProjection),
                format: this._selectedFormat
            })
        },
        getImageData: function() {
            return {
                canImageBeRequested: this._canImageBeRequested,
                isNativeResolutionAvailable: this._nativeResolutionAvailable,
                hasCoverage: this._hasCoverage,
                width: this._imageWidth,
                height: this._imageHeight,
                storageSize: this._storageSize,
                imageUrl: this._imageUrl
            }
        },
        queryImageFormats: function(a) {
            a = "undefined" == typeof arguments[0] ? [] : a,
            s.getJSON(this._urlImageFormatsAvailable).done(function(a) {
                return this._handleImageFormatResponse(a)
            }
            .bind(this)).fail(function() {
                return this._handleImageFormatResponse(a)
            }
            .bind(this))
        },
        _handleImageFormatResponse: function(a) {
            this._availableFormats = q(l(a.formats, function(a) {
                return {
                    label: a.description,
                    value: a.formatId,
                    info: a.info
                }
            }
            .bind(this)));
            var b = o(this._availableFormats);
            return b && b.value ? void this.setSelectedFormat(b.value) : void this.changed()
        },
        getAvailableFormats: function() {
            return this._availableFormats
        },
        setSelectedFormat: function(a) {
            this._selectedFormat = a,
            this._updateImageUrl(),
            this.changed()
        },
        getSelectedFormat: function() {
            return this._selectedFormat
        }
    })
}),
nm_module("nm/dataproviders/photomaps/urls", function(a, b, c, d) {
    var e = b("nm/const", "HOST_URL");
    a.SaveImageProfileFormat = e + "maps/api/saveimage/v1/imageprofile?bbox={bbox1},{bbox2},{bbox3},{bbox4}&nmd={date}&webMercZoom={webMercZoom}",
    a.SaveImageSaveFormat = e + "maps/api/saveimage/v1/image?bbox={bbox1},{bbox2},{bbox3},{bbox4}&nmd={date}&geo={geoFile}&pixelSize={pixelSize}&srs={projection}",
    a.DemExportProfileFormat = e + "maps/api/demexport/v1/profile?bbox={bbox1},{bbox2},{bbox3},{bbox4}&nmd={date}&webMercZoom={webMercZoom}",
    a.DemExportSaveFormat = e + "maps/api/demexport/v1/image?bbox={bbox1},{bbox2},{bbox3},{bbox4}&nmd={date}&pixelSize={pixelSize}&srs={projection}&format={format}",
    a.DemExportAvailableFormats = e + "maps/api/demexport/v1/formats",
    a.DemExportDefaultFormats = {
        formats: [{
            description: "Arc/Info ASCII Grid",
            formatId: "aaigrid"
        }, {
            description: "ASCII Gridded XYZ",
            formatId: "xyz"
        }]
    }
}),
nm_module("nm/tools/savephotomaps/currentselectionview", function(a, b, c, d) {
    var e = b("nm/dataproviders/photomaps/photomapsprovider", "PhotomapsProvider")
      , f = b("nm/dataproviders/photomaps/urls", "SaveImageProfileFormat")
      , g = b("nm/dataproviders/photomaps/urls", "SaveImageSaveFormat")
      , h = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , i = b("jscore/events", "Change")
      , j = b("jscore/functools", "bind")
      , k = a.CurrentSelectionView = c(h, {
        constructor: function() {
            k.base.call(this),
            this._dataProvider = new e(f,g,!0),
            this._dataProvider.addListener(i, j(this, this._onDataProviderChanged))
        },
        _onDataProviderChanged: function() {
            this.setProgress(this._dataProvider.getProgress()),
            this.changed()
        },
        queryImageProfile: function(a, b, c, d) {
            return this._dataProvider.queryImageProfile(a, b, c, d)
        },
        getImageData: function() {
            return this._dataProvider.getImageData()
        }
    })
}),
nm_module("nm/tools/savephotomaps/dynamicdropdownview", function(a, b, c, d) {
    var e = b("jscore/events", "ObservableObject")
      , f = b("jscore/events", "Change")
      , g = b("jscore/types", "isUndefinedOrNull")
      , h = b("jscore/strings", "format")
      , i = b("jscore/itertools", "zip")
      , j = b("js-libs/jquery", "jQuery")
      , k = a.DynamicDropDownView = c(e, {
        constructor: function(a, b, c, d) {
            k.base.call(this),
            this._getList = c,
            this._getSelectedItem = d,
            this._provider = b,
            this._prevValue = null ,
            this._buildUI(a),
            this._setupListeners()
        },
        _buildUI: function(a) {
            this._$node = j('<div class="unit-view"></div>'),
            this._$lstItems = j('<select class="units"><select>'),
            this._$lstItems.hide(),
            this._$noData = j("<div>No Data</div>"),
            this._$noData.show(),
            this._$node.append(this._$lstItems),
            this._$node.append(this._$noData),
            a.append(this._$node)
        },
        _setupListeners: function() {
            this._$lstItems.change(function(a) {
                return this._onSelectedItemChange(a)
            }
            .bind(this)),
            this._provider.addListener(f, function() {
                return this._onListChange()
            }
            .bind(this))
        },
        _hasListChanged: function(a, b) {
            var c = b.children("option").toArray();
            if (a.length !== c.length)
                return !0;
            for (var e, f = i(a, c)[d.iterator](); !(e = f.next()).done; ) {
                var g = e.value
                  , h = g[1]
                  , g = g[0]
                  , j = g
                  , k = j.value
                  , j = j.label;
                if (h.value !== k && h.value !== k.toString() || h.text !== j)
                    return !0
            }
            return !1
        },
        _onListChange: function() {
            var a = this._$lstItems
              , b = this._getList();
            if (g(b) && (b = []),
            this._hasListChanged(b, a)) {
                var c = this._prevValue = a.val();
                a.empty();
                var e;
                if (0 === b.length)
                    return a.hide(),
                    void this._$noData.show();
                for (var f, i = b[d.iterator](); !(f = i.next()).done; ) {
                    var j = f.value
                      , k = j
                      , l = k.value
                      , k = k.label
                      , m = h('<option value="{value}">{label}</option>', {
                        label: k,
                        value: l
                    });
                    a.append(m),
                    (!g(c) && c === l || c === l.toString()) && a.val(l),
                    e = l
                }
                g(a.val()) && a.val(e),
                g(a.val()) && a.val(e),
                this._$noData.hide(),
                a.show()
            }
        },
        _onSelectedItemChange: function(a) {
            var b = j(a.target).val();
            "" === b && (b = null );
            var c = this._prevValue;
            (g(c) || c !== b) && (this._prevValue = b,
            this.changed())
        },
        getCurrentSelectedValue: function() {
            return this._$lstItems.val()
        }
    })
}),
nm_module("nm/tools/savephotomaps/defineareatmpl", function(a, b, c, d) {
    a.html = '<div class="contents" style="display:none;">\n    <div class="left">\n        <div class="prop-row map-projection-type">\n            <label>Projection</label>\n        </div>\n        <div class="prop-row map-resolution">\n            <label>Resolution (meters/pixel)</label>\n        </div>\n        <label>\n            <input type="checkbox" name="georeference" class="georeference"> \n            Include georeference file\n        </label>\n        <div class="prop-row image-width">\n            <label>Width: </label>\n            <label class="imageWidth"></label>\n        </div>\n        <div class="prop-row image-height">\n            <label>Height: </label>\n            <label class="imageHeight"></label>\n        </div>\n    </div>\n    </div>\n</div>\n'
}),
nm_module("nm/tools/savephotomaps/defineareaview", function(a, b, c, d) {
    var e = b("nm/dataproviders/photomaps/urls", "SaveImageProfileFormat")
      , f = b("nm/dataproviders/photomaps/urls", "SaveImageSaveFormat")
      , g = b("nm/dataproviders/photomaps/photomapsprovider", "PhotomapsProvider")
      , h = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , i = b("./dynamicdropdownview", "DynamicDropDownView")
      , j = b("./defineareatmpl", "html")
      , k = b("jscore/events", "Change")
      , l = b("jscore/functools", "bind")
      , m = b("jscore/types", "isUndefinedOrNull")
      , n = b("jscore/types", "isNumeric")
      , o = b("js-libs/jquery", "jQuery")
      , p = a.DefineAreaView = c(h, {
        constructor: function() {
            p.base.call(this),
            this._dataProvider = new g(e,f),
            this._buildUi(o(j)),
            this._setupListeners(),
            this._dataProvider.addListener(k, l(this, this._onDataProviderChanged))
        },
        _onDataProviderChanged: function() {
            var a = this._dataProvider.getImageData();
            if (a.canImageBeRequested) {
                var b = Math.round(a.width) + " pixels";
                this._$imageWidth.empty(),
                this._$imageWidth.append(b);
                var c = Math.round(a.height) + " pixels";
                this._$imageHeight.empty(),
                this._$imageHeight.append(c)
            } else
                this._$imageWidth.empty(),
                this._$imageWidth.append("NA"),
                this._$imageHeight.empty(),
                this._$imageHeight.append("NA");
            this.setProgress(this._dataProvider.getProgress()),
            this.changed()
        },
        _buildUi: function(a) {
            this._$html = a,
            this._$mapProjectionTypes = a.find(".map-projection-type"),
            this._$mapResolutions = a.find(".map-resolution"),
            this._$includeGeoreference = a.find(".georeference"),
            this._$imageWidth = a.find(".imageWidth"),
            this._$imageHeight = a.find(".imageHeight"),
            this._mapResolutions = new i(this._$mapResolutions,this._dataProvider,l(this._dataProvider, this._dataProvider.getAvailableResolutions),l(this._dataProvider, this._dataProvider.getSelectedPixelSize)),
            this._mapProjectionTypes = new i(this._$mapProjectionTypes,this._dataProvider,l(this._dataProvider, this._dataProvider.getAvailableProjections),l(this._dataProvider, this._dataProvider.getSelectedProjection))
        },
        _setupListeners: function() {
            this._mapResolutions.addListener(k, l(this, this._onMapResolutionsDDChanged)),
            this._mapProjectionTypes.addListener(k, l(this, this._onMapProjectionTypesDDChanged)),
            this._$includeGeoreference.change(l(this, this._onGeoFileIncludedChanged))
        },
        _onGeoFileIncludedChanged: function() {
            var a = this._$includeGeoreference.is(":checked");
            this._dataProvider.setGeoFileIncluded(a)
        },
        _onMapResolutionsDDChanged: function() {
            var a = this._mapResolutions.getCurrentSelectedValue();
            a = parseFloat(a),
            n(a) && a !== this._dataProvider.getSelectedPixelSize() && this._dataProvider.setSelectedPixelSize(a)
        },
        _onMapProjectionTypesDDChanged: function() {
            var a = this._mapProjectionTypes.getCurrentSelectedValue();
            m(a) || a === this._dataProvider.getSelectedProjection() || this._dataProvider.setSelectedProjection(a)
        },
        getHtml: function() {
            return this._$html
        },
        queryImageProfile: function(a, b, c) {
            return this._dataProvider.queryImageProfile(a, b, c)
        },
        getImageData: function() {
            return this._dataProvider.getImageData()
        }
    })
}),
nm_module("nm/tools/savephotomaps/demexporttmpl", function(a, b, c, d) {
    a.html = '<div class="contents" style="display:none;">\n    <div class="left">\n        <div class="prop-row map-projection-type">\n            <label>Projection</label>\n        </div>\n        <div class="prop-row map-resolution">\n            <label>Resolution (meters/pixel)</label>\n        </div>\n        <div class="prop-row image-format">\n            <label>Format</label>\n        </div>\n        <div class="prop-row image-width">\n            <label>Width: </label>\n            <label class="imageWidth"></label>\n        </div>\n        <div class="prop-row image-height">\n            <label>Height: </label>\n            <label class="imageHeight"></label>\n        </div>\n    </div>\n</div>'
}),
nm_module("nm/tools/savephotomaps/demexportview", function(a, b, c, d) {
    var e = b("nm/dataproviders/photomaps/urls", "DemExportProfileFormat")
      , f = b("nm/dataproviders/photomaps/urls", "DemExportSaveFormat")
      , g = b("nm/dataproviders/photomaps/urls", "DemExportAvailableFormats")
      , h = b("nm/dataproviders/photomaps/urls", "DemExportDefaultFormats")
      , i = b("nm/dataproviders/photomaps/photomapsprovider", "PhotomapsProvider")
      , j = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , k = b("./dynamicdropdownview", "DynamicDropDownView")
      , l = b("./demexporttmpl", "html")
      , m = b("jscore/events", "Change")
      , n = b("jscore/functools", "bind")
      , o = b("jscore/types", "isUndefinedOrNull")
      , p = b("jscore/types", "isNumeric")
      , q = b("js-libs/jquery", "jQuery")
      , r = a.DemExportView = c(j, {
        constructor: function() {
            r.base.call(this),
            this._dataProvider = new i(e,f,!1,g),
            this._buildUi(q(l)),
            this._setupListeners(),
            this._dataProvider.addListener(m, n(this, this._onDataProviderChanged))
        },
        _onDataProviderChanged: function() {
            var a = this._dataProvider.getImageData();
            if (a.canImageBeRequested) {
                var b = Math.round(a.width) + " pixels";
                this._$imageWidth.empty(),
                this._$imageWidth.append(b);
                var c = Math.round(a.height) + " pixels";
                this._$imageHeight.empty(),
                this._$imageHeight.append(c)
            } else
                this._$imageWidth.empty(),
                this._$imageWidth.append("NA"),
                this._$imageHeight.empty(),
                this._$imageHeight.append("NA");
            this.setProgress(this._dataProvider.getProgress()),
            this.changed()
        },
        _buildUi: function(a) {
            this._$html = a,
            this._$mapProjectionTypes = a.find(".map-projection-type"),
            this._$mapResolutions = a.find(".map-resolution"),
            this._$imageFormats = a.find(".image-format"),
            this._$imageWidth = a.find(".imageWidth"),
            this._$imageHeight = a.find(".imageHeight"),
            this._mapResolutions = new k(this._$mapResolutions,this._dataProvider,n(this._dataProvider, this._dataProvider.getAvailableResolutions),n(this._dataProvider, this._dataProvider.getSelectedPixelSize)),
            this._mapProjectionTypes = new k(this._$mapProjectionTypes,this._dataProvider,n(this._dataProvider, this._dataProvider.getAvailableProjections),n(this._dataProvider, this._dataProvider.getSelectedProjection)),
            this._imageFormats = new k(this._$imageFormats,this._dataProvider,n(this._dataProvider, this._dataProvider.getAvailableFormats),n(this._dataProvider, this._dataProvider.getSelectedFormat))
        },
        _setupListeners: function() {
            this._mapResolutions.addListener(m, n(this, this._onMapResolutionsDDChanged)),
            this._mapProjectionTypes.addListener(m, n(this, this._onMapProjectionTypesDDChanged)),
            this._imageFormats.addListener(m, n(this, this._onFormatsDDChanged)),
            this._dataProvider.queryImageFormats(h)
        },
        _onMapResolutionsDDChanged: function() {
            var a = this._mapResolutions.getCurrentSelectedValue();
            a = parseFloat(a),
            p(a) && a !== this._dataProvider.getSelectedPixelSize() && this._dataProvider.setSelectedPixelSize(a)
        },
        _onMapProjectionTypesDDChanged: function() {
            var a = this._mapProjectionTypes.getCurrentSelectedValue();
            o(a) || a === this._dataProvider.getSelectedProjection() || this._dataProvider.setSelectedProjection(a)
        },
        _onFormatsDDChanged: function() {
            var a = this._imageFormats.getCurrentSelectedValue();
            o(a) || a === this._dataProvider.getSelectedFormat() || this._dataProvider.setSelectedFormat(a)
        },
        getHtml: function() {
            return this._$html
        },
        queryImageProfile: function(a, b, c) {
            return this._dataProvider.queryImageProfile(a, b, c)
        },
        getImageData: function() {
            return this._dataProvider.getImageData()
        }
    })
}),
nm_module("nm/tools/savephotomaps", function(a, b, c, d) {
    var e = b("nm/tools", "Tool")
      , f = b("nm/dataproviders/progress/progressprovider", "ProgressProvider")
      , g = b("nm/views/components/progressbar", "ProgressBar")
      , h = b("nm/geom", "LatLng")
      , i = b("nm/features/rectanglemodel", "Rectangle")
      , j = b("nm/layers/feature", "FeatureLayer")
      , k = b("nm/const/tools", "SAVE_IMAGE_KEY")
      , l = b("nm/const/tools", "DEM_EXPORT_KEY")
      , m = b("./savephotomaps/savephotomapstmpl", "html")
      , n = b("./savephotomaps/currentselectionview", "CurrentSelectionView")
      , o = b("./savephotomaps/defineareaview", "DefineAreaView")
      , p = b("./savephotomaps/demexportview", "DemExportView")
      , q = b("jscore/functools", "bind")
      , r = b("jscore/async", "clearTimeout")
      , s = b("jscore/async", "setTimeout")
      , t = b("jscore/events", "Change")
      , u = b("jscore/types", "isUndefinedOrNull")
      , v = b("js-libs/jquery", "jQuery")
      , w = a.SavePhotomaps = c(e, {
        constructor: function(a, b, c) {
            w.base.call(this),
            this._auth = a,
            this._demexportEnabled = a.can(l),
            this._map = b,
            this._layersCtrl = b.layersCtrl,
            this._surveysController = c,
            this.name = "Save PhotoMaps",
            this.accessKey = k,
            this._layer = null ,
            this._rectangle = null ,
            this._advancedMode = !1,
            this._createSections(),
            this._buildUI(),
            this._setupUIListeners()
        },
        _createSections: function() {
            this._currentSelectionSection = new n,
            this._currentSelectionSection.addListener(t, q(this, function() {
                return this._onSectionChanged(this._currentSelectionSection)
            }
            .bind(this))),
            this._defineAreaSection = new o,
            this._defineAreaSection.addListener(t, q(this, function() {
                return this._onSectionChanged(this._defineAreaSection)
            }
            .bind(this))),
            this._demexportEnabled && (this._demExportSection = new p,
            this._demExportSection.addListener(t, q(this, function() {
                return this._onSectionChanged(this._demExportSection)
            }
            .bind(this)))),
            this._activeSection = this._currentSelectionSection
        },
        _buildUI: function() {
            var a = this.popup = v(m);
            this._$currentScreenRadioButton = a.find(".current-screen"),
            this._$defineAreaRadioButton = a.find(".define-area"),
            this._$demexportRadioButton = a.find(".demexport-radio");
            var b = a.find(".advanced-options");
            this._$saveImageContents = this._defineAreaSection.getHtml(),
            b.append(this._$saveImageContents);
            var c = a.find(".demexport-wrapper");
            if (this._demexportEnabled) {
                this._$demexportContents = this._demExportSection.getHtml();
                var d = c.find(".demexport-options");
                d.append(this._$demexportContents)
            } else
                this._$demexportContents = v("<div />"),
                c.remove();
            this._$storageUnitView = a.find(".fileSize"),
            this._$saveButton = a.find(".save-button"),
            this._$messaging = a.find(".messaging"),
            this._progressProvider = new f,
            this._$progressBar = a.find(".progressbar-container"),
            this.progressBar = new g(this._$progressBar,this._progressProvider)
        },
        _setupSurveyListeners: function() {
            this._surveysController.addListener(t, q(this, this._onSurveyChange))
        },
        _removeSurveyListeners: function() {
            this._surveysController.removeListeners(this)
        },
        _setupUIListeners: function() {
            this._$currentScreenRadioButton.change(q(this, this._onCurrentScreenRadioButton)),
            this._$defineAreaRadioButton.change(q(this, this._onDefineAreaRadioButton)),
            this._demexportEnabled && this._$demexportRadioButton.change(q(this, this._onDemexportRadioButton))
        },
        _addMessage: function(a) {
            this._$messaging.append(a)
        },
        _clearMessage: function() {
            this._$messaging.empty()
        },
        _onSurveyChange: function() {
            this._handleAreaChangeWithTimeout()
        },
        _onCurrentScreenRadioButton: function() {
            this._$demexportContents.slideUp(),
            this._$saveImageContents.slideUp(),
            this._clearRectangle(),
            this._clearMessage(),
            this._activeSection = this._currentSelectionSection,
            this._handleAreaSelectedChange()
        },
        _onDefineAreaRadioButton: function() {
            this._$demexportContents.slideUp({
                complete: function() {
                    return this._$saveImageContents.slideDown()
                }
                .bind(this)
            }),
            this._createRectangleFromCurrentView(),
            this._clearMessage(),
            this._activeSection = this._defineAreaSection,
            this._handleAreaSelectedChange()
        },
        _onDemexportRadioButton: function() {
            this._demexportEnabled && (this._$saveImageContents.slideUp({
                complete: function() {
                    return this._$demexportContents.slideDown()
                }
                .bind(this)
            }),
            this._createRectangleFromCurrentView(),
            this._clearMessage(),
            this._activeSection = this._demExportSection,
            this._handleAreaSelectedChange())
        },
        _handleAreaChangeWithTimeout: function() {
            r(this._timeout),
            this._timeout = s(q(this, this._handleAreaSelectedChange), 400)
        },
        _handleAreaSelectedChange: function() {
            var a, b, c = this._activeSection, d = this._surveysController.getDisplayDate(), e = this._rectangle;
            if (u(e)) {
                var f = this._map.tmpGoogleMapViewController.getBounds();
                a = new h(f.bottom,f.left),
                b = new h(f.top,f.right);
                var g = this._map.getZoom();
                return c.queryImageProfile(a, b, d, g)
            }
            return a = e.getSouthWest(),
            b = e.getNorthEast(),
            c.queryImageProfile(a, b, d)
        },
        _onSectionChanged: function(a) {
            if (this._activeSection === a) {
                this._progressProvider.setProgress(a.getProgress()),
                this._progressProvider.changed();
                var b = a.getImageData();
                return b.canImageBeRequested ? this._updateImageData(b) : this._updateImageNoData(b.hasCoverage)
            }
        },
        _updateImageData: function(a) {
            this._$storageUnitView.empty(),
            this._$storageUnitView.append(a.storageSize);
            var b = this._$saveButton;
            b.removeAttr("disabled"),
            b.removeAttr("style"),
            b.attr("href", a.imageUrl),
            this._clearMessage(),
            a.isNativeResolutionAvailable || this._activeSection === this._currentSelectionSection || this._addMessage("For higher resolution please define a smaller area")
        },
        _updateImageNoData: function(a) {
            this._$storageUnitView.empty(),
            this._$storageUnitView.append("NA");
            var b = this._$saveButton;
            b.attr("disabled", "disabled"),
            b.attr("style", "pointer-events: none; cursor: default;"),
            b.attr("href", "#"),
            this._clearMessage(),
            a ? this._addMessage("Save Photomaps is not available. Please define a smaller area") : this._addMessage("Save Photomaps is not available in the selected area")
        },
        _createRectangleFromCurrentView: function() {
            var a = this._rectangle;
            if (u(a)) {
                var b = this._map.tmpGoogleMapViewController.getBounds()
                  , c = b.left
                  , d = b.right
                  , e = b.top
                  , f = b.bottom;
                c > 0 && 0 > d && (d += 360);
                var g = new h((2 * f + e) / 3,(2 * c + d) / 3)
                  , j = new h((f + 2 * e) / 3,(c + 2 * d) / 3);
                a = new i(g,j),
                a.addListener(t, q(this, this._handleAreaChangeWithTimeout)),
                this._layer.addNewFeature(a),
                this._rectangle = a
            }
        },
        _clearRectangle: function() {
            u(this._rectangle) || (this._rectangle.removeListeners(this),
            this._layer.deleteFeature(this._rectangle),
            this._rectangle = null )
        },
        hasAccess: function() {
            return this._auth.can(k)
        },
        start: function() {
            if (null  === this._layer) {
                var a = new j("Save Photomaps Layer",!0,null ,!1);
                this._layer = a,
                this._layersCtrl.addLayer(a)
            }
            this._activeSection !== this._currentSelectionSection && this._createRectangleFromCurrentView(),
            this._setupSurveyListeners(),
            this._handleAreaSelectedChange()
        },
        stop: function() {
            this._clearRectangle(),
            this._layersCtrl.removeLayer(this._layer),
            this._removeSurveyListeners()
        }
    })
}),
nm_module("gooscr/draw", function(a, b) {
    "use strict";
    var c = b("js-libs/google")
      , d = a;
    a.drawings = [],
    a.start = function(a, b, e) {
        var f, g, h = {
            type: b,
            callback: function() {
                "function" == typeof e && e()
            },
            shape: null 
        };
        switch (h.type) {
        case "rectangle":
            f = h.shape = new c.maps.Rectangle;
            var i = a.getBounds()
              , j = i.getSouthWest()
              , k = i.getNorthEast()
              , l = j.lng()
              , m = k.lng();
            l > 0 && 0 > m && (m += 360);
            var n = new c.maps.LatLngBounds(new c.maps.LatLng((2 * j.lat() + k.lat()) / 3,(2 * l + m) / 3),new c.maps.LatLng((j.lat() + 2 * k.lat()) / 3,(l + 2 * m) / 3))
              , o = {
                strokeColor: "#00f",
                strokeOpacity: .8,
                strokeWeight: 2,
                fillColor: "#00f",
                fillOpacity: .35,
                map: a,
                bounds: n,
                editable: !0,
                draggable: !0
            };
            f.setOptions(o),
            g = !0
        }
        return d.drawings.push(h),
        g && h.callback(h),
        f
    }
    ,
    a.remove = function(a) {
        return a && "object" == typeof a && "setMap" in a ? (a.setMap(null ),
        !0) : (a = null ,
        !1)
    }
}),
nm_module("gooscr/tools/savePhotomaps", function(a, b) {
    "use strict";
    function c(a, b) {
        for (var c, d = 0, e = /{[a-z0-9]+}/i; (c = e.exec(a)) && d++ < 100; ) {
            var f = c[0].substr(1, c[0].length - 2)
              , g = f in b ? b[f] : "";
            a = a.replace(c[0], g)
        }
        return a
    }
    var d = b("gooscr/draw")
      , e = b("jscore/async").setTimeout
      , f = b("nm/const/tools")
      , g = b("jscore/dateutils")
      , h = b("nm/const")
      , i = b("js-libs/jquery").jQuery;
    a.buildTool = function(a, b, j) {
        var k = {
            name: "Save PhotoMaps",
            accessKey: f.SAVE_IMAGE_KEY,
            popup: i('<div><form action="" class="save-image"><label><input type="radio" name="type" value="screen" checked=""> <div>Current Screen</div></label><label><input type="radio" name="type" value="rectangle"> <div>Select Area</div></label><div class="compact-buttons buttons"><div class="left"><label class="left"><input type="checkbox" name="georeference"> Include georeference file</label></div><div class="right"><input type="submit" value="Save" class="button primary"></div></div></form></div>'),
            popupId: null ,
            $typeInputs: null ,
            $geoInput: null ,
            urlFormat: "/staticmap?bbox={southWestLat},{southWestLng},{northEastLat},{northEastLng}&zoom={zoom}&date={date}&filename=",
            rectangle: null ,
            hasAccess: function() {
                try {
                    return a.can(k.accessKey)
                } catch (b) {
                    return !1
                }
            },
            init: function() {
                k.$form = k.popup.find("form"),
                k.$typeInputs = k.$form.find(":input[name=type]"),
                k.$geoInput = k.$form.find(":input[name=georeference]"),
                k.$form.on("submit.saveImage", k._onSubmit),
                k.$typeInputs.on("change.saveImage", k._onTypeChanged)
            },
            _getType: function() {
                return k.$typeInputs.filter(":checked").val()
            },
            _getGeo: function() {
                return k.$geoInput.filter(":checked").length > 0
            },
            _onSubmit: function(a) {
                a.preventDefault();
                var b = k._getGeo()
                  , c = k.getUrl();
                k.download(c),
                b && k.download(c + "&world=true")
            },
            _onTypeChanged: function() {
                var a = k._getType();
                "rectangle" === a ? k.rectangle = d.start(b, "rectangle") : d.remove(k.rectangle)
            },
            getUrl: function() {
                var a, d = k._getType();
                a = "rectangle" === d ? k.rectangle.getBounds() : b.getBounds();
                var e = a.getNorthEast()
                  , f = a.getSouthWest()
                  , i = j.getDisplayDate()
                  , l = {
                    date: g.format(i, h.DATE_FORMAT, !0),
                    zoom: "rectangle" === d ? "best" : b.getZoom(),
                    northEastLat: e.lat(),
                    northEastLng: e.lng(),
                    southWestLat: f.lat(),
                    southWestLng: f.lng()
                };
                return c(k.urlFormat, l)
            },
            download: function(a) {
                var b = i("<iframe>", {
                    css: {
                        display: "none"
                    }
                });
                b.on("readystatechange", function(a) {
                    k._onIframeLoaded(a, b.get(0))
                }),
                i("body").append(b),
                b.attr("src", a),
                e(function() {
                    b.remove()
                }, 1e5)
            },
            _onIframeLoaded: function(a, b) {
                "loaded" !== b.readyState && "complete" !== b.readyState && "interactive" !== b.readyState || e(function() {
                    i(b).remove()
                }, 1e3)
            },
            start: function() {},
            stop: function() {
                k.$typeInputs.filter("[value=screen]").prop("checked", !0).trigger("change")
            }
        };
        return k
    }
}),
nm_module("gooscr/tools/locationMarker", function(a, b) {
    "use strict";
    function c(a, b, c) {
        for (var d = b.length, e = /\?/.test(a), f = 0; d > f; f++)
            e ? a += "&" + b[f] : (a += "?" + b[f],
            e = !0);
        return c && (a = a.replace(/&/g, "&amp;")),
        a
    }
    function d(a, b, d, e, f) {
        var g = []
          , h = b.getMapType()
          , i = location.protocol + "//" + location.hostname + (location.port ? ":" + location.port : "")
          , j = a.getZoom()
          , k = b.getDisplayDate();
        i = i.replace(".au.", ".").replace(".audev.", ".").replace(".us.", ".").replace(".usdev.", "."),
        g.push(m.SEARCH_QUERY_KEY + "=" + f),
        e && g.push(m.LATLNG_KEY + "=" + e.toUrlValue()),
        j > 0 && g.push(m.ZOOM_KEY + "=" + j),
        h && g.push(m.MAPTYPE_KEY + "=" + t.get(h, "k"));
        var l = d.getState();
        return l && g.push(m.OVERLAY_KEY + "=" + l),
        k && g.push(m.TILE_DATE_KEY + "=" + n.format(k, "yyyymmdd", !0)),
        c(i, g)
    }
    var e = b("nm/geom").LatLng
      , f = b("gooscr/toolbar")
      , g = b("gooscr/tooltip")
      , h = b("nm/const").STATIC_ASSETS_URL
      , i = b("jscore/events").Change
      , j = b("js-libs/jquery").jQuery
      , k = b("js-libs/google").maps
      , l = b("nm/intl")
      , m = b("nm/const")
      , n = b("jscore/dateutils")
      , o = b("jscore/objtools").Dictionary
      , p = b("nm/const/imagery")
      , q = b("gooscr/tools/uistate").UiState
      , r = b("nm/const/tools").LOCATION_TOOL_KEY
      , s = b("nm/const/tools").REVERSE_GEOCODE_KEY
      , t = new o([[p.SURVEY, "k"], [p.TERRAIN, "p"], [p.SURVEY_N, "n"], [p.SURVEY_E, "e"], [p.SURVEY_S, "s"], [p.SURVEY_W, "w"], [p.ROAD, "roadmap"]]);
    a.buildTool = function(a, b, c, m, n, o) {
        function p(a) {
            return '<span class="location-dms">' + a + "</span>"
        }
        function t(a) {
            var b = 0 | a
              , c = 60 * Math.abs(a - b)
              , d = 0 | c
              , e = Math.round(60 * (c - d));
            return p(b + "°") + p(d + "'") + p(e + '"')
        }
        function u(a, b, c) {
            return "dms" === c ? t(a) + ", " + t(b) : a.toFixed(6) + "," + b.toFixed(6)
        }
        function v(a) {
            return H.popup.find(a)
        }
        function w() {
            for (var a = "Location ", b = 0, c = H.markers.length - 1; c >= 0; c--) {
                var d = H.markers[c]
                  , e = d.getTitle() || "";
                if (0 === e.indexOf(a)) {
                    var f = parseInt(e.split(" ")[1], 10);
                    f > b && (b = f)
                }
            }
            return a + (b + 1)
        }
        function x(a, b) {
            a.address = b
        }
        function y(a, b) {
            if (a && b && b.position) {
                var c = new e(b.position.lat(),b.position.lng());
                a.setCoordinates(c)
            }
        }
        function z(a, b) {
            if (a && b && b.position) {
                var c = new e(b.position.lat(),b.position.lng());
                a.setCoordinates([c])
            }
        }
        var A = "Location"
          , B = null 
          , C = 46;
        q.register(A, {
            latLngFormat: "deg"
        });
        var D = q.getUi(A)
          , E = h + "img/blue-dot.png"
          , F = h + "img/green-dot.png"
          , G = "Click anywhere on the map to mark the location."
          , H = {
            name: A,
            accessKey: r,
            reverseGeocodeKey: s,
            active: !1,
            activeMarker: null ,
            markers: [],
            latLngFormat: D.latLngFormat,
            popup: j('<div>   <div class="description">       You are now in location information mode.        Click anywhere on the map to add a marker.   </div>   <ul class="info">       <li class="address-row">           <div class="address"></div>       </li>       <li>           <div class="label lbl-button"               title="Click to change format.">Lat/Long</div>           <div class="data"><span class="latlng"></span>           </div>       </li>       <li class="elevation-row" style="display: none;">           <div class="label">' + l.getText("tools.Elevation") + '           </div>           <div class="data">               <span class="elevation">N/A</span>           </div>       </li>       <li>           <div class="label">Name</div>           <div class="data">               <input type="text" class="title" />           </div>       </li>       <li title="Copy the URL to share it.">           <div class="label">Share</div>           <div class="data">               <input type="text" class="url"                    readonly="readonly"/>           </div>       </li>       <li class="timestamp-row" style="display: none;">           <div class="label">Photo time</div>           <div class="data">               <span class="timestamp">N/A</span>           </div>       </li>   </ul>   <div class="buttons">       <div class="add-btn" title="Add new marker"></div>       <div class="delete-btn" title="Delete marker"></div>       <div class="clear-btn"           title="Remove all markers">Clear       </div>   </div></div>'),
            hasAccess: function() {
                try {
                    return a.can(H.accessKey)
                } catch (b) {
                    return !1
                }
            },
            hasReverseGeocodeAccess: function() {
                try {
                    return a.can(H.reverseGeocodeKey)
                } catch (b) {
                    return !1
                }
            },
            init: function() {
                var a = f.getToolKey(H);
                B = f.events.makeChannel(a, {
                    clicksAware: !0
                }),
                b.addListener("click", H._onMapClick),
                j(document).on("keydown", H._onKeyDown),
                v(".title").change(function() {
                    var a = H.activeMarker;
                    if (a) {
                        var b = j(this).val();
                        a.setTitle(b),
                        a.hasCustomTitle = !!b,
                        H.update()
                    }
                }),
                this.hasReverseGeocodeAccess() || v(".address-row").css("display", "none"),
                v(".url").click(function() {
                    j(this).select()
                }),
                v(".add-btn").on("click", function() {
                    H.activateMarker(null )
                }),
                v(".delete-btn").on("click", H.removeActiveMarker),
                v(".clear-btn").on("click", H.removeAllMarkers),
                v(".lbl-button").click(function() {
                    var a = H.latLngFormat;
                    a = "dms" === a ? "deg" : "dms",
                    H.latLngFormat = a,
                    q.setUi(H.name, {
                        latLngFormat: a
                    }),
                    H.update()
                });
                var c;
                if (n && (c = v(".timestamp-row"),
                n.enabled ? (c.show(),
                c.find(".data").html(n.node),
                n.addListener(i, function() {
                    n.enabled ? c.show() : c.hide()
                })) : c.remove()),
                o) {
                    var d = v(".elevation-row");
                    o.enabled ? (d.show(),
                    d.find(".data").html(o.node),
                    o.addListener(i, function() {
                        o.enabled ? d.show() : d.hide()
                    })) : c.remove()
                }
            },
            _onMapClick: function(a) {
                if (H.active) {
                    var b = H.activeMarker;
                    b ? (b.setPosition(a.latLng),
                    H.autoSetAddress(),
                    H.update(),
                    y(n, b),
                    z(o, b)) : H.setMarker(a.latLng)
                }
            },
            _onKeyDown: function(a) {
                a.which === C && H.active && !j(a.target).is("input") && H.removeActiveMarker()
            },
            addMarker: function(a, b, c) {
                H.activateMarker(null ),
                H.setMarker(a, b, c)
            },
            setMarker: function(a, c, d) {
                H.removeActiveMarker(),
                H.activateMarker(null ),
                c = c || w(),
                d = d || "";
                var g = new k.Marker({
                    map: b,
                    draggable: !0,
                    title: c,
                    position: a,
                    icon: F
                });
                H.activeMarker = g,
                H.markers.unshift(g),
                g.addListener("dragstart", function() {
                    H.activateMarker(g)
                }),
                g.addListener("drag", H.update),
                g.addListener("dragend", function() {
                    H.autoSetAddress(),
                    y(n, g),
                    z(o, g)
                }),
                g.addListener("click", function() {
                    var a = f.getActive()
                      , b = f.getTool(a);
                    if ("solarPanels" === a && b.jobsPanel) {
                        H.removeAllMarkers();
                        var c = g.getPosition();
                        c = new e(c.lat(),c.lng()),
                        b.jobsPanel.addAndShowJob(c)
                    } else
                        H.activateMarker(g),
                        f.start("locationMarker"),
                        y(n, g),
                        z(o, g),
                        H.update()
                }),
                d ? x(g, d) : H.autoSetAddress(),
                y(n, g),
                z(o, g),
                H.update()
            },
            removeActiveMarker: function() {
                var a = H.activeMarker;
                if (a) {
                    a.setMap(null ),
                    H.activeMarker = null ;
                    var b = H.markers
                      , c = b.indexOf(a);
                    c > -1 && b.splice(c, 1),
                    H.activateMarker(H.markers[0])
                }
                H.update()
            },
            removeAllMarkers: function() {
                for (var a = H.markers, b = a.length - 1; b >= 0; b--) {
                    var c = a[b];
                    c.setMap(null )
                }
                H.activeMarker = null ,
                H.markers = [],
                H.update()
            },
            activateMarker: function(a) {
                var b = H.activeMarker;
                if (b && b.setIcon(E),
                a) {
                    a.setIcon(F);
                    var c = H.markers
                      , d = c.indexOf(a);
                    d > 0 && (c.splice(d, 1),
                    c.unshift(a))
                }
                H.activeMarker = a
            },
            autoSetAddress: function() {
                if (H.hasReverseGeocodeAccess()) {
                    var a = new k.Geocoder
                      , b = H.activeMarker;
                    a.geocode({
                        location: b.position
                    }, function(a, c) {
                        var d = "";
                        c === k.GeocoderStatus.OK && a.length && (d = a[0].formatted_address),
                        b.hasCustomTitle || b.setTitle(d),
                        x(b, d),
                        H.update()
                    })
                }
            },
            update: function() {
                if (H.active) {
                    var a = H.activeMarker;
                    if (a) {
                        v(".description").css("display", "none"),
                        v(".info").css("display", "block"),
                        v(".buttons").css("display", "block");
                        var e = a.position
                          , f = e.lat()
                          , g = e.lng()
                          , h = u(f, g, H.latLngFormat)
                          , i = a.getTitle()
                          , j = a.address || "<br /><br />"
                          , k = encodeURIComponent(i + "@" + e.toUrlValue())
                          , l = d(b, c, m, e, k);
                        v(".latlng").html(h),
                        v(".address").html(j),
                        v(".title").val(i),
                        v(".url").val(l),
                        n && n.setVisible(!0),
                        o && o.setVisible(!0)
                    } else
                        v(".description").css("display", "block"),
                        v(".info").css("display", "none"),
                        v(".buttons").css("display", "none"),
                        n && n.setVisible(!1),
                        o && o.setVisible(!1)
                }
            },
            activate: function() {
                H.active || (H.active = !0,
                b.setOptions({
                    draggableCursor: "crosshair"
                }),
                g.set(G),
                n && n.setVisible(!0),
                o && o.setVisible(!0),
                H.update())
            },
            deactivate: function() {
                H.active = !1,
                g.unset(G),
                b.setOptions({
                    draggableCursor: null 
                }),
                n && n.setVisible(!1),
                o && o.setVisible(!1),
                H.update()
            },
            start: function() {
                H.activate()
            },
            stop: function() {
                H.deactivate()
            }
        };
        return H
    }
}),
nm_module("hw/gooapp", function(a, b, c, d) {
    function e(a) {
        if (!a)
            return ja.NORMAL;
        var b = a.getValue(ka);
        return b = null  === b ? ja.NORMAL : Number(b)
    }
    function f(a) {
        var b = a.getUserId()
          , c = a.getPlanCode()
          , d = JSON.stringify({
            userId: b,
            plancode: c
        });
        window.ga("send", {
            hitType: "event",
            eventAction: "start",
            eventCategory: "mapbrowser",
            eventLabel: JSON.stringify(d)
        })
    }
    function g() {
        var a = -1 === window.location.hostname.indexOf("maps.au")
          , b = -1 !== document.cookie.indexOf("nearmap_web3_app=");
        return a && !b
    }
    var h = b("nm/authorization", "Authorization")
      , i = b("jscore/functools", "bind")
      , j = b("jscore/events", "Change")
      , k = b("jscore/async", "callWhenIdle")
      , l = b("jscore/types", "isUndefinedOrNull")
      , m = b("nm/dataproviders/auth/ticket", "Ticket")
      , n = b("nm/ui/panel", "Panel")
      , o = b("nm/ui/panel", "HSplitPanel")
      , p = b("nm/tools/authui", "AuthUI")
      , q = b("nm/tools/authui", "SurveysAuthUI")
      , r = b("nm/tools/authui", "TouUI")
      , s = b("nm/Usage", "Usage")
      , t = b("nm/maps/map", "Map")
      , u = b("nm/views/google/map", "GoogleMapViewController")
      , v = b("nm/layers/baselayer", "BaseLayer")
      , w = b("nm/tools/layerpicker", "LayerPicker")
      , x = b("nm/views/google/mapoverlays", "MapOverlays")
      , y = b("nm/layers/persistence/manager", "LayersPersistenceManager")
      , z = b("nm/views/timeline/timelineplayer", "TimelinePlayer")
      , A = b("nm/tools/timeline/surveyscontroller", "SurveysController")
      , B = b("nm/dataproviders/surveys", "SurveyInfo")
      , C = b("nm/views/timeline/dropdowntimeline", "DropDownTimeLine")
      , D = b("nm/dataproviders/search/googlesearchprovider", "GoogleSearchProvider")
      , E = b("nm/tools/property/boundsselector", "PropertyBoundsSelectorTool")
      , F = b("nm/dataproviders/property/conditions", "PropertyConditionsProvider")
      , G = b("nm/dataproviders/property/boundaries", "PropertyBoundsProvider")
      , H = b("nm/tools/search/searchtool", "SearchTool")
      , I = b("nm/tools/search/searchtool", "SEARCH_TITLE")
      , J = b("nm/features/solar", "SolarPanel")
      , K = b("nm/features/solar", "SolarJob")
      , L = b("nm/features/polygonimage", "PolygonImage")
      , M = b("nm/tools/state/statemanager", "StateManager")
      , N = b("nm/tools/state/statemanager", "MAP_CENTER")
      , O = b("nm/tools/state/statemanager", "MAP_ZOOM")
      , P = b("nm/tools/state/statemanager", "DESIRED_DATE")
      , Q = b("nm/tools/state/statemanager", "BASE_MAPTYPE")
      , R = b("nm/tools/elevation", "ElevationTool")
      , S = b("nm/tools/solar", "SolarTool")
      , T = b("nm/tools/compare", "CompareTool")
      , U = b("nm/views/timeline/timeline", "TimeLine")
      , V = b("nm/tools/site", "SiteTool")
      , W = b("nm/tools/site", "SITE_PLANNER_TITLE")
      , X = b("nm/tools/volume", "VolumeTool")
      , Y = b("nm/tools/layersmanager", "LayersManagerTool")
      , Z = b("nm/tools/layersmanager", "LAYERS_MANAGER_TITLE")
      , $ = b("nm/tools/timestamp", "TimestampTool")
      , _ = b("nm/dataproviders/geocode/google", "Geocoder")
      , aa = b("nm/ui/FileDropzoneOverlay", "FileDropzoneOverlay")
      , ba = b("nm/tools/elevation/location", "ElevationLocationTool")
      , ca = b("nm/tools/watermark", "Watermark")
      , da = b("nm/views/displaydate", "DisplayDate")
      , ea = b("nm/geom", "LatLng")
      , fa = b("nm/http", "Request")
      , ga = b("nm/metrics", "init")
      , ha = b("nm/intl", "init")
      , ia = b("nm/intl", "getSetting")
      , ja = b("nm/const/output", "MapOutput")
      , ka = b("nm/const/output", "OUTPUT_KEY")
      , la = b("gooscr/closestreetview", "init")
      , ma = b("gooscr/tooltip", "tooltip")
      , na = b("gooscr/toolbar", "toolbar")
      , oa = b("gooscr/popup", "popupMgr")
      , pa = b("gooscr/tools/datalayers/datalayers", "DataLayersBase")
      , qa = b("gooscr/contextmenu", "MapContextMenuControl")
      , ra = b("gooscr/tools/measure", "buildMeasureTool")
      , sa = b("gooscr/tools/measureCircle", "buildMeasureTool")
      , ta = b("nm/tools/rail", "buildTool")
      , ua = b("nm/tools/savephotomaps", "SavePhotomaps")
      , va = b("gooscr/tools/savePhotomaps", "buildTool")
      , wa = b("gooscr/tools/locationMarker", "buildTool")
      , xa = b("gooscr/tools/partiPropertyInfo", "buildTool")
      , ya = b("gooscr/notify", "init")
      , za = b("gooscr/tour", "tour")
      , Aa = b("nm/const", "DEFAULT_ZOOM")
      , Ba = b("nm/const", "STATIC_ASSETS_URL")
      , Ca = b("nm/const", "ADDRESS_QUERY_KEY")
      , Da = b("nm/const", "TILE_DATE_KEY")
      , Ea = b("nm/const/tools", "PREVENT_COMMINGLING")
      , Fa = b("nm/const/tools", "DATA_LAYERS_KEY")
      , Ga = b("nm/const/tools", "VOLUME_TOOL_KEY")
      , Ha = b("nm/const/tools", "MEASUREMENT_KEY")
      , Ia = b("nm/const/tools", "SITE_PLANNER_KEY")
      , Ja = b("nm/const/tools", "SAVE_IMAGE_KEY")
      , Ka = b("nm/const/tools", "ADVANCED_SAVE_IMAGE_KEY")
      , La = b("nm/const/tools", "LAYERS_MANAGER_KEY")
      , Ma = b("nm/const/tools", "DRAG_AND_DROP_FILE_KEY")
      , Na = b("nm/const/tools", "COMPARE_TOOL_KEY")
      , Oa = b("nm/const/tools", "RAIL_TOOL_KEY")
      , Pa = b("nm/const/tools", "SOLAR_TOOL_KEY")
      , Qa = b("nm/const/tools", "LITE")
      , Ra = b("nm/const/tools", "PROPERTY_KEY")
      , Sa = b("nm/const/tools", "LOCATION_TOOL_KEY")
      , Ta = b("js-libs/google", "maps")
      , Ua = b("js-libs/jquery", "jQuery")
      , Va = c(Object, {
        constructor: function(a) {
            this.mapDiv = a,
            this.isDiscoveryUser = g(),
            this.startupURL = new fa(window.location.href),
            this.stateManager = new M(this.startupURL)
        },
        start: function() {
            var a = new h(this.isDiscoveryUser);
            this.auth = a,
            ha(a),
            new p(Ua("body")[0],a);
            var b = !1;
            a.addListener(j, i(this, function() {
                b || a.loginRequired() || (b = !0,
                this.handleLogin())
            }))
        },
        handleLogin: function() {
            var a = this.auth;
            f(a),
            this.initMap(),
            this.initSurveysCtl(),
            this.initBaselayer(),
            this.initStateHandler(),
            this.ticket = new m(this.isDiscoveryUser),
            this.ticket.update(),
            a.setTicket(this.ticket);
            var b = this.googleMapViewController.gMap;
            e(this.startupURL) === ja.FEATURELESS ? this.initFeaturelessMap() : (this.initPanels(),
            this.initTools(),
            ga(a, window.ga, b)),
            this.initLegacy()
        },
        initMap: function() {
            var a;
            if (e(this.startupURL) === ja.FEATURELESS)
                a = {
                    zoom: Aa,
                    zoomControl: !1,
                    streetViewControl: !1,
                    scaleControl: !1,
                    panControl: !1
                };
            else {
                var b, c, d = this.stateManager;
                if (this.auth.isDemoUser()) {
                    var f = ia("demo-center");
                    b = new ea(f.lat,f.lon),
                    c = ia("demo-zoom")
                } else
                    b = d.loadSetting(N),
                    c = d.loadSetting(O);
                a = {
                    zoom: c,
                    center: b,
                    layers: [],
                    zoomControl: !0,
                    zoomControlOptions: {
                        style: Ta.ZoomControlStyle.SMALL,
                        position: Ta.ControlPosition.LEFT_TOP
                    },
                    streetViewControl: !0,
                    streetViewControlOptions: {
                        position: Ta.ControlPosition.TOP_LEFT
                    },
                    scaleControl: !0,
                    panControl: !1
                }
            }
            var g = new t(a);
            this.map = g,
            this.layersCtrl = g.getLayersCtrl();
            var h = new u(this.mapDiv,g,a);
            this.googleMapViewController = h,
            g.tmpGoogleMapViewController = h
        },
        initLayersPersistenceObjects: function() {
            var a = new y(this.auth,this.googleMapViewController,this.layersCtrl);
            a.init(),
            this.layersPersistenceManager = a
        },
        initSurveysCtl: function() {
            var a = this.map
              , b = this.stateManager
              , c = this.auth
              , d = b.loadSetting(P)
              , e = b.loadSetting(Q)
              , f = new B(a,this.isDiscoveryUser)
              , g = new A(c,f,e,d);
            this.surveysCtl = g,
            this.surveyInfo = f,
            new r(Ua("body")[0],c),
            new q(c,g),
            new s(Ua("body")[0],c,a)
        },
        initBaselayer: function() {
            var a = this.surveysCtl
              , b = !this.auth.can(Ea)
              , c = this.startupURL.getValue("cmlng");
            b = b && "0" !== c,
            b = b || "1" === c;
            var d = new v(this.auth,a,b,"Base Layer");
            this.baseLayer = d,
            this.layersCtrl.addLayer(d)
        },
        initStateHandler: function() {
            var a = this.map
              , b = this.surveysCtl
              , c = this.stateManager
              , d = k(function() {
                c.saveSetting(N, a.getCenter()),
                c.saveSetting(O, a.getZoom()),
                c.saveSetting(P, b.getDesiredDate()),
                c.saveSetting(Q, b.getMapType())
            }, 1e3, 1e3);
            a.addListener(j, d),
            b.addListener(j, d)
        },
        initFeaturelessMap: function() {
            function a() {
                var a = "http://maps.gstatic.com/mapfiles/api-3/images/google4"
                  , b = Ua('img[src^="' + a + '"]')
                  , c = {
                    width: "203px",
                    height: "64px"
                };
                b.attr("src", Ba + "img/logo-watermark.png").css(c),
                b.parent().css(c);
                var d = Ua("a").filter(function() {
                    return "Terms of Use" === Ua(this).text()
                })
                  , e = d.attr("href");
                e && e.length > 0 && -1 !== e.indexOf("help/terms_maps.html") && d.parent().remove()
            }
            function b() {
                var a = this.startupURL.getValue("solar-job");
                if (a && !c) {
                    var b = this.map;
                    c = new S(d,b,this.googleMapViewController.getSelection(),e),
                    c.loadJobHeadlessHackidyHackWack(a)
                }
            }
            var c, d = this.auth, e = this.surveysCtl, f = this.googleMapViewController.gMap;
            Ua(".toolbar").remove(),
            Ua(".toolbarBottom").remove(),
            Ua(".panel-top").hide(),
            Ua(".panel-content").css({
                left: "0",
                top: 0
            }),
            na.setAuth(d),
            na._recalculateSize = function() {}
            ,
            za.init = function() {}
            ;
            var g = this.ticket;
            g.handlers.success = i(this, b),
            g.update(),
            na._recalculateSize = function() {}
            ,
            g.getValue() ? b.call(this) : g.addListener(j, i(this, b)),
            f.addListener("idle", a),
            f.addListener("maptypeid_changed", a)
        },
        initPanels: function() {
            var a = Ua("#bottom-panel")
              , b = new n(a);
            Ua("#bottom-panel .popup-close").click(function() {
                b.setVisible(!1)
            }),
            this.bottomPanel = b;
            var c = new n(Ua("#map"))
              , d = new o(c,b);
            d.addListener(j, i(this, function() {
                var a = this.googleMapViewController.gMap;
                Ta.event.trigger(a, "resize")
            }))
        },
        initTools: function() {
            var a = this.map
              , b = this.googleMapViewController
              , c = b.gMap
              , d = this.auth
              , e = this.mapDiv
              , f = this.stateManager
              , g = this.surveysCtl
              , h = new x(c,f);
            new w(d,a,g,h,e),
            new ca(b),
            new da(g,b);
            var i = wa(d, c, g, h, new $(d,a,this.surveysCtl), new ba(d), new G(null ));
            d.can(Na) && (this.compareTool = new T(d,a,this.baseLayer,g));
            var k = na.appendTool("search", I, function() {
                return new H(d,a,i,Ua(".panel-content"),this._getUserEmailDialogContainer(),new D(d,a),this.stateManager,g)
            }
            .bind(this));
            na.appendDivider();
            var l = new R(this.bottomPanel,d,a,g,i)
              , m = na.appendTool("hidden", "Hidden", function() {
                return ra(d, a, "hidden")
            }
            .bind(this), d, Ha);
            na.appendTool("measureLine", "Line", function() {
                var b = ra(d, a, "line", l);
                return b.foo.addListener(j, function() {
                    l.setFeature(b.foo.selectedFeature)
                }),
                b
            }
            .bind(this), d, Ha);
            var n = na.appendTool("measurePath", "Path", function() {
                var b = ra(d, a, "path", l);
                return b.foo.addListener(j, function() {
                    l.setFeature(b.foo.selectedFeature)
                }),
                b
            }
            .bind(this), d, Ha);
            na.appendTool("measureArea", "Area", function() {
                var b = ra(d, a, "area", l);
                return b.foo.addListener(j, function() {
                    l.setFeature(b.foo.selectedFeature)
                }),
                b
            }
            .bind(this), d, Ha),
            na.appendTool("measureCircle", "Circle", function() {
                return sa(d, c, m)
            }
            .bind(this), d, Ha),
            na.appendDivider(),
            na.appendTool("sitePlanner", W, function() {
                return new V(a,d)
            }
            .bind(this), d, Ia),
            na.appendTool("layersManager", Z, function() {
                this.initLayersPersistenceObjects();
                var b = new Y(d,a,a.getSelection(),this.layersPersistenceManager);
                if (d.can(Ma)) {
                    var c = new aa(Ua("body"),"Drop to import KML...");
                    c.addListener(j, function(a) {
                        na.start("layersManager"),
                        b.importKML(a.properties.file)
                    })
                }
                return b
            }
            .bind(this), d, La),
            na.appendTool("volume", "Volume Tool", function() {
                return new X(d,a,g)
            }
            .bind(this), d, Ga),
            na.appendDivider(),
            na.appendTool("savePhotomaps", "Save Photomaps", function() {
                return d.can(Ka) ? new ua(d,a,g) : va(d, c, g)
            }
            .bind(this), d, Ja),
            na.appendDivider(),
            na.appendTool("partiPropertyInfo", "Property", function() {
                var a = new E(d)
                  , b = new F(d);
                b.setEnabled(!0);
                var e = xa(d, c, a, b);
                return e
            }
            .bind(this), d, Ra),
            na.appendTool("locationMarker", "Location", function() {
                return i
            }
            .bind(this), d, Sa),
            na.appendDivider(),
            na.appendTool("solarPanels", "Solar", function() {
                return new S(d,a,b.getSelection(),g,new _(d),ma,oa)
            }
            .bind(this), d, Pa),
            na.appendDivider(),
            na.appendTool("dataLayers", "Data Layers", function() {
                return new pa({
                    key: "dataLayers",
                    name: "Layers",
                    singularName: "Layer",
                    accessKey: Fa,
                    isMultiSelect: !1,
                    categoryType: "base",
                    showSearch: !0,
                    auth: d,
                    map: a,
                    surveysController: g,
                    surveyInfo: this.surveyInfo
                })
            }
            .bind(this), d, Fa),
            na.appendTool("rail", "Rail", function() {
                return ta(d, c, n)
            }
            .bind(this), d, Oa),
            na.setAuth(d),
            this._initializeTimeLine(d),
            this._initiliazeSearchState(k),
            this._initializeToolSwitcher(),
            k.start()
        },
        _initializeToolSwitcher: function() {
            var a = this.googleMapViewController.getSelection()
              , b = null ;
            a.addListener(j, function() {
                var c = a.getSelectedFeatures()
                  , d = c.pop();
                d && d !== b && (d instanceof J || d instanceof K ? na.start("solarPanels") : d instanceof L ? na.start("volume") : na.start("sitePlanner")),
                b = d || null 
            }
            .bind(this))
        },
        _initializeTimeLine: function(a) {
            if (!a.can(Qa)) {
                var b = new C(this.surveysCtl)
                  , c = new U(this.surveysCtl)
                  , d = Ua("#map-timeline");
                d.append(b.node),
                d.append(c.node),
                this._timelinePlayer = new z(this.surveysCtl),
                Ua(".panel-top").append(this._timelinePlayer.node);
                var e = this.compareTool;
                if (e) {
                    var f = Ua('<div title="Compare two dates" class="compare-btn btn"/>');
                    f.click(function() {
                        e.toggleOnOff()
                    }),
                    Ua(".panel-top").append(f)
                }
            }
        },
        _initiliazeSearchState: function(a) {
            var b = this.startupURL
              , c = b.getValue(Ca);
            if (!l(c)) {
                var d = b.getValue(Da);
                l(d) || a.disableLatestImagery(),
                a.getSearchController().search(c)
            }
        },
        initLegacy: function() {
            ya();
            var a = this.googleMapViewController.gMap;
            oa.init(),
            ma.init(),
            na.init(a, this.surveysCtl),
            la(a);
            var b = new qa(!1,!0,a,this.auth);
            b.initialize(),
            Ua("input").blur()
        },
        _getUserEmailDialogContainer: function() {
            return this._dialogContainer = Ua('<div class="dialogContainer"></div>'),
            this._mapBody = Ua("#map-body"),
            this._mapBody.append(this._dialogContainer),
            this._dialogContainer
        }
    });
    a.init = function() {
        var a = Ua("#map")[0]
          , b = new Va(a);
        b.start()
    }
});
